var SvgCanvas=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t,r){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&s(i,r.prototype),i}).apply(null,arguments)}function u(e){var t="function"==typeof Map?new Map:void 0;return(u=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return o(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s(n,e)})(e)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){d=function(e,t){return new s(e,void 0,t)};var r=u(RegExp),n=RegExp.prototype,a=new WeakMap;function s(e,t,n){var i=r.call(this,e,t);return a.set(i,n||a.get(e)),i}function o(e,t){var r=a.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return i(s,r),s.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=o(t,this)),t},s.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=a.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(o(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},d.apply(this,arguments)}function m(t){var r=t.fn.attr;return t.fn.attr=function(t,n){var i=this.length;if(!i)return r.call(this,t,n);for(var a=0;a<i;++a){var s=this[a];if("http://www.w3.org/2000/svg"!==s.namespaceURI)return r.call(this,t,n);if(void 0!==n)s.setAttribute(t,n);else if(Array.isArray(t)){for(var o={},u=t.length;u--;){var l=t[u],c=s.getAttribute(l);(c||"0"===c)&&(c=isNaN(c)?c:c-0),o[l]=c}return o}if("object"!==e(t)){var d=s.getAttribute(t);return(d||"0"===d)&&(d=isNaN(d)?d:d-0),d}for(var m=0,f=Object.entries(t);m<f.length;m++){var g=h(f[m],2),p=g[0],y=g[1];s.setAttribute(p,y)}}return this},t}!function(){if(!("SVGPathSeg"in window)){var e=function(){function e(r,n,i){t(this,e),this.pathSegType=r,this.pathSegTypeAsLetter=n,this._owningPathSegList=i}return n(e,[{key:"_segmentChanged",value:function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)}}]),e}();e.prototype.classname="SVGPathSeg",e.PATHSEG_UNKNOWN=0,e.PATHSEG_CLOSEPATH=1,e.PATHSEG_MOVETO_ABS=2,e.PATHSEG_MOVETO_REL=3,e.PATHSEG_LINETO_ABS=4,e.PATHSEG_LINETO_REL=5,e.PATHSEG_CURVETO_CUBIC_ABS=6,e.PATHSEG_CURVETO_CUBIC_REL=7,e.PATHSEG_CURVETO_QUADRATIC_ABS=8,e.PATHSEG_CURVETO_QUADRATIC_REL=9,e.PATHSEG_ARC_ABS=10,e.PATHSEG_ARC_REL=11,e.PATHSEG_LINETO_HORIZONTAL_ABS=12,e.PATHSEG_LINETO_HORIZONTAL_REL=13,e.PATHSEG_LINETO_VERTICAL_ABS=14,e.PATHSEG_LINETO_VERTICAL_REL=15,e.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,e.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;var r=function(r){function s(r){return t(this,s),l(this,a(s).call(this,e.PATHSEG_CLOSEPATH,"z",r))}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegClosePath]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter}},{key:"clone",value:function(){return new s(void 0)}}]),s}(e),s=function(r){function s(r,n,i){var o;return t(this,s),(o=l(this,a(s).call(this,e.PATHSEG_MOVETO_ABS,"M",r)))._x=n,o._y=i,o}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegMovetoAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y)}}]),s}(e);Object.defineProperties(s.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}});var o=function(r){function s(r,n,i){var o;return t(this,s),(o=l(this,a(s).call(this,e.PATHSEG_MOVETO_REL,"m",r)))._x=n,o._y=i,o}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegMovetoRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y)}}]),s}(e);Object.defineProperties(o.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}});var u=function(r){function s(r,n,i){var o;return t(this,s),(o=l(this,a(s).call(this,e.PATHSEG_LINETO_ABS,"L",r)))._x=n,o._y=i,o}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegLinetoAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y)}}]),s}(e);Object.defineProperties(u.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}});var h=function(r){function s(r,n,i){var o;return t(this,s),(o=l(this,a(s).call(this,e.PATHSEG_LINETO_REL,"l",r)))._x=n,o._y=i,o}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegLinetoRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y)}}]),s}(e);Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}});var c=function(r){function s(r,n,i,o,u,h,c){var d;return t(this,s),(d=l(this,a(s).call(this,e.PATHSEG_CURVETO_CUBIC_ABS,"C",r)))._x=n,d._y=i,d._x1=o,d._y1=u,d._x2=h,d._y2=c,d}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoCubicAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)}}]),s}(e);Object.defineProperties(c.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0},x2:{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}});var d=function(r){function s(r,n,i,o,u,h,c){var d;return t(this,s),(d=l(this,a(s).call(this,e.PATHSEG_CURVETO_CUBIC_REL,"c",r)))._x=n,d._y=i,d._x1=o,d._y1=u,d._x2=h,d._y2=c,d}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoCubicRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)}}]),s}(e);Object.defineProperties(d.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0},x2:{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}});var m=function(r){function s(r,n,i,o,u){var h;return t(this,s),(h=l(this,a(s).call(this,e.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",r)))._x=n,h._y=i,h._x1=o,h._y1=u,h}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoQuadraticAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._x1,this._y1)}}]),s}(e);Object.defineProperties(m.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0}});var f=function(r){function s(r,n,i,o,u){var h;return t(this,s),(h=l(this,a(s).call(this,e.PATHSEG_CURVETO_QUADRATIC_REL,"q",r)))._x=n,h._y=i,h._x1=o,h._y1=u,h}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoQuadraticRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._x1,this._y1)}}]),s}(e);Object.defineProperties(f.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},x1:{get:function(){return this._x1},set:function(e){this._x1=e,this._segmentChanged()},enumerable:!0},y1:{get:function(){return this._y1},set:function(e){this._y1=e,this._segmentChanged()},enumerable:!0}});var g=function(r){function s(r,n,i,o,u,h,c,d){var m;return t(this,s),(m=l(this,a(s).call(this,e.PATHSEG_ARC_ABS,"A",r)))._x=n,m._y=i,m._r1=o,m._r2=u,m._angle=h,m._largeArcFlag=c,m._sweepFlag=d,m}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegArcAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)}}]),s}(e);Object.defineProperties(g.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},r1:{get:function(){return this._r1},set:function(e){this._r1=e,this._segmentChanged()},enumerable:!0},r2:{get:function(){return this._r2},set:function(e){this._r2=e,this._segmentChanged()},enumerable:!0},angle:{get:function(){return this._angle},set:function(e){this._angle=e,this._segmentChanged()},enumerable:!0},largeArcFlag:{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e,this._segmentChanged()},enumerable:!0},sweepFlag:{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e,this._segmentChanged()},enumerable:!0}});var p=function(r){function s(r,n,i,o,u,h,c,d){var m;return t(this,s),(m=l(this,a(s).call(this,e.PATHSEG_ARC_REL,"a",r)))._x=n,m._y=i,m._r1=o,m._r2=u,m._angle=h,m._largeArcFlag=c,m._sweepFlag=d,m}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegArcRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)}}]),s}(e);Object.defineProperties(p.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},r1:{get:function(){return this._r1},set:function(e){this._r1=e,this._segmentChanged()},enumerable:!0},r2:{get:function(){return this._r2},set:function(e){this._r2=e,this._segmentChanged()},enumerable:!0},angle:{get:function(){return this._angle},set:function(e){this._angle=e,this._segmentChanged()},enumerable:!0},largeArcFlag:{get:function(){return this._largeArcFlag},set:function(e){this._largeArcFlag=e,this._segmentChanged()},enumerable:!0},sweepFlag:{get:function(){return this._sweepFlag},set:function(e){this._sweepFlag=e,this._segmentChanged()},enumerable:!0}});var y=function(r){function s(r,n){var i;return t(this,s),(i=l(this,a(s).call(this,e.PATHSEG_LINETO_HORIZONTAL_ABS,"H",r)))._x=n,i}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegLinetoHorizontalAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x}},{key:"clone",value:function(){return new s(void 0,this._x)}}]),s}(e);Object.defineProperty(y.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0});var v=function(r){function s(r,n){var i;return t(this,s),(i=l(this,a(s).call(this,e.PATHSEG_LINETO_HORIZONTAL_REL,"h",r)))._x=n,i}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegLinetoHorizontalRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x}},{key:"clone",value:function(){return new s(void 0,this._x)}}]),s}(e);Object.defineProperty(v.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0});var x=function(r){function s(r,n){var i;return t(this,s),(i=l(this,a(s).call(this,e.PATHSEG_LINETO_VERTICAL_ABS,"V",r)))._y=n,i}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegLinetoVerticalAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._y)}}]),s}(e);Object.defineProperty(x.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0});var _=function(r){function s(r,n){var i;return t(this,s),(i=l(this,a(s).call(this,e.PATHSEG_LINETO_VERTICAL_REL,"v",r)))._y=n,i}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegLinetoVerticalRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._y)}}]),s}(e);Object.defineProperty(_.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0});var S=function(r){function s(r,n,i,o,u){var h;return t(this,s),(h=l(this,a(s).call(this,e.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",r)))._x=n,h._y=i,h._x2=o,h._y2=u,h}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._x2,this._y2)}}]),s}(e);Object.defineProperties(S.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},x2:{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}});var b=function(r){function s(r,n,i,o,u){var h;return t(this,s),(h=l(this,a(s).call(this,e.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",r)))._x=n,h._y=i,h._x2=o,h._y2=u,h}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y,this._x2,this._y2)}}]),s}(e);Object.defineProperties(b.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0},x2:{get:function(){return this._x2},set:function(e){this._x2=e,this._segmentChanged()},enumerable:!0},y2:{get:function(){return this._y2},set:function(e){this._y2=e,this._segmentChanged()},enumerable:!0}});var w=function(r){function s(r,n,i){var o;return t(this,s),(o=l(this,a(s).call(this,e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",r)))._x=n,o._y=i,o}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y)}}]),s}(e);Object.defineProperties(w.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}});var A=function(r){function s(r,n,i){var o;return t(this,s),(o=l(this,a(s).call(this,e.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",r)))._x=n,o._y=i,o}return i(s,r),n(s,[{key:"toString",value:function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"}},{key:"_asPathString",value:function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y}},{key:"clone",value:function(){return new s(void 0,this._x,this._y)}}]),s}(e);Object.defineProperties(A.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._segmentChanged()},enumerable:!0},y:{get:function(){return this._y},set:function(e){this._y=e,this._segmentChanged()},enumerable:!0}}),SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new r(void 0)},SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(e,t){return new s(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegMovetoRel=function(e,t){return new o(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(e,t){return new u(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegLinetoRel=function(e,t){return new h(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(e,t,r,n,i,a){return new c(void 0,e,t,r,n,i,a)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(e,t,r,n,i,a){return new d(void 0,e,t,r,n,i,a)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(e,t,r,n){return new m(void 0,e,t,r,n)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(e,t,r,n){return new f(void 0,e,t,r,n)},SVGPathElement.prototype.createSVGPathSegArcAbs=function(e,t,r,n,i,a,s){return new g(void 0,e,t,r,n,i,a,s)},SVGPathElement.prototype.createSVGPathSegArcRel=function(e,t,r,n,i,a,s){return new p(void 0,e,t,r,n,i,a,s)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(e){return new y(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(e){return new v(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(e){return new x(void 0,e)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(e){return new _(void 0,e)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(e,t,r,n){return new S(void 0,e,t,r,n)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(e,t,r,n){return new b(void 0,e,t,r,n)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(e,t){return new w(void 0,e,t)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(e,t){return new A(void 0,e,t)},"getPathSegAtLength"in SVGPathElement.prototype||(SVGPathElement.prototype.getPathSegAtLength=function(e){if(void 0===e||!isFinite(e))throw new Error("Invalid arguments.");var t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",this.getAttribute("d"));var r=t.pathSegList.numberOfItems-1;if(r<=0)return 0;do{if(t.pathSegList.removeItem(r),e>t.getTotalLength())break;r--}while(r>0);return r}),window.SVGPathSeg=e,window.SVGPathSegClosePath=r,window.SVGPathSegMovetoAbs=s,window.SVGPathSegMovetoRel=o,window.SVGPathSegLinetoAbs=u,window.SVGPathSegLinetoRel=h,window.SVGPathSegCurvetoCubicAbs=c,window.SVGPathSegCurvetoCubicRel=d,window.SVGPathSegCurvetoQuadraticAbs=m,window.SVGPathSegCurvetoQuadraticRel=f,window.SVGPathSegArcAbs=g,window.SVGPathSegArcRel=p,window.SVGPathSegLinetoHorizontalAbs=y,window.SVGPathSegLinetoHorizontalRel=v,window.SVGPathSegLinetoVerticalAbs=x,window.SVGPathSegLinetoVerticalRel=_,window.SVGPathSegCurvetoCubicSmoothAbs=S,window.SVGPathSegCurvetoCubicSmoothRel=b,window.SVGPathSegCurvetoQuadraticSmoothAbs=w,window.SVGPathSegCurvetoQuadraticSmoothRel=A}if(!("SVGPathSegList"in window&&"appendItem"in window.SVGPathSegList.prototype)){var k=function(){function e(r){t(this,e),this._pathElement=r,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)}return n(e,[{key:"_checkPathSynchronizedToList",value:function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())}},{key:"_updateListFromPathMutations",value:function(e){if(this._pathElement){var t=!1;e.forEach((function(e){"d"===e.attributeName&&(t=!0)})),t&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}}},{key:"_writeListToPath",value:function(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",e._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)}},{key:"segmentChanged",value:function(e){this._writeListToPath()}},{key:"clear",value:function(){this._checkPathSynchronizedToList(),this._list.forEach((function(e){e._owningPathSegList=null})),this._list=[],this._writeListToPath()}},{key:"initialize",value:function(e){return this._checkPathSynchronizedToList(),this._list=[e],e._owningPathSegList=this,this._writeListToPath(),e}},{key:"_checkValidIndex",value:function(e){if(isNaN(e)||e<0||e>=this.numberOfItems)throw new Error("INDEX_SIZE_ERR")}},{key:"getItem",value:function(e){return this._checkPathSynchronizedToList(),this._checkValidIndex(e),this._list[e]}},{key:"insertItemBefore",value:function(e,t){return this._checkPathSynchronizedToList(),t>this.numberOfItems&&(t=this.numberOfItems),e._owningPathSegList&&(e=e.clone()),this._list.splice(t,0,e),e._owningPathSegList=this,this._writeListToPath(),e}},{key:"replaceItem",value:function(e,t){return this._checkPathSynchronizedToList(),e._owningPathSegList&&(e=e.clone()),this._checkValidIndex(t),this._list[t]=e,e._owningPathSegList=this,this._writeListToPath(),e}},{key:"removeItem",value:function(e){this._checkPathSynchronizedToList(),this._checkValidIndex(e);var t=this._list[e];return this._list.splice(e,1),this._writeListToPath(),t}},{key:"appendItem",value:function(e){return this._checkPathSynchronizedToList(),e._owningPathSegList&&(e=e.clone()),this._list.push(e),e._owningPathSegList=this,this._writeListToPath(),e}},{key:"_parsePath",value:function(e){if(!e||!e.length)return[];var r=this,i=function(){function e(){t(this,e),this.pathSegList=[]}return n(e,[{key:"appendSegment",value:function(e){this.pathSegList.push(e)}}]),e}(),a=function(){function e(r){t(this,e),this._string=r,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()}return n(e,[{key:"_isCurrentSpace",value:function(){var e=this._string[this._currentIndex];return e<=" "&&(" "===e||"\n"===e||"\t"===e||"\r"===e||"\f"===e)}},{key:"_skipOptionalSpaces",value:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex}},{key:"_skipOptionalSpacesOrDelimiter",value:function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!==this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)}},{key:"hasMoreData",value:function(){return this._currentIndex<this._endIndex}},{key:"peekSegmentType",value:function(){var e=this._string[this._currentIndex];return this._pathSegTypeFromChar(e)}},{key:"_pathSegTypeFromChar",value:function(e){switch(e){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}}},{key:"_nextCommandHelper",value:function(e,t){return("+"===e||"-"===e||"."===e||e>="0"&&e<="9")&&t!==SVGPathSeg.PATHSEG_CLOSEPATH?t===SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:t===SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:t:SVGPathSeg.PATHSEG_UNKNOWN}},{key:"initialCommandIsMoveTo",value:function(){if(!this.hasMoreData())return!0;var e=this.peekSegmentType();return e===SVGPathSeg.PATHSEG_MOVETO_ABS||e===SVGPathSeg.PATHSEG_MOVETO_REL}},{key:"_parseNumber",value:function(){var e=0,t=0,r=1,n=0,i=1,a=1,s=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"===this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"===this._string.charAt(this._currentIndex)&&(this._currentIndex++,i=-1),!(this._currentIndex===this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!==this._string.charAt(this._currentIndex))){for(var o=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!==o)for(var u=this._currentIndex-1,l=1;u>=o;)t+=l*(this._string.charAt(u--)-"0"),l*=10;if(this._currentIndex<this._endIndex&&"."===this._string.charAt(this._currentIndex)){if(this._currentIndex++,this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)r*=10,n+=(this._string.charAt(this._currentIndex)-"0")/r,this._currentIndex+=1}if(this._currentIndex!==s&&this._currentIndex+1<this._endIndex&&("e"===this._string.charAt(this._currentIndex)||"E"===this._string.charAt(this._currentIndex))&&"x"!==this._string.charAt(this._currentIndex+1)&&"m"!==this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"===this._string.charAt(this._currentIndex)?this._currentIndex++:"-"===this._string.charAt(this._currentIndex)&&(this._currentIndex++,a=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)e*=10,e+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}var h=t+n;if(h*=i,e&&(h*=Math.pow(10,a*e)),s!==this._currentIndex)return this._skipOptionalSpacesOrDelimiter(),h}}},{key:"_parseArcFlag",value:function(){if(!(this._currentIndex>=this._endIndex)){var e=!1,t=this._string.charAt(this._currentIndex++);if("0"===t)e=!1;else{if("1"!==t)return;e=!0}return this._skipOptionalSpacesOrDelimiter(),e}}},{key:"parseSegment",value:function(){var e=this._string[this._currentIndex],t=this._pathSegTypeFromChar(e);if(t===SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand===SVGPathSeg.PATHSEG_UNKNOWN)return null;if((t=this._nextCommandHelper(e,this._previousCommand))===SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=t,t){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(r,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(r,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(r,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(r,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(r,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(r,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(r,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(r,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new SVGPathSegClosePath(r);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(r,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:var i={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(r,i.x,i.y,i.x1,i.y1,i.x2,i.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:var a={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(r,a.x,a.y,a.x2,a.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:var s={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(r,s.x,s.y,s.x2,s.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:var o={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(r,o.x,o.y,o.x1,o.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:var u={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(r,u.x,u.y,u.x1,u.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(r,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(r,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:var l={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(r,l.x,l.y,l.x1,l.y1,l.arcAngle,l.arcLarge,l.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:var h={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(r,h.x,h.y,h.x1,h.y1,h.arcAngle,h.arcLarge,h.arcSweep);default:throw new Error("Unknown path seg type.")}}}]),e}(),s=new i,o=new a(e);if(!o.initialCommandIsMoveTo())return[];for(;o.hasMoreData();){var u=o.parseSegment();if(!u)return[];s.appendSegment(u)}return s.pathSegList}}],[{key:"_pathSegArrayAsString",value:function(e){var t="",r=!0;return e.forEach((function(e){r?(r=!1,t+=e._asPathString()):t+=" "+e._asPathString()})),t}}]),e}();k.prototype.classname="SVGPathSegList",Object.defineProperty(k.prototype,"numberOfItems",{get:function(){return this._checkPathSynchronizedToList(),this._list.length},enumerable:!0}),Object.defineProperties(SVGPathElement.prototype,{pathSegList:{get:function(){return this._pathSegList||(this._pathSegList=new k(this)),this._pathSegList},enumerable:!0},normalizedPathSegList:{get:function(){return this.pathSegList},enumerable:!0},animatedPathSegList:{get:function(){return this.pathSegList},enumerable:!0},animatedNormalizedPathSegList:{get:function(){return this.pathSegList},enumerable:!0}}),window.SVGPathSegList=k}}();var f,g={HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"},p=function(){var e={};return Object.entries(g).forEach((function(t){var r=h(t,2),n=r[0],i=r[1];e[i]=n.toLowerCase()})),e},y=jQuery,v=(Boolean(document.createElementNS&&document.createElementNS(g.SVG,"svg").createSVGRect),navigator.userAgent),x=document.createElementNS(g.SVG,"svg"),_=Boolean(window.opera),S=v.includes("AppleWebKit"),b=v.includes("Gecko/"),w=v.includes("MSIE"),A=v.includes("Chrome/"),k=(v.includes("Windows"),v.includes("Macintosh"),"ontouchstart"in window),C=Boolean(x.querySelector),E=Boolean(document.evaluate),P=function(){var e=document.createElementNS(g.SVG,"path");e.setAttribute("d","M0,0 10,10");var t=e.pathSegList,r=e.createSVGPathSegLinetoAbs(5,5);try{return t.replaceItem(r,1),!0}catch(e){}return!1}(),G=function(){var e=document.createElementNS(g.SVG,"path");e.setAttribute("d","M0,0 10,10");var t=e.pathSegList,r=e.createSVGPathSegLinetoAbs(5,5);try{return t.insertItemBefore(r,1),!0}catch(e){}return!1}(),N=function(){var e=document.createElementNS(g.SVG,"svg"),t=document.createElementNS(g.SVG,"svg");document.documentElement.append(e),t.setAttribute("x",5),e.append(t);var r=document.createElementNS(g.SVG,"text");r.textContent="a",t.append(r);try{return 0===r.getStartPositionOfChar(0).x}catch(e){return!1}finally{e.remove()}}(),I=function(){var e=document.createElementNS(g.SVG,"svg");document.documentElement.append(e);var t=document.createElementNS(g.SVG,"path");t.setAttribute("d","M0,0 C0,0 10,10 10,0"),e.append(t);var r=t.getBBox();return e.remove(),r.height>4&&r.height<5}(),T=function(){var e=document.createElementNS(g.SVG,"svg");document.documentElement.append(e);var t=document.createElementNS(g.SVG,"path");t.setAttribute("d","M0,0 10,0");var r=document.createElementNS(g.SVG,"path");r.setAttribute("d","M5,0 15,0");var n=document.createElementNS(g.SVG,"g");n.append(t,r),e.append(n);var i=n.getBBox();return e.remove(),15===i.width}(),L=(function(){var e=document.createElementNS(g.SVG,"rect");e.setAttribute("x",.1);var t=!e.cloneNode(!1).getAttribute("x").includes(",");t||y.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.')}(),(f=document.createElementNS(g.SVG,"rect")).setAttribute("style","vector-effect:non-scaling-stroke"),"non-scaling-stroke"===f.style.vectorEffect),V=function(){var t=document.createElementNS(g.SVG,"rect").transform.baseVal,r=x.createSVGTransform();t.appendItem(r);var n=t.getItem(0),i=function(t){return t&&"object"===e(t)&&"function"==typeof t.setMatrix&&"angle"in t};return i(n)&&i(r)&&n.type===r.type&&n.angle===r.angle&&n.matrix.a===r.matrix.a&&n.matrix.b===r.matrix.b&&n.matrix.c===r.matrix.c&&n.matrix.d===r.matrix.d&&n.matrix.e===r.matrix.e&&n.matrix.f===r.matrix.f}(),O=function(){return _},M=function(){return S},R=function(){return b},B=function(){return w},F=function(){return A},U=function(){return T},H=function(){return L},j=document.createElementNS(g.SVG,"svg");function D(e){var t=e.matrix,r="";switch(e.type){case 1:r="matrix("+[t.a,t.b,t.c,t.d,t.e,t.f].join(",")+")";break;case 2:r="translate("+t.e+","+t.f+")";break;case 3:r=t.a===t.d?"scale("+t.a+")":"scale("+t.a+","+t.d+")";break;case 4:var n=0,i=0;if(0!==e.angle){var a=1-t.a;i=(a*t.f+t.b*t.e)/(a*a+t.b*t.b),n=(t.e-t.b*i)/a}r="rotate("+e.angle+" "+n+","+i+")"}return r}var z,q={},W=function(){function e(r){t(this,e),this._elem=r||null,this._xforms=[],this._update=function(){for(var e="",t=0;t<this.numberOfItems;++t){e+=D(this._list.getItem(t))+" "}this._elem.setAttribute("transform",e)},this._list=this,this._init=function(){var e=this,t=this._elem.getAttribute("transform");if(t)for(var r=d(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*((?:scale|matrix|rotate|translate)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\(.*?\))[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*/,{xform:1}),n=!0;n;)n=t.match(r),t=t.replace(r,""),n&&n.groups.xform&&function(){var t=h(n.groups.xform.split(/\s*\(/),2),r=t[0],i=t[1].match(d(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*?)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\)/,{nonWhitespace:1}));i.groups.nonWhitespace=i.groups.nonWhitespace.replace(d(/([0-9])\x2D/g,{digit:1}),"$<digit> -");var a=i.groups.nonWhitespace.split(/[, ]+/),s=c("abcdef"),o=j.createSVGMatrix();Object.values(a).forEach((function(e,t){a[t]=parseFloat(e),"matrix"===r&&(o[s[t]]=a[t])}));var u=j.createSVGTransform(),l="set"+r.charAt(0).toUpperCase()+r.slice(1),m="matrix"===r?[o]:a;"scale"===r&&1===m.length?m.push(m[0]):"translate"===r&&1===m.length?m.push(0):"rotate"===r&&1===m.length&&m.push(0,0),u[l].apply(u,c(m)),e._list.appendItem(u)}()},this._removeFromOtherLists=function(e){e&&Object.values(q).some((function(t){for(var r=0,n=t._xforms.length;r<n;++r)if(t._xforms[r]===e)return t.removeItem(r),!0;return!1}))},this.numberOfItems=0}return n(e,[{key:"clear",value:function(){this.numberOfItems=0,this._xforms=[]}},{key:"initialize",value:function(e){this.numberOfItems=1,this._removeFromOtherLists(e),this._xforms=[e]}},{key:"getItem",value:function(e){if(e<this.numberOfItems&&e>=0)return this._xforms[e];var t=new Error("DOMException with code=INDEX_SIZE_ERR");throw t.code=1,t}},{key:"insertItemBefore",value:function(e,t){var r=null;if(t>=0)if(t<this.numberOfItems){this._removeFromOtherLists(e);var n,i=new Array(this.numberOfItems+1);for(n=0;n<t;++n)i[n]=this._xforms[n];i[n]=e;for(var a=n+1;n<this.numberOfItems;++a,++n)i[a]=this._xforms[n];this.numberOfItems++,this._xforms=i,r=e,this._list._update()}else r=this._list.appendItem(e);return r}},{key:"replaceItem",value:function(e,t){var r=null;return t<this.numberOfItems&&t>=0&&(this._removeFromOtherLists(e),this._xforms[t]=e,r=e,this._list._update()),r}},{key:"removeItem",value:function(e){if(e<this.numberOfItems&&e>=0){var t,r=this._xforms[e],n=new Array(this.numberOfItems-1);for(t=0;t<e;++t)n[t]=this._xforms[t];for(var i=t;i<this.numberOfItems-1;++i,++t)n[i]=this._xforms[t+1];return this.numberOfItems--,this._xforms=n,this._list._update(),r}var a=new Error("DOMException with code=INDEX_SIZE_ERR");throw a.code=1,a}},{key:"appendItem",value:function(e){return this._removeFromOtherLists(e),this._xforms.push(e),this.numberOfItems++,this._list._update(),e}}]),e}(),Q=function(e){e.id&&q[e.id]&&delete q[e.id]},Y=function(e){if(!V){var t=e.id||"temp",r=q[t];return r&&"temp"!==t||(q[t]=new W(e),q[t]._init(),r=q[t]),r}return e.transform?e.transform.baseVal:e.gradientTransform?e.gradientTransform.baseVal:e.patternTransform?e.patternTransform.baseVal:null},Z=["x","x1","cx","rx","width"],X=["y","y1","cy","ry","height"],K={},$=function(){return K},J=function e(t){var r=z.getRoundDigits();return isNaN(t)?Array.isArray(t)?e(t[0])+","+e(t[1]):parseFloat(t).toFixed(r)-0:Number(Number(t).toFixed(r))},ee=function(e,t){return t=t||z.getBaseUnit(),J(e/K[t])},te=function(e,t,r){e.setAttribute(t,r)},re=function(e,t){if(!isNaN(t))return t-0;if("%"===t.substr(-1)){var r=t.substr(0,t.length-1)/100,n=z.getWidth(),i=z.getHeight();return Z.includes(e)?r*n:X.includes(e)?r*i:r*Math.sqrt(n*n+i*i)/Math.sqrt(2)}var a=t.substr(-2);return t.substr(0,t.length-2)*K[a]},ne={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"},ie=function(){function e(){t(this,e)}return n(e,[{key:"getText",value:function(){return this.text}}]),e}(),ae=function(e){function r(e,n,i,s){var o;return t(this,r),(o=l(this,a(r).call(this))).elem=e,o.text=s?"Move "+e.tagName+" to "+s:"Move "+e.tagName,o.oldNextSibling=n,o.oldParent=i,o.newNextSibling=e.nextSibling,o.newParent=e.parentNode,o}return i(r,e),n(r,[{key:"type",value:function(){return"svgedit.history.MoveElementCommand"}},{key:"apply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_APPLY,this),this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling),e&&e.handleHistoryEvent(ne.AFTER_APPLY,this)}},{key:"unapply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_UNAPPLY,this),this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling),e&&e.handleHistoryEvent(ne.AFTER_UNAPPLY,this)}},{key:"elements",value:function(){return[this.elem]}}]),r}(ie);ae.type=ae.prototype.type;var se=function(e){function r(e,n){var i;return t(this,r),(i=l(this,a(r).call(this))).elem=e,i.text=n||"Create "+e.tagName,i.parent=e.parentNode,i.nextSibling=i.elem.nextSibling,i}return i(r,e),n(r,[{key:"type",value:function(){return"svgedit.history.InsertElementCommand"}},{key:"apply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_APPLY,this),this.elem=this.parent.insertBefore(this.elem,this.nextSibling),e&&e.handleHistoryEvent(ne.AFTER_APPLY,this)}},{key:"unapply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_UNAPPLY,this),this.parent=this.elem.parentNode,this.elem=this.elem.parentNode.removeChild(this.elem),e&&e.handleHistoryEvent(ne.AFTER_UNAPPLY,this)}},{key:"elements",value:function(){return[this.elem]}}]),r}(ie);se.type=se.prototype.type;var oe=function(e){function r(e,n,i,s){var o;return t(this,r),(o=l(this,a(r).call(this))).elem=e,o.text=s||"Delete "+e.tagName,o.nextSibling=n,o.parent=i,Q(e),o}return i(r,e),n(r,[{key:"type",value:function(){return"svgedit.history.RemoveElementCommand"}},{key:"apply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_APPLY,this),Q(this.elem),this.parent=this.elem.parentNode,this.elem=this.parent.removeChild(this.elem),e&&e.handleHistoryEvent(ne.AFTER_APPLY,this)}},{key:"unapply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_UNAPPLY,this),Q(this.elem),Kt(this.nextSibling)&&window.console&&console.log("Error: reference element was lost"),this.parent.insertBefore(this.elem,this.nextSibling),e&&e.handleHistoryEvent(ne.AFTER_UNAPPLY,this)}},{key:"elements",value:function(){return[this.elem]}}]),r}(ie);oe.type=oe.prototype.type;var ue=function(e){function r(e,n,i){var s;for(var o in t(this,r),(s=l(this,a(r).call(this))).elem=e,s.text=i?"Change "+e.tagName+" "+i:"Change "+e.tagName,s.newValues={},s.oldValues=n,n)s.newValues[o]="#text"===o?e.textContent:"#href"===o?Pt(e):e.getAttribute(o);return s}return i(r,e),n(r,[{key:"type",value:function(){return"svgedit.history.ChangeElementCommand"}},{key:"apply",value:function(e){var t=this;e&&e.handleHistoryEvent(ne.BEFORE_APPLY,this);var r=!1;if(Object.entries(this.newValues).forEach((function(e){var n=h(e,2),i=n[0],a=n[1];a?"#text"===i?t.elem.textContent=a:"#href"===i?Gt(t.elem,a):t.elem.setAttribute(i,a):"#text"===i?t.elem.textContent="":(t.elem.setAttribute(i,""),t.elem.removeAttribute(i)),"transform"===i&&(r=!0)})),!r){var n=zt(this.elem);if(n){var i=this.elem.getBBox(),a=["rotate(",n," ",i.x+i.width/2,",",i.y+i.height/2,")"].join("");a!==this.elem.getAttribute("transform")&&this.elem.setAttribute("transform",a)}}return e&&e.handleHistoryEvent(ne.AFTER_APPLY,this),!0}},{key:"unapply",value:function(e){var t=this;e&&e.handleHistoryEvent(ne.BEFORE_UNAPPLY,this);var r=!1;if(Object.entries(this.oldValues).forEach((function(e){var n=h(e,2),i=n[0],a=n[1];a?"#text"===i?t.elem.textContent=a:"#href"===i?Gt(t.elem,a):t.elem.setAttribute(i,a):"#text"===i?t.elem.textContent="":t.elem.removeAttribute(i),"transform"===i&&(r=!0)})),!r){var n=zt(this.elem);if(n){var i=this.elem.getBBox(),a=["rotate(",n," ",i.x+i.width/2,",",i.y+i.height/2,")"].join("");a!==this.elem.getAttribute("transform")&&this.elem.setAttribute("transform",a)}}return Q(this.elem),e&&e.handleHistoryEvent(ne.AFTER_UNAPPLY,this),!0}},{key:"elements",value:function(){return[this.elem]}}]),r}(ie);ue.type=ue.prototype.type;var le=function(e){function r(e){var n;return t(this,r),(n=l(this,a(r).call(this))).text=e||"Batch Command",n.stack=[],n}return i(r,e),n(r,[{key:"type",value:function(){return"svgedit.history.BatchCommand"}},{key:"apply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_APPLY,this);for(var t=this.stack.length,r=0;r<t;++r)this.stack[r].apply(e);e&&e.handleHistoryEvent(ne.AFTER_APPLY,this)}},{key:"unapply",value:function(e){e&&e.handleHistoryEvent(ne.BEFORE_UNAPPLY,this);for(var t=this.stack.length-1;t>=0;t--)this.stack[t].unapply(e);e&&e.handleHistoryEvent(ne.AFTER_UNAPPLY,this)}},{key:"elements",value:function(){for(var e=[],t=this.stack.length;t--;)for(var r=this.stack[t].elements(),n=r.length;n--;)e.includes(r[n])||e.push(r[n]);return e}},{key:"addSubCommand",value:function(e){this.stack.push(e)}},{key:"isEmpty",value:function(){return!this.stack.length}}]),r}(ie);le.type=le.prototype.type;var he,ce,de,me,fe,ge=function(){function e(r){t(this,e),this.handler_=r||null,this.undoStackPointer=0,this.undoStack=[],this.undoChangeStackPointer=-1,this.undoableChangeStack=[]}return n(e,[{key:"resetUndoStack",value:function(){this.undoStack=[],this.undoStackPointer=0}},{key:"getUndoStackSize",value:function(){return this.undoStackPointer}},{key:"getRedoStackSize",value:function(){return this.undoStack.length-this.undoStackPointer}},{key:"getNextUndoCommandText",value:function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""}},{key:"getNextRedoCommandText",value:function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""}},{key:"undo",value:function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)}},{key:"redo",value:function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)}},{key:"addCommandToHistory",value:function(e){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&(this.undoStack=this.undoStack.splice(0,this.undoStackPointer)),this.undoStack.push(e),this.undoStackPointer=this.undoStack.length}},{key:"beginUndoableChange",value:function(e,t){for(var r=++this.undoChangeStackPointer,n=t.length,i=new Array(n),a=new Array(n);n--;){var s=t[n];Kt(s)||(a[n]=s,i[n]=s.getAttribute(e))}this.undoableChangeStack[r]={attrName:e,oldValues:i,elements:a}}},{key:"finishUndoableChange",value:function(){for(var e=this.undoChangeStackPointer--,t=this.undoableChangeStack[e],r=t.attrName,n=new le("Change "+r),i=t.elements.length;i--;){var a=t.elements[i];if(!Kt(a)){var s={};s[r]=t.oldValues[i],s[r]!==a.getAttribute(r)&&n.addSubCommand(new ue(a,s,r))}}return this.undoableChangeStack[e]=null,n}}]),e}(),pe=Object.freeze({__proto__:null,HistoryEventTypes:ne,MoveElementCommand:ae,InsertElementCommand:se,RemoveElementCommand:oe,ChangeElementCommand:ue,BatchCommand:le,UndoManager:ge}),ye=document.createElementNS(g.SVG,"svg"),ve=function(e,t,r){return{x:r.a*e+r.c*t+r.e,y:r.b*e+r.d*t+r.f}},xe=function(e){return 1===e.a&&0===e.b&&0===e.c&&1===e.d&&0===e.e&&0===e.f},_e=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.reduceRight((function(e,t){return t.multiply(e)}));return Math.abs(n.a)<1e-14&&(n.a=0),Math.abs(n.b)<1e-14&&(n.b=0),Math.abs(n.c)<1e-14&&(n.c=0),Math.abs(n.d)<1e-14&&(n.d=0),Math.abs(n.e)<1e-14&&(n.e=0),Math.abs(n.f)<1e-14&&(n.f=0),n},Se=function(e){if(!e)return!1;for(var t=e.numberOfItems;t--;){var r=e.getItem(t);if(1===r.type&&!xe(r.matrix))return!0}return!1},be=function(e,t,r,n,i){var a=ve(e,t,i),s=ve(e+r,t,i),o=ve(e,t+n,i),u=ve(e+r,t+n,i),l=Math.min(a.x,s.x,o.x,u.x),h=Math.max(a.x,s.x,o.x,u.x),c=Math.min(a.y,s.y,o.y,u.y);return{tl:a,tr:s,bl:o,br:u,aabox:{x:l,y:c,width:h-l,height:Math.max(a.y,s.y,o.y,u.y)-c}}},we=function(e,t,r){if(Kt(e))return ye.createSVGTransformFromMatrix(ye.createSVGMatrix());if(t=t||0,r=r||e.numberOfItems-1,(t=parseInt(t))>(r=parseInt(r))){var n=r;r=t,t=n}for(var i=ye.createSVGMatrix(),a=t;a<=r;++a){var s=a>=0&&a<e.numberOfItems?e.getItem(a).matrix:ye.createSVGMatrix();i=_e(i,s)}return ye.createSVGTransformFromMatrix(i)},Ae=function(e){var t=Y(e);return we(t).matrix},ke=function(e,t,r,n){var i=Math.PI/4,a=r-e,s=n-t,o=Math.atan2(s,a),u=Math.sqrt(a*a+s*s),l=Math.round(o/i)*i;return{x:e+u*Math.cos(l),y:t+u*Math.sin(l),a:l}},Ce=function(e,t){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},Ee=jQuery,Pe={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},Ge={},Ne=function(e){Object.assign(Ge,e.ui)},Ie=[],Te=!0,Le={},Ve=null,Oe=null,Me=function(e){Oe=e,Ie=[0,"ClosePath"];Ee.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],(function(e,t){Ie.push(t+"Abs"),Ie.push(t+"Rel")}))},Re=function(e,t,r){var n=e.pathSegList;if(G)n.insertItemBefore(t,r);else{for(var i=n.numberOfItems,a=[],s=0;s<i;s++){var o=n.getItem(s);a.push(o)}n.clear();for(var u=0;u<i;u++)u===r&&n.appendItem(t),n.appendItem(a[u])}},Be=function(e,t){return Pe[e].map((function(e){return t[e]}))},Fe=function(e,t){var r=e.path,n={x:t?t.x:e.item.x,y:t?t.y:e.item.y};r.matrix&&(n=ve(n.x,n.y,r.matrix));var i=Oe.getCurrentZoom();return n.x*=i,n.y*=i,n},Ue=function(e,t){var r={x:e.x,y:e.y};t.matrix&&(e=ve(r.x,r.y,t.imatrix),r.x=e.x,r.y=e.y);var n=Oe.getCurrentZoom();return r.x/=n,r.y/=n,r},He=function(e,t,r){var n=je(),i=Wt("pathpointgrip_"+e);if(!i){i=document.createElementNS(g.SVG,"circle");var a={id:"pathpointgrip_"+e,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all"};"pathNodeTooltip"in Ge&&(a["xlink:title"]=Ge.pathNodeTooltip),Qt(i,a),i=n.appendChild(i),Ee("#pathpointgrip_"+e).dblclick((function(){Ve&&Ve.setSegType()}))}return t&&r&&Qt(i,{cx:t,cy:r,display:"inline"}),i},je=function(){var e=Wt("pathpointgrip_container");e||((e=Wt("selectorParentGroup").appendChild(document.createElementNS(g.SVG,"g"))).id="pathpointgrip_container");return e},De=function(e){var t=Wt("ctrlpointgrip_"+e);if(t)return t;t=document.createElementNS(g.SVG,"circle");var r={id:"ctrlpointgrip_"+e,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all"};return"pathCtrlPtTooltip"in Ge&&(r["xlink:title"]=Ge.pathCtrlPtTooltip),Qt(t,r),je().append(t),t},ze=function(e){var t=Wt("ctrlLine_"+e);return t||(t=document.createElementNS(g.SVG,"line"),Qt(t,{id:"ctrlLine_"+e,stroke:"#555","stroke-width":1,style:"pointer-events:none"}),je().append(t),t)},qe=function(e){var t=e.item,r=e.index;if(!("x1"in t&&"x2"in t))return null;var n={};je();for(var i=[Ve.segs[r-1].item,t],a=1;a<3;a++){var s=r+"c"+a,o=n["c"+a+"_line"]=ze(s),u=Fe(e,{x:t["x"+a],y:t["y"+a]}),l=Fe(e,{x:i[a-1].x,y:i[a-1].y});Qt(o,{x1:u.x,y1:u.y,x2:l.x,y2:l.y,display:"inline"}),n["c"+a+"_line"]=o;var h=n["c"+a]=De(s);Qt(h,{cx:u.x,cy:u.y,display:"inline"}),n["c"+a]=h}return n},We=function(e,t,r,n){var i=n||Ve.elem,a=i["createSVGPathSeg"+Ie[e]].apply(i,c(r));if(P)i.pathSegList.replaceItem(a,t);else{for(var s=i.pathSegList,o=s.numberOfItems,u=[],l=0;l<o;l++){var h=s.getItem(l);u.push(h)}s.clear();for(var d=0;d<o;d++)d===t?s.appendItem(a):s.appendItem(u[d])}},Qe=function(e,t){var r=e.index,n=Wt("segline_"+r);if(!n){var i=je();n=document.createElementNS(g.SVG,"path"),Qt(n,{id:"segline_"+r,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"}),i.append(n)}if(t){var a=e.prev;if(!a)return n.setAttribute("display","none"),n;var s=Fe(a);We(2,0,[s.x,s.y],n);for(var o=Be(e.type,e.item),u=0;u<o.length;u+=2){var l=Fe(e,{x:o[u],y:o[u+1]});o[u]=l.x,o[u+1]=l.y}We(e.type,1,o,n)}return n},Ye=function(e,t,r){var n=e.x-r.x,i=e.y-r.y,a=t.x-r.x,s=t.y-r.y;if(!(0===n&&0===i||0===a&&0===s)){var o=Math.sqrt(n*n+i*i),u=Math.sqrt(a*a+s*s),l=Oe.getSVGRoot().createSVGPoint(),h=Oe.getSVGRoot().createSVGPoint(),c=Math.atan2(i,n),d=Math.atan2(s,a);c<0&&(c+=2*Math.PI),d<0&&(d+=2*Math.PI);var m,f,g=Math.abs(c-d),p=Math.abs(Math.PI-g)/2;return c-d>0?(m=g<Math.PI?c+p:c-p,f=g<Math.PI?d-p:d+p):(m=g<Math.PI?c-p:c+p,f=g<Math.PI?d+p:d-p),l.x=o*Math.cos(m)+r.x,l.y=o*Math.sin(m)+r.y,h.x=u*Math.cos(f)+r.x,h.y=u*Math.sin(f)+r.y,[l,h]}},Ze=function(){function e(r,n){t(this,e),this.selected=!1,this.index=r,this.item=n,this.type=n.pathSegType,this.ctrlpts=[],this.ptgrip=null,this.segsel=null}return n(e,[{key:"showCtrlPts",value:function(e){for(var t in this.ctrlpts)({}).hasOwnProperty.call(this.ctrlpts,t)&&this.ctrlpts[t].setAttribute("display",e?"inline":"none")}},{key:"selectCtrls",value:function(e){Ee("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",e?"#0FF":"#EEE")}},{key:"show",value:function(e){this.ptgrip&&(this.ptgrip.setAttribute("display",e?"inline":"none"),this.segsel.setAttribute("display",e?"inline":"none"),this.showCtrlPts(e))}},{key:"select",value:function(e){this.ptgrip&&(this.ptgrip.setAttribute("stroke",e?"#0FF":"#00F"),this.segsel.setAttribute("display",e?"inline":"none"),this.ctrlpts&&this.selectCtrls(e),this.selected=e)}},{key:"addGrip",value:function(){this.ptgrip=function(e,t){var r=e.index,n=He(r);if(t){var i=Fe(e);Qt(n,{cx:i.x,cy:i.y,display:"inline"})}return n}(this,!0),this.ctrlpts=qe(this),this.segsel=Qe(this,!0)}},{key:"update",value:function(e){if(this.ptgrip){var t=Fe(this);Qt(this.ptgrip,{cx:t.x,cy:t.y}),Qe(this,!0),this.ctrlpts&&(e&&(this.item=Ve.elem.pathSegList.getItem(this.index),this.type=this.item.pathSegType),qe(this))}}},{key:"move",value:function(e,t){var r=this.item,n=this.ctrlpts?[r.x+=e,r.y+=t,r.x1,r.y1,r.x2+=e,r.y2+=t]:[r.x+=e,r.y+=t];if(We(this.type,this.index,10===this.type?Be(this.type,r):n),this.next&&this.next.ctrlpts){var i=this.next.item,a=[i.x,i.y,i.x1+=e,i.y1+=t,i.x2,i.y2];We(this.next.type,this.next.index,a)}if(this.mate){var s=this.mate.item,o=[s.x+=e,s.y+=t];We(this.mate.type,this.mate.index,o)}this.update(!0),this.next&&this.next.update(!0)}},{key:"setLinked",value:function(e){var t,r,n;if(2===e){if(r=1,!(t=this.next))return;n=this.item}else{if(r=2,!(t=this.prev))return;n=t.item}var i=t.item;i["x"+r]=n.x+(n.x-this.item["x"+e]),i["y"+r]=n.y+(n.y-this.item["y"+e]);var a=[i.x,i.y,i.x1,i.y1,i.x2,i.y2];We(t.type,t.index,a),t.update(!0)}},{key:"moveCtrl",value:function(e,t,r){var n=this.item;n["x"+e]+=t,n["y"+e]+=r;var i=[n.x,n.y,n.x1,n.y1,n.x2,n.y2];We(this.type,this.index,i),this.update(!0)}},{key:"setType",value:function(e,t){We(e,this.index,t),this.type=e,this.item=Ve.elem.pathSegList.getItem(this.index),this.showCtrlPts(6===e),this.ctrlpts=qe(this),this.update(!0)}}]),e}(),Xe=function(){function e(r){if(t(this,e),!r||"path"!==r.tagName)throw new Error("svgedit.path.Path constructed without a <path> element");this.elem=r,this.segs=[],this.selected_pts=[],Ve=this,this.init()}return n(e,[{key:"init",value:function(){Ee(je()).find("*").each((function(){Ee(this).attr("display","none")}));var e=this.elem.pathSegList,t=e.numberOfItems;this.segs=[],this.selected_pts=[],this.first_seg=null;for(var r=0;r<t;r++){var n=e.getItem(r),i=new Ze(r,n);i.path=this,this.segs.push(i)}for(var a=this.segs,s=null,o=0;o<t;o++){var u=a[o],l=o+1>=t?null:a[o+1],h=o-1<0?null:a[o-1];if(2===u.type){if(h&&1!==h.type){var c=a[s];c.next=a[s+1],c.next.prev=c,c.addGrip()}s=o}else if(l&&1===l.type)u.next=a[s+1],u.next.prev=u,u.mate=a[s],u.addGrip(),Kt(this.first_seg)&&(this.first_seg=u);else if(l)1!==u.type&&(u.addGrip(),l&&2!==l.type&&(u.next=l,u.next.prev=u));else if(1!==u.type){var d=a[s];d.next=a[s+1],d.next.prev=d,d.addGrip(),u.addGrip(),this.first_seg||(this.first_seg=a[s])}}return this}},{key:"eachSeg",value:function(e){for(var t=this.segs.length,r=0;r<t;r++){if(!1===e.call(this.segs[r],r))break}}},{key:"addSeg",value:function(e){var t=this.segs[e];if(t.prev){var r,n,i,a=t.prev;switch(t.item.pathSegType){case 4:n=(t.item.x+a.item.x)/2,i=(t.item.y+a.item.y)/2,r=this.elem.createSVGPathSegLinetoAbs(n,i);break;case 6:var s=(a.item.x+t.item.x1)/2,o=(t.item.x1+t.item.x2)/2,u=(t.item.x2+t.item.x)/2,l=(s+o)/2,h=(o+u)/2;n=(l+h)/2;var c=(a.item.y+t.item.y1)/2,d=(t.item.y1+t.item.y2)/2,m=(t.item.y2+t.item.y)/2,f=(c+d)/2,g=(d+m)/2;i=(f+g)/2,r=this.elem.createSVGPathSegCurvetoCubicAbs(n,i,s,c,l,f);var p=[t.item.x,t.item.y,h,g,u,m];We(t.type,e,p)}Re(this.elem,r,e)}}},{key:"deleteSeg",value:function(e){var t=this.segs[e],r=this.elem.pathSegList;t.show(!1);var n=t.next;if(t.mate){var i=[n.item.x,n.item.y];We(2,n.index,i),We(4,t.index,i),r.removeItem(t.mate.index)}else if(t.prev)r.removeItem(e);else{var a=[n.item.x,n.item.y];We(2,t.next.index,a),r.removeItem(e)}}},{key:"removePtFromSelection",value:function(e){var t=this.selected_pts.indexOf(e);-1!==t&&(this.segs[e].select(!1),this.selected_pts.splice(t,1))}},{key:"clearSelection",value:function(){this.eachSeg((function(){this.select(!1)})),this.selected_pts=[]}},{key:"storeD",value:function(){this.last_d=this.elem.getAttribute("d")}},{key:"show",value:function(e){return this.eachSeg((function(){this.show(e)})),e&&this.selectPt(this.first_seg.index),this}},{key:"movePts",value:function(e,t){for(var r=this.selected_pts.length;r--;){this.segs[this.selected_pts[r]].move(e,t)}}},{key:"moveCtrl",value:function(e,t){var r=this.segs[this.selected_pts[0]];r.moveCtrl(this.dragctrl,e,t),Te&&r.setLinked(this.dragctrl)}},{key:"setSegType",value:function(e){this.storeD();for(var t,r=this.selected_pts.length;r--;){var n=this.selected_pts[r],i=this.segs[n],a=i.prev;if(a){if(!e)t="Toggle Path Segment Type",e=6===i.type?4:6;e=Number(e);var s=i.item.x,o=i.item.y,u=a.item.x,l=a.item.y,h=void 0;switch(e){case 6:if(i.olditem){var c=i.olditem;h=[s,o,c.x1,c.y1,c.x2,c.y2]}else{var d=s-u,m=o-l;h=[s,o,u+d/3,l+m/3,s-d/3,o-m/3]}break;case 4:h=[s,o],i.olditem=i.item}i.setType(e,h)}}Ve.endChanges(t)}},{key:"selectPt",value:function(e,t){this.clearSelection(),Kt(e)&&this.eachSeg((function(t){this.prev&&(e=t)})),this.addPtsToSelection(e),t&&(this.dragctrl=t,Te&&this.segs[e].setLinked(t))}},{key:"update",value:function(){var e=this.elem;return zt(e)?(this.matrix=Ae(e),this.imatrix=this.matrix.inverse()):(this.matrix=null,this.imatrix=null),this.eachSeg((function(t){this.item=e.pathSegList.getItem(t),this.update()})),this}},{key:"endChanges",value:function(e){M()&&Oe.resetD(this.elem);var t=new ue(this.elem,{d:this.last_d},e);Oe.endChanges({cmd:t,elem:this.elem})}},{key:"addPtsToSelection",value:function(t){var r=this;Array.isArray(t)||(t=[t]),t.forEach((function(e){r.segs[e].ptgrip&&!r.selected_pts.includes(e)&&e>=0&&r.selected_pts.push(e)})),this.selected_pts.sort();var n=this.selected_pts.length,i=[];for(i.length=n;n--;){var a=this.selected_pts[n],s=this.segs[a];s.select(!0),i[n]=s.ptgrip}var o=e.subpathIsClosed(this.selected_pts[0]);Oe.addPtsToSelection({grips:i,closedSubpath:o})}}],[{key:"subpathIsClosed",value:function(e){var t=!1;return Ve.eachSeg((function(r){return r<=e||2!==this.type&&(1!==this.type||(t=!0,!1))})),t}}]),e}(),Ke=function(e){var t=Le[e.id];return t||(t=Le[e.id]=new Xe(e)),t},$e=function(e){e in Le&&delete Le[e]},Je=function(e,t){var r=e-de,n=t-me,i=Math.sqrt(r*r+n*n),a=Math.atan2(n,r)+fe;return r=i*Math.cos(a)+de,n=i*Math.sin(a)+me,r-=he,n-=ce,i=Math.sqrt(r*r+n*n),a=Math.atan2(n,r)-fe,{x:i*Math.cos(a)+he,y:i*Math.sin(a)+ce}},et=function(){var e=Ve.elem;if(fe=zt(e,!0)){var t=Ve.oldbbox;de=t.x+t.width/2,me=t.y+t.height/2;var r=Lt(e);he=r.x+r.width/2,ce=r.y+r.height/2;var n=he-de,i=ce-me,a=Math.sqrt(n*n+i*i),s=Math.atan2(i,n)+fe;he=a*Math.cos(s)+de,ce=a*Math.sin(s)+me;for(var o=e.pathSegList,u=o.numberOfItems;u;){u-=1;var l=o.getItem(u),h=l.pathSegType;if(1!==h){var c=Je(l.x,l.y),d=[c.x,c.y];if(!Kt(l.x1)&&!Kt(l.x2)){var m=Je(l.x1,l.y1),f=Je(l.x2,l.y2);d.splice(d.length,0,m.x,m.y,f.x,f.y)}We(h,u,d)}}Lt(e);var g=Oe.getSVGRoot().createSVGTransform(),p=Y(e);g.setRotate(180*fe/Math.PI,he,ce),p.replaceItem(g,0)}},tt=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],rt=function(e,t){for(var r=e.pathSegList,n=r.numberOfItems,i=0,a=0,s="",o=null,u=0;u<n;++u){var l=r.getItem(u),h=l.x||0,c=l.y||0,d=l.x1||0,m=l.y1||0,f=l.x2||0,g=l.y2||0,p=l.pathSegType,y=tt[p]["to"+(t?"Lower":"Upper")+"Case"]();switch(p){case 1:s+="z",o&&!t&&(i=o[0],a=o[1]);break;case 12:h-=i;case 13:t?(i+=h,y="l"):(i=h+=i,y="L"),s+=nt(y,[[h,a]]);break;case 14:c-=a;case 15:t?(a+=c,y="l"):(a=c+=a,y="L"),s+=nt(y,[[i,c]]);break;case 2:case 4:case 18:h-=i,c-=a;case 5:case 3:case 19:t?(i+=h,a+=c):(i=h+=i,a=c+=a),2!==p&&3!==p||(o=[i,a]),s+=nt(y,[[h,c]]);break;case 6:h-=i,d-=i,f-=i,c-=a,m-=a,g-=a;case 7:t?(i+=h,a+=c):(d+=i,f+=i,m+=a,g+=a,i=h+=i,a=c+=a),s+=nt(y,[[d,m],[f,g],[h,c]]);break;case 8:h-=i,d-=i,c-=a,m-=a;case 9:t?(i+=h,a+=c):(d+=i,m+=a,i=h+=i,a=c+=a),s+=nt(y,[[d,m],[h,c]]);break;case 10:h-=i,c-=a;case 11:t?(i+=h,a+=c):(i=h+=i,a=c+=a),s+=nt(y,[[l.r1,l.r2]],[l.angle,l.largeArcFlag?1:0,l.sweepFlag?1:0],[h,c]);break;case 16:h-=i,f-=i,c-=a,g-=a;case 17:t?(i+=h,a+=c):(f+=i,g+=a,i=h+=i,a=c+=a),s+=nt(y,[[f,g],[h,c]])}}return s};function nt(e,t,r,n){Ee.each(t,(function(e,r){t[e]=J(r)}));var i=e+t.join(" ");return r&&(i+=" "+r.join(" ")),n&&(i+=" "+J(n)),i}var it,at,st,ot,ut,lt=(st=!1,ot=null,ut=!1,{mouseDown:function(e,t,r,n){var i;if("path"!==Oe.getCurrentMode()){if(Ve){var a;if(Ve.storeD(),"pathpointgrip_"===(i=e.target.id).substr(0,14)){a=Ve.cur_pt=parseInt(i.substr(14)),Ve.dragging=[r,n];var s=Ve.segs[a];e.shiftKey?s.selected?Ve.removePtFromSelection(a):Ve.addPtsToSelection(a):((Ve.selected_pts.length<=1||!s.selected)&&Ve.clearSelection(),Ve.addPtsToSelection(a))}else if(i.startsWith("ctrlpointgrip_")){Ve.dragging=[r,n];var o=i.split("_")[1].split("c");a=Number(o[0]);var u=Number(o[1]);Ve.selectPt(a,u)}if(!Ve.dragging){var l=Oe.getRubberBox();Kt(l)&&(l=Oe.setRubberBox(Oe.selectorManager.getRubberBandBox()));var h=Oe.getCurrentZoom();Qt(l,{x:r*h,y:n*h,width:0,height:0,display:"inline"})}}}else{var c=r,d=n,m=Oe.getCurrentZoom(),f=c/m,p=d/m,y=Wt("path_stretch_line");it=[f,p],Oe.getGridSnapping()&&(f=Zt(f),p=Zt(p),c=Zt(c),d=Zt(d)),y||(y=document.createElementNS(g.SVG,"path"),Qt(y,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"}),y=Wt("selectorParentGroup").appendChild(y)),y.setAttribute("display","inline");var v,x=Oe.getDrawnPath();if(x){for(var _=x.pathSegList,S=_.numberOfItems,b=6/m,w=!1;S;){S--;var A=_.getItem(S),k=A.x,C=A.y;if(f>=k-b&&f<=k+b&&p>=C-b&&p<=C+b){w=!0;break}}i=Oe.getId(),$e(i);var E,P,G=Wt(i),N=_.numberOfItems;if(w){if(S<=1&&N>=2){var I=_.getItem(0).x,T=_.getItem(0).y;E=4===(P=y.pathSegList.getItem(1)).pathSegType?x.createSVGPathSegLinetoAbs(I,T):x.createSVGPathSegCurvetoCubicAbs(I,T,P.x1/m,P.y1/m,I,T);var L=x.createSVGPathSegClosePath();_.appendItem(E),_.appendItem(L)}else if(N<3)return!1;if(Ee(y).remove(),Oe.setDrawnPath(null),Oe.setStarted(!1),st){Ve.matrix&&Oe.remapElement(G,{},Ve.matrix.inverse());var V=G.getAttribute("d"),O=Ee(Ve.elem).attr("d");return Ee(Ve.elem).attr("d",O+V),Ee(G).remove(),Ve.matrix&&et(),Me(),lt.toEditMode(Ve.elem),Ve.selectPt(),!1}}else{if(!Ee.contains(Oe.getContainer(),Oe.getMouseTarget(e)))return!1;var M=x.pathSegList.numberOfItems,R=x.pathSegList.getItem(M-1),B=R.x,F=R.y;if(e.shiftKey){var U=ke(B,F,f,p);f=U.x,p=U.y}E=4===(P=y.pathSegList.getItem(1)).pathSegType?x.createSVGPathSegLinetoAbs(Oe.round(f),Oe.round(p)):x.createSVGPathSegCurvetoCubicAbs(Oe.round(f),Oe.round(p),P.x1/m,P.y1/m,P.x2/m,P.y2/m),x.pathSegList.appendItem(E),f*=m,p*=m,y.setAttribute("d",["M",f,p,f,p].join(" ")),v=M,st&&(v+=Ve.segs.length),He(v,f,p)}}else{var H="M"+f+","+p+" ";Oe.setDrawnPath(Oe.addSVGElementFromJson({element:"path",curStyles:!0,attr:{d:H,id:Oe.getNextId(),opacity:Oe.getOpacity()/2}})),y.setAttribute("d",["M",c,d,c,d].join(" ")),v=st?Ve.segs.length:0,He(v,c,d)}}},mouseMove:function(e,t){var r=Oe.getCurrentZoom();ut=!0;var n=Oe.getDrawnPath();if("path"!==Oe.getCurrentMode())if(Ve.dragging){var i=Ue({x:Ve.dragging[0],y:Ve.dragging[1]},Ve),a=Ue({x:e,y:t},Ve),s=a.x-i.x,o=a.y-i.y;Ve.dragging=[e,t],Ve.dragctrl?Ve.moveCtrl(s,o):Ve.movePts(s,o)}else Ve.selected_pts=[],Ve.eachSeg((function(e){if(this.next||this.prev){var t=Oe.getRubberBox().getBBox(),r=Fe(this),n={x:r.x,y:r.y,width:0,height:0},i=Ce(t,n);this.select(i),i&&Ve.selected_pts.push(this.index)}}));else{if(!n)return;var u=n.pathSegList,l=u.numberOfItems-1;if(it){var h=De("1c1"),c=De("0c2");h.setAttribute("cx",e),h.setAttribute("cy",t),h.setAttribute("display","inline");var d=it[0],m=it[1],f=d+(d-e/r),g=m+(m-t/r);c.setAttribute("cx",f*r),c.setAttribute("cy",g*r),c.setAttribute("display","inline");var p=ze(1);if(Qt(p,{x1:e,y1:t,x2:f*r,y2:g*r,display:"inline"}),0===l)at=[e,t];else{var y=u.getItem(l-1),v=y.x,x=y.y;6===y.pathSegType?(v+=v-y.x2,x+=x-y.y2):at&&(v=at[0]/r,x=at[1]/r),We(6,l,[d,m,v,x,f,g],n)}}else{var _=Wt("path_stretch_line");if(_){var S=u.getItem(l);if(6===S.pathSegType){var b=S.x+(S.x-S.x2),w=S.y+(S.y-S.y2);We(6,1,[e,t,b*r,w*r,e,t],_)}else at?We(6,1,[e,t,at[0],at[1],e,t],_):We(4,1,[e,t],_)}}}},mouseUp:function(e,t,r,n){var i=Oe.getDrawnPath();if("path"===Oe.getCurrentMode())return it=null,i||(t=Wt(Oe.getId()),Oe.setStarted(!1),at=null),{keep:!0,element:t};var a=Oe.getRubberBox();if(Ve.dragging){var s=Ve.cur_pt;Ve.dragging=!1,Ve.dragctrl=!1,Ve.update(),ut&&Ve.endChanges("Move path point(s)"),e.shiftKey||ut||Ve.selectPt(s)}else a&&"none"!==a.getAttribute("display")?(a.setAttribute("display","none"),a.getAttribute("width")<=2&&a.getAttribute("height")<=2&&lt.toSelectMode(e.target)):lt.toSelectMode(e.target);ut=!1},toEditMode:function(e){Ve=Ke(e),Oe.setCurrentMode("pathedit"),Oe.clearSelection(),Ve.show(!0).update(),Ve.oldbbox=Lt(Ve.elem),st=!1},toSelectMode:function(e){var t=e===Ve.elem;Oe.setCurrentMode("select"),Ve.show(!1),ot=!1,Oe.clearSelection(),Ve.matrix&&et(),t&&(Oe.call("selected",[e]),Oe.addToSelection([e],!0))},addSubPath:function(e){e?(Oe.setCurrentMode("path"),st=!0):(lt.clear(!0),lt.toEditMode(Ve.elem))},select:function(e){ot===e?(lt.toEditMode(e),Oe.setCurrentMode("pathedit")):ot=e},reorient:function(){var e=Oe.getSelectedElements()[0];if(e&&0!==zt(e)){var t=new le("Reorient path"),r={d:e.getAttribute("d"),transform:e.getAttribute("transform")};t.addSubCommand(new ue(e,r)),Oe.clearSelection(),this.resetOrientation(e),Oe.addCommandToHistory(t),Ke(e).show(!1).matrix=null,this.clear(),Oe.addToSelection([e],!0),Oe.call("changed",Oe.getSelectedElements())}},clear:function(e){var t=Oe.getDrawnPath();if(ot=null,t){var r=Wt(Oe.getId());Ee(Wt("path_stretch_line")).remove(),Ee(r).remove(),Ee(Wt("pathpointgrip_container")).find("*").attr("display","none"),at=null,Oe.setDrawnPath(null),Oe.setStarted(!1)}else"pathedit"===Oe.getCurrentMode()&&this.toSelectMode();Ve&&Ve.init().show(!1)},resetOrientation:function(e){if(Kt(e)||"path"!==e.nodeName)return!1;var t=Y(e),r=we(t).matrix;t.clear(),e.removeAttribute("transform");for(var n=e.pathSegList,i=n.numberOfItems,a=function(t){var i=n.getItem(t),a=i.pathSegType;if(1===a)return"continue";var s=[];Ee.each(["",1,2],(function(e,t){var n=i["x"+t],a=i["y"+t];if(void 0!==n&&void 0!==a){var o=ve(n,a,r);s.splice(s.length,0,o.x,o.y)}})),We(a,t,s,e)},s=0;s<i;++s)a(s);!function(e,t){for(var r=Lt(e),n=0;n<2;n++){var i=0===n?"fill":"stroke",a=e.getAttribute(i);if(a&&a.startsWith("url(")){var s=qt(a);if("linearGradient"===s.tagName){var o=s.getAttribute("x1")||0,u=s.getAttribute("y1")||0,l=s.getAttribute("x2")||1,h=s.getAttribute("y2")||0;o=r.width*o+r.x,u=r.height*u+r.y,l=r.width*l+r.x,h=r.height*h+r.y;var c=ve(o,u,t),d=ve(l,h,t),m={x1:(c.x-r.x)/r.width,y1:(c.y-r.y)/r.height,x2:(d.x-r.x)/r.width,y2:(d.y-r.y)/r.height},f=s.cloneNode(!0);Ee(f).attr(m),f.id=Oe.getNextId(),Nt().append(f),e.setAttribute(i,"url(#"+f.id+")")}}}}(e,r)},zoomChange:function(){"pathedit"===Oe.getCurrentMode()&&Ve.update()},getNodePoint:function(){var e=Ve.selected_pts.length?Ve.selected_pts[0]:1,t=Ve.segs[e];return{x:t.item.x,y:t.item.y,type:t.type}},linkControlPoints:function(e){Te=e},clonePathNode:function(){Ve.storeD();for(var e=Ve.selected_pts,t=e.length,r=[];t--;){var n=e[t];Ve.addSeg(n),r.push(n+t),r.push(n+t+1)}Ve.init().addPtsToSelection(r),Ve.endChanges("Clone path node(s)")},opencloseSubPath:function(){var e=Ve.selected_pts;if(1===e.length){var t,r,n=Ve.elem,i=n.pathSegList,a=e[0],s=null,o=null;if(Ve.eachSeg((function(e){return 2===this.type&&e<=a&&(o=this.item),e<=a||(2===this.type?(s=e,!1):1!==this.type||(s=!1,!1))})),Kt(s)&&(s=Ve.segs.length-1),!1!==s){var u=n.createSVGPathSegLinetoAbs(o.x,o.y),l=n.createSVGPathSegClosePath();return s===Ve.segs.length-1?(i.appendItem(u),i.appendItem(l)):(Re(n,l,s),Re(n,u,s)),void Ve.init().selectPt(s+1)}if(Ve.segs[a].mate)return i.removeItem(a),i.removeItem(a),void Ve.init().selectPt(a-1);for(var h=0;h<i.numberOfItems;h++){var c=i.getItem(h);if(2===c.pathSegType)t=h;else if(h===a)i.removeItem(t);else if(1===c.pathSegType&&a<h){r=h-1,i.removeItem(h);break}}for(var d=a-t-1;d--;)Re(n,i.getItem(t),r);var m=i.getItem(t);We(2,t,[m.x,m.y]),Ve.init().selectPt(0)}},deletePathNode:function(){if(lt.canDeleteNodes){Ve.storeD();for(var e=Ve.selected_pts,t=e.length;t--;){var r=e[t];Ve.deleteSeg(r)}if(function e(){var t=Ve.elem.pathSegList,r=t.numberOfItems,n=function(e,r){for(;r--;)t.removeItem(e)};if(r<=1)return!0;for(;r--;){var i=t.getItem(r);if(1===i.pathSegType){var a=t.getItem(r-1),s=t.getItem(r-2);if(2===a.pathSegType){n(r-1,2),e();break}if(2===s.pathSegType){n(r-2,3),e();break}}else if(2===i.pathSegType&&r>0){var o=t.getItem(r-1).pathSegType;if(2===o){n(r-1,1),e();break}if(1===o&&t.numberOfItems-1===r){n(r,1),e();break}}}return!1}(),Ve.elem.pathSegList.numberOfItems<=1)return lt.toSelectMode(Ve.elem),void Oe.canvas.deleteSelectedElements();if(Ve.init(),Ve.clearSelection(),window.opera){var n=Ee(Ve.elem);n.attr("d",n.attr("d"))}Ve.endChanges("Delete path node(s)")}},smoothPolylineIntoPath:function(e){var t,r=e.points,n=r.numberOfItems;if(n>=4){var i=r.getItem(0),a=null,s=[];for(s.push(["M",i.x,",",i.y," C"].join("")),t=1;t<=n-4;t+=3){var o=r.getItem(t),u=r.getItem(t+1),l=r.getItem(t+2);if(a){var h=Ye(a,o,i);if(h&&2===h.length){var c=s[s.length-1].split(",");c[2]=h[0].x,c[3]=h[0].y,s[s.length-1]=c.join(","),o=h[1]}}s.push([o.x,o.y,u.x,u.y,l.x,l.y].join(",")),i=l,a=u}for(s.push("L");t<n;){var d=r.getItem(t);s.push([d.x,d.y].join(",")),t++}s=s.join(" "),e=Oe.addSVGElementFromJson({element:"path",curStyles:!0,attr:{id:Oe.getId(),d:s,fill:"none"}})}return e},setSegType:function(e){Ve.setSegType(e)},moveNode:function(e,t){var r=Ve.selected_pts;if(r.length){Ve.storeD();var n=Ve.segs[r[0]],i={x:0,y:0};i[e]=t-n.item[e],n.move(i.x,i.y),Ve.endChanges("Move path point")}},fixEnd:function(e){for(var t,r=e.pathSegList,n=r.numberOfItems,i=0;i<n;++i){var a=r.getItem(i);if(2===a.pathSegType&&(t=a),1===a.pathSegType){var s=r.getItem(i-1);if(s.x!==t.x||s.y!==t.y){var o=e.createSVGPathSegLinetoAbs(t.x,t.y);Re(e,o,i),lt.fixEnd(e);break}}}M()&&Oe.resetD(e)},convertPath:rt}),ht=m(jQuery),ct="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",dt="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),mt=null,ft=null,gt=null,pt=null,yt=function(e){return e.replace(d(/(<!DOCTYPE[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+[0-9A-Z_a-z]*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\[).*(\?\]>)/,{doctypeOpen:1,doctypeClose:2}),"$<doctypeOpen>$<doctypeClose>")},vt=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")};function xt(e){if(e=bt(e),window.btoa)return window.btoa(e);var t=new Array(4*Math.floor((e.length+2)/3)),r=0,n=0;do{var i=e.charCodeAt(r++),a=e.charCodeAt(r++),s=e.charCodeAt(r++),o=i>>2,u=(3&i)<<4|a>>4,l=(15&a)<<2|s>>6,h=63&s;isNaN(a)?(l=64,h=64):isNaN(s)&&(h=64),t[n++]=ct.charAt(o),t[n++]=ct.charAt(u),t[n++]=ct.charAt(l),t[n++]=ct.charAt(h)}while(r<e.length);return t.join("")}function _t(e){if(window.atob)return St(window.atob(e));e=e.replace(/[^A-Za-z0-9+\/=]/g,"");var t="",r=0;do{var n=ct.indexOf(e.charAt(r++)),i=ct.indexOf(e.charAt(r++)),a=ct.indexOf(e.charAt(r++)),s=ct.indexOf(e.charAt(r++)),o=n<<2|i>>4,u=(15&i)<<4|a>>2,l=(3&a)<<6|s;t+=String.fromCharCode(o),64!==a&&(t+=String.fromCharCode(u)),64!==s&&(t+=String.fromCharCode(l))}while(r<e.length);return St(t)}function St(e){return decodeURIComponent(escape(e))}var bt=function(e){return unescape(encodeURIComponent(e))},wt=function(e){if("undefined"==typeof Uint8Array||"undefined"==typeof Blob||"undefined"==typeof URL||!URL.createObjectURL)return"";for(var t=h(e.split(","),2),r=t[0],n=t[1],i=r.match(d(/:(.*?);/,{mime:1})).groups.mime,a=atob(n),s=a.length,o=new Uint8Array(s);s--;)o[s]=a.charCodeAt(s);var u=new Blob([o],{type:i});return URL.createObjectURL(u)},At=function(e){return e&&"undefined"!=typeof URL&&URL.createObjectURL?URL.createObjectURL(e):""},kt=(function(){if("undefined"==typeof Blob)return"";var e=new Blob(["<html><head><title>SVG-edit</title></head><body>&nbsp;</body></html>"],{type:"text/html"});At(e)}(),function(e){var t,r;e.includes("<svg:svg")&&(e=e.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns"));try{(r=window.DOMParser?new DOMParser:new window.ActiveXObject("Microsoft.XMLDOM")).async=!1}catch(e){throw new Error("XML Parser could not be instantiated")}try{t=r.loadXML?!!r.loadXML(e)&&r:r.parseFromString(e,"text/xml")}catch(e){throw new Error("Error parsing XML string")}return t}),Ct=function e(t,r){if(t&&1===t.nodeType){r(t);for(var n=t.childNodes.length;n--;)e(t.childNodes.item(n),r)}},Et=function(e){if(e){if(e.startsWith('url("'))return e.substring(5,e.indexOf('"',6));if(e.startsWith("url('"))return e.substring(5,e.indexOf("'",6));if(e.startsWith("url("))return e.substring(4,e.indexOf(")"))}return null},Pt=function(e){return e.getAttributeNS(g.XLINK,"href")},Gt=function(e,t){e.setAttributeNS(g.XLINK,"xlink:href",t)},Nt=function(){var e=mt.getSVGContent(),t=e.getElementsByTagNameNS(g.SVG,"defs");return t.length>0?t=t[0]:(t=e.ownerDocument.createElementNS(g.SVG,"defs"),e.firstChild?e.insertBefore(t,e.firstChild.nextSibling):e.append(t)),t},It=function(e){for(var t=e.pathSegList,r=t.numberOfItems,n=[[],[]],i=t.getItem(0),a=[i.x,i.y],s=function(e,t,r,n){return function(i){return 1-Math.pow(i,3)*a[e]+3-Math.pow(i,2)*i*t[e]+3*(1-i)*Math.pow(i,2)*r[e]+Math.pow(i,3)*n[e]}},o=0;o<r;o++){var u=t.getItem(o);if(void 0!==u.x)if(n[0].push(a[0]),n[1].push(a[1]),u.x1){for(var l=[u.x1,u.y1],h=[u.x2,u.y2],c=[u.x,u.y],d=0;d<2;d++){var m=s(d,l,h,c),f=6*a[d]-12*l[d]+6*h[d],g=-3*a[d]+9*l[d]-9*h[d]+3*c[d],p=3*l[d]-3*a[d];if(0!==g){var y=Math.pow(f,2)-4*p*g;if(!(y<0)){var v=(-f+Math.sqrt(y))/(2*g);v>0&&v<1&&n[d].push(m(v));var x=(-f-Math.sqrt(y))/(2*g);x>0&&x<1&&n[d].push(m(x))}}else{if(0===f)continue;var _=-p/f;_>0&&_<1&&n[d].push(m(_))}}a=c}else n[0].push(u.x),n[1].push(u.y)}var S=Math.min.apply(null,n[0]),b=Math.max.apply(null,n[0])-S,w=Math.min.apply(null,n[1]);return{x:S,y:w,width:b,height:Math.max.apply(null,n[1])-w}};function Tt(e){if(U())try{return e.getBBox()}catch(e){}var t,r,n=ht.data(e,"ref"),i=null;n?(r=ht(n).children().clone().attr("visibility","hidden"),ht(pt).append(r),i=r.filter("line, path")):i=ht(e).find("line, path");var a=!1;if(i.length)if(i.each((function(){var e=this.getBBox();e.width&&e.height||(a=!0)})),a){var s=n?r:ht(e).children();t=Ut(s)}else t=e.getBBox();else t=e.getBBox();return n&&r.remove(),t}var Lt=function(e){var t=e||mt.geSelectedElements()[0];if(1!==e.nodeType)return null;var r,n=t.nodeName,i=null;switch(n){case"text":""===t.textContent?(t.textContent="a",i=t.getBBox(),t.textContent=""):t.getBBox&&(i=t.getBBox());break;case"path":I?t.getBBox&&(i=t.getBBox()):i=It(t);break;case"g":case"a":i=Tt(t);break;default:if("use"===n&&(i=Tt(t)),"use"===n||"foreignObject"===n&&M()){if(i||(i=t.getBBox()),!M()){var a=i,s=a.x,o=a.y;i={width:a.width,height:a.height,x:s+parseFloat(t.getAttribute("x")||0),y:o+parseFloat(t.getAttribute("y")||0)}}}else if(dt.includes(n))if(t)try{i=t.getBBox()}catch(e){var u=t.getExtentOfChar(0),l=t.getComputedTextLength();i={x:u.x,y:u.y,width:l,height:u.height}}else{var h=ht(t).closest("foreignObject");h.length&&h[0].getBBox&&(i=h[0].getBBox())}}return i&&(i={x:(r=i).x,y:r.y,width:r.width,height:r.height}),i},Vt=function(e){var t="";return ht.each(e,(function(e,r){var n=h(r,2),i=n[0],a=n[1];t+=i;for(var s=0;s<a.length;s+=2)t+=a[s]+","+a[s+1]+" "})),t},Ot=function(e){var t,r,n,i,a=1.81;switch(e.tagName){case"ellipse":case"circle":var s=r=ht(e).attr(["rx","ry","cx","cy"]),o=s.cx,u=s.cy,l=r;n=l.rx,i=l.ry,"circle"===e.tagName&&(n=i=ht(e).attr("r")),t=Vt([["M",[o-n,u]],["C",[o-n,u-i/a,o-n/a,u-i,o,u-i]],["C",[o+n/a,u-i,o+n,u-i/a,o+n,u]],["C",[o+n,u+i/a,o+n/a,u+i,o,u+i]],["C",[o-n/a,u+i,o-n,u+i/a,o-n,u]],["Z",[]]]);break;case"path":t=e.getAttribute("d");break;case"line":t="M"+(r=ht(e).attr(["x1","y1","x2","y2"])).x1+","+r.y1+"L"+r.x2+","+r.y2;break;case"polyline":t="M"+e.getAttribute("points");break;case"polygon":t="M"+e.getAttribute("points")+" Z";break;case"rect":var h=ht(e).attr(["rx","ry"]);n=h.rx,i=h.ry;var c=e.getBBox(),d=c.x,m=c.y,f=c.width,g=c.height;a=4-a,t=Vt(n||i?[["M",[d,m+i]],["C",[d,m+i/a,d+n/a,m,d+n,m]],["L",[d+f-n,m]],["C",[d+f-n/a,m,d+f,m+i/a,d+f,m+i]],["L",[d+f,m+g-i]],["C",[d+f,m+g-i/a,d+f-n/a,m+g,d+f-n,m+g]],["L",[d+n,m+g]],["C",[d+n/a,m+g,d,m+g-i/a,d,m+g-i]],["L",[d,m+i]],["Z",[]]]:[["M",[d,m]],["L",[d+f,m]],["L",[d+f,m+g]],["L",[d,m+g]],["L",[d,m]],["Z",[]]])}return t},Mt=function(e){var t={};return ht.each(["marker-start","marker-end","marker-mid","filter","clip-path"],(function(){var r=e.getAttribute(this);r&&(t[this]=r)})),t},Rt=function(e,t,r){var n=t({element:"path",attr:Mt(e)}),i=e.getAttribute("transform");i&&n.setAttribute("transform",i);var a=e.parentNode;e.nextSibling?e.before(n):a.append(n);var s=Ot(e);s?n.setAttribute("d",s):n.remove(),r.resetOrientation(n);var o=!1;try{o=n.getBBox()}catch(e){}return n.remove(),o};var Bt=function(e,t,r){var n=Lt(e);if(!n)return null;var i=Y(e),a=Dt(i),s=Se(i);if(a||s){var o=!1;if(function(e,t){var r=e%90;return t||!(r>-.001&&r<.001||(r<-89.99||r>89.99))}(a,s)){if(["ellipse","path","line","polyline","polygon"].includes(e.tagName))n=o=Rt(e,t,r);else if("rect"===e.tagName){var u=e.getAttribute("rx"),l=e.getAttribute("ry");(u||l)&&(n=o=Rt(e,t,r))}}if(!o){var h=we(i).matrix;n=be(n.x,n.y,n.width,n.height,h).aabox}}return n};function Ft(e){var t=e.getAttribute("stroke-width");return isNaN(t)||"none"===e.getAttribute("stroke")?0:t/2}var Ut=function(e,t,r){if(!e||!e.length)return!1;var n;if(ht.each(e,(function(){n||this.parentNode&&(n=Bt(this,t,r))})),void 0===n)return null;var i=n.x+n.width,a=n.y+n.height,s=n.x,o=n.y;if(1===e.length){var u=Ft(e[0]);s-=u,o-=u,i+=u,a+=u}else ht.each(e,(function(e,n){var u=Bt(n,t,r);if(u){var l=Ft(n);s=Math.min(s,u.x-l),o=Math.min(o,u.y-l),1===n.nodeType&&(i=Math.max(i,u.x+u.width+l),a=Math.max(a,u.y+u.height+l))}}));return n.x=s,n.y=o,n.width=i-s,n.height=a-o,n},Ht=function(e){e||(e=ht(mt.getSVGContent()).children());var t=[];return ht(e).children().each((function(e,r){r.getBBox&&t.push(r)})),t.reverse()},jt=function(e){return e||(e=Ht()),Ut(e,mt.addSVGElementFromJson,mt.pathActions)},Dt=function(e,t){if(!e)return 0;for(var r=e.numberOfItems,n=0;n<r;++n){var i=e.getItem(n);if(4===i.type)return t?i.angle*Math.PI/180:i.angle}return 0},zt=function(e,t){var r=e||mt.getSelectedElements()[0],n=Y(r);return Dt(n,t)},qt=function(e){return Wt(Et(e).substr(1))},Wt=C?function(e){return pt.querySelector("#"+e)}:E?function(e){return ft.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+e+'"]',gt,(function(){return g.SVG}),9,null).singleNodeValue}:function(e){return ht(pt).find("[id="+e+"]")[0]},Qt=function(e,t,r,n){for(var i=0,a=Object.entries(t);i<a.length;i++){var s=h(a[i],2),o=s[0],u=s[1],l="xml:"===o.substr(0,4)?g.XML:"xlink:"===o.substr(0,6)?g.XLINK:null;l?e.setAttributeNS(l,o,u):n?te(e,o,u):e.setAttribute(o,u)}},Yt=function(e){var t={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};"ellipse"===e.nodeName&&(delete t.rx,delete t.ry),Object.entries(t).forEach((function(t){var r=h(t,2),n=r[0],i=r[1];e.getAttribute(n)===String(i)&&e.removeAttribute(n)}))},Zt=function(e){var t=mt.getBaseUnit(),r=mt.getSnappingStep();return"px"!==t&&(r*=$()[t]),e=Math.round(e/r)*r},Xt=function(e){ht(e).click((function(e){e.preventDefault()}))},Kt=function(e){return null==e},$t=jQuery,Jt=function(){function e(r,n,i){if(t(this,e),this.name_=r,this.group_=i?null:n,i){var a=i.ownerDocument;this.group_=a.createElementNS(g.SVG,"g");var s=a.createElementNS(g.SVG,"title");s.textContent=r,this.group_.append(s),n?$t(n).after(this.group_):i.append(this.group_)}er(this.group_),Ct(this.group_,(function(e){e.setAttribute("style","pointer-events:inherit")})),this.group_.setAttribute("style",i?"pointer-events:all":"pointer-events:none")}return n(e,[{key:"getName",value:function(){return this.name_}},{key:"getGroup",value:function(){return this.group_}},{key:"activate",value:function(){this.group_.setAttribute("style","pointer-events:all")}},{key:"deactivate",value:function(){this.group_.setAttribute("style","pointer-events:none")}},{key:"setVisible",value:function(e){var t=void 0===e||e?"inline":"none";this.group_.getAttribute("display")!==t&&this.group_.setAttribute("display",t)}},{key:"isVisible",value:function(){return"none"!==this.group_.getAttribute("display")}},{key:"getOpacity",value:function(){var e=this.group_.getAttribute("opacity");return Kt(e)?1:parseFloat(e)}},{key:"setOpacity",value:function(e){"number"==typeof e&&e>=0&&e<=1&&this.group_.setAttribute("opacity",e)}},{key:"appendChildren",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;this.group_.append(s)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"getTitleElement",value:function(){for(var e=this.group_.childNodes.length,t=0;t<e;++t){var r=this.group_.childNodes.item(t);if(r&&"title"===r.tagName)return r}return null}},{key:"setName",value:function(e,t){var r=this.name_;e=vt(e);var n=this.getTitleElement();return n?($t(n).empty(),n.textContent=e,this.name_=e,t&&t.changeElement(n,{"#text":r}),this.name_):null}},{key:"removeGroup",value:function(){var e=this.group_.parentNode.removeChild(this.group_);return this.group_=void 0,e}}]),e}();function er(e){var t=e.getAttribute("class");Kt(t)||!t.length?e.setAttribute("class",Jt.CLASS_NAME):Jt.CLASS_REGEX.test(t)||e.setAttribute("class",t+" "+Jt.CLASS_NAME)}Jt.CLASS_NAME="layer",Jt.CLASS_REGEX=new RegExp("(\\s|^)"+Jt.CLASS_NAME+"(\\s|$)");var tr=function(){function e(r){t(this,e),this.undoManager_=r,this.currentBatchCommand_=null,this.batchCommandStack_=[]}return n(e,[{key:"startBatchCommand",value:function(e){return this.undoManager_?(this.currentBatchCommand_=new le(e),this.batchCommandStack_.push(this.currentBatchCommand_),this):this}},{key:"endBatchCommand",value:function(){if(!this.undoManager_)return this;if(this.currentBatchCommand_){var e=this.currentBatchCommand_;this.batchCommandStack_.pop();var t=this.batchCommandStack_.length;this.currentBatchCommand_=t?this.batchCommandStack_[t-1]:null,this.addCommand_(e)}return this}},{key:"moveElement",value:function(e,t,r,n){return this.undoManager_?(this.addCommand_(new ae(e,t,r,n)),this):this}},{key:"insertElement",value:function(e,t){return this.undoManager_?(this.addCommand_(new se(e,t)),this):this}},{key:"removeElement",value:function(e,t,r,n){return this.undoManager_?(this.addCommand_(new oe(e,t,r,n)),this):this}},{key:"changeElement",value:function(e,t,r){return this.undoManager_?(this.addCommand_(new ue(e,t,r)),this):this}},{key:"addCommand_",value:function(e){if(!this.undoManager_)return this;this.currentBatchCommand_?this.currentBatchCommand_.addSubCommand(e):this.undoManager_.addCommandToHistory(e)}}]),e}();tr.NO_HISTORY=new tr;var rr=jQuery,nr="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),ir={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},ar=ir.LET_DOCUMENT_DECIDE,sr=[];function or(e){return e||new tr(lr.undoMgr)}function ur(e){for(var t=1;e.includes("Layer "+t);)t++;return"Layer "+t}var lr,hr=function(){function e(r,n){if(t(this,e),!r||!r.tagName||!r.namespaceURI||"svg"!==r.tagName||r.namespaceURI!==g.SVG)throw new Error("Error: svgedit.draw.Drawing instance initialized without a <svg> element");this.svgElem_=r,this.obj_num=0,this.idPrefix=n||"svg_",this.releasedNums=[],this.all_layers=[],this.layer_map={},this.current_layer=null,this.nonce_="";var i=this.svgElem_.getAttributeNS(g.SE,"nonce");i&&ar!==ir.NEVER_RANDOMIZE?this.nonce_=i:ar===ir.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(100001*Math.random()))}return n(e,[{key:"getElem_",value:function(e){return this.svgElem_.querySelector?this.svgElem_.querySelector("#"+e):rr(this.svgElem_).find("[id="+e+"]")[0]}},{key:"getSvgElem",value:function(){return this.svgElem_}},{key:"getNonce",value:function(){return this.nonce_}},{key:"setNonce",value:function(e){this.svgElem_.setAttributeNS(g.XMLNS,"xmlns:se",g.SE),this.svgElem_.setAttributeNS(g.SE,"se:nonce",e),this.nonce_=e}},{key:"clearNonce",value:function(){this.nonce_=""}},{key:"getId",value:function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num}},{key:"getNextId",value:function(){var e=this.obj_num,t=!1;this.releasedNums.length>0?(this.obj_num=this.releasedNums.pop(),t=!0):this.obj_num++;for(var r=this.getId();this.getElem_(r);)t&&(this.obj_num=e,t=!1),this.obj_num++,r=this.getId();return t&&(this.obj_num=e),r}},{key:"releaseId",value:function(e){var t=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if("string"!=typeof e||!e.startsWith(t))return!1;var r=parseInt(e.substr(t.length));return!("number"!=typeof r||r<=0||this.releasedNums.includes(r))&&(this.releasedNums.push(r),!0)}},{key:"getNumLayers",value:function(){return this.all_layers.length}},{key:"hasLayer",value:function(e){return void 0!==this.layer_map[e]}},{key:"getLayerName",value:function(e){return e>=0&&e<this.getNumLayers()?this.all_layers[e].getName():""}},{key:"getCurrentLayer",value:function(){return this.current_layer?this.current_layer.getGroup():null}},{key:"getLayerByName",value:function(e){var t=this.layer_map[e];return t?t.getGroup():null}},{key:"getCurrentLayerName",value:function(){return this.current_layer?this.current_layer.getName():""}},{key:"setCurrentLayerName",value:function(e,t){var r=null;if(this.current_layer){var n=this.current_layer.getName();(r=this.current_layer.setName(e,t))&&(delete this.layer_map[n],this.layer_map[r]=this.current_layer)}return r}},{key:"setCurrentLayerPosition",value:function(e){var t,r=this.getNumLayers();if(!this.current_layer||e<0||e>=r)return null;for(t=0;t<r&&this.all_layers[t]!==this.current_layer;++t);if(t===r)return null;if(t!==e){var n=this.current_layer.getGroup(),i=n.nextSibling,a=null;return e>t?e<r-1&&(a=this.all_layers[e+1].getGroup()):a=this.all_layers[e].getGroup(),this.svgElem_.insertBefore(n,a),this.identifyLayers(),this.setCurrentLayer(this.getLayerName(e)),{currentGroup:n,oldNextSibling:i}}return null}},{key:"mergeLayer",value:function(e){var t=this.current_layer.getGroup(),r=rr(t).prev()[0];if(r){e.startBatchCommand("Merge Layer");var n=t.nextSibling;for(e.removeElement(t,n,this.svgElem_);t.firstChild;){var i=t.firstChild;if("title"!==i.localName){var a=i.nextSibling;r.append(i),e.moveElement(i,a,t)}else e.removeElement(i,i.nextSibling,t),i.remove()}this.current_layer.removeGroup();var s=this.all_layers.indexOf(this.current_layer);if(s>0){var o=this.current_layer.getName();this.current_layer=this.all_layers[s-1],this.all_layers.splice(s,1),delete this.layer_map[o]}e.endBatchCommand()}}},{key:"mergeAllLayers",value:function(e){for(this.current_layer=this.all_layers[this.all_layers.length-1],e.startBatchCommand("Merge all Layers");this.all_layers.length>1;)this.mergeLayer(e);e.endBatchCommand()}},{key:"setCurrentLayer",value:function(e){var t=this.layer_map[e];return!!t&&(this.current_layer&&this.current_layer.deactivate(),this.current_layer=t,this.current_layer.activate(),!0)}},{key:"deleteCurrentLayer",value:function(){if(this.current_layer&&this.getNumLayers()>1){var e=this.current_layer.removeGroup();return this.identifyLayers(),e}return null}},{key:"identifyLayers",value:function(){this.all_layers=[],this.layer_map={};for(var e,t=this.svgElem_.childNodes.length,r=[],n=[],i=null,a=!1,s=0;s<t;++s){var o=this.svgElem_.childNodes.item(s);if(o&&1===o.nodeType)if("g"===o.tagName){a=!0;var u=rr("title",e=o).text()||(O()&&e.querySelectorAll?rr(e.querySelectorAll("title")).text():"");u?(n.push(u),i=new Jt(u,o),this.all_layers.push(i),this.layer_map[u]=i):r.push(o)}else nr.includes(o.nodeName)&&r.push(o)}r.length>0||!a?((i=new Jt(ur(n),null,this.svgElem_)).appendChildren(r),this.all_layers.push(i),this.layer_map[name]=i):i.activate(),this.current_layer=i}},{key:"createLayer",value:function(e,t){this.current_layer&&this.current_layer.deactivate(),(null==e||""===e||this.layer_map[e])&&(e=ur(Object.keys(this.layer_map)));var r=new Jt(e,null,this.svgElem_);return t&&(t.startBatchCommand("Create Layer"),t.insertElement(r.getGroup()),t.endBatchCommand()),this.all_layers.push(r),this.layer_map[e]=r,this.current_layer=r,r.getGroup()}},{key:"cloneLayer",value:function(e,t){var r=this;if(!this.current_layer)return null;this.current_layer.deactivate(),(null==e||""===e||this.layer_map[e])&&(e=ur(Object.keys(this.layer_map)));var n=this.current_layer.getGroup(),i=new Jt(e,n,this.svgElem_),a=i.getGroup();c(n.childNodes).forEach((function(e){"title"!==e.localName&&a.append(r.copyElem(e))})),t&&(t.startBatchCommand("Duplicate Layer"),t.insertElement(a),t.endBatchCommand());var s=this.all_layers.indexOf(this.current_layer);return s>=0?this.all_layers.splice(s+1,0,i):this.all_layers.push(i),this.layer_map[e]=i,this.current_layer=i,a}},{key:"getLayerVisibility",value:function(e){var t=this.layer_map[e];return!!t&&t.isVisible()}},{key:"setLayerVisibility",value:function(e,t){if("boolean"!=typeof t)return null;var r=this.layer_map[e];return r?(r.setVisible(t),r.getGroup()):null}},{key:"getLayerOpacity",value:function(e){var t=this.layer_map[e];return t?t.getOpacity():null}},{key:"setLayerOpacity",value:function(e,t){if(!("number"!=typeof t||t<0||t>1)){var r=this.layer_map[e];r&&r.setOpacity(t)}}},{key:"copyElem",value:function(e){var t=this;return function e(t,r){var n=document.createElementNS(t.namespaceURI,t.nodeName);if(ht.each(t.attributes,(function(e,t){"-moz-math-font-style"!==t.localName&&n.setAttributeNS(t.namespaceURI,t.nodeName,t.value)})),n.removeAttribute("id"),n.id=r(),M()&&"path"===t.nodeName){var i=rt(t);n.setAttribute("d",i)}if(ht.each(t.childNodes,(function(t,i){switch(i.nodeType){case 1:n.append(e(i,r));break;case 3:n.textContent=i.nodeValue}})),ht(t).data("gsvg"))ht(n).data("gsvg",n.firstChild);else if(ht(t).data("symbol")){var a=ht(t).data("symbol");ht(n).data("ref",a).data("symbol",a)}else"image"===n.tagName&&Xt(n);return n}(e,(function(){return t.getNextId()}))}}]),e}(),cr=function(e,t){(ar=!1===e?ir.NEVER_RANDOMIZE:ir.ALWAYS_RANDOMIZE)!==ir.ALWAYS_RANDOMIZE||t.getNonce()?ar===ir.NEVER_RANDOMIZE&&t.getNonce()&&t.clearNonce():t.setNonce(Math.floor(100001*Math.random()))},dr=function(){wr(),lr.getCurrentDrawing().identifyLayers()},mr=function(e,t){var r=lr.getCurrentDrawing().createLayer(e,or(t));lr.clearSelection(),lr.call("changed",[r])},fr=function(e,t){var r=lr.getCurrentDrawing().cloneLayer(e,or(t));lr.clearSelection(),wr(),lr.call("changed",[r])},gr=function(){var e=lr.getCurrentDrawing().getCurrentLayer(),t=e.nextSibling,r=e.parentNode;if(e=lr.getCurrentDrawing().deleteCurrentLayer()){var n=new le("Delete Layer");return n.addSubCommand(new oe(e,t,r)),lr.addCommandToHistory(n),lr.clearSelection(),lr.call("changed",[r]),!0}return!1},pr=function(e){var t=lr.getCurrentDrawing().setCurrentLayer(vt(e));return t&&lr.clearSelection(),t},yr=function(e){var t=lr.getCurrentDrawing(),r=t.getCurrentLayer();if(r&&t.setCurrentLayerName(e,or()))return lr.call("changed",[r]),!0;return!1},vr=function(e){var t=lr.getCurrentDrawing().setCurrentLayerPosition(e);return!!t&&(lr.addCommandToHistory(new ae(t.currentGroup,t.oldNextSibling,lr.getSVGContent())),!0)},xr=function(e,t){var r=lr.getCurrentDrawing(),n=r.getLayerVisibility(e),i=r.setLayerVisibility(e,t);if(!i)return!1;var a=n?"inline":"none";return lr.addCommandToHistory(new ue(i,{display:a},"Layer Visibility")),i===r.getCurrentLayer()&&(lr.clearSelection(),lr.pathActions.clear()),!0},_r=function(e){var t=lr.getCurrentDrawing().getLayerByName(e);if(!t)return!1;for(var r=new le("Move Elements to Layer"),n=lr.getSelectedElements(),i=n.length;i--;){var a=n[i];if(a){var s=a.nextSibling,o=a.parentNode;t.append(a),r.addSubCommand(new ae(a,s,o))}}return lr.addCommandToHistory(r),!0},Sr=function(e){lr.getCurrentDrawing().mergeLayer(or(e)),lr.clearSelection(),wr(),lr.changeSVGContent()},br=function(e){lr.getCurrentDrawing().mergeAllLayers(or(e)),lr.clearSelection(),wr(),lr.changeSVGContent()},wr=function(){var e=sr.length;if(e){for(var t=0;t<e;t++){var r=sr[t],n=lr.elData(r,"orig_opac");1!==n?r.setAttribute("opacity",n):r.removeAttribute("opacity"),r.setAttribute("style","pointer-events: inherit")}sr=[],lr.clearSelection(!0),lr.call("contextset",null)}lr.setCurrentGroup(null)},Ar=function(e){wr(),"string"==typeof e&&(e=Wt(e)),lr.setCurrentGroup(e),rr(e).parentsUntil("#svgcontent").andSelf().siblings().each((function(){var e=this.getAttribute("opacity")||1;lr.elData(this,"orig_opac",e),this.setAttribute("opacity",.33*e),this.setAttribute("style","pointer-events: none"),sr.push(this)})),lr.clearSelection(),lr.call("contextset",lr.getCurrentGroup())},kr=p(),Cr={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],feMorphology:["class","in","operator","radius"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],switch:["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},Er={};Object.entries(Cr).forEach((function(e){var t=h(e,2),r=t[0],n=t[1],i={};Object.entries(n).forEach((function(e){var t=h(e,2),r=(t[0],t[1]);if(r.includes(":")){var n=r.split(":");i[n[1]]=g[n[0].toUpperCase()]}else i[r]="xmlns"===r?g.XMLNS:null})),Er[r]=i}));var Pr=function e(t){if(3===t.nodeType&&(t.nodeValue=t.nodeValue.replace(/^\s+|\s+$/g,""),t.nodeValue.length||t.remove()),1===t.nodeType){var r=t.ownerDocument,n=t.parentNode;if(r&&n){var i=Cr[t.nodeName],a=Er[t.nodeName];if(void 0!==i){for(var s=[],o=t.attributes.length;o--;){var u=t.attributes.item(o),l=u.nodeName,c=u.localName,m=u.namespaceURI;if({}.hasOwnProperty.call(a,c)&&m===a[c]&&m!==g.XMLNS||m===g.XMLNS&&kr[u.value]||((l.startsWith("se:")||l.startsWith("data-"))&&s.push([l,u.value]),t.removeAttributeNS(m,c)),R())switch(l){case"transform":case"gradientTransform":case"patternTransform":var f=u.value.replace(d(/([0-9])\x2D/g,{digit:1}),"$<digit> -");t.setAttribute(l,f)}if("style"===l){for(var p=u.value.split(";"),y=p.length;y--;){var v=h(p[y].split(":"),2),x=v[0],_=v[1],S=(x||"").trim(),b=(_||"").trim();i.includes(S)&&t.setAttribute(S,b)}t.removeAttribute("style")}}Object.values(s).forEach((function(e){var r=h(e,2),n=r[0],i=r[1];t.setAttributeNS(g.SE,n,i)}));var w=Pt(t);if(w&&["filter","linearGradient","pattern","radialGradient","textPath","use"].includes(t.nodeName)&&"#"!==w[0]&&(Gt(t,""),t.removeAttributeNS(g.XLINK,"href")),"use"===t.nodeName&&!Pt(t))return void t.remove();for(Object.values(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],(function(e){var r=t.getAttribute(e);r&&(r=Et(r))&&"#"!==r[0]&&(t.setAttribute(e,""),t.removeAttribute(e))})),o=t.childNodes.length;o--;)e(t.childNodes.item(o))}else{for(var A=[];t.hasChildNodes();)A.push(n.insertBefore(t.firstChild,t));t.remove();for(var k=A.length;k--;)e(A[k])}}}};function Gr(e,t){["id","class","type"].forEach((function(r){r in t&&(e[r]=t[r])}))}function Nr(e,t){var r,n;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(r=t.global,n=t.returnDefault,!!("svgEditor"in window&&window.svgEditor&&!1===window.svgEditor.modules)){i.next=4;break}return i.abrupt("return",Tr(e,void 0,{returnDefault:n}));case 4:return i.next=6,regeneratorRuntime.awrap(Ir(e));case 6:return i.abrupt("return",window[r]);case 7:case"end":return i.stop()}}))}function Ir(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Array.isArray(e)?Promise.all(e.map((function(e){return Ir(e,t)}))):new Promise((function(r,n){var i=document.createElement("script");function a(){n(new Error("Failed to import: ".concat(e))),o()}function s(){r(),o()}var o=function(){i.removeEventListener("error",a),i.removeEventListener("load",s),i.remove(),i.src=""};i.defer="defer",Gr(i,t),i.addEventListener("error",a),i.addEventListener("load",s),i.src=e,document.head.append(i)}))}function Tr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).returnDefault,n=void 0!==r&&r;return Array.isArray(e)?Promise.all(e.map((function(e){return Tr(e,t)}))):new Promise((function(r,i){var a="$importModule$"+Math.random().toString(32).slice(2),s=document.createElement("script");function o(){i(new Error("Failed to import: ".concat(e))),l()}function u(){r(window[a]),l()}var l=function(){delete window[a],s.removeEventListener("error",o),s.removeEventListener("load",u),s.remove(),URL.revokeObjectURL(s.src),s.src=""};Gr(s,t),s.defer="defer",s.type="module",s.addEventListener("error",o),s.addEventListener("load",u);var h=function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.cloneNode(!1).href}(e),c="import * as m from '".concat(h.replace(/'/g,"\\'"),"'; window.").concat(a," = ").concat(n?"m.default || ":"","m;"),d=new Blob([c],{type:"text/javascript"});s.src=URL.createObjectURL(d),document.head.append(s)}))}var Lr,Vr,Or,Mr,Rr=jQuery,Br=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Fr=null,Ur=function(e,t,r){for(var n=function(e,t){return ve(e,t,r)},i=function(e){return r.a*e},a=function(e){return r.d*e},s=Fr.getGridSnapping()&&"svg"===e.parentNode.parentNode.localName,o=function(){s&&Object.entries(t).forEach((function(e){var r=h(e,2),n=r[0],i=r[1];t[n]=Zt(i)})),Qt(e,t,1e3,!0)},u=Lt(e),l=0;l<2;l++){var c=0===l?"fill":"stroke",d=e.getAttribute(c);if(d&&d.startsWith("url(")&&(r.a<0||r.d<0)){var m=qt(d).cloneNode(!0);if(r.a<0){var f=m.getAttribute("x1"),g=m.getAttribute("x2");m.setAttribute("x1",-(f-1)),m.setAttribute("x2",-(g-1))}if(r.d<0){var p=m.getAttribute("y1"),y=m.getAttribute("y2");m.setAttribute("y1",-(p-1)),m.setAttribute("y2",-(y-1))}m.id=Fr.getDrawing().getNextId(),Nt().append(m),e.setAttribute(c,"url(#"+m.id+")")}}var v=e.tagName;if("g"===v||"text"===v||"tspan"===v||"use"===v)if(1!==r.a||0!==r.b||0!==r.c||1!==r.d||0===r.e&&0===r.f){var x=Y(e),_=Fr.getSVGRoot().createSVGTransform();_.setMatrix(_e(we(x).matrix,r)),x.clear(),x.appendItem(_)}else{var S=we(e).matrix,b=_e(S.inverse(),r,S);t.x=parseFloat(t.x)+b.e,t.y=parseFloat(t.y)+b.f}switch(v){case"foreignObject":case"rect":case"image":if("image"===v&&(r.a<0||r.d<0)){var w=Y(e),A=Fr.getSVGRoot().createSVGTransform();A.setMatrix(_e(we(w).matrix,r)),w.clear(),w.appendItem(A)}else{var k=n(t.x,t.y);t.width=i(t.width),t.height=a(t.height),t.x=k.x+Math.min(0,t.width),t.y=k.y+Math.min(0,t.height),t.width=Math.abs(t.width),t.height=Math.abs(t.height)}o();break;case"ellipse":var C=n(t.cx,t.cy);t.cx=C.x,t.cy=C.y,t.rx=i(t.rx),t.ry=a(t.ry),t.rx=Math.abs(t.rx),t.ry=Math.abs(t.ry),o();break;case"circle":var E=n(t.cx,t.cy);t.cx=E.x,t.cy=E.y;var P=be(u.x,u.y,u.width,u.height,r),G=P.tr.x-P.tl.x,N=P.bl.y-P.tl.y;t.r=Math.min(G/2,N/2),t.r&&(t.r=Math.abs(t.r)),o();break;case"line":var I=n(t.x1,t.y1),T=n(t.x2,t.y2);t.x1=I.x,t.y1=I.y,t.x2=T.x,t.y2=T.y;case"text":case"tspan":case"use":o();break;case"g":var L=Rr(e).data("gsvg");L&&Qt(L,t,1e3,!0);break;case"polyline":case"polygon":for(var V=t.points.length,O=0;O<V;++O){var M=t.points[O],R=n(M.x,M.y),B=R.x,F=R.y;t.points[O].x=B,t.points[O].y=F}for(var U="",H=0;H<V;++H){var j=t.points[H];U+=j.x+","+j.y+" "}e.setAttribute("points",U);break;case"path":var D=e.pathSegList,z=D.numberOfItems;t.d=[];for(var q=0;q<z;++q){var W=D.getItem(q);t.d[q]={type:W.pathSegType,x:W.x,y:W.y,x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,r1:W.r1,r2:W.r2,angle:W.angle,largeArcFlag:W.largeArcFlag,sweepFlag:W.sweepFlag}}z=t.d.length;var Q=t.d[0],Z=n(Q.x,Q.y);t.d[0].x=Z.x,t.d[0].y=Z.y;for(var X=1;X<z;++X){var K=t.d[X];if(K.type%2==0){var $=n(void 0!==K.x?K.x:Z.x,void 0!==K.y?K.y:Z.y),J=n(K.x1,K.y1),ee=n(K.x2,K.y2);K.x=$.x,K.y=$.y,K.x1=J.x,K.y1=J.y,K.x2=ee.x,K.y2=ee.y,K.r1=i(K.r1),K.r2=a(K.r2)}else K.x=i(K.x),K.y=a(K.y),K.x1=i(K.x1),K.y1=a(K.y1),K.x2=i(K.x2),K.y2=a(K.y2),K.r1=i(K.r1),K.r2=a(K.r2)}var te="";z=t.d.length;for(var re=0;re<z;++re){var ne=t.d[re],ie=ne.type;switch(te+=Br[ie],ie){case 13:case 12:te+=ne.x+" ";break;case 15:case 14:te+=ne.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:te+=ne.x+","+ne.y+" ";break;case 7:case 6:te+=ne.x1+","+ne.y1+" "+ne.x2+","+ne.y2+" "+ne.x+","+ne.y+" ";break;case 9:case 8:te+=ne.x1+","+ne.y1+" "+ne.x+","+ne.y+" ";break;case 11:case 10:te+=ne.r1+","+ne.r2+" "+ne.angle+" "+Number(ne.largeArcFlag)+" "+Number(ne.sweepFlag)+" "+ne.x+","+ne.y+" ";break;case 17:case 16:te+=ne.x2+","+ne.y2+" "+ne.x+","+ne.y+" "}}e.setAttribute("d",te)}},Hr=m(jQuery),jr=function(e,t,r){var n=qt(e).firstChild,i=Y(n),a=Lr.getSVGRoot().createSVGTransform();a.setTranslate(t,r),i.appendItem(a),Dr(n)},Dr=function e(t){if(Kt(t))return null;if("svg"===t.nodeName&&navigator.userAgent.includes("Firefox/20"))return null;var r=Lr.getSVGRoot(),n=Y(t);if(n&&n.numberOfItems>0){for(var i=n.numberOfItems,a=i;i--;){var s=n.getItem(i);if(0===s.type)n.removeItem(i);else if(1===s.type){if(xe(s.matrix)){if(1===a)return t.removeAttribute("transform"),null;n.removeItem(i)}}else 4===s.type&&0===s.angle&&n.removeItem(i)}if(1===n.numberOfItems&&zt(t))return null}if(!n||0===n.numberOfItems)return t.setAttribute("transform",""),t.removeAttribute("transform"),null;if(n){for(var o=[],u=n.numberOfItems;u--;){var l=n.getItem(u);1===l.type?o.push([l.matrix,u]):o.length&&(o=[])}if(2===o.length){var h=r.createSVGTransformFromMatrix(_e(o[1][0],o[0][0]));n.removeItem(o[0][1]),n.removeItem(o[1][1]),n.insertItemBefore(h,o[1][1])}if((u=n.numberOfItems)>=2&&1===n.getItem(u-2).type&&2===n.getItem(u-1).type){var c=r.createSVGTransform(),d=_e(n.getItem(u-2).matrix,n.getItem(u-1).matrix);c.setMatrix(d),n.removeItem(u-2),n.removeItem(u-2),n.appendItem(c)}}switch(t.tagName){case"line":case"polyline":case"polygon":case"path":break;default:if(1===n.numberOfItems&&1===n.getItem(0).type||2===n.numberOfItems&&1===n.getItem(0).type&&4===n.getItem(0).type)return null}var m,f,p=Hr(t).data("gsvg"),y=new le("Transform"),v={},x=null,_=[];switch(t.tagName){case"line":_=["x1","y1","x2","y2"];break;case"circle":_=["cx","cy","r"];break;case"ellipse":_=["cx","cy","rx","ry"];break;case"foreignObject":case"rect":case"image":_=["width","height","x","y"];break;case"use":case"text":case"tspan":_=["x","y"];break;case"polygon":case"polyline":(x={}).points=t.getAttribute("points");var S=t.points,b=S.numberOfItems;v.points=new Array(b);for(var w=0;w<b;++w){var A=S.getItem(w);v.points[w]={x:A.x,y:A.y}}break;case"path":(x={}).d=t.getAttribute("d"),v.d=t.getAttribute("d")}if(_.length?(v=Hr(t).attr(_),Hr.each(v,(function(e,t){v[e]=re(e,t)}))):p&&(v={x:Hr(p).attr("x")||0,y:Hr(p).attr("y")||0}),Kt(x)&&(x=Hr.extend(!0,{},v),Hr.each(x,(function(e,t){x[e]=re(e,t)}))),x.transform=Lr.getStartTransform()||"","g"===t.tagName&&!p||"a"===t.tagName){var k=Lt(t);m={x:k.x+k.width/2,y:k.y+k.height/2},f=ve(k.x+k.width/2,k.y+k.height/2,we(n).matrix);var C=zt(t);if(C){var E,P=C*Math.PI/180;E=Math.abs(P)>1e-10?Math.sin(P)/(1-Math.cos(P)):2/P;for(var G=0;G<n.numberOfItems;++G){var N=n.getItem(G);if(4===N.type){var I=N.matrix;m.y=(E*I.e+I.f)/2,m.x=(I.e-E*I.f)/2,n.removeItem(G);break}}}var T,L,V=n.numberOfItems,O=0,R=0,B=0;if(V&&(T=n.getItem(0).matrix),V>=3&&3===n.getItem(V-2).type&&2===n.getItem(V-3).type&&2===n.getItem(V-1).type){B=3;for(var F=n.getItem(V-3).matrix,U=n.getItem(V-2).matrix,H=n.getItem(V-1).matrix,j=t.childNodes,D=j.length;D--;){var z=j.item(D);if(O=0,R=0,1===z.nodeType){var q=Y(z);if(!q)continue;var W=we(q).matrix,Q=zt(z);if(L=Lr.getStartTransform(),Lr.setStartTransform(z.getAttribute("transform")),Q||Se(q)){var Z=r.createSVGTransform();Z.setMatrix(_e(F,U,H,W)),q.clear(),q.appendItem(Z)}else{var X=_e(W.inverse(),H,W),K=r.createSVGMatrix();K.e=-X.e,K.f=-X.f;var $=_e(K.inverse(),W.inverse(),F,U,H,W,X.inverse()),J=r.createSVGTransform(),ee=r.createSVGTransform(),te=r.createSVGTransform();J.setTranslate(X.e,X.f),ee.setScale($.a,$.d),te.setTranslate(K.e,K.f),q.appendItem(te),q.appendItem(ee),q.appendItem(J)}y.addSubCommand(e(z)),Lr.setStartTransform(L)}}n.removeItem(V-1),n.removeItem(V-2),n.removeItem(V-3)}else if(V>=3&&1===n.getItem(V-1).type){B=3;var ne=we(n).matrix,ie=r.createSVGTransform();ie.setMatrix(ne),n.clear(),n.appendItem(ie)}else if((1===V||V>1&&3!==n.getItem(1).type)&&2===n.getItem(0).type){B=2;var ae=we(n).matrix;n.removeItem(0);var se=we(n).matrix.inverse(),oe=_e(se,ae);if(O=oe.e,R=oe.f,0!==O||0!==R){for(var he=t.childNodes,ce=he.length,de=[];ce--;){var me=he.item(ce);if(1===me.nodeType){if(me.getAttribute("clip-path")){var fe=me.getAttribute("clip-path");de.includes(fe)||(jr(fe,O,R),de.push(fe))}L=Lr.getStartTransform(),Lr.setStartTransform(me.getAttribute("transform"));var ge=Y(me);if(ge){var pe=r.createSVGTransform();pe.setTranslate(O,R),ge.numberOfItems?ge.insertItemBefore(pe,0):ge.appendItem(pe),y.addSubCommand(e(me));for(var ye=t.getElementsByTagNameNS(g.SVG,"use"),be="#"+me.id,Ae=ye.length;Ae--;){var ke=ye.item(Ae);if(be===Pt(ke)){var Ce=r.createSVGTransform();Ce.setTranslate(-O,-R),Y(ke).insertItemBefore(Ce,0),y.addSubCommand(e(ke))}}Lr.setStartTransform(L)}}}Lr.setStartTransform(L)}}else{if(1!==V||1!==n.getItem(0).type||C){if(C){var Ee=r.createSVGTransform();Ee.setRotate(C,f.x,f.y),n.numberOfItems?n.insertItemBefore(Ee,0):n.appendItem(Ee)}return 0===n.numberOfItems&&t.removeAttribute("transform"),null}B=1;for(var Pe=n.getItem(0).matrix,Ge=t.childNodes,Ne=Ge.length;Ne--;){var Ie=Ge.item(Ne);if(1===Ie.nodeType){L=Lr.getStartTransform(),Lr.setStartTransform(Ie.getAttribute("transform"));var Te=Y(Ie);if(!Te)continue;var Le=_e(Pe,we(Te).matrix),Ve=r.createSVGTransform();Ve.setMatrix(Le),Te.clear(),Te.appendItem(Ve,0),y.addSubCommand(e(Ie)),Lr.setStartTransform(L);var Oe=Ie.getAttribute("stroke-width");if("none"!==Ie.getAttribute("stroke")&&!isNaN(Oe)){var Me=(Math.abs(Le.a)+Math.abs(Le.d))/2;Ie.setAttribute("stroke-width",Oe*Me)}}}n.clear()}if(2===B){if(C){f={x:m.x+T.e,y:m.y+T.f};var Re=r.createSVGTransform();Re.setRotate(C,f.x,f.y),n.numberOfItems?n.insertItemBefore(Re,0):n.appendItem(Re)}}else if(3===B){var Be=we(n).matrix,Fe=r.createSVGTransform();Fe.setRotate(C,m.x,m.y);var Ue=Fe.matrix,He=r.createSVGTransform();He.setRotate(C,f.x,f.y);var je=He.matrix.inverse(),De=Be.inverse(),ze=_e(De,je,Ue,Be);if(O=ze.e,R=ze.f,0!==O||0!==R)for(var qe=t.childNodes,We=qe.length;We--;){var Qe=qe.item(We);if(1===Qe.nodeType){L=Lr.getStartTransform(),Lr.setStartTransform(Qe.getAttribute("transform"));var Ye=Y(Qe),Ze=r.createSVGTransform();Ze.setTranslate(O,R),Ye.numberOfItems?Ye.insertItemBefore(Ze,0):Ye.appendItem(Ze),y.addSubCommand(e(Qe)),Lr.setStartTransform(L)}}C&&(n.numberOfItems?n.insertItemBefore(He,0):n.appendItem(He))}}else{var Xe,Ke=Lt(t);if(!Ke&&"path"!==t.tagName)return null;var $e=zt(t);if($e){m={x:Ke.x+Ke.width/2,y:Ke.y+Ke.height/2},f=ve(Ke.x+Ke.width/2,Ke.y+Ke.height/2,we(n).matrix);for(var Je=$e*Math.PI/180,et=Math.abs(Je)>1e-10?Math.sin(Je)/(1-Math.cos(Je)):2/Je,tt=0;tt<n.numberOfItems;++tt){var rt=n.getItem(tt);if(4===rt.type){var nt=rt.matrix;m.y=(et*nt.e+nt.f)/2,m.x=(nt.e-et*nt.f)/2,n.removeItem(tt);break}}}var it=0,at=n.numberOfItems;if(!M()){var st=t.getAttribute("fill");if(st&&st.startsWith("url(")){var ot=qt(st),ut="pattern";if(ot.tagName!==ut&&(ut="gradient"),"userSpaceOnUse"===ot.getAttribute(ut+"Units")){Xe=we(n).matrix;var lt=Y(ot),ht=we(lt).matrix,ct="matrix("+[(Xe=_e(Xe,ht)).a,Xe.b,Xe.c,Xe.d,Xe.e,Xe.f].join(",")+")";ot.setAttribute(ut+"Transform",ct)}}}if(at>=3&&3===n.getItem(at-2).type&&2===n.getItem(at-3).type&&2===n.getItem(at-1).type)it=3,Xe=we(n,at-3,at-1).matrix,n.removeItem(at-1),n.removeItem(at-2),n.removeItem(at-3);else if(4===at&&1===n.getItem(at-1).type){it=3,Xe=we(n).matrix;var dt=r.createSVGTransform();dt.setMatrix(Xe),n.clear(),n.appendItem(dt),Xe=r.createSVGMatrix()}else if((1===at||at>1&&3!==n.getItem(1).type)&&2===n.getItem(0).type){it=2;var mt=n.getItem(0).matrix,ft=we(n,1).matrix,gt=ft.inverse();Xe=_e(gt,mt,ft),n.removeItem(0)}else{if(1!==at||1!==n.getItem(0).type||$e){if($e){var pt=r.createSVGTransform();pt.setRotate($e,f.x,f.y),n.numberOfItems?n.insertItemBefore(pt,0):n.appendItem(pt)}return 0===n.numberOfItems&&t.removeAttribute("transform"),null}switch(Xe=we(n).matrix,t.tagName){case"line":v=Hr(t).attr(["x1","y1","x2","y2"]);case"polyline":case"polygon":if(v.points=t.getAttribute("points"),v.points){var yt=t.points,vt=yt.numberOfItems;v.points=new Array(vt);for(var xt=0;xt<vt;++xt){var _t=yt.getItem(xt);v.points[xt]={x:_t.x,y:_t.y}}}case"path":v.d=t.getAttribute("d"),it=1,n.clear()}}if(1!==it&&2!==it&&3!==it||Ur(t,v,Xe),2===it){if($e){Se(n)||(f={x:m.x+Xe.e,y:m.y+Xe.f});var St=r.createSVGTransform();St.setRotate($e,f.x,f.y),n.numberOfItems?n.insertItemBefore(St,0):n.appendItem(St)}if("text"===t.tagName)for(var bt=t.childNodes,wt=bt.length;wt--;){var At=bt.item(wt);if("tspan"===At.tagName){var kt={x:Hr(At).attr("x")||0,y:Hr(At).attr("y")||0};Ur(At,kt,Xe)}}}else if(3===it&&$e){var Ct=we(n).matrix,Et=r.createSVGTransform();Et.setRotate($e,m.x,m.y);var Gt=Et.matrix,Nt=r.createSVGTransform();Nt.setRotate($e,f.x,f.y);var It=Nt.matrix.inverse(),Tt=Ct.inverse(),Vt=_e(Tt,It,Gt,Ct);Ur(t,v,Vt),$e&&(n.numberOfItems?n.insertItemBefore(Nt,0):n.appendItem(Nt))}}return 0===n.numberOfItems&&t.removeAttribute("transform"),y.addSubCommand(new ue(t,x)),y},zr=jQuery,qr=k?10:4,Wr=function(){function e(r,n,i){t(this,e),this.id=r,this.selectedElement=n,this.locked=!0,this.selectorGroup=Vr.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}}),this.selectorRect=this.selectorGroup.appendChild(Vr.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}})),this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.reset(this.selectedElement,i)}return n(e,[{key:"reset",value:function(e,t){this.locked=!0,this.selectedElement=e,this.resize(t),this.selectorGroup.setAttribute("display","inline")}},{key:"showGrips",value:function(t){var r=t?"inline":"none";Mr.selectorGripsGroup.setAttribute("display",r);var n=this.selectedElement;this.hasGrips=t,n&&t&&(this.selectorGroup.append(Mr.selectorGripsGroup),e.updateGripCursors(zt(n)))}},{key:"resize",value:function(e){var t=this.selectorRect,r=Mr,n=r.selectorGrips,i=this.selectedElement,a=i.getAttribute("stroke-width"),s=Vr.getCurrentZoom(),o=1/s;"none"===i.getAttribute("stroke")||isNaN(a)||(o+=a/2);var u=i.tagName;"text"===u&&(o+=2/s);var l=Y(i),c=we(l).matrix;if(c.e*=s,c.f*=s,e||(e=Lt(i)),"g"===u&&!zr.data(i,"gsvg")){var d=Ut([i.childNodes]);d&&(e=d)}var m=e.x,f=e.y,g=e.width,p=e.height;o*=s;var y=be(m*s,f*s,g*s,p*s,c),v=y.aabox,x=v.x-o,_=v.y-o,S=v.width+2*o,b=v.height+2*o,w=x+S/2,A=_+b/2,k=zt(i);if(k){var C=Vr.svgRoot().createSVGTransform();C.setRotate(-k,w,A);var E=C.matrix;y.tl=ve(y.tl.x,y.tl.y,E),y.tr=ve(y.tr.x,y.tr.y,E),y.bl=ve(y.bl.x,y.bl.y,E),y.br=ve(y.br.x,y.br.y,E);var P=y.tl,G=P.x,N=P.y,I=P.x,T=P.y,L=Math.min,V=Math.max;x=G=L(G,L(y.tr.x,L(y.bl.x,y.br.x)))-o,_=N=L(N,L(y.tr.y,L(y.bl.y,y.br.y)))-o,S=(I=V(I,V(y.tr.x,V(y.bl.x,y.br.x)))+o)-G,b=(T=V(T,V(y.tr.y,V(y.bl.y,y.br.y)))+o)-N}var O="M"+x+","+_+" L"+(x+S)+","+_+" "+(x+S)+","+(_+b)+" "+x+","+(_+b)+"z";t.setAttribute("d",O);var M=k?"rotate("+[k,w,A].join(",")+")":"";this.selectorGroup.setAttribute("transform",M),this.gripCoords={nw:[x,_],ne:[x+S,_],sw:[x,_+b],se:[x+S,_+b],n:[x+S/2,_],w:[x,_+b/2],e:[x+S,_+b/2],s:[x+S/2,_+b]},Object.entries(this.gripCoords).forEach((function(e){var t=h(e,2),r=t[0],i=t[1];n[r].setAttribute("cx",i[0]),n[r].setAttribute("cy",i[1])})),r.rotateGripConnector.setAttribute("x1",x+S/2),r.rotateGripConnector.setAttribute("y1",_),r.rotateGripConnector.setAttribute("x2",x+S/2),r.rotateGripConnector.setAttribute("y2",_-5*qr),r.rotateGrip.setAttribute("cx",x+S/2),r.rotateGrip.setAttribute("cy",_-5*qr)}}],[{key:"updateGripCursors",value:function(e){var t=Object.keys(Mr.selectorGrips),r=Math.round(e/45);for(r<0&&(r+=8);r>0;)t.push(t.shift()),r--;Object.values(Mr.selectorGrips).forEach((function(e,r){e.setAttribute("style","cursor:"+t[r]+"-resize")}))}}]),e}(),Qr=function(){function r(){t(this,r),this.selectorParentGroup=null,this.rubberBandBox=null,this.selectors=[],this.selectorMap={},this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.selectorGripsGroup=null,this.rotateGripConnector=null,this.rotateGrip=null,this.initGroup()}return n(r,[{key:"initGroup",value:function(){var e=this;if(this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.remove(),this.selectorParentGroup=Vr.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}}),this.selectorGripsGroup=Vr.createSVGElement({element:"g",attr:{display:"none"}}),this.selectorParentGroup.append(this.selectorGripsGroup),Vr.svgRoot().append(this.selectorParentGroup),this.selectorMap={},this.selectors=[],this.rubberBandBox=null,Object.keys(this.selectorGrips).forEach((function(t){var r=Vr.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+t,fill:"#22C",r:qr,style:"cursor:"+t+"-resize","stroke-width":2,"pointer-events":"all"}});zr.data(r,"dir",t),zr.data(r,"type","resize"),e.selectorGrips[t]=e.selectorGripsGroup.appendChild(r)})),this.rotateGripConnector=this.selectorGripsGroup.appendChild(Vr.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}})),this.rotateGrip=this.selectorGripsGroup.appendChild(Vr.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:qr,stroke:"#22C","stroke-width":2,style:"cursor:url("+Or.imgPath+"rotate.png) 12 12, auto;"}})),zr.data(this.rotateGrip,"type","rotate"),!zr("#canvasBackground").length){var t=h(Or.dimensions,2),r=t[0],n=t[1],i=Vr.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:r,height:n,x:0,y:0,overflow:M()?"none":"visible",style:"pointer-events:none"}}),a=Vr.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});i.append(a),Vr.svgRoot().insertBefore(i,Vr.svgContent())}}},{key:"requestSelector",value:function(t,r){if(Kt(t))return null;var n=this.selectors.length;if("object"===e(this.selectorMap[t.id]))return this.selectorMap[t.id].locked=!0,this.selectorMap[t.id];for(var i=0;i<n;++i)if(this.selectors[i]&&!this.selectors[i].locked)return this.selectors[i].locked=!0,this.selectors[i].reset(t,r),this.selectorMap[t.id]=this.selectors[i],this.selectors[i];return this.selectors[n]=new Wr(n,t,r),this.selectorParentGroup.append(this.selectors[n].selectorGroup),this.selectorMap[t.id]=this.selectors[n],this.selectors[n]}},{key:"releaseSelector",value:function(e){if(!Kt(e)){var t=this.selectors.length,r=this.selectorMap[e.id];r.locked||console.log("WARNING! selector was released but was already unlocked");for(var n=0;n<t;++n)if(this.selectors[n]&&this.selectors[n]===r){delete this.selectorMap[e.id],r.locked=!1,r.selectedElement=null,r.showGrips(!1);try{r.selectorGroup.setAttribute("display","none")}catch(e){}break}}}},{key:"getRubberBandBox",value:function(){return this.rubberBandBox||(this.rubberBandBox=this.selectorParentGroup.appendChild(Vr.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":.15,stroke:"#22C","stroke-width":.5,display:"none",style:"pointer-events:none"}}))),this.rubberBandBox}}]),r}(),Yr=m(jQuery),Zr=ae,Xr=se,Kr=oe,$r=ue,Jr=le,en=ge,tn=ne;window.console||(window.console={},window.console.log=function(e){},window.console.dir=function(e){}),window.opera&&(window.console.log=function(e){window.opera.postError(e)},window.console.dir=function(e){});return function r(n,i){t(this,r);var a={show_outside_canvas:!0,selectNew:!0,dimensions:[640,480]};i&&Yr.extend(a,i);var s=a.dimensions,o=this,u=n.ownerDocument,l=u.importNode(kt('<svg id="svgroot" xmlns="'+g.SVG+'" xlinkns="'+g.XLINK+'" width="'+s[0]+'" height="'+s[1]+'" x="'+s[0]+'" y="'+s[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,!0);n.append(l);var m=u.createElementNS(g.SVG,"svg");(o.clearSvgContentElement=function(){Yr(m).empty(),Yr(m).attr({id:"svgcontent",width:s[0],height:s[1],x:s[0],y:s[1],overflow:a.show_outside_canvas?"visible":"hidden",xmlns:g.SVG,"xmlns:se":g.SE,"xmlns:xlink":g.XLINK}).appendTo(l);var e=u.createComment(" Created with SVG-edit - https://github.com/SVG-Edit/svgedit");m.append(e)})();var f="svg_";o.setIdPrefix=function(e){f=e},o.current_drawing_=new hr(m,f);var y=o.getCurrentDrawing=function(){return o.current_drawing_},v=1,x=null,_={shape:{fill:("none"===a.initFill.color?"":"#")+a.initFill.color,fill_paint:null,fill_opacity:a.initFill.opacity,stroke:"#"+a.initStroke.color,stroke_paint:null,stroke_opacity:a.initStroke.opacity,stroke_width:a.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:a.initOpacity}};_.text=Yr.extend(!0,{},_.shape),Yr.extend(_.text,{fill:"#000000",stroke_width:a.text&&a.text.stroke_width,font_size:a.text&&a.text.font_size,font_family:a.text&&a.text.font_family});var S=_.shape,b=[],w=this.getJsonFromSvgElement=function(e){if(3===e.nodeType)return e.nodeValue;for(var t,r={element:e.tagName,attr:{},children:[]},n=0;t=e.attributes[n];n++)r.attr[t.name]=t.value;for(var i,a=0;i=e.childNodes[a];a++)r.children[a]=w(i);return r},A=this.addSVGElementFromJson=function(e){if("string"==typeof e)return u.createTextNode(e);var t=Wt(e.attr.id),r=y().getCurrentLayer();if(t&&e.element!==t.tagName&&(t.remove(),t=null),!t){var n=e.namespace||g.SVG;t=u.createElementNS(n,e.element),r&&(x||r).append(t)}return e.curStyles&&Qt(t,{fill:S.fill,stroke:S.stroke,"stroke-width":S.stroke_width,"stroke-dasharray":S.stroke_dasharray,"stroke-linejoin":S.stroke_linejoin,"stroke-linecap":S.stroke_linecap,"stroke-opacity":S.stroke_opacity,"fill-opacity":S.fill_opacity,opacity:S.opacity/2,style:"pointer-events:inherit"}),Qt(t,e.attr),Yt(t),e.children&&e.children.forEach((function(e){t.append(A(e))})),t};o.getTransformList=Y,o.matrixMultiply=_e,o.hasMatrixTransform=Se,o.transformListToTransform=we;var k=function(){return a.baseUnit};!function(e){z=e;var t=document.createElementNS(g.SVG,"svg");document.body.append(t);var r=document.createElementNS(g.SVG,"rect");r.setAttribute("width","1em"),r.setAttribute("height","1ex"),r.setAttribute("x","1in"),t.append(r);var n=r.getBBox();t.remove();var i=n.x;K={em:n.width,ex:n.height,in:i,cm:i/2.54,mm:i/25.4,pt:i/72,pc:i/6,px:1,"%":0}}({getBaseUnit:k,getElement:Wt,getHeight:function(){return m.getAttribute("height")/v},getWidth:function(){return m.getAttribute("width")/v},getRoundDigits:function(){return me.round_digits}}),o.convertToNum=re;var C,E=function(){return m},P=this.getSelectedElems=function(){return b},G=lt,I=function(){return l};mt=C={pathActions:G,getSVGContent:E,addSVGElementFromJson:A,getSelectedElements:P,getDOMDocument:function(){return u},getDOMContainer:function(){return n},getSVGRoot:I,getBaseUnit:k,getSnappingStep:function(){return a.snappingStep}},ft=C.getDOMDocument(),gt=C.getDOMContainer(),pt=C.getSVGRoot(),o.findDefs=Nt,o.getUrlFromAttr=Et,o.getHref=Pt,o.setHref=Gt,o.getBBox=Lt,o.getRotationAngle=zt,o.getElem=Wt,o.getRefElem=qt,o.assignAttributes=Qt,this.cleanupElement=Yt;var T=function(){return a.gridSnapping};!function(e){Fr=e}({getDrawing:function(){return y()},getSVGRoot:I,getGridSnapping:T}),this.remapElement=Ur,function(e){Lr=e}({getSVGRoot:I,getStartTransform:function(){return Ie},setStartTransform:function(e){Ie=e}}),this.recalculateDimensions=Dr;var L=p();o.sanitizeSvg=Pr;var V=o.undoMgr=new en({handleHistoryEvent:function(e,t){var r=tn;if(e===r.BEFORE_UNAPPLY||e===r.BEFORE_APPLY)o.clearSelection();else if(e===r.AFTER_APPLY||e===r.AFTER_UNAPPLY){var n=t.elements();o.pathActions.clear(),X("changed",n);var i=t.type(),a=e===r.AFTER_APPLY;if(i===Zr.type())(a?t.newParent:t.oldParent)===m&&dr();else if(i===Xr.type()||i===Kr.type())t.parent===m&&dr(),i===Xr.type()?a&&ce(t.elem):a||ce(t.elem),"use"===t.elem.tagName&&Jt(t.elem);else if(i===$r.type()){"title"===t.elem.tagName&&t.elem.parentNode.parentNode===m&&dr();var s=a?t.newValues:t.oldValues;s.stdDeviation&&o.setBlurOffsets(t.elem.parentNode,s.stdDeviation)}}}}),O=function(e){o.undoMgr.addCommandToHistory(e)},U=this.getZoom=function(){return v},j=this.round=function(e){return parseInt(e*v)/v};!function(e,t){Or=e,Vr=t,Mr=new Qr}(a,{createSVGElement:function(e){return o.addSVGElementFromJson(e)},svgRoot:function(){return l},svgContent:function(){return m},getCurrentZoom:U});var D=this.selectorManager=Mr,Q=o.getNextId=function(){return y().getNextId()},Z=o.getId=function(){return y().getId()},X=function(e,t){if(We[e])return We[e](window,t)},te=this.clearSelection=function(e){b.forEach((function(e){Kt(e)||D.releaseSelector(e)})),b=[],e||X("selected",b)},ne=this.addToSelection=function(e,t){if(e.length){for(var r=0;r<b.length&&!Kt(b[r]);)++r;for(var n=e.length;n--;){var i=e[n];if(i){var a=Lt(i);if(a&&("a"===i.tagName&&1===i.childNodes.length&&(i=i.firstChild),!b.includes(i))){b[r]=i,r++;var s=D.requestSelector(i,a);b.length>1&&s.showGrips(!1)}}}for(X("selected",b),t||1===b.length?D.requestSelector(b[0]).showGrips(!0):D.requestSelector(b[0]).showGrips(!1),b.sort((function(e,t){return e&&t&&e.compareDocumentPosition?3-(6&t.compareDocumentPosition(e)):Kt(e)?1:0}));Kt(b[0]);)b.shift(0)}},ie=function(){return S.opacity},ae=this.getMouseTarget=function(e){if(Kt(e))return null;var t=e.target;if(t.correspondingUseElement&&(t=t.correspondingUseElement),[g.MATH,g.HTML].includes(t.namespaceURI)&&"svgcanvas"!==t.id)for(;"foreignObject"!==t.nodeName;)if(!(t=t.parentNode))return l;var r=y().getCurrentLayer();if([l,n,m,r].includes(t))return l;if(Yr(t).closest("#selectorParentGroup").length)return D.selectorParentGroup;for(;t.parentNode!==(x||r);)t=t.parentNode;return t};o.pathActions=G,Me({selectorManager:D,canvas:o,call:X,resetD:function(e){e.setAttribute("d",G.convertPath(e))},round:j,clearSelection:te,addToSelection:ne,addCommandToHistory:O,remapElement:Ur,addSVGElementFromJson:A,getGridSnapping:T,getOpacity:ie,getSelectedElements:P,getContainer:function(){return n},setStarted:function(e){Ge=e},getRubberBox:function(){return Fe},setRubberBox:function(e){return Fe=e},addPtsToSelection:function(e){var t=e.closedSubpath,r=e.grips;G.canDeleteNodes=!0,G.closed_subpath=t,X("pointsAdded",{closedSubpath:t,grips:r}),X("selected",r)},endChanges:function(e){var t=e.cmd,r=e.elem;O(t),X("changed",[r])},getCurrentZoom:U,getId:Z,getNextId:Q,getMouseTarget:ae,getCurrentMode:function(){return Te},setCurrentMode:function(e){return Te=e},getDrawnPath:function(){return Vt},setDrawnPath:function(e){return Vt=e},getSVGRoot:I});var se={},oe="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use",ue=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],le=Yr.data,he=document.createElementNS(g.SVG,"animate");Yr(he).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(l);var ce=function e(t){var r=Yr(t).attr(ue);Object.values(r).forEach((function(e){if(e&&e.startsWith("url(")){var t=Et(e).substr(1);Wt(t)||(Nt().append(Ee[t]),delete Ee[t])}}));var n=t.getElementsByTagName("*");if(n.length)for(var i=0,a=n.length;i<a;i++)e(n[i])},de={},me={round_digits:5},fe={},ge=_.text,ye={},Ee={},Pe=a.imgPath+"logo.png",Ge=!1,Ie=null,Te="select",Oe="none",Re=S,Be=null,Fe=null,Ue=[],He=null;this.runExtension=function(e,t,r){return this.runExtensions(t,r,!1,(function(t){return t===e}))};var je=this.runExtensions=function(e,t,r,n){var i=!!r&&[];return Yr.each(ye,(function(a,s){n&&!n(a)||s&&e in s&&("function"==typeof t&&(t=t(a)),r?i.push(s[e](t)):i=s[e](t))})),i};this.addExtension=function(e,t,r){var n,i,a,s;return regeneratorRuntime.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(n=r.$,i=r.importLocale,"function"==typeof t){u.next=3;break}throw new TypeError("Function argument expected for `svgcanvas.addExtension`");case 3:if(!(e in ye)){u.next=5;break}throw new Error('Cannot add extension "'+e+'", an extension by that name already exists.');case 5:return a=Yr.extend(o.getPrivateMethods(),{$:n,importLocale:i,svgroot:l,svgcontent:m,nonce:y().getNonce(),selectorManager:D}),u.next=8,regeneratorRuntime.awrap(t(a));case 8:return(s=u.sent)&&(s.name=e),ye[e]=s,u.abrupt("return",X("extension_added",s));case 12:case"end":return u.stop()}}))};var De=this.getIntersectionList=function(e){if(Kt(Fe))return null;var t,r=x||y().getCurrentLayer();if(e)(t=m.createSVGRect()).x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else{t=Fe.getBBox();var n=m.createSVGRect();["x","y","width","height","top","right","bottom","left"].forEach((function(e){n[e]=t[e]/v})),t=n}var i=null;if(B()||"function"==typeof l.getIntersectionList&&(t.x+=parseInt(m.getAttribute("x")),t.y+=parseInt(m.getAttribute("y")),i=l.getIntersectionList(t,r)),Kt(i)||"function"!=typeof i.item){i=[],Ue.length||(Ue=ze(r));for(var a=Ue.length;a--;)t.width&&Ce(t,Ue[a].bbox)&&i.push(Ue[a].elem)}return i};this.getStrokedBBox=jt,this.getVisibleElements=Ht;var ze=this.getVisibleElementsAndBBoxes=function(e){e||(e=Yr(m).children());var t=[];return Yr(e).children().each((function(e,r){r.getBBox&&t.push({elem:r,bbox:jt([r])})})),t.reverse()},qe=this.groupSvgElem=function(e){var t=document.createElementNS(g.SVG,"g");e.replaceWith(t),Yr(t).append(e).data("gsvg",e)[0].id=Q()},We={};o.call=X,o.bind=function(e,t){var r=We[e];return We[e]=t,r},this.prepareSvg=function(e){this.sanitizeSvg(e.documentElement),c(e.getElementsByTagNameNS(g.SVG,"path")).forEach((function(e){e.setAttribute("d",G.convertPath(e)),G.fixEnd(e)}))};var Qe=function(e){if(!R())return e;var t=e.cloneNode(!0);return e.before(t),e.remove(),D.releaseSelector(e),b[0]=t,D.requestSelector(t).showGrips(!0),t};this.setRotationAngle=function(e,t){e=parseFloat(e);var r=b[0],n=r.getAttribute("transform"),i=Lt(r),a=i.x+i.width/2,s=i.y+i.height/2,o=Y(r);o.numberOfItems>0&&(4===o.getItem(0).type&&o.removeItem(0));if(0!==e){var u=ve(a,s,we(o).matrix),h=l.createSVGTransform();h.setRotate(e,u.x,u.y),o.numberOfItems?o.insertItemBefore(h,0):o.appendItem(h)}else 0===o.numberOfItems&&r.removeAttribute("transform");if(!t){var c=r.getAttribute("transform");r.setAttribute("transform",n),ur("transform",c,b),X("changed",b)}D.requestSelector(b[0]).resize(),Wr.updateGripCursors(e)};var Ye=this.recalculateAllSelectedDimensions=function(){for(var e=new Jr("none"===Oe?"position":"size"),t=b.length;t--;){var r=b[t],n=Dr(r);n&&e.addSubCommand(n)}e.isEmpty()||(O(e),X("changed",b))},Ze=function(e){console.log([e.a,e.b,e.c,e.d,e.e,e.f])},Xe=null,Ke=this.selectOnly=function(e,t){te(!0),ne(e,t)};this.removeFromSelection=function(e){if(!Kt(b[0])&&e.length){for(var t=[],r=b.length,n=0;n<r;++n){var i=b[n];i&&(e.includes(i)?D.releaseSelector(i):t.push(i))}b=t}},this.selectAllInCurrentLayer=function(){var e=y().getCurrentLayer();e&&(Te="select",Ke(Yr(x||e).children()))};var Je,et,tt,rt,nt,it,at,st,ot,ut,ct,dt,St,bt,Tt,Vt=null;et={minx:null,miny:null,maxx:null,maxy:null},tt=null,rt=null,nt=null,it=null,at={},st=0,ot={x:0,y:0},ut={x:0,y:0},ct={x:0,y:0},dt={x:0,y:0},St={x:0,y:0},bt={x:0,y:0},Tt=function(e){var t={x:0,y:0},r=ot,n=ut,i=ct,a=dt,s=e*e,o=s*e,u=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];return t.x=1/6*((r.x*u[0][0]+n.x*u[0][1]+i.x*u[0][2]+a.x*u[0][3])*o+(r.x*u[1][0]+n.x*u[1][1]+i.x*u[1][2]+a.x*u[1][3])*s+(r.x*u[2][0]+n.x*u[2][1]+i.x*u[2][2]+a.x*u[2][3])*e+(r.x*u[3][0]+n.x*u[3][1]+i.x*u[3][2]+a.x*u[3][3])),t.y=1/6*((r.y*u[0][0]+n.y*u[0][1]+i.y*u[0][2]+a.y*u[0][3])*o+(r.y*u[1][0]+n.y*u[1][1]+i.y*u[1][2]+a.y*u[1][3])*s+(r.y*u[2][0]+n.y*u[2][1]+i.y*u[2][2]+a.y*u[2][3])*e+(r.y*u[3][0]+n.y*u[3][1]+i.y*u[3][2]+a.y*u[3][3])),{x:t.x,y:t.y}},Yr(n).mousedown((function(e){if(!o.spaceKey&&1!==e.button){var t=2===e.button;e.altKey&&o.cloneSelectedElements(0,0),Xe=Yr("#svgcontent g")[0].getScreenCTM().inverse();var r=ve(e.pageX,e.pageY,Xe),n=r.x*v,i=r.y*v;e.preventDefault(),t&&(Te="select",He=r);var s=n/v,u=i/v,h=ae(e);"a"===h.tagName&&1===h.childNodes.length&&(h=h.firstChild);var c=s;nt=tt=s;var d=u;if(it=rt=u,a.gridSnapping&&(s=Zt(s),u=Zt(u),tt=Zt(tt),rt=Zt(rt)),h===D.selectorParentGroup&&!Kt(b[0])){var m=e.target,f=le(m,"type");"rotate"===f?Te="rotate":"resize"===f&&(Te="resize",Oe=le(m,"dir")),h=b[0]}Ie=h.getAttribute("transform");var g=Y(h);switch(Te){case"select":if(Ge=!0,Oe="none",t&&(Ge=!1),h!==l){if(b.includes(h)||(e.shiftKey||te(!0),ne([h]),Be=h,G.clear()),!t){var p=!0,y=!1,x=void 0;try{for(var _,w=b[Symbol.iterator]();!(p=(_=w.next()).done);p=!0){var k=_.value;if(!Kt(k)){var C=Y(k);C.numberOfItems?C.insertItemBefore(l.createSVGTransform(),0):C.appendItem(l.createSVGTransform())}}}catch(e){y=!0,x=e}finally{try{p||null==w.return||w.return()}finally{if(y)throw x}}}}else t||(te(),Te="multiselect",Kt(Fe)&&(Fe=D.getRubberBandBox()),Qt(Fe,{x:nt*=v,y:it*=v,width:0,height:0,display:"inline"}));break;case"zoom":Ge=!0,Kt(Fe)&&(Fe=D.getRubberBandBox()),Qt(Fe,{x:c*v,y:c*v,width:0,height:0,display:"inline"});break;case"resize":Ge=!0,tt=s,rt=u,at=Lt(Yr("#selectedBox0")[0]);var E={};Yr.each(at,(function(e,t){E[e]=t/v})),at=E;var P=zt(h)?1:0;if(Se(g))g.insertItemBefore(l.createSVGTransform(),P),g.insertItemBefore(l.createSVGTransform(),P),g.insertItemBefore(l.createSVGTransform(),P);else if(g.appendItem(l.createSVGTransform()),g.appendItem(l.createSVGTransform()),g.appendItem(l.createSVGTransform()),H()){var N,I=M();I&&(N=function(e){var t=e.getAttribute("stroke");e.removeAttribute("stroke"),null!==t&&setTimeout((function(){e.setAttribute("stroke",t)}),0)}),h.style.vectorEffect="non-scaling-stroke",I&&N(h);for(var T=h.getElementsByTagName("*"),L=T.length,V=0;V<L;V++)T[V].style&&(T[V].style.vectorEffect="non-scaling-stroke",I&&N(T[V]))}break;case"fhellipse":case"fhrect":case"fhpath":ct.x=c,ct.y=d,Ge=!0,A({element:"polyline",curStyles:!0,attr:{points:c+","+d+" ",id:Q(),fill:"none",opacity:S.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}}),et.minx=c,et.maxx=c,et.miny=d,et.maxy=d;break;case"image":Ge=!0;var O=A({element:"image",attr:{x:s,y:u,width:0,height:0,id:Q(),opacity:S.opacity/2,style:"pointer-events:inherit"}});Gt(O,Pe),Xt(O);break;case"square":case"rect":Ge=!0,tt=s,rt=u,A({element:"rect",curStyles:!0,attr:{x:s,y:u,width:0,height:0,id:Q(),opacity:S.opacity/2}});break;case"line":Ge=!0;var R=0===Number(S.stroke_width)?1:S.stroke_width;A({element:"line",curStyles:!0,attr:{x1:s,y1:u,x2:s,y2:u,id:Q(),stroke:S.stroke,"stroke-width":R,"stroke-dasharray":S.stroke_dasharray,"stroke-linejoin":S.stroke_linejoin,"stroke-linecap":S.stroke_linecap,"stroke-opacity":S.stroke_opacity,fill:"none",opacity:S.opacity/2,style:"pointer-events:none"}});break;case"circle":Ge=!0,A({element:"circle",curStyles:!0,attr:{cx:s,cy:u,r:0,id:Q(),opacity:S.opacity/2}});break;case"ellipse":Ge=!0,A({element:"ellipse",curStyles:!0,attr:{cx:s,cy:u,rx:0,ry:0,id:Q(),opacity:S.opacity/2}});break;case"text":Ge=!0,A({element:"text",curStyles:!0,attr:{x:s,y:u,id:Q(),fill:ge.fill,"stroke-width":ge.stroke_width,"font-size":ge.font_size,"font-family":ge.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:S.opacity}});break;case"path":case"pathedit":tt*=v,rt*=v,G.mouseDown(e,h,tt,rt),Ge=!0;break;case"textedit":tt*=v,rt*=v,Ft.mouseDown(e,h,tt,rt),Ge=!0;break;case"rotate":Ge=!0,o.undoMgr.beginUndoableChange("transform",b)}var B=je("mouseDown",{event:e,start_x:tt,start_y:rt,selectedElements:b},!0);Yr.each(B,(function(e,t){t&&t.started&&(Ge=!0)}))}})).mousemove((function(e){if(Ge&&1!==e.button&&!o.spaceKey){var t,r,n,i,s,u,h,c,d,f,g=b[0],p=ve(e.pageX,e.pageY,Xe),y=p.x*v,x=p.y*v,_=Wt(Z()),S=y/v,w=S,A=x/v,k=A;switch(a.gridSnapping&&(w=Zt(w),k=Zt(k)),e.preventDefault(),Te){case"select":if(null!==b[0]&&(s=w-tt,u=k-rt,a.gridSnapping&&(s=Zt(s),u=Zt(u)),0!==s||0!==u)){for(h=b.length,t=0;t<h&&(g=b[t],!Kt(g));++t){var C=l.createSVGTransform();f=Y(g),C.setTranslate(s,u),f.numberOfItems?f.replaceItem(C,0):f.appendItem(C),D.requestSelector(g).resize()}X("transition",b)}break;case"multiselect":S*=v,A*=v,Qt(Fe,{x:Math.min(nt,S),y:Math.min(it,A),width:Math.abs(S-nt),height:Math.abs(A-it)});var E=b.slice(),P=[],N=De();for(h=N.length,t=0;t<h;++t){var I=N[t];b.includes(I)||P.push(I);var T=E.indexOf(I);-1!==T&&E.splice(T,1)}E.length>0&&o.removeFromSelection(E),P.length>0&&o.addToSelection(P);break;case"resize":f=Y(g);var L=Se(f),V=(d=L?at:Lt(g)).x,O=d.y,M=d,R=M.width,B=M.height;if(s=w-tt,u=k-rt,a.gridSnapping&&(s=Zt(s),u=Zt(u),B=Zt(B),R=Zt(R)),c=zt(g)){var F=Math.sqrt(s*s+u*u),U=Math.atan2(u,s)-c*Math.PI/180;s=F*Math.cos(U),u=F*Math.sin(U)}Oe.includes("n")||Oe.includes("s")||(u=0),Oe.includes("e")||Oe.includes("w")||(s=0);var H=0,j=0,z=B?(B+u)/B:1,q=R?(R+s)/R:1;Oe.includes("n")&&(z=B?(B-u)/B:1,j=B),Oe.includes("w")&&(q=R?(R-s)/R:1,H=R);var W=l.createSVGTransform(),Q=l.createSVGTransform(),K=l.createSVGTransform();if(a.gridSnapping&&(V=Zt(V),H=Zt(H),O=Zt(O),j=Zt(j)),W.setTranslate(-(V+H),-(O+j)),e.shiftKey&&(1===q?q=z:z=q),Q.setScale(q,z),K.setTranslate(V+H,O+j),L){var $=c?1:0;f.replaceItem(W,2+$),f.replaceItem(Q,1+$),f.replaceItem(K,Number($))}else{var J=f.numberOfItems;f.replaceItem(K,J-3),f.replaceItem(Q,J-2),f.replaceItem(W,J-1)}D.requestSelector(g).resize(),X("transition",b);break;case"zoom":S*=v,A*=v,Qt(Fe,{x:Math.min(nt*v,S),y:Math.min(it*v,A),width:Math.abs(S-nt*v),height:Math.abs(A-it*v)});break;case"text":Qt(_,{x:w,y:k});break;case"line":a.gridSnapping&&(w=Zt(w),k=Zt(k));var ee=w,te=k;e.shiftKey&&(ee=(r=ke(tt,rt,ee,te)).x,te=r.y),_.setAttribute("x2",ee),_.setAttribute("y2",te);break;case"foreignObject":case"square":case"rect":case"image":var re,ne,ie="square"===Te||e.shiftKey,ae=Math.abs(w-tt),se=Math.abs(k-rt);ie?(ae=se=Math.max(ae,se),re=tt<w?tt:tt-ae,ne=rt<k?rt:rt-se):(re=Math.min(tt,w),ne=Math.min(rt,k)),a.gridSnapping&&(ae=Zt(ae),se=Zt(se),re=Zt(re),ne=Zt(ne)),Qt(_,{width:ae,height:se,x:re,y:ne});break;case"circle":var oe=Yr(_).attr(["cx","cy"]);n=oe.cx,i=oe.cy;var ue=Math.sqrt((w-n)*(w-n)+(k-i)*(k-i));a.gridSnapping&&(ue=Zt(ue)),_.setAttribute("r",ue);break;case"ellipse":var le=Yr(_).attr(["cx","cy"]);n=le.cx,i=le.cy,a.gridSnapping&&(w=Zt(w),n=Zt(n),k=Zt(k),i=Zt(i)),_.setAttribute("rx",Math.abs(w-n));var he=Math.abs(e.shiftKey?w-n:k-i);_.setAttribute("ry",he);break;case"fhellipse":case"fhrect":et.minx=Math.min(S,et.minx),et.maxx=Math.max(S,et.maxx),et.miny=Math.min(A,et.miny),et.maxy=Math.max(A,et.maxy);case"fhpath":if(dt.x=S,dt.y=A,ot.x&&ot.y)for(t=0;t<9;t++)if(Je=t/10,St=Tt((t+1)/10),bt=St,St=Tt(Je),(st+=Math.sqrt((bt.x-St.x)*(bt.x-St.x)+(bt.y-St.y)*(bt.y-St.y)))>.8){st-=.8;var ce=m.createSVGPoint();ce.x=St.x,ce.y=St.y,_.points.appendItem(ce)}ot={x:ut.x,y:ut.y},ut={x:ct.x,y:ct.y},ct={x:dt.x,y:dt.y};break;case"path":case"pathedit":if(w*=v,k*=v,a.gridSnapping&&(w=Zt(w),k=Zt(k),tt=Zt(tt),rt=Zt(rt)),e.shiftKey){var de,me,fe=Ve;fe?(de=fe.dragging?fe.dragging[0]:tt,me=fe.dragging?fe.dragging[1]:rt):(de=tt,me=rt);var ge=r=ke(de,me,w,k);w=ge.x,k=ge.y}Fe&&"none"!==Fe.getAttribute("display")&&(S*=v,A*=v,Qt(Fe,{x:Math.min(nt*v,S),y:Math.min(it*v,A),width:Math.abs(S-nt*v),height:Math.abs(A-it*v)})),G.mouseMove(w,k);break;case"textedit":w*=v,k*=v,Ft.mouseMove(y,x);break;case"rotate":n=(d=Lt(g)).x+d.width/2,i=d.y+d.height/2;var pe=Ae(g),ye=ve(n,i,pe);n=ye.x,i=ye.y,c=(Math.atan2(i-k,n-w)*(180/Math.PI)-90)%360,a.gridSnapping&&(c=Zt(c)),e.shiftKey&&(c=45*Math.round(c/45)),o.setRotationAngle(c<-180?360+c:c,!0),X("transition",b)}je("mouseMove",{event:e,mouse_x:y,mouse_y:x,selected:g})}})).click((function(e){return e.preventDefault(),!1})).dblclick((function(e){var t=e.target.parentNode;if(t!==x){var r=ae(e),n=r.tagName;if("text"===n&&"textedit"!==Te){var i=ve(e.pageX,e.pageY,Xe);Ft.select(r,i.x,i.y)}"g"!==n&&"a"!==n||!zt(r)||(kr(r),r=b[0],te(!0)),x&&wr(),"g"!==t.tagName&&"a"!==t.tagName||t===y().getCurrentLayer()||r===D.selectorParentGroup||Ar(r)}})).mouseup((function(e){if(2!==e.button){var t=Be;if(Be=null,Ge){var r,n,i=ve(e.pageX,e.pageY,Xe),s=i.x*v,u=i.y*v,l=s/v,h=u/v,c=Wt(Z()),d=!1,m=l,f=h;switch(Ge=!1,Te){case"resize":case"multiselect":Kt(Fe)||(Fe.setAttribute("display","none"),Ue=[]),Te="select";case"select":if(!Kt(b[0])){if(Kt(b[1])){var g=b[0];switch(g.tagName){case"g":case"use":case"image":case"foreignObject":break;default:Re.fill=g.getAttribute("fill"),Re.fill_opacity=g.getAttribute("fill-opacity"),Re.stroke=g.getAttribute("stroke"),Re.stroke_opacity=g.getAttribute("stroke-opacity"),Re.stroke_width=g.getAttribute("stroke-width"),Re.stroke_dasharray=g.getAttribute("stroke-dasharray"),Re.stroke_linejoin=g.getAttribute("stroke-linejoin"),Re.stroke_linecap=g.getAttribute("stroke-linecap")}"text"===g.tagName&&(ge.font_size=g.getAttribute("font-size"),ge.font_family=g.getAttribute("font-family")),D.requestSelector(g).showGrips(!0)}if(Ye(),m!==nt||f!==it)for(var p=b.length,x=0;x<p&&!Kt(b[x]);++x)b[x].firstChild||D.requestSelector(b[x]).resize();else n=e.target,"path"===b[0].nodeName&&Kt(b[1])?G.select(b[0]):e.shiftKey&&t!==n&&o.removeFromSelection([n]);if(H()){var _=b[0];_&&(_.removeAttribute("style"),Ct(_,(function(e){e.removeAttribute("style")})))}}return;case"zoom":Kt(Fe)||Fe.setAttribute("display","none");var w=e.shiftKey?.5:2;return void X("zoomed",{x:Math.min(nt,m),y:Math.min(it,f),width:Math.abs(m-nt),height:Math.abs(f-it),factor:w});case"fhpath":st=0,ot={x:0,y:0},ut={x:0,y:0},ct={x:0,y:0},dt={x:0,y:0};var k=c.getAttribute("points"),C=k.indexOf(",");(d=C>=0?k.includes(",",C+1):k.includes(" ",k.indexOf(" ")+1))&&(c=G.smoothPolylineIntoPath(c));break;case"line":r=Yr(c).attr(["x1","x2","y1","y2"]),d=r.x1!==r.x2||r.y1!==r.y2;break;case"foreignObject":case"square":case"rect":case"image":r=Yr(c).attr(["width","height"]),d=r.width||r.height||"image"===Te;break;case"circle":d="0"!==c.getAttribute("r");break;case"ellipse":r=Yr(c).attr(["rx","ry"]),d=r.rx||r.ry;break;case"fhellipse":et.maxx-et.minx>0&&et.maxy-et.miny>0&&(c=A({element:"ellipse",curStyles:!0,attr:{cx:(et.minx+et.maxx)/2,cy:(et.miny+et.maxy)/2,rx:(et.maxx-et.minx)/2,ry:(et.maxy-et.miny)/2,id:Z()}}),X("changed",[c]),d=!0);break;case"fhrect":et.maxx-et.minx>0&&et.maxy-et.miny>0&&(c=A({element:"rect",curStyles:!0,attr:{x:et.minx,y:et.miny,width:et.maxx-et.minx,height:et.maxy-et.miny,id:Z()}}),X("changed",[c]),d=!0);break;case"text":d=!0,Ke([c]),Ft.start(c);break;case"path":c=null,Ge=!0;var E=G.mouseUp(e,c,s,u);c=E.element,d=E.keep;break;case"pathedit":d=!0,c=null,G.mouseUp(e);break;case"textedit":d=!1,c=null,Ft.mouseUp(e,s,u);break;case"rotate":d=!0,c=null,Te="select";var P=o.undoMgr.finishUndoableChange();P.isEmpty()||O(P),Ye(),X("changed",b)}var N=je("mouseUp",{event:e,mouse_x:s,mouse_y:u},!0);if(Yr.each(N,(function(e,t){t&&(d=t.keep||d,c=t.element,Ge=t.started||Ge)})),d||Kt(c)){if(!Kt(c)){o.addedNew=!0;var I,T=.2;if(he.beginElement&&parseFloat(c.getAttribute("opacity"))!==S.opacity){I=Yr(he).clone().attr({to:S.opacity,dur:T}).appendTo(c);try{I[0].beginElement()}catch(e){}}else T=0;setTimeout((function(){I&&I.remove(),c.setAttribute("opacity",S.opacity),c.setAttribute("style","pointer-events:inherit"),Yt(c),"path"===Te?G.toEditMode(c):a.selectNew&&Ke([c],!0),O(new Xr(c)),X("changed",[c])}),1e3*T)}}else{for(y().releaseId(Z()),c.remove(),c=null,n=e.target;n&&n.parentNode&&n.parentNode.parentNode&&"g"===n.parentNode.parentNode.tagName;)n=n.parentNode;"path"===Te&&Vt||!n||!n.parentNode||"selectorParentGroup"===n.parentNode.id||"svgcanvas"===n.id||"svgroot"===n.id||(o.setMode("select"),Ke([n],!0))}Ie=null}}})),Yr(n).bind("mousewheel DOMMouseScroll",(function(e){if(e.shiftKey){e.preventDefault();var t=e.originalEvent;Xe=Yr("#svgcontent g")[0].getScreenCTM().inverse();var r=Yr("#workarea"),n=a.showRulers?16:0,i=ve(t.pageX,t.pageY,Xe),s=r.width(),u=r.height(),l=s-15-n,h=u-15-n,c=l*Xe.a,d=h*Xe.d,m=r.offset(),f=m.left+n,g=m.top+n,p=t.wheelDelta?t.wheelDelta:t.detail?-t.detail:0;if(p){var y,x,_=Math.max(.75,Math.min(4/3,p));_>1?(y=Math.ceil(l/c*_*100)/100,x=Math.ceil(h/d*_*100)/100):(y=Math.floor(l/c*_*100)/100,x=Math.floor(h/d*_*100)/100);var S=Math.min(y,x);if((S=Math.min(10,Math.max(.01,S)))!==v){_=S/v;var b=ve(f,g,Xe),w={x:(i.x-(i.x-b.x)/_)*S-n+s/2,y:(i.y-(i.y-b.y)/_)*S-n+u/2};o.setZoom(S),Yr("#zoom").val((100*S).toFixed(1)),X("updateCanvas",{center:!1,newCtr:w}),X("zoomDone")}}}}));var Bt,Ft=o.textActions=function(){var e,t,r,n,i,a,s,u,h,c,d=[];function m(e){var s=""===t.value;if(Yr(t).focus(),!arguments.length)if(s)e=0;else{if(t.selectionEnd!==t.selectionStart)return;e=t.selectionEnd}var o=d[e];s||t.setSelectionRange(e,e),(r=Wt("text_cursor"))||(r=document.createElementNS(g.SVG,"line"),Qt(r,{id:"text_cursor",stroke:"#333","stroke-width":1}),r=Wt("selectorParentGroup").appendChild(r)),i||(i=setInterval((function(){var e="none"===r.getAttribute("display");r.setAttribute("display",e?"inline":"none")}),600));var u=S(o.x,a.y),l=S(o.x,a.y+a.height);Qt(r,{x1:u.x,y1:u.y,x2:l.x,y2:l.y,visibility:"visible",display:"inline"}),n&&n.setAttribute("d","")}function f(e,i,s){if(e!==i){s||t.setSelectionRange(e,i),(n=Wt("text_selectblock"))||(n=document.createElementNS(g.SVG,"path"),Qt(n,{id:"text_selectblock",fill:"green",opacity:.5,style:"pointer-events:none"}),Wt("selectorParentGroup").append(n));var o=d[e],u=d[i];r.setAttribute("visibility","hidden");var l=S(o.x,a.y),h=S(o.x+(u.x-o.x),a.y),c=S(o.x,a.y+a.height),f=S(o.x+(u.x-o.x),a.y+a.height),p="M"+l.x+","+l.y+" L"+h.x+","+h.y+" "+f.x+","+f.y+" "+c.x+","+c.y+"z";Qt(n,{d:p,display:"inline"})}else m(i)}function p(t,r){var n=l.createSVGPoint();if(n.x=t,n.y=r,1===d.length)return 0;var i=e.getCharNumAtPosition(n);i<0?(i=d.length-2,t<=d[0].x&&(i=0)):i>=d.length-2&&(i=d.length-2);var a=d[i];return t>a.x+a.width/2&&i++,i}function y(e,t){m(p(e,t))}function x(e,r,n){var i=t.selectionStart,a=p(e,r);f(Math.min(i,a),Math.max(i,a),!n)}function _(e,t){var r={x:e,y:t};if(r.x/=v,r.y/=v,s){var n=ve(r.x,r.y,s.inverse());r.x=n.x,r.y=n.y}return r}function S(e,t){var r={x:e,y:t};if(s){var n=ve(r.x,r.y,s);r.x=n.x,r.y=n.y}return r.x*=v,r.y*=v,r}function w(t){f(0,e.textContent.length),Yr(this).unbind(t)}function A(t){if(c&&e){var r=ve(t.pageX,t.pageY,Xe),n=_(r.x*v,r.y*v),i=p(n.x,n.y),a=e.textContent,s=a.substr(0,i).replace(/[a-z0-9]+$/i,"").length,o=a.substr(i).match(/^[a-z0-9]+/i);f(s,(o?o[0].length:0)+i),Yr(t.target).click(w),setTimeout((function(){Yr(t.target).unbind("click",w)}),300)}}return{select:function(t,r,n){e=t,Ft.toEditMode(r,n)},start:function(t){e=t,Ft.toEditMode()},mouseDown:function(e,r,n,i){var a=_(n,i);t.focus(),y(a.x,a.y),u=n,h=i},mouseMove:function(e,t){var r=_(e,t);x(r.x,r.y)},mouseUp:function(t,r,n){var i=_(r,n);x(i.x,i.y,!0),t.target!==e&&r<u+2&&r>u-2&&n<h+2&&n>h-2&&Ft.toSelectMode(!0)},setCursor:m,toEditMode:function(t,r){if(c=!1,Te="textedit",D.requestSelector(e).showGrips(!1),D.requestSelector(e),Ft.init(),Yr(e).css("cursor","text"),arguments.length){var n=_(t,r);y(n.x,n.y)}else m();setTimeout((function(){c=!0}),300)},toSelectMode:function(a){Te="select",clearInterval(i),i=null,n&&Yr(n).attr("display","none"),r&&Yr(r).attr("visibility","hidden"),Yr(e).css("cursor","move"),a&&(te(),Yr(e).css("cursor","move"),X("selected",[e]),ne([e],!0)),e&&!e.textContent.length&&o.deleteSelectedElements(),Yr(t).blur(),e=!1},setInputElem:function(e){t=e},clear:function(){"textedit"===Te&&Ft.toSelectMode()},init:function(r){if(e){var n,i;e.parentNode||(e=b[0],D.requestSelector(e).showGrips(!1));var u=e.textContent.length,l=e.getAttribute("transform");for(a=Lt(e),s=l?Ae(e):null,(d=[]).length=u,t.focus(),Yr(e).unbind("dblclick",A).dblclick(A),u||(i={x:a.x+a.width/2,width:0}),n=0;n<u;n++){var h=e.getStartPositionOfChar(n);if(i=e.getEndPositionOfChar(n),!N){var c=o.contentW*v;h.x-=c,i.x-=c,h.x/=v,i.x/=v}d[n]={x:h.x,y:a.y,width:i.x-h.x,height:a.height}}d.push({x:i.x,width:0}),f(t.selectionStart,t.selectionEnd,!0)}}}}(),Ut=this.removeUnusedDefElems=function(){var e=m.getElementsByTagNameNS(g.SVG,"defs");if(!e||!e.length)return 0;var t,r,n=[],i=0,a=["fill","stroke","filter","marker-start","marker-mid","marker-end"],s=a.length,o=m.getElementsByTagNameNS(g.SVG,"*"),u=o.length;for(t=0;t<u;t++){var l=o[t];for(r=0;r<s;r++){var h=Et(l.getAttribute(a[r]));h&&n.push(h.substr(1))}var c=Pt(l);c&&c.startsWith("#")&&n.push(c.substr(1))}var d=Yr(e).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(t=d.length;t--;){var f=d[t],p=f.id;n.includes(p)||(Ee[p]=f,f.remove(),i++)}return i};function Dt(){te();var e=[],t=[],r={feGaussianBlur:se.exportNoBlur,foreignObject:se.exportNoforeignObject,"[stroke-dasharray]":se.exportNoDashArray},n=Yr(m);return"font"in Yr("<canvas>")[0].getContext("2d")||(r.text=se.exportNoText),Yr.each(r,(function(r,i){n.find(r).length&&(t.push(r),e.push(i))})),{issues:e,issueCodes:t}}this.svgCanvasToString=function(){for(;Ut()>0;);G.clear(!0),Yr.each(m.childNodes,(function(e,t){e&&8===t.nodeType&&t.data.includes("Created with")&&m.firstChild.before(t)})),x&&(wr(),Ke([x]));var e=[];Yr(m).find("g:data(gsvg)").each((function(){for(var t=this.attributes,r=t.length,n=0;n<r;n++)"id"!==t[n].nodeName&&"style"!==t[n].nodeName||r--;if(r<=0){var i=this.firstChild;e.push(i),Yr(this).replaceWith(i)}}));var t=this.svgToString(m,0);return e.length&&Yr(e).each((function(){qe(this)})),t},this.svgToString=function(e,t){var r=[],n=a.baseUnit,i=new RegExp("^-?[\\d\\.]+"+n+"$");if(e){Yt(e);var s=c(e.attributes),o=e.childNodes;s.sort((function(e,t){return e.name>t.name?-1:1}));for(var u=0;u<t;u++)r.push(" ");if(r.push("<"),r.push(e.nodeName),"svgcontent"===e.id){var l=nr();"px"!==n&&(l.w=ee(l.w,n)+n,l.h=ee(l.h,n)+n),r.push(' width="'+l.w+'" height="'+l.h+'" xmlns="'+g.SVG+'"');var h={};Yr(e).find("*").andSelf().each((function(){var e=this.namespaceURI;e&&!h[e]&&L[e]&&"xmlns"!==L[e]&&"xml"!==L[e]&&(h[e]=!0,r.push(" xmlns:"+L[e]+'="'+e+'"')),Yr.each(this.attributes,(function(e,t){var n=t.namespaceURI;n&&!h[n]&&"xmlns"!==L[n]&&"xml"!==L[n]&&(h[n]=!0,r.push(" xmlns:"+L[n]+'="'+n+'"'))}))}));for(var d=s.length,m=["width","height","xmlns","x","y","viewBox","id","overflow"];d--;){var f=s[d],p=vt(f.value);f.nodeName.startsWith("xmlns:")||(""===p||m.includes(f.localName)||f.namespaceURI&&!L[f.namespaceURI]||(r.push(" "),r.push(f.nodeName),r.push('="'),r.push(p),r.push('"')))}}else{if("defs"===e.nodeName&&!e.firstChild)return"";for(var y=["-moz-math-font-style","_moz-math-font-style"],v=s.length-1;v>=0;v--){var x=s[v],_=vt(x.value);if(!y.includes(x.localName)&&""!==_){if(_.startsWith("pointer-events"))continue;if("class"===x.localName&&_.startsWith("se_"))continue;if(r.push(" "),"d"===x.localName&&(_=G.convertPath(e,!0)),isNaN(_)?i.test(_)&&(_=J(_)+n):_=J(_),me.apply&&"image"===e.nodeName&&"href"===x.localName&&me.images&&"embed"===me.images){var S=de[_];S&&(_=S)}x.namespaceURI&&x.namespaceURI!==g.SVG&&!L[x.namespaceURI]||(r.push(x.nodeName),r.push('="'),r.push(_),r.push('"'))}}}if(e.hasChildNodes()){r.push(">"),t++;for(var b=!1,w=0;w<o.length;w++){var A=o.item(w);switch(A.nodeType){case 1:r.push("\n"),r.push(this.svgToString(o.item(w),t));break;case 3:var k=A.nodeValue.replace(/^\s+|\s+$/g,"");""!==k&&(b=!0,r.push(String(vt(k))));break;case 4:r.push("\n"),r.push(new Array(t+1).join(" ")),r.push("<![CDATA["),r.push(A.nodeValue),r.push("]]>");break;case 8:r.push("\n"),r.push(new Array(t+1).join(" ")),r.push("\x3c!--"),r.push(A.data),r.push("--\x3e")}}if(t--,!b){r.push("\n");for(var C=0;C<t;C++)r.push(" ")}r.push("</"),r.push(e.nodeName),r.push(">")}else r.push("/>")}return r.join("")},this.embedImage=function(e){return new Promise((function(t,r){Yr(new Image).load((function(n,i,a){if("error"!==i){var s=document.createElement("canvas");s.width=this.width,s.height=this.height,s.getContext("2d").drawImage(this,0,0);try{var o=";svgedit_url="+encodeURIComponent(e);o=s.toDataURL().replace(";base64",o+";base64"),de[e]=o}catch(t){de[e]=!1}Pe=e,t(de[e])}else r(new Error("Error loading image: "+a.status+" "+a.statusText))})).attr("src",e)}))},this.setGoodImage=function(e){Pe=e},this.open=function(){},this.save=function(e){te(),e&&Yr.extend(me,e),me.apply=!0;var t=this.svgCanvasToString();X("saved",t)},this.rasterExport=function(e,t,r){var n,i,s,u,l,h,c,d,m,f=arguments;return regeneratorRuntime.async((function(g){for(;;)switch(g.prev=g.next){case 0:if(n=f.length>3&&void 0!==f[3]?f[3]:{},s="image/"+(i="ICO"===e?"BMP":e||"PNG").toLowerCase(),u=Dt(),l=u.issues,h=u.issueCodes,c=this.svgCanvasToString(),Bt){g.next=10;break}return g.next=8,regeneratorRuntime.awrap(Nr(a.canvgPath+"canvg.js",{global:"canvg"}));case 8:d=g.sent,Bt=d.canvg;case 10:return Yr("#export_canvas").length||Yr("<canvas>",{id:"export_canvas"}).hide().appendTo("body"),(m=Yr("#export_canvas")[0]).width=o.contentW,m.height=o.contentH,g.next=16,regeneratorRuntime.awrap(Bt(m,c));case 16:return g.abrupt("return",new Promise((function(a,o){var u,d=i.toLowerCase(),f=t?m.toDataURL("image/"+d,t):m.toDataURL("image/"+d);function g(){var i={datauri:f,bloburl:u,svg:c,issues:l,issueCodes:h,type:e,mimeType:s,quality:t,exportWindowName:r};n.avoidEvent||X("exported",i),a(i)}m.toBlob?m.toBlob((function(e){u=At(e),g()}),s,t):(u=wt(f),g())})));case 17:case"end":return g.stop()}}),null,this)},this.exportPDF=function(e){var t,r,n,i,s,o,u,l,h,c,d,m,f=arguments;return regeneratorRuntime.async((function(g){for(;;)switch(g.prev=g.next){case 0:if(t=f.length>1&&void 0!==f[1]?f[1]:F()?"save":void 0,window.jsPDF){g.next=7;break}return g.next=4,regeneratorRuntime.awrap(Ir(["jspdf/underscore-min.js","jspdf/jspdf.min.js"]));case 4:return r=!("svgEditor"in window&&window.svgEditor&&!1===window.svgEditor.modules),g.next=7,regeneratorRuntime.awrap(Ir(a.jspdfPath+"jspdf.plugin.svgToPdf.js",{type:r?"module":"text/javascript"}));case 7:return n=nr(),i=n.w>n.h?"landscape":"portrait",s="pt",o=jsPDF({orientation:i,unit:s,format:[n.w,n.h]}),u=ir(),o.setProperties({title:u}),l=Dt(),h=l.issues,c=l.issueCodes,d=this.svgCanvasToString(),o.addSVG(d,0,0),(m={svg:d,issues:h,issueCodes:c,exportWindowName:e,outputType:t=t||"dataurlstring"}).output=o.output(t,"save"===t?e||"svg.pdf":void 0),X("exportedPDF",m),g.abrupt("return",m);case 21:case"end":return g.stop()}}),null,this)},this.getSvgString=function(){return me.apply=!1,this.svgCanvasToString()},this.randomizeIds=function(e){arguments.length>0&&!1===e?cr(!1,y()):cr(!0,y())};var $t=this.uniquifyElems=function(e){var t={},r=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];for(var n in Ct(e,(function(e){if(1===e.nodeType){e.id&&(e.id in t||(t[e.id]={elem:null,attrs:[],hrefs:[]}),t[e.id].elem=e),Yr.each(ue,(function(r,n){var i=e.getAttributeNode(n);if(i){var a=Et(i.value),s=a?a.substr(1):null;s&&(s in t||(t[s]={elem:null,attrs:[],hrefs:[]}),t[s].attrs.push(i))}}));var n=Pt(e);if(n&&r.includes(e.nodeName)){var i=n.substr(1);i&&(i in t||(t[i]={elem:null,attrs:[],hrefs:[]}),t[i].hrefs.push(e))}}})),t)if(n){var i=t[n].elem;if(i){var a=Q();i.id=a;for(var s=t[n].attrs,o=s.length;o--;){var u=s[o];u.ownerElement.setAttribute(u.name,"url(#"+a+")")}for(var l=t[n].hrefs,h=l.length;h--;){var c=l[h];Gt(c,"#"+a)}}}},Jt=this.setUseData=function(e){var t=Yr(e);"use"!==e.tagName&&(t=t.find("use")),t.each((function(){var e=Pt(this).substr(1),t=Wt(e);t&&(Yr(this).data("ref",t),"symbol"!==t.tagName&&"svg"!==t.tagName||Yr(this).data("symbol",t).data("ref",t))}))},er=this.convertGradients=function(e){var t=Yr(e).find("linearGradient, radialGradient");!t.length&&M()&&(t=Yr(e).find("*").filter((function(){return this.tagName.includes("Gradient")}))),t.each((function(){if("userSpaceOnUse"===Yr(this).attr("gradientUnits")){var e=Yr(m).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(!e.length)return;var t=Lt(e[0]);if(!t)return;if("linearGradient"===this.tagName){var r=Yr(this).attr(["x1","y1","x2","y2"]),n=this.gradientTransform.baseVal;if(n&&n.numberOfItems>0){var i=we(n).matrix,a=ve(r.x1,r.y1,i),s=ve(r.x2,r.y2,i);r.x1=a.x,r.y1=a.y,r.x2=s.x,r.y2=s.y,this.removeAttribute("gradientTransform")}Yr(this).attr({x1:(r.x1-t.x)/t.width,y1:(r.y1-t.y)/t.height,x2:(r.x2-t.x)/t.width,y2:(r.y2-t.y)/t.height}),this.removeAttribute("gradientUnits")}}}))},tr=this.convertToGroup=function(e){e||(e=b[0]);var t,r=Yr(e),n=new Jr;if(r.data("gsvg")){var i=e.firstChild,a=Yr(i).attr(["x","y"]);Yr(e.firstChild.firstChild).unwrap(),Yr(e).removeData("gsvg");var s=Y(e),o=l.createSVGTransform();o.setTranslate(a.x,a.y),s.appendItem(o),Dr(e),X("selected",[e])}else if(r.data("symbol")){e=r.data("symbol"),t=r.attr("transform");var h=r.attr(["x","y"]),c=e.getAttribute("viewBox");if(c){var d=c.split(" ");h.x-=Number(d[0]),h.y-=Number(d[1])}t+=" translate("+(h.x||0)+","+(h.y||0)+")";var f=r.prev();n.addSubCommand(new Kr(r[0],r[0].nextSibling,r[0].parentNode)),r.remove();var p,y=Yr(m).find("use:data(symbol)").length,v=u.createElementNS(g.SVG,"g"),x=e.childNodes;for(p=0;p<x.length;p++)v.append(x[p].cloneNode(!0));if(R()){var _=Yr(Nt()).children("linearGradient,radialGradient,pattern").clone();Yr(v).append(_)}t&&v.setAttribute("transform",t);var S=e.parentNode;if($t(v),R()&&Yr(Nt()).append(Yr(v).find("linearGradient,radialGradient,pattern")),v.id=Q(),f.after(v),S){if(!y){var w=e.nextSibling;e.remove(),n.addSubCommand(new Kr(e,w,S))}n.addSubCommand(new Xr(v))}Jt(v),R()?er(Nt()):er(v),function(e,t){if(e&&1===e.nodeType){for(var r=e.childNodes.length;r--;)Ct(e.childNodes.item(r),t);t(e)}}(v,(function(e){try{Dr(e)}catch(e){console.log(e)}})),Yr(v).find(oe).each((function(){this.id||(this.id=Q())})),Ke([v]);var A=kr(v,!0);A&&n.addSubCommand(A),O(n)}else console.log("Unexpected element to ungroup:",e)};this.setSvgString=function(e,t){try{var r=kt(e);if(r.firstElementChild&&r.firstElementChild.namespaceURI!==g.SVG)return!1;this.prepareSvg(r);var n=new Jr("Change Source"),i=m.nextSibling,s=l.removeChild(m);n.addSubCommand(new Kr(s,i,l)),m=u.adoptNode?u.adoptNode(r.documentElement):u.importNode(r.documentElement,!0),l.append(m);var h=Yr(m);o.current_drawing_=new hr(m,f);var c=y().getNonce();c?X("setnonce",c):X("unsetnonce"),h.find("image").each((function(){var e=this;Xt(e);var t=Pt(this);if(t){if(t.startsWith("data:")){var r=t.match(d(/svgedit_url=(.*?);/,{url:1}));if(r){var n=decodeURIComponent(r.groups.url);Yr(new Image).load((function(){e.setAttributeNS(g.XLINK,"xlink:href",n)})).attr("src",n)}}o.embedImage(t)}})),h.find("svg").each((function(){if(!Yr(this).closest("defs").length){$t(this);var e=this.parentNode;1===e.childNodes.length&&"g"===e.nodeName?(Yr(e).data("gsvg",this),e.id=e.id||Q()):qe(this)}})),R()&&h.find("linearGradient, radialGradient, pattern").appendTo(Nt()),Jt(h),er(h[0]);var p={id:"svgcontent",overflow:a.show_outside_canvas?"visible":"hidden"},x=!1;if(h.attr("viewBox")){var _=h.attr("viewBox").split(" ");p.width=_[2],p.height=_[3]}else Yr.each(["width","height"],(function(e,t){var r=h.attr(t)||"100%";"%"===String(r).substr(-1)?x=!0:p[t]=re(t,r)}));if(dr(),h.children().find(oe).each((function(){this.id||(this.id=Q())})),x){var S=jt();p.width=S.width+S.x,p.height=S.height+S.y}p.width<=0&&(p.width=100),p.height<=0&&(p.height=100),h.attr(p),this.contentW=p.width,this.contentH=p.height,n.addSubCommand(new Xr(m));var b=h.attr(["width","height"]);n.addSubCommand(new $r(l,b)),v=1,q={},te(),Le={},l.append(D.selectorParentGroup),t||O(n),X("changed",[m])}catch(e){return console.log(e),!1}return!0},this.importSvgString=function(e){var t,r,n;try{var i=xt(e.length+e).substr(0,32),a=!1;fe[i]&&Yr(fe[i].symbol).parents("#svgroot").length&&(a=!0);var s,o=new Jr("Import Image");if(a)s=fe[i].symbol,r=fe[i].xform;else{var l,h=kt(e);this.prepareSvg(h),l=u.adoptNode?u.adoptNode(h.documentElement):u.importNode(h.documentElement,!0),$t(l);var c=re("width",l.getAttribute("width")),d=re("height",l.getAttribute("height")),f=l.getAttribute("viewBox"),p=f?f.split(" "):[0,0,c,d];for(t=0;t<4;++t)p[t]=Number(p[t]);var v=Number(m.getAttribute("height"));r="translate(0) "+(r=d>c?"scale("+v/3/p[3]+")":"scale("+v/3/p[2]+")")+" translate(0)",s=u.createElementNS(g.SVG,"symbol");var _=Nt();for(R()&&Yr(l).find("linearGradient, radialGradient, pattern").appendTo(_);l.firstChild;){var S=l.firstChild;s.append(S)}var b=l.attributes,w=!0,A=!1,k=void 0;try{for(var C,E=b[Symbol.iterator]();!(w=(C=E.next()).done);w=!0){var P=C.value;s.setAttribute(P.nodeName,P.value)}}catch(e){A=!0,k=e}finally{try{w||null==E.return||E.return()}finally{if(A)throw k}}s.id=Q(),fe[i]={symbol:s,xform:r},Nt().append(s),o.addSubCommand(new Xr(s))}(n=u.createElementNS(g.SVG,"use")).id=Q(),Gt(n,"#"+s.id),(x||y().getCurrentLayer()).append(n),o.addSubCommand(new Xr(n)),te(),n.setAttribute("transform",r),Dr(n),Yr(n).data("symbol",s).data("ref",s),ne([n]),O(o),X("changed",[m])}catch(e){return console.log(e),null}return n};var rr={identifyLayers:dr,createLayer:mr,cloneLayer:fr,deleteCurrentLayer:gr,setCurrentLayer:pr,renameCurrentLayer:yr,setCurrentLayerPosition:vr,setLayerVisibility:xr,moveSelectedToLayer:_r,mergeLayer:Sr,mergeAllLayers:br,leaveContext:wr,setContext:Ar};Object.entries(rr).forEach((function(e){var t=h(e,2),r=t[0],n=t[1];o[r]=n})),function(e){lr=e}({pathActions:G,getCurrentGroup:function(){return x},setCurrentGroup:function(e){x=e},getSelectedElements:P,getSVGContent:E,undoMgr:V,elData:le,getCurrentDrawing:y,clearSelection:te,call:X,addCommandToHistory:O,changeSVGContent:function(){X("changed",[m])}}),this.clear=function(){G.clear(),te(),o.clearSvgContentElement(),o.current_drawing_=new hr(m),o.createLayer("Layer 1"),o.undoMgr.resetUndoStack(),D.initGroup(),Fe=D.getRubberBandBox(),X("cleared")},this.linkControlPoints=G.linkControlPoints,this.getContentElem=function(){return m},this.getRootElem=function(){return l};var nr=this.getResolution=function(){return{w:m.getAttribute("width")/v,h:m.getAttribute("height")/v,zoom:v}};this.getSnapToGrid=function(){return a.gridSnapping},this.getVersion=function(){return"svgcanvas.js ($Rev$)"},this.setUiStrings=function(t){Object.assign(se,t.notification),Yr=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ok:"Ok",cancel:"Cancel"};t("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"}).css("position","absolute");var n=t("#dialog_box"),i=t("#dialog_buttons"),a=t("#dialog_content");function s(s,o,u,l,h,c){a.html("<p>"+o.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"===s),i.empty();var d=t('<input type="button" data-ok="" value="'+r.ok+'">').appendTo(i);return new Promise((function(m,f){var g,p;if("alert"!==s&&t('<input type="button" value="'+r.cancel+'">').appendTo(i).click((function(){n.hide(),m(!1)})),"prompt"===s)(g=t('<input type="text">').prependTo(i)).val(u||""),g.bind("keydown","return",(function(){d.click()}));else if("select"===s){var y=t('<div style="text-align:center;">');if(g=t('<select aria-label="'.concat(o,'">')).appendTo(y),c){var v=t("<label>").text(c.label);(p=t('<input type="checkbox">').appendTo(v)).val(c.value),c.tooltip&&v.attr("title",c.tooltip),p.prop("checked",Boolean(c.checked)),y.append(t("<div>").append(v))}t.each(l||[],(function(r,n){"object"===e(n)?g.append(t("<option>").val(n.value).html(n.text)):g.append(t("<option>").html(n))})),a.append(y),u&&g.val(u),h&&g.bind("change","return",h),g.bind("keydown","return",(function(){d.click()}))}else"process"===s&&d.hide();n.show(),d.click((function(){n.hide();var e="prompt"!==s&&"select"!==s||g.val();m(p?{response:e,checked:p.prop("checked")}:e)})).focus(),"prompt"!==s&&"select"!==s||g.focus()}))}return t.alert=function(e){return s("alert",e)},t.confirm=function(e){return s("confirm",e)},t.process_cancel=function(e){return s("process",e)},t.prompt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return s("prompt",e,t)},t.select=function(e,t,r,n,i){return s("select",e,n,t,r,i)},t}(Yr,t.common),Ne(t)},this.setConfig=function(e){Object.assign(a,e)},this.getTitle=function(e){if(e=e||b[0]){var t=(e=Yr(e).data("gsvg")||Yr(e).data("symbol")||e).childNodes,r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;if("title"===o.nodeName)return o.textContent}}catch(e){n=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return""}},this.setGroupTitle=function(e){var t=b[0];t=Yr(t).data("gsvg")||t;var r,n=Yr(t).children("title"),i=new Jr("Set Label");if(e.length)n.length?(r=n[0],i.addSubCommand(new $r(r,{"#text":r.textContent})),r.textContent=e):((r=u.createElementNS(g.SVG,"title")).textContent=e,Yr(t).prepend(r),i.addSubCommand(new Xr(r)));else{var a=n.nextSibling;i.addSubCommand(new Kr(n[0],a,t)),n.remove()}O(i)};var ir=this.getDocumentTitle=function(){return o.getTitle(m)};this.setDocumentTitle=function(e){var t=m.childNodes,r=!1,n="",i=new Jr("Change Image Title"),a=!0,s=!1,o=void 0;try{for(var l,h=t[Symbol.iterator]();!(a=(l=h.next()).done);a=!0){var c=l.value;if("title"===c.nodeName){n=(r=c).textContent;break}}}catch(e){s=!0,o=e}finally{try{a||null==h.return||h.return()}finally{if(s)throw o}}r||(r=u.createElementNS(g.SVG,"title"),m.insertBefore(r,m.firstChild)),e.length?r.textContent=e:r.remove(),i.addSubCommand(new $r(r,{"#text":n})),O(i)},this.getEditorNS=function(e){return e&&m.setAttribute("xmlns:se",g.SE),g.SE},this.setResolution=function(e,t){var r,n=nr(),i=n.w,a=n.h;if("fit"===e){var s=jt();if(!s)return!1;r=new Jr("Fit Canvas to Content");var u=Ht();ne(u);var l=[],h=[];Yr.each(u,(function(e,t){l.push(-1*s.x),h.push(-1*s.y)}));var c=o.moveSelectedElements(l,h,!0);r.addSubCommand(c),te(),e=Math.round(s.width),t=Math.round(s.height)}return e===i&&t===a||(r||(r=new Jr("Change Image Dimensions")),e=re("width",e),t=re("height",t),m.setAttribute("width",e),m.setAttribute("height",t),this.contentW=e,this.contentH=t,r.addSubCommand(new $r(m,{width:i,height:a})),m.setAttribute("viewBox",[0,0,e/v,t/v].join(" ")),r.addSubCommand(new $r(m,{viewBox:["0 0",i,a].join(" ")})),O(r),X("changed",[m])),!0},this.getOffset=function(){return Yr(m).attr(["x","y"])},this.setBBoxZoom=function(t,r,n){var i,a=.85,s=function(e){if(!e)return!1;var t=Math.round(r/e.width*100*a)/100,i=Math.round(n/e.height*100*a)/100,s=Math.min(t,i);return o.setZoom(s),{zoom:s,bbox:e}};if("object"===e(t)){if(0===(i=t).width||0===i.height){var u=i.zoom?i.zoom:v*i.factor;return o.setZoom(u),{zoom:v,bbox:i}}return s(i)}switch(t){case"selection":if(!b[0])return;var l=Yr.map(b,(function(e){if(e)return e}));i=jt(l);break;case"canvas":var h=nr();a=.95,i={width:h.w,height:h.h,x:0,y:0};break;case"content":i=jt();break;case"layer":i=jt(Ht(y().getCurrentLayer()));break;default:return}return s(i)},this.setZoom=function(e){var t=nr();m.setAttribute("viewBox","0 0 "+t.w/e+" "+t.h/e),v=e,Yr.each(b,(function(e,t){t&&D.requestSelector(t).resize()})),G.zoomChange(),je("zoomChanged",e)},this.getMode=function(){return Te},this.setMode=function(e){G.clear(!0),Ft.clear(),Re=b[0]&&"text"===b[0].nodeName?ge:S,Te=e},this.getColor=function(e){return Re[e]},this.setColor=function(e,t,r){S[e]=t,Re[e+"_paint"]={type:"solidColor"};var n=[];function i(e){"g"!==e.nodeName&&n.push(e)}for(var a=b.length;a--;){var s=b[a];s&&("g"===s.tagName?Ct(s,i):"fill"===e?"polyline"!==s.tagName&&"line"!==s.tagName&&n.push(s):n.push(s))}n.length>0&&(r?or(e,t,n):(ur(e,t,n),X("changed",n)))};var ar=this.setGradient=function(e){if(Re[e+"_paint"]&&"solidColor"!==Re[e+"_paint"].type){var t=o[e+"Grad"],r=sr(t),n=Nt();r?t=r:(t=n.appendChild(u.importNode(t,!0))).id=Q(),o.setColor(e,"url(#"+t.id+")")}},sr=function(e){for(var t=Nt(),r=Yr(t).find("linearGradient, radialGradient"),n=r.length,i=["r","cx","cy","fx","fy"];n--;){var a=r[n];if("linearGradient"===e.tagName){if(e.getAttribute("x1")!==a.getAttribute("x1")||e.getAttribute("y1")!==a.getAttribute("y1")||e.getAttribute("x2")!==a.getAttribute("x2")||e.getAttribute("y2")!==a.getAttribute("y2"))continue}else if("continue"===function(){var t=Yr(e).attr(i),r=Yr(a).attr(i),n=!1;if(Yr.each(i,(function(e,i){t[i]!==r[i]&&(n=!0)})),n)return"continue"}())continue;var s=e.getElementsByTagNameNS(g.SVG,"stop"),o=a.getElementsByTagNameNS(g.SVG,"stop");if(s.length===o.length){for(var u=s.length;u--;){var l=s[u],h=o[u];if(l.getAttribute("offset")!==h.getAttribute("offset")||l.getAttribute("stop-opacity")!==h.getAttribute("stop-opacity")||l.getAttribute("stop-color")!==h.getAttribute("stop-color"))break}if(-1===u)return a}}return null};this.setPaint=function(e,t){var r=new Yr.jGraduate.Paint(t);switch(this.setPaintOpacity(e,r.alpha/100,!0),Re[e+"_paint"]=r,r.type){case"solidColor":this.setColor(e,"none"!==r.solidColor?"#"+r.solidColor:"none");break;case"linearGradient":case"radialGradient":o[e+"Grad"]=r[r.type],ar(e)}},this.setStrokePaint=function(e){this.setPaint("stroke",e)},this.setFillPaint=function(e){this.setPaint("fill",e)},this.getStrokeWidth=function(){return Re.stroke_width},this.setStrokeWidth=function(e){if(0===e&&["line","path"].includes(Te))o.setStrokeWidth(1);else{Re.stroke_width=e;for(var t=[],r=b.length;r--;){var n=b[r];n&&("g"===n.tagName?Ct(n,i):t.push(n))}t.length>0&&(ur("stroke-width",e,t),X("changed",b))}function i(e){"g"!==e.nodeName&&t.push(e)}},this.setStrokeAttr=function(e,t){S[e.replace("-","_")]=t;for(var r=[],n=b.length;n--;){var i=b[n];i&&("g"===i.tagName?Ct(i,(function(e){"g"!==e.nodeName&&r.push(e)})):r.push(i))}r.length>0&&(ur(e,t,r),X("changed",b))},this.getStyle=function(){return S},this.getOpacity=ie,this.setOpacity=function(e){S.opacity=e,ur("opacity",e)},this.getFillOpacity=function(){return S.fill_opacity},this.getStrokeOpacity=function(){return S.stroke_opacity},this.setPaintOpacity=function(e,t,r){S[e+"_opacity"]=t,r?or(e+"-opacity",t):ur(e+"-opacity",t)},this.getPaintOpacity=function(e){return"fill"===e?this.getFillOpacity():this.getStrokeOpacity()},this.getBlur=function(e){var t=0;if(e&&e.getAttribute("filter")){var r=Wt(e.id+"_blur");r&&(t=r.firstChild.getAttribute("stdDeviation"))}return t},function(){var e=null,t=null,r=!1;function n(){var r=o.undoMgr.finishUndoableChange();e.addSubCommand(r),O(e),e=null,t=null}o.setBlurNoUndo=function(e){if(t)if(0===e)or("filter",""),r=!0;else{var n=b[0];r&&or("filter","url(#"+n.id+"_blur)"),M()&&(n.removeAttribute("filter"),n.setAttribute("filter","url(#"+n.id+"_blur)")),or("stdDeviation",e,[t.firstChild]),o.setBlurOffsets(t,e)}else o.setBlur(e)},o.setBlurOffsets=function(e,t){t>3?Qt(e,{x:"-50%",y:"-50%",width:"200%",height:"200%"}):M()||(e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("width"),e.removeAttribute("height"))},o.setBlur=function(r,i){if(e)n();else{var a=b[0],s=a.id;t=Wt(s+"_blur"),r-=0;var u=new Jr;if(t)0===r&&(t=null);else{var l=A({element:"feGaussianBlur",attr:{in:"SourceGraphic",stdDeviation:r}});(t=A({element:"filter",attr:{id:s+"_blur"}})).append(l),Nt().append(t),u.addSubCommand(new Xr(t))}var h={filter:a.getAttribute("filter")};if(0===r)return a.removeAttribute("filter"),void u.addSubCommand(new $r(a,h));ur("filter","url(#"+s+"_blur)"),u.addSubCommand(new $r(a,h)),o.setBlurOffsets(t,r),e=u,o.undoMgr.beginUndoableChange("stdDeviation",[t?t.firstChild:null]),i&&(o.setBlurNoUndo(r),n())}}}(),this.getBold=function(){var e=b[0];return!(Kt(e)||"text"!==e.tagName||!Kt(b[1]))&&"bold"===e.getAttribute("font-weight")},this.setBold=function(e){var t=b[0];!Kt(t)&&"text"===t.tagName&&Kt(b[1])&&ur("font-weight",e?"bold":"normal"),b[0].textContent||Ft.setCursor()},this.getItalic=function(){var e=b[0];return!(Kt(e)||"text"!==e.tagName||!Kt(b[1]))&&"italic"===e.getAttribute("font-style")},this.setItalic=function(e){var t=b[0];!Kt(t)&&"text"===t.tagName&&Kt(b[1])&&ur("font-style",e?"italic":"normal"),b[0].textContent||Ft.setCursor()},this.getFontFamily=function(){return ge.font_family},this.setFontFamily=function(e){ge.font_family=e,ur("font-family",e),b[0]&&!b[0].textContent&&Ft.setCursor()},this.setFontColor=function(e){ge.fill=e,ur("fill",e)},this.getFontColor=function(){return ge.fill},this.getFontSize=function(){return ge.font_size},this.setFontSize=function(e){ge.font_size=e,ur("font-size",e),b[0].textContent||Ft.setCursor()},this.getText=function(){var e=b[0];return Kt(e)?"":e.textContent},this.setTextContent=function(e){ur("#text",e),Ft.init(e),Ft.setCursor()},this.setImageURL=function(e){var t=b[0];if(t){var r=Yr(t).attr(["width","height"]),n=!r.width||!r.height,i=Pt(t);if(i!==e||n){var a=new Jr("Change Image URL");Gt(t,e),a.addSubCommand(new $r(t,{"#href":i})),Yr(new Image).load((function(){var e=Yr(t).attr(["width","height"]);Yr(t).attr({width:this.width,height:this.height}),D.requestSelector(t).resize(),a.addSubCommand(new $r(t,e)),O(a),X("changed",[t])})).attr("src",e)}}},this.setLinkURL=function(e){var t=b[0];if(t){if("a"!==t.tagName){var r=Yr(t).parents("a");if(!r.length)return;t=r[0]}var n=Pt(t);if(n!==e){var i=new Jr("Change Link URL");Gt(t,e),i.addSubCommand(new $r(t,{"#href":n})),O(i)}}},this.setRectRadius=function(e){var t=b[0];if(!Kt(t)&&"rect"===t.tagName){var r=t.getAttribute("rx");r!==String(e)&&(t.setAttribute("rx",e),t.setAttribute("ry",e),O(new $r(t,{rx:r,ry:r},"Radius")),X("changed",[t]))}},this.makeHyperlink=function(e){o.groupSelectedElements("a",e)},this.removeHyperlink=function(){o.ungroupSelectedElement()},this.setSegType=function(e){G.setSegType(e)},this.convertToPath=function(e,t){if(!Kt(e))return t?Rt(e,A,G):function(e,t,r,n,i,a,s,o){var u=new s.BatchCommand("Convert element to Path"),l=r({element:"path",attr:t=ht.extend({},t,Mt(e))}),h=e.getAttribute("transform");h&&l.setAttribute("transform",h);var c=e.id,d=e.parentNode;e.nextSibling?e.before(l):d.append(l);var m=Ot(e);if(m){if(l.setAttribute("d",m),h){var f=Y(l);Se(f)&&n.resetOrientation(l)}var g=e.nextSibling;return u.addSubCommand(new s.RemoveElementCommand(e,g,parent)),u.addSubCommand(new s.InsertElementCommand(l)),i(),e.remove(),l.setAttribute("id",c),l.removeAttribute("visibility"),a([l],!0),o(u),l}return l.remove(),null}(e,{fill:S.fill,"fill-opacity":S.fill_opacity,stroke:S.stroke,"stroke-width":S.stroke_width,"stroke-dasharray":S.stroke_dasharray,"stroke-linejoin":S.stroke_linejoin,"stroke-linecap":S.stroke_linecap,"stroke-opacity":S.stroke_opacity,opacity:S.opacity,visibility:"hidden"},A,G,te,ne,pe,O);var r=b;Yr.each(r,(function(e,t){t&&o.convertToPath(t)}))};var or=function(e,t,r){"pathedit"===Te&&G.moveNode(e,t);for(var n=(r=r||b).length,i=["g","polyline","path"],a=function(){var a=r[n];if(Kt(a))return"continue";if(("x"===e||"y"===e)&&i.includes(a.tagName)){var s=jt([a]),u="x"===e?t-s.x:0,h="y"===e?t-s.y:0;return o.moveSelectedElements(u*v,h*v,!0),"continue"}var c="#text"===e?a.textContent:a.getAttribute(e);if(Kt(c)&&(c=""),c!==String(t)){"#text"===e?(a.textContent=t,/rotate/.test(a.getAttribute("transform"))&&(a=Qe(a))):"#href"===e?Gt(a,t):a.setAttribute(e,t),"textedit"===Te&&"#text"!==e&&a.textContent.length&&Ft.toSelectMode(a),R()&&"text"===a.nodeName&&/rotate/.test(a.getAttribute("transform"))&&(String(t).startsWith("url")||["font-size","font-family","x","y"].includes(e)&&a.textContent)&&(a=Qe(a)),b.includes(a)&&setTimeout((function(){a.parentNode&&D.requestSelector(a).resize()}),0);var d=zt(a);if(0!==d&&"transform"!==e)for(var m=Y(a),f=m.numberOfItems;f--;){if(4===m.getItem(f).type){m.removeItem(f);var g=Lt(a),p=ve(g.x+g.width/2,g.y+g.height/2,we(m).matrix),y=p.x,x=p.y,_=l.createSVGTransform();_.setRotate(d,y,x),m.insertItemBefore(_,f);break}}}};n--;)a()},ur=this.changeSelectedAttribute=function(e,t,r){r=r||b,o.undoMgr.beginUndoableChange(e,r),or(e,t,r);var n=o.undoMgr.finishUndoableChange();n.isEmpty()||O(n)};this.deleteSelectedElements=function(){for(var e=new Jr("Delete Elements"),t=b.length,r=[],n=0;n<t;++n){var i=b[n];if(Kt(i))break;var a=i.parentNode,s=i;D.releaseSelector(s),$e(s.id),"a"===a.tagName&&1===a.childNodes.length&&(s=a,a=a.parentNode);var o=s.nextSibling,u=a.removeChild(s);r.push(i),e.addSubCommand(new Kr(u,o,a))}b=[],e.isEmpty()||O(e),X("changed",r),te()},this.cutSelectedElements=function(){o.copySelectedElements(),o.deleteSelectedElements()},this.copySelectedElements=function(){localStorage.setItem("svgedit_clipboard",JSON.stringify(b.map((function(e){return w(e)})))),Yr("#cmenu_canvas").enableContextMenuItems("#paste,#paste_in_place")},this.pasteElements=function(e,t,r){var n=JSON.parse(localStorage.getItem("svgedit_clipboard")),i=n.length;if(i){var a=[],s=new Jr("Paste elements"),u={};for(n.forEach((function e(t){t.attr&&t.attr.id&&(u[t.attr.id]=Q(),t.attr.id=u[t.attr.id]),t.children&&t.children.forEach(e)})),je("IDsUpdated",{elems:n,changes:u},!0).forEach((function(e){e&&"remove"in e&&e.remove.forEach((function(e){n=n.filter((function(t){return t.attr.id!==e}))}))}));i--;){var l=n[i];if(l){var h=A(l);a.push(h),s.addSubCommand(new Xr(h)),ce(h)}}if(Ke(a),"in_place"!==e){var c,d;e?"point"===e&&(c=t,d=r):(c=He.x,d=He.y);var m=jt(a),f=c-(m.x+m.width/2),g=d-(m.y+m.height/2),p=[],y=[];Yr.each(a,(function(e,t){p.push(f),y.push(g)}));var v=o.moveSelectedElements(p,y,!1);v&&s.addSubCommand(v)}O(s),X("changed",a)}},this.groupSelectedElements=function(e,t){e||(e="g");var r,n="";switch(e){case"a":n="Make hyperlink",r=t||"";break;default:e="g",n="Group Elements"}var i=new Jr(n),a=A({element:e,attr:{id:Q()}});"a"===e&&Gt(a,r),i.addSubCommand(new Xr(a));for(var s=b.length;s--;){var o=b[s];if(!Kt(o)){"a"===o.parentNode.tagName&&1===o.parentNode.childNodes.length&&(o=o.parentNode);var u=o.nextSibling,l=o.parentNode;a.append(o),i.addSubCommand(new Zr(o,u,l))}}i.isEmpty()||O(i),Ke([a],!0)};var kr=this.pushGroupProperties=function(e,t){for(var r,n,i,a=e.childNodes,s=a.length,u=e.getAttribute("transform"),h=Y(e),c=we(h).matrix,d=new Jr("Push group properties"),m=zt(e),f=Yr(e).attr(["filter","opacity"]),g=y(),p=0;p<s;p++){var v=a[p];if(1===v.nodeType){if(null!==f.opacity&&1!==f.opacity){var x=Math.round((v.getAttribute("opacity")||1)*f.opacity*100)/100;ur("opacity",x,[v])}if(f.filter){var _=this.getBlur(v),S=_;n||(n=this.getBlur(e)),_?_=Number(n)+Number(_):0===_&&(_=n),S?r=qt(v.getAttribute("filter")):r?(r=g.copyElem(r),Nt().append(r)):r=qt(f.filter);var b="feGaussianBlur"===r.firstChild.tagName?"blur":"filter";r.id=v.id+"_"+b,ur("filter","url(#"+r.id+")",[v]),_&&(ur("stdDeviation",_,[r.firstChild]),o.setBlurOffsets(r,_))}var w=Y(v);if(v.tagName.includes("Gradient")&&(w=null),w&&"defs"!==v.tagName&&h.numberOfItems){if(m&&1===h.numberOfItems){var A=h.getItem(0).matrix,k=l.createSVGMatrix(),C=zt(v);C&&(k=w.getItem(0).matrix);var E=Lt(v),P=we(w).matrix,G=ve(E.x+E.width/2,E.y+E.height/2,P),N=m+C,I=l.createSVGTransform();I.setRotate(N,G.x,G.y);var T=_e(A,k,I.matrix.inverse());if(C&&w.removeItem(0),N&&(w.numberOfItems?w.insertItemBefore(I,0):w.appendItem(I)),T.e||T.f){var L=l.createSVGTransform();L.setTranslate(T.e,T.f),w.numberOfItems?w.insertItemBefore(L,0):w.appendItem(L)}}else{var V=v.getAttribute("transform");(i={}).transform=V||"";var O=l.createSVGTransform(),M=we(w).matrix,R=M.inverse(),B=_e(R,c,M);O.setMatrix(B),w.appendItem(O)}var F=Dr(v);F&&d.addSubCommand(F)}}}if(u&&((i={}).transform=u,e.setAttribute("transform",""),e.removeAttribute("transform"),d.addSubCommand(new $r(e,i))),t&&!d.isEmpty())return d};this.ungroupSelectedElement=function(){var e=b[0];if(e)if(Yr(e).data("gsvg")||Yr(e).data("symbol"))tr(e);else{if("use"===e.tagName){var t=Wt(Pt(e).substr(1));return Yr(e).data("symbol",t).data("ref",t),void tr(e)}var r=Yr(e).parents("a");if(r.length&&(e=r[0]),"g"===e.tagName||"a"===e.tagName){var n=new Jr("Ungroup Elements"),i=kr(e,!0);i&&n.addSubCommand(i);for(var a=e.parentNode,s=e.nextSibling,o=new Array(e.childNodes.length),u=0;e.firstChild;){var l=e.firstChild,h=l.nextSibling,c=l.parentNode;if("title"!==l.tagName)o[u++]=l=a.insertBefore(l,s),n.addSubCommand(new Zr(l,h,c));else{var d=l.nextSibling;n.addSubCommand(new Kr(l,d,c)),l.remove()}}te();var m=e.nextSibling;e=a.removeChild(e),n.addSubCommand(new Kr(e,m,a)),n.isEmpty()||O(n),ne(o)}}},this.moveToTopSelectedElement=function(){var e=h(b,1)[0];if(!Kt(e)){var t=e,r=t.parentNode,n=t.nextSibling;n!==(t=t.parentNode.appendChild(t)).nextSibling&&(O(new Zr(t,n,r,"top")),X("changed",[t]))}},this.moveToBottomSelectedElement=function(){var e=h(b,1)[0];if(!Kt(e)){var t=e,r=t.parentNode,n=t.nextSibling,i=t.parentNode.firstChild;"title"===i.tagName&&(i=i.nextSibling),"defs"===i.tagName&&(i=i.nextSibling),n!==(t=t.parentNode.insertBefore(t,i)).nextSibling&&(O(new Zr(t,n,r,"bottom")),X("changed",[t]))}},this.moveUpDownSelected=function(e){var t=b[0];if(t){var r,n;Ue=[];var i=Yr(De(jt([t]))).toArray();if("Down"===e&&i.reverse(),Yr.each(i,(function(){return n?(r=this,!1):(this===t&&(n=!0),!0)})),r){var a=t,s=a.parentNode,o=a.nextSibling;Yr(r)["Down"===e?"before":"after"](a),o!==a.nextSibling&&(O(new Zr(a,o,s,"Move "+e)),X("changed",[a]))}}},this.moveSelectedElements=function(e,t,r){e.constructor!==Array&&(e/=v,t/=v),r=r||!0;for(var n=new Jr("position"),i=b.length;i--;){var a=b[i];if(!Kt(a)){var s=l.createSVGTransform(),o=Y(a);e.constructor===Array?s.setTranslate(e[i],t[i]):s.setTranslate(e,t),o.numberOfItems?o.insertItemBefore(s,0):o.appendItem(s);var u=Dr(a);u&&n.addSubCommand(u),D.requestSelector(a).resize()}}if(!n.isEmpty())return r&&O(n),X("changed",b),n},this.cloneSelectedElements=function(e,t){var r,n,i=new Jr("Clone Elements"),a=b.length;for(b.sort((function(e,t){return Yr(t).index()-Yr(e).index()})),r=0;r<a&&(n=b[r],!Kt(n));++r);var s=b.slice(0,r);this.clearSelection(!0);var o=y();for(r=s.length;r--;)n=s[r]=o.copyElem(s[r]),(x||o.getCurrentLayer()).append(n),i.addSubCommand(new Xr(n));i.isEmpty()||(ne(s.reverse()),this.moveSelectedElements(e,t,!1),O(i))},this.alignSelectedElements=function(e,t){var r=[],n=b.length;if(n){for(var i=Number.MAX_VALUE,a=Number.MIN_VALUE,s=Number.MAX_VALUE,u=Number.MIN_VALUE,l=Number.MIN_VALUE,h=Number.MIN_VALUE,c=0;c<n&&!Kt(b[c]);++c){var d=b[c];switch(r[c]=jt([d]),t){case"smallest":(("l"===e||"c"===e||"r"===e)&&(l===Number.MIN_VALUE||l>r[c].width)||("t"===e||"m"===e||"b"===e)&&(h===Number.MIN_VALUE||h>r[c].height))&&(i=r[c].x,s=r[c].y,a=r[c].x+r[c].width,u=r[c].y+r[c].height,l=r[c].width,h=r[c].height);break;case"largest":(("l"===e||"c"===e||"r"===e)&&(l===Number.MIN_VALUE||l<r[c].width)||("t"===e||"m"===e||"b"===e)&&(h===Number.MIN_VALUE||h<r[c].height))&&(i=r[c].x,s=r[c].y,a=r[c].x+r[c].width,u=r[c].y+r[c].height,l=r[c].width,h=r[c].height);break;default:r[c].x<i&&(i=r[c].x),r[c].y<s&&(s=r[c].y),r[c].x+r[c].width>a&&(a=r[c].x+r[c].width),r[c].y+r[c].height>u&&(u=r[c].y+r[c].height)}}"page"===t&&(i=0,s=0,a=o.contentW,u=o.contentH);for(var m=new Array(n),f=new Array(n),g=0;g<n&&!Kt(b[g]);++g){var p=r[g];switch(m[g]=0,f[g]=0,e){case"l":m[g]=i-p.x;break;case"c":m[g]=(i+a)/2-(p.x+p.width/2);break;case"r":m[g]=a-(p.x+p.width);break;case"t":f[g]=s-p.y;break;case"m":f[g]=(s+u)/2-(p.y+p.height/2);break;case"b":f[g]=u-(p.y+p.height)}}this.moveSelectedElements(m,f)}},this.contentW=nr().w,this.contentH=nr().h,this.updateCanvas=function(e,t){l.setAttribute("width",e),l.setAttribute("height",t);var r=Yr("#canvasBackground")[0],n=m.getAttribute("x"),i=m.getAttribute("y"),a=(e-this.contentW*v)/2,s=(t-this.contentH*v)/2;Qt(m,{width:this.contentW*v,height:this.contentH*v,x:a,y:s,viewBox:"0 0 "+this.contentW+" "+this.contentH}),Qt(r,{width:m.getAttribute("width"),height:m.getAttribute("height"),x:a,y:s});var o=Wt("background_image");return o&&Qt(o,{width:"100%",height:"100%"}),D.selectorParentGroup.setAttribute("transform","translate("+a+","+s+")"),je("canvasUpdated",{new_x:a,new_y:s,old_x:n,old_y:i,d_x:a-n,d_y:s-i}),{x:a,y:s,old_x:n,old_y:i,d_x:a-n,d_y:s-i}},this.setBackground=function(e,t){var r=Wt("canvasBackground"),n=Yr(r).find("rect")[0],i=Wt("background_image");n.setAttribute("fill",e),t?(i||(i=u.createElementNS(g.SVG,"image"),Qt(i,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})),Gt(i,t),r.append(i)):i&&i.remove()},this.cycleElement=function(e){var t,r=b[0],n=!1,i=Ht(x||y().getCurrentLayer());if(i.length){if(Kt(r))n=i[t=e?i.length-1:0];else for(var a=i.length;a--;)if(i[a]===r){(t=e?a-1:a+1)>=i.length?t=0:t<0&&(t=i.length-1),n=i[t];break}Ke([n],!0),X("selected",b)}},this.clear(),this.getPrivateMethods=function(){return{addCommandToHistory:O,BatchCommand:Jr,ChangeElementCommand:$r,decode64:_t,dropXMLInteralSubset:yt,encode64:xt,ffClone:Qe,findDefs:Nt,findDuplicateGradient:sr,getElem:Wt,getPathBBox:It,getTypeMap:$,getUrlFromAttr:Et,identifyLayers:dr,InsertElementCommand:Xr,isChrome:F,isIdentity:xe,isIE:B,logMatrix:Ze,MoveElementCommand:Zr,NS:g,preventClickDefault:Xt,RemoveElementCommand:Kr,SVGEditTransformList:W,text2xml:kt,transformBox:be,transformPoint:ve,walkTree:Ct}}}}();
//# sourceMappingURL=svgcanvas-iife.min.js.map
