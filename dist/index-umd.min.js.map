{"version":3,"file":"index-umd.min.js","sources":["../editor/touch.js","../editor/svgedit.js","../editor/pathseg.js","../editor/browser.js","../editor/jquery-svg.js","../editor/svgtransformlist.js","../editor/units.js","../editor/history.js","../editor/math.js","../editor/path.js","../editor/svgutils.js","../editor/contextmenu.js","../editor/external/dynamic-import-polyfill/importModule.js","../editor/layer.js","../editor/historyrecording.js","../editor/draw.js","../editor/sanitize.js","../editor/coords.js","../editor/recalculate.js","../editor/select.js","../editor/svgcanvas.js","../editor/jgraduate/jquery.jgraduate.js","../editor/jgraduate/jpicker.js","../editor/locale/locale.js","../editor/svg-editor.js","../editor/js-hotkeys/jquery.hotkeys.min.js","../editor/jquerybbq/jquery.bbq.min.js","../editor/svgicons/jquery.svgicons.js","../editor/spinbtn/JQuerySpinBtn.js","../editor/contextmenu/jquery.contextMenu.js","../editor/external/load-stylesheets/index-es.js"],"sourcesContent":["// http://ross.posterous.com/2008/08/19/iphone-touch-events-in-javascript/\nfunction touchHandler (event) {\n  const touches = event.changedTouches,\n    first = touches[0];\n  let type = '';\n  switch (event.type) {\n  case 'touchstart': type = 'mousedown'; break;\n  case 'touchmove': type = 'mousemove'; break;\n  case 'touchend': type = 'mouseup'; break;\n  default: return;\n  }\n\n  // initMouseEvent(type, canBubble, cancelable, view, clickCount,\n  //  screenX, screenY, clientX, clientY, ctrlKey,\n  //  altKey, shiftKey, metaKey, button, relatedTarget);\n\n  const simulatedEvent = document.createEvent('MouseEvent');\n  simulatedEvent.initMouseEvent(type, true, true, window, 1,\n    first.screenX, first.screenY,\n    first.clientX, first.clientY, false,\n    false, false, false, 0/* left */, null);\n  if (touches.length < 2) {\n    first.target.dispatchEvent(simulatedEvent);\n    event.preventDefault();\n  }\n}\n\ndocument.addEventListener('touchstart', touchHandler, true);\ndocument.addEventListener('touchmove', touchHandler, true);\ndocument.addEventListener('touchend', touchHandler, true);\ndocument.addEventListener('touchcancel', touchHandler, true);\n","/**\n *\n * Licensed under the MIT License\n */\n\n/**\n* Common namepaces constants in alpha order\n*/\nexport const NS = {\n  HTML: 'http://www.w3.org/1999/xhtml',\n  MATH: 'http://www.w3.org/1998/Math/MathML',\n  SE: 'http://svg-edit.googlecode.com',\n  SVG: 'http://www.w3.org/2000/svg',\n  XLINK: 'http://www.w3.org/1999/xlink',\n  XML: 'http://www.w3.org/XML/1998/namespace',\n  XMLNS: 'http://www.w3.org/2000/xmlns/' // see http://www.w3.org/TR/REC-xml-names/#xmlReserved\n};\n\n/**\n* @returns The NS with key values switched and lowercase\n*/\nexport const getReverseNS = function () {\n  const reverseNS = {};\n  Object.entries(NS).forEach(([name, URI]) => {\n    reverseNS[URI] = name.toLowerCase();\n  });\n  return reverseNS;\n};\n","// SVGPathSeg API polyfill\n// https://github.com/progers/pathseg\n//\n// This is a drop-in replacement for the SVGPathSeg and SVGPathSegList APIs that were removed from\n// SVG2 (https://lists.w3.org/Archives/Public/www-svg/2015Jun/0044.html), including the latest spec\n// changes which were implemented in Firefox 43 and Chrome 46.\n\n(() => {\nif (!('SVGPathSeg' in window)) {\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSeg\n  class SVGPathSeg {\n    constructor (type, typeAsLetter, owningPathSegList) {\n      this.pathSegType = type;\n      this.pathSegTypeAsLetter = typeAsLetter;\n      this._owningPathSegList = owningPathSegList;\n    }\n    // Notify owning PathSegList on any changes so they can be synchronized back to the path element.\n    _segmentChanged () {\n      if (this._owningPathSegList) {\n        this._owningPathSegList.segmentChanged(this);\n      }\n    }\n  }\n  SVGPathSeg.prototype.classname = 'SVGPathSeg';\n\n  SVGPathSeg.PATHSEG_UNKNOWN = 0;\n  SVGPathSeg.PATHSEG_CLOSEPATH = 1;\n  SVGPathSeg.PATHSEG_MOVETO_ABS = 2;\n  SVGPathSeg.PATHSEG_MOVETO_REL = 3;\n  SVGPathSeg.PATHSEG_LINETO_ABS = 4;\n  SVGPathSeg.PATHSEG_LINETO_REL = 5;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS = 6;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL = 7;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS = 8;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL = 9;\n  SVGPathSeg.PATHSEG_ARC_ABS = 10;\n  SVGPathSeg.PATHSEG_ARC_REL = 11;\n  SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS = 12;\n  SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL = 13;\n  SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS = 14;\n  SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL = 15;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS = 16;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL = 17;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS = 18;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL = 19;\n\n  class SVGPathSegClosePath extends SVGPathSeg {\n    constructor (owningPathSegList) {\n      super(SVGPathSeg.PATHSEG_CLOSEPATH, 'z', owningPathSegList);\n    }\n    toString () { return '[object SVGPathSegClosePath]'; }\n    _asPathString () { return this.pathSegTypeAsLetter; }\n    clone () { return new SVGPathSegClosePath(undefined); }\n  }\n\n  class SVGPathSegMovetoAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_MOVETO_ABS, 'M', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegMovetoAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegMovetoAbs(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegMovetoAbs.prototype, {\n    x: {\n      get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true\n    },\n    y: {\n      get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true\n    }\n  });\n\n  class SVGPathSegMovetoRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_MOVETO_REL, 'm', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegMovetoRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegMovetoRel(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegMovetoRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegLinetoAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_ABS, 'L', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoAbs(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegLinetoAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegLinetoRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_REL, 'l', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoRel(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegLinetoRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoCubicAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS, 'C', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicAbs(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoCubicRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL, 'c', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicRel(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS, 'Q', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticAbs(undefined, this._x, this._y, this._x1, this._y1); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL, 'q', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticRel(undefined, this._x, this._y, this._x1, this._y1); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegArcAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {\n      super(SVGPathSeg.PATHSEG_ARC_ABS, 'A', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._r1 = r1;\n      this._r2 = r2;\n      this._angle = angle;\n      this._largeArcFlag = largeArcFlag;\n      this._sweepFlag = sweepFlag;\n    }\n    toString () { return '[object SVGPathSegArcAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._r1 + ' ' + this._r2 + ' ' + this._angle + ' ' + (this._largeArcFlag ? '1' : '0') + ' ' + (this._sweepFlag ? '1' : '0') + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegArcAbs(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag); }\n  }\n  Object.defineProperties(SVGPathSegArcAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    r1: { get () { return this._r1; }, set (r1) { this._r1 = r1; this._segmentChanged(); }, enumerable: true },\n    r2: { get () { return this._r2; }, set (r2) { this._r2 = r2; this._segmentChanged(); }, enumerable: true },\n    angle: { get () { return this._angle; }, set (angle) { this._angle = angle; this._segmentChanged(); }, enumerable: true },\n    largeArcFlag: { get () { return this._largeArcFlag; }, set (largeArcFlag) { this._largeArcFlag = largeArcFlag; this._segmentChanged(); }, enumerable: true },\n    sweepFlag: { get () { return this._sweepFlag; }, set (sweepFlag) { this._sweepFlag = sweepFlag; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegArcRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {\n      super(SVGPathSeg.PATHSEG_ARC_REL, 'a', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._r1 = r1;\n      this._r2 = r2;\n      this._angle = angle;\n      this._largeArcFlag = largeArcFlag;\n      this._sweepFlag = sweepFlag;\n    }\n    toString () { return '[object SVGPathSegArcRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._r1 + ' ' + this._r2 + ' ' + this._angle + ' ' + (this._largeArcFlag ? '1' : '0') + ' ' + (this._sweepFlag ? '1' : '0') + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegArcRel(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag); }\n  }\n  Object.defineProperties(SVGPathSegArcRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    r1: { get () { return this._r1; }, set (r1) { this._r1 = r1; this._segmentChanged(); }, enumerable: true },\n    r2: { get () { return this._r2; }, set (r2) { this._r2 = r2; this._segmentChanged(); }, enumerable: true },\n    angle: { get () { return this._angle; }, set (angle) { this._angle = angle; this._segmentChanged(); }, enumerable: true },\n    largeArcFlag: { get () { return this._largeArcFlag; }, set (largeArcFlag) { this._largeArcFlag = largeArcFlag; this._segmentChanged(); }, enumerable: true },\n    sweepFlag: { get () { return this._sweepFlag; }, set (sweepFlag) { this._sweepFlag = sweepFlag; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegLinetoHorizontalAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x) {\n      super(SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS, 'H', owningPathSegList);\n      this._x = x;\n    }\n    toString () { return '[object SVGPathSegLinetoHorizontalAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x; }\n    clone () { return new SVGPathSegLinetoHorizontalAbs(undefined, this._x); }\n  }\n  Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype, 'x', { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegLinetoHorizontalRel extends SVGPathSeg {\n    constructor (owningPathSegList, x) {\n      super(SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL, 'h', owningPathSegList);\n      this._x = x;\n    }\n    toString () { return '[object SVGPathSegLinetoHorizontalRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x; }\n    clone () { return new SVGPathSegLinetoHorizontalRel(undefined, this._x); }\n  }\n  Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype, 'x', { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegLinetoVerticalAbs extends SVGPathSeg {\n    constructor (owningPathSegList, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS, 'V', owningPathSegList);\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoVerticalAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoVerticalAbs(undefined, this._y); }\n  }\n  Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype, 'y', { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegLinetoVerticalRel extends SVGPathSeg {\n    constructor (owningPathSegList, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL, 'v', owningPathSegList);\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoVerticalRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoVerticalRel(undefined, this._y); }\n  }\n  Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype, 'y', { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegCurvetoCubicSmoothAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS, 'S', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicSmoothAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicSmoothAbs(undefined, this._x, this._y, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicSmoothAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoCubicSmoothRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL, 's', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicSmoothRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicSmoothRel(undefined, this._x, this._y, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicSmoothRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticSmoothAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS, 'T', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticSmoothAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticSmoothAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticSmoothRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL, 't', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticSmoothRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticSmoothRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  // Add createSVGPathSeg* functions to SVGPathElement.\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathElement.\n  SVGPathElement.prototype.createSVGPathSegClosePath = function () { return new SVGPathSegClosePath(undefined); };\n  SVGPathElement.prototype.createSVGPathSegMovetoAbs = function (x, y) { return new SVGPathSegMovetoAbs(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegMovetoRel = function (x, y) { return new SVGPathSegMovetoRel(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegLinetoAbs = function (x, y) { return new SVGPathSegLinetoAbs(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegLinetoRel = function (x, y) { return new SVGPathSegLinetoRel(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs = function (x, y, x1, y1, x2, y2) { return new SVGPathSegCurvetoCubicAbs(undefined, x, y, x1, y1, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel = function (x, y, x1, y1, x2, y2) { return new SVGPathSegCurvetoCubicRel(undefined, x, y, x1, y1, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs = function (x, y, x1, y1) { return new SVGPathSegCurvetoQuadraticAbs(undefined, x, y, x1, y1); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel = function (x, y, x1, y1) { return new SVGPathSegCurvetoQuadraticRel(undefined, x, y, x1, y1); };\n  SVGPathElement.prototype.createSVGPathSegArcAbs = function (x, y, r1, r2, angle, largeArcFlag, sweepFlag) { return new SVGPathSegArcAbs(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag); };\n  SVGPathElement.prototype.createSVGPathSegArcRel = function (x, y, r1, r2, angle, largeArcFlag, sweepFlag) { return new SVGPathSegArcRel(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag); };\n  SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs = function (x) { return new SVGPathSegLinetoHorizontalAbs(undefined, x); };\n  SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel = function (x) { return new SVGPathSegLinetoHorizontalRel(undefined, x); };\n  SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs = function (y) { return new SVGPathSegLinetoVerticalAbs(undefined, y); };\n  SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel = function (y) { return new SVGPathSegLinetoVerticalRel(undefined, y); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs = function (x, y, x2, y2) { return new SVGPathSegCurvetoCubicSmoothAbs(undefined, x, y, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel = function (x, y, x2, y2) { return new SVGPathSegCurvetoCubicSmoothRel(undefined, x, y, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs = function (x, y) { return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel = function (x, y) { return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, x, y); };\n\n  if (!('getPathSegAtLength' in SVGPathElement.prototype)) {\n    // Add getPathSegAtLength to SVGPathElement.\n    // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-__svg__SVGPathElement__getPathSegAtLength\n    // This polyfill requires SVGPathElement.getTotalLength to implement the distance-along-a-path algorithm.\n    SVGPathElement.prototype.getPathSegAtLength = function (distance) {\n      if (distance === undefined || !isFinite(distance)) {\n        throw new Error('Invalid arguments.');\n      }\n\n      const measurementElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n      measurementElement.setAttribute('d', this.getAttribute('d'));\n      let lastPathSegment = measurementElement.pathSegList.numberOfItems - 1;\n\n      // If the path is empty, return 0.\n      if (lastPathSegment <= 0) {\n        return 0;\n      }\n\n      do {\n        measurementElement.pathSegList.removeItem(lastPathSegment);\n        if (distance > measurementElement.getTotalLength()) {\n          break;\n        }\n        lastPathSegment--;\n      } while (lastPathSegment > 0);\n      return lastPathSegment;\n    };\n  }\n\n  window.SVGPathSeg = SVGPathSeg;\n  window.SVGPathSegClosePath = SVGPathSegClosePath;\n  window.SVGPathSegMovetoAbs = SVGPathSegMovetoAbs;\n  window.SVGPathSegMovetoRel = SVGPathSegMovetoRel;\n  window.SVGPathSegLinetoAbs = SVGPathSegLinetoAbs;\n  window.SVGPathSegLinetoRel = SVGPathSegLinetoRel;\n  window.SVGPathSegCurvetoCubicAbs = SVGPathSegCurvetoCubicAbs;\n  window.SVGPathSegCurvetoCubicRel = SVGPathSegCurvetoCubicRel;\n  window.SVGPathSegCurvetoQuadraticAbs = SVGPathSegCurvetoQuadraticAbs;\n  window.SVGPathSegCurvetoQuadraticRel = SVGPathSegCurvetoQuadraticRel;\n  window.SVGPathSegArcAbs = SVGPathSegArcAbs;\n  window.SVGPathSegArcRel = SVGPathSegArcRel;\n  window.SVGPathSegLinetoHorizontalAbs = SVGPathSegLinetoHorizontalAbs;\n  window.SVGPathSegLinetoHorizontalRel = SVGPathSegLinetoHorizontalRel;\n  window.SVGPathSegLinetoVerticalAbs = SVGPathSegLinetoVerticalAbs;\n  window.SVGPathSegLinetoVerticalRel = SVGPathSegLinetoVerticalRel;\n  window.SVGPathSegCurvetoCubicSmoothAbs = SVGPathSegCurvetoCubicSmoothAbs;\n  window.SVGPathSegCurvetoCubicSmoothRel = SVGPathSegCurvetoCubicSmoothRel;\n  window.SVGPathSegCurvetoQuadraticSmoothAbs = SVGPathSegCurvetoQuadraticSmoothAbs;\n  window.SVGPathSegCurvetoQuadraticSmoothRel = SVGPathSegCurvetoQuadraticSmoothRel;\n}\n\n// Checking for SVGPathSegList in window checks for the case of an implementation without the\n// SVGPathSegList API.\n// The second check for appendItem is specific to Firefox 59+ which removed only parts of the\n// SVGPathSegList API (e.g., appendItem). In this case we need to re-implement the entire API\n// so the polyfill data (i.e., _list) is used throughout.\nif (!('SVGPathSegList' in window) || !('appendItem' in SVGPathSegList.prototype)) {\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSegList\n  class SVGPathSegList {\n    constructor (pathElement) {\n      this._pathElement = pathElement;\n      this._list = this._parsePath(this._pathElement.getAttribute('d'));\n\n      // Use a MutationObserver to catch changes to the path's \"d\" attribute.\n      this._mutationObserverConfig = {attributes: true, attributeFilter: ['d']};\n      this._pathElementMutationObserver = new MutationObserver(this._updateListFromPathMutations.bind(this));\n      this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);\n    }\n    // Process any pending mutations to the path element and update the list as needed.\n    // This should be the first call of all public functions and is needed because\n    // MutationObservers are not synchronous so we can have pending asynchronous mutations.\n    _checkPathSynchronizedToList () {\n      this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords());\n    }\n\n    _updateListFromPathMutations (mutationRecords) {\n      if (!this._pathElement) {\n        return;\n      }\n      let hasPathMutations = false;\n      mutationRecords.forEach((record) => {\n        if (record.attributeName === 'd') {\n          hasPathMutations = true;\n        }\n      });\n      if (hasPathMutations) {\n        this._list = this._parsePath(this._pathElement.getAttribute('d'));\n      }\n    }\n\n    // Serialize the list and update the path's 'd' attribute.\n    _writeListToPath () {\n      this._pathElementMutationObserver.disconnect();\n      this._pathElement.setAttribute('d', SVGPathSegList._pathSegArrayAsString(this._list));\n      this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);\n    }\n\n    // When a path segment changes the list needs to be synchronized back to the path element.\n    segmentChanged (pathSeg) {\n      this._writeListToPath();\n    }\n\n    clear () {\n      this._checkPathSynchronizedToList();\n\n      this._list.forEach((pathSeg) => {\n        pathSeg._owningPathSegList = null;\n      });\n      this._list = [];\n      this._writeListToPath();\n    }\n\n    initialize (newItem) {\n      this._checkPathSynchronizedToList();\n\n      this._list = [newItem];\n      newItem._owningPathSegList = this;\n      this._writeListToPath();\n      return newItem;\n    }\n\n    _checkValidIndex (index) {\n      if (isNaN(index) || index < 0 || index >= this.numberOfItems) {\n        throw new Error('INDEX_SIZE_ERR');\n      }\n    }\n\n    getItem (index) {\n      this._checkPathSynchronizedToList();\n\n      this._checkValidIndex(index);\n      return this._list[index];\n    }\n\n    insertItemBefore (newItem, index) {\n      this._checkPathSynchronizedToList();\n\n      // Spec: If the index is greater than or equal to numberOfItems, then the new item is appended to the end of the list.\n      if (index > this.numberOfItems) {\n        index = this.numberOfItems;\n      }\n      if (newItem._owningPathSegList) {\n        // SVG2 spec says to make a copy.\n        newItem = newItem.clone();\n      }\n      this._list.splice(index, 0, newItem);\n      newItem._owningPathSegList = this;\n      this._writeListToPath();\n      return newItem;\n    }\n\n    replaceItem (newItem, index) {\n      this._checkPathSynchronizedToList();\n\n      if (newItem._owningPathSegList) {\n        // SVG2 spec says to make a copy.\n        newItem = newItem.clone();\n      }\n      this._checkValidIndex(index);\n      this._list[index] = newItem;\n      newItem._owningPathSegList = this;\n      this._writeListToPath();\n      return newItem;\n    }\n\n    removeItem (index) {\n      this._checkPathSynchronizedToList();\n\n      this._checkValidIndex(index);\n      const item = this._list[index];\n      this._list.splice(index, 1);\n      this._writeListToPath();\n      return item;\n    }\n\n    appendItem (newItem) {\n      this._checkPathSynchronizedToList();\n\n      if (newItem._owningPathSegList) {\n        // SVG2 spec says to make a copy.\n        newItem = newItem.clone();\n      }\n      this._list.push(newItem);\n      newItem._owningPathSegList = this;\n      // TODO: Optimize this to just append to the existing attribute.\n      this._writeListToPath();\n      return newItem;\n    }\n\n    // This closely follows SVGPathParser::parsePath from Source/core/svg/SVGPathParser.cpp.\n    _parsePath (string) {\n      if (!string || !string.length) {\n        return [];\n      }\n\n      const owningPathSegList = this;\n\n      class Builder {\n        constructor () {\n          this.pathSegList = [];\n        }\n        appendSegment (pathSeg) {\n          this.pathSegList.push(pathSeg);\n        }\n      }\n\n      class Source {\n        constructor (string) {\n          this._string = string;\n          this._currentIndex = 0;\n          this._endIndex = this._string.length;\n          this._previousCommand = SVGPathSeg.PATHSEG_UNKNOWN;\n\n          this._skipOptionalSpaces();\n        }\n        _isCurrentSpace () {\n          const character = this._string[this._currentIndex];\n          return character <= ' ' && (character === ' ' || character === '\\n' || character === '\\t' || character === '\\r' || character === '\\f');\n        }\n\n        _skipOptionalSpaces () {\n          while (this._currentIndex < this._endIndex && this._isCurrentSpace()) {\n            this._currentIndex++;\n          }\n          return this._currentIndex < this._endIndex;\n        }\n\n        _skipOptionalSpacesOrDelimiter () {\n          if (this._currentIndex < this._endIndex && !this._isCurrentSpace() && this._string.charAt(this._currentIndex) !== ',') {\n            return false;\n          }\n          if (this._skipOptionalSpaces()) {\n            if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === ',') {\n              this._currentIndex++;\n              this._skipOptionalSpaces();\n            }\n          }\n          return this._currentIndex < this._endIndex;\n        }\n\n        hasMoreData () {\n          return this._currentIndex < this._endIndex;\n        }\n\n        peekSegmentType () {\n          const lookahead = this._string[this._currentIndex];\n          return this._pathSegTypeFromChar(lookahead);\n        }\n\n        _pathSegTypeFromChar (lookahead) {\n          switch (lookahead) {\n          case 'Z':\n          case 'z':\n            return SVGPathSeg.PATHSEG_CLOSEPATH;\n          case 'M':\n            return SVGPathSeg.PATHSEG_MOVETO_ABS;\n          case 'm':\n            return SVGPathSeg.PATHSEG_MOVETO_REL;\n          case 'L':\n            return SVGPathSeg.PATHSEG_LINETO_ABS;\n          case 'l':\n            return SVGPathSeg.PATHSEG_LINETO_REL;\n          case 'C':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;\n          case 'c':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;\n          case 'Q':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;\n          case 'q':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;\n          case 'A':\n            return SVGPathSeg.PATHSEG_ARC_ABS;\n          case 'a':\n            return SVGPathSeg.PATHSEG_ARC_REL;\n          case 'H':\n            return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;\n          case 'h':\n            return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;\n          case 'V':\n            return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;\n          case 'v':\n            return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;\n          case 'S':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;\n          case 's':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;\n          case 'T':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;\n          case 't':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;\n          default:\n            return SVGPathSeg.PATHSEG_UNKNOWN;\n          }\n        }\n\n        _nextCommandHelper (lookahead, previousCommand) {\n          // Check for remaining coordinates in the current command.\n          if ((lookahead === '+' || lookahead === '-' || lookahead === '.' || (lookahead >= '0' && lookahead <= '9')) && previousCommand !== SVGPathSeg.PATHSEG_CLOSEPATH) {\n            if (previousCommand === SVGPathSeg.PATHSEG_MOVETO_ABS) {\n              return SVGPathSeg.PATHSEG_LINETO_ABS;\n            }\n            if (previousCommand === SVGPathSeg.PATHSEG_MOVETO_REL) {\n              return SVGPathSeg.PATHSEG_LINETO_REL;\n            }\n            return previousCommand;\n          }\n          return SVGPathSeg.PATHSEG_UNKNOWN;\n        }\n\n        initialCommandIsMoveTo () {\n          // If the path is empty it is still valid, so return true.\n          if (!this.hasMoreData()) {\n            return true;\n          }\n          const command = this.peekSegmentType();\n          // Path must start with moveTo.\n          return command === SVGPathSeg.PATHSEG_MOVETO_ABS || command === SVGPathSeg.PATHSEG_MOVETO_REL;\n        }\n\n        // Parse a number from an SVG path. This very closely follows genericParseNumber(...) from Source/core/svg/SVGParserUtilities.cpp.\n        // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-PathDataBNF\n        _parseNumber () {\n          let exponent = 0;\n          let integer = 0;\n          let frac = 1;\n          let decimal = 0;\n          let sign = 1;\n          let expsign = 1;\n\n          const startIndex = this._currentIndex;\n\n          this._skipOptionalSpaces();\n\n          // Read the sign.\n          if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === '+') {\n            this._currentIndex++;\n          } else if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === '-') {\n            this._currentIndex++;\n            sign = -1;\n          }\n\n          if (this._currentIndex === this._endIndex || ((this._string.charAt(this._currentIndex) < '0' || this._string.charAt(this._currentIndex) > '9') && this._string.charAt(this._currentIndex) !== '.')) {\n            // The first character of a number must be one of [0-9+-.].\n            return undefined;\n          }\n\n          // Read the integer part, build right-to-left.\n          const startIntPartIndex = this._currentIndex;\n          while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= '0' && this._string.charAt(this._currentIndex) <= '9') {\n            this._currentIndex++; // Advance to first non-digit.\n          }\n\n          if (this._currentIndex !== startIntPartIndex) {\n            let scanIntPartIndex = this._currentIndex - 1;\n            let multiplier = 1;\n            while (scanIntPartIndex >= startIntPartIndex) {\n              integer += multiplier * (this._string.charAt(scanIntPartIndex--) - '0');\n              multiplier *= 10;\n            }\n          }\n\n          // Read the decimals.\n          if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === '.') {\n            this._currentIndex++;\n\n            // There must be a least one digit following the .\n            if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < '0' || this._string.charAt(this._currentIndex) > '9') {\n              return undefined;\n            }\n            while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= '0' && this._string.charAt(this._currentIndex) <= '9') {\n              frac *= 10;\n              decimal += (this._string.charAt(this._currentIndex) - '0') / frac;\n              this._currentIndex += 1;\n            }\n          }\n\n          // Read the exponent part.\n          if (this._currentIndex !== startIndex && this._currentIndex + 1 < this._endIndex && (this._string.charAt(this._currentIndex) === 'e' || this._string.charAt(this._currentIndex) === 'E') && (this._string.charAt(this._currentIndex + 1) !== 'x' && this._string.charAt(this._currentIndex + 1) !== 'm')) {\n            this._currentIndex++;\n\n            // Read the sign of the exponent.\n            if (this._string.charAt(this._currentIndex) === '+') {\n              this._currentIndex++;\n            } else if (this._string.charAt(this._currentIndex) === '-') {\n              this._currentIndex++;\n              expsign = -1;\n            }\n\n            // There must be an exponent.\n            if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < '0' || this._string.charAt(this._currentIndex) > '9') {\n              return undefined;\n            }\n\n            while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= '0' && this._string.charAt(this._currentIndex) <= '9') {\n              exponent *= 10;\n              exponent += (this._string.charAt(this._currentIndex) - '0');\n              this._currentIndex++;\n            }\n          }\n\n          let number = integer + decimal;\n          number *= sign;\n\n          if (exponent) {\n            number *= Math.pow(10, expsign * exponent);\n          }\n\n          if (startIndex === this._currentIndex) {\n            return undefined;\n          }\n\n          this._skipOptionalSpacesOrDelimiter();\n\n          return number;\n        }\n\n        _parseArcFlag () {\n          if (this._currentIndex >= this._endIndex) {\n            return undefined;\n          }\n          let flag = false;\n          const flagChar = this._string.charAt(this._currentIndex++);\n          if (flagChar === '0') {\n            flag = false;\n          } else if (flagChar === '1') {\n            flag = true;\n          } else {\n            return undefined;\n          }\n\n          this._skipOptionalSpacesOrDelimiter();\n          return flag;\n        }\n\n        parseSegment () {\n          const lookahead = this._string[this._currentIndex];\n          let command = this._pathSegTypeFromChar(lookahead);\n          if (command === SVGPathSeg.PATHSEG_UNKNOWN) {\n            // Possibly an implicit command. Not allowed if this is the first command.\n            if (this._previousCommand === SVGPathSeg.PATHSEG_UNKNOWN) {\n              return null;\n            }\n            command = this._nextCommandHelper(lookahead, this._previousCommand);\n            if (command === SVGPathSeg.PATHSEG_UNKNOWN) {\n              return null;\n            }\n          } else {\n            this._currentIndex++;\n          }\n\n          this._previousCommand = command;\n\n          switch (command) {\n          case SVGPathSeg.PATHSEG_MOVETO_REL:\n            return new SVGPathSegMovetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_MOVETO_ABS:\n            return new SVGPathSegMovetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_REL:\n            return new SVGPathSegLinetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_ABS:\n            return new SVGPathSegLinetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:\n            return new SVGPathSegLinetoHorizontalRel(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:\n            return new SVGPathSegLinetoHorizontalAbs(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:\n            return new SVGPathSegLinetoVerticalRel(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:\n            return new SVGPathSegLinetoVerticalAbs(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_CLOSEPATH:\n            this._skipOptionalSpaces();\n            return new SVGPathSegClosePath(owningPathSegList);\n          case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL: {\n            const points = {x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicSmoothRel(owningPathSegList, points.x, points.y, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS: {\n            const points = {x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicSmoothAbs(owningPathSegList, points.x, points.y, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoQuadraticRel(owningPathSegList, points.x, points.y, points.x1, points.y1);\n          } case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoQuadraticAbs(owningPathSegList, points.x, points.y, points.x1, points.y1);\n          case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:\n            return new SVGPathSegCurvetoQuadraticSmoothRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:\n            return new SVGPathSegCurvetoQuadraticSmoothAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_ARC_REL: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegArcRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);\n          } case SVGPathSeg.PATHSEG_ARC_ABS: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegArcAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);\n          } default:\n            throw new Error('Unknown path seg type.');\n          }\n        }\n      }\n\n      const builder = new Builder();\n      const source = new Source(string);\n\n      if (!source.initialCommandIsMoveTo()) {\n        return [];\n      }\n      while (source.hasMoreData()) {\n        const pathSeg = source.parseSegment();\n        if (!pathSeg) {\n          return [];\n        }\n        builder.appendSegment(pathSeg);\n      }\n\n      return builder.pathSegList;\n    }\n  }\n\n  SVGPathSegList.prototype.classname = 'SVGPathSegList';\n\n  Object.defineProperty(SVGPathSegList.prototype, 'numberOfItems', {\n    get () {\n      this._checkPathSynchronizedToList();\n      return this._list.length;\n    },\n    enumerable: true\n  });\n\n  SVGPathSegList._pathSegArrayAsString = function (pathSegArray) {\n    let string = '';\n    let first = true;\n    pathSegArray.forEach((pathSeg) => {\n      if (first) {\n        first = false;\n        string += pathSeg._asPathString();\n      } else {\n        string += ' ' + pathSeg._asPathString();\n      }\n    });\n    return string;\n  };\n\n  // Add the pathSegList accessors to SVGPathElement.\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGAnimatedPathData\n  Object.defineProperties(SVGPathElement.prototype, {\n    pathSegList: {\n      get () {\n        if (!this._pathSegList) {\n          this._pathSegList = new SVGPathSegList(this);\n        }\n        return this._pathSegList;\n      },\n      enumerable: true\n    },\n    // FIXME: The following are not implemented and simply return SVGPathElement.pathSegList.\n    normalizedPathSegList: { get () { return this.pathSegList; }, enumerable: true },\n    animatedPathSegList: { get () { return this.pathSegList; }, enumerable: true },\n    animatedNormalizedPathSegList: { get () { return this.pathSegList; }, enumerable: true }\n  });\n  window.SVGPathSegList = SVGPathSegList;\n}\n})();\n","/* globals jQuery */\n/**\n * Package: svgedit.browser\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Jeff Schiller\n * Copyright(c) 2010 Alexis Deveria\n */\n\n// Dependencies:\n// 1) jQuery (for $.alert())\n\nimport './pathseg.js';\nimport {NS} from './svgedit.js';\n\nconst $ = jQuery;\n\nconst supportsSvg_ = (function () {\nreturn !!document.createElementNS && !!document.createElementNS(NS.SVG, 'svg').createSVGRect;\n}());\n\nexport const supportsSvg = () => supportsSvg_;\n\nconst {userAgent} = navigator;\nconst svg = document.createElementNS(NS.SVG, 'svg');\n\n// Note: Browser sniffing should only be used if no other detection method is possible\nconst isOpera_ = !!window.opera;\nconst isWebkit_ = userAgent.includes('AppleWebKit');\nconst isGecko_ = userAgent.includes('Gecko/');\nconst isIE_ = userAgent.includes('MSIE');\nconst isChrome_ = userAgent.includes('Chrome/');\nconst isWindows_ = userAgent.includes('Windows');\nconst isMac_ = userAgent.includes('Macintosh');\nconst isTouch_ = 'ontouchstart' in window;\n\nconst supportsSelectors_ = (function () {\nreturn !!svg.querySelector;\n}());\n\nconst supportsXpath_ = (function () {\nreturn !!document.evaluate;\n}());\n\n// segList functions (for FF1.5 and 2.0)\nconst supportsPathReplaceItem_ = (function () {\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 10,10');\nconst seglist = path.pathSegList;\nconst seg = path.createSVGPathSegLinetoAbs(5, 5);\ntry {\n  seglist.replaceItem(seg, 1);\n  return true;\n} catch (err) {}\nreturn false;\n}());\n\nconst supportsPathInsertItemBefore_ = (function () {\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 10,10');\nconst seglist = path.pathSegList;\nconst seg = path.createSVGPathSegLinetoAbs(5, 5);\ntry {\n  seglist.insertItemBefore(seg, 1);\n  return true;\n} catch (err) {}\nreturn false;\n}());\n\n// text character positioning (for IE9)\nconst supportsGoodTextCharPos_ = (function () {\nconst svgroot = document.createElementNS(NS.SVG, 'svg');\nconst svgcontent = document.createElementNS(NS.SVG, 'svg');\ndocument.documentElement.append(svgroot);\nsvgcontent.setAttribute('x', 5);\nsvgroot.append(svgcontent);\nconst text = document.createElementNS(NS.SVG, 'text');\ntext.textContent = 'a';\nsvgcontent.append(text);\nconst pos = text.getStartPositionOfChar(0).x;\nsvgroot.remove();\nreturn (pos === 0);\n}());\n\nconst supportsPathBBox_ = (function () {\nconst svgcontent = document.createElementNS(NS.SVG, 'svg');\ndocument.documentElement.append(svgcontent);\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 C0,0 10,10 10,0');\nsvgcontent.append(path);\nconst bbox = path.getBBox();\nsvgcontent.remove();\nreturn (bbox.height > 4 && bbox.height < 5);\n}());\n\n// Support for correct bbox sizing on groups with horizontal/vertical lines\nconst supportsHVLineContainerBBox_ = (function () {\nconst svgcontent = document.createElementNS(NS.SVG, 'svg');\ndocument.documentElement.append(svgcontent);\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 10,0');\nconst path2 = document.createElementNS(NS.SVG, 'path');\npath2.setAttribute('d', 'M5,0 15,0');\nconst g = document.createElementNS(NS.SVG, 'g');\ng.append(path, path2);\nsvgcontent.append(g);\nconst bbox = g.getBBox();\nsvgcontent.remove();\n// Webkit gives 0, FF gives 10, Opera (correctly) gives 15\nreturn (bbox.width === 15);\n}());\n\nconst supportsEditableText_ = (function () {\n// TODO: Find better way to check support for this\nreturn isOpera_;\n}());\n\nconst supportsGoodDecimals_ = (function () {\n// Correct decimals on clone attributes (Opera < 10.5/win/non-en)\nconst rect = document.createElementNS(NS.SVG, 'rect');\nrect.setAttribute('x', 0.1);\nconst crect = rect.cloneNode(false);\nconst retValue = (!crect.getAttribute('x').includes(','));\nif (!retValue) {\n  // Todo: i18nize or remove\n  $.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\\n' +\n\t'Please upgrade to the <a href=\"http://opera.com\">latest version</a> in which the problems have been fixed.');\n}\nreturn retValue;\n}());\n\nconst supportsNonScalingStroke_ = (function () {\nconst rect = document.createElementNS(NS.SVG, 'rect');\nrect.setAttribute('style', 'vector-effect:non-scaling-stroke');\nreturn rect.style.vectorEffect === 'non-scaling-stroke';\n}());\n\nlet supportsNativeSVGTransformLists_ = (function () {\nconst rect = document.createElementNS(NS.SVG, 'rect');\nconst rxform = rect.transform.baseVal;\nconst t1 = svg.createSVGTransform();\nrxform.appendItem(t1);\nconst r1 = rxform.getItem(0);\n// Todo: Do frame-independent instance checking\nreturn r1 instanceof SVGTransform && t1 instanceof SVGTransform &&\n\tr1.type === t1.type && r1.angle === t1.angle &&\n\tr1.matrix.a === t1.matrix.a &&\n\tr1.matrix.b === t1.matrix.b &&\n\tr1.matrix.c === t1.matrix.c &&\n\tr1.matrix.d === t1.matrix.d &&\n\tr1.matrix.e === t1.matrix.e &&\n\tr1.matrix.f === t1.matrix.f;\n}());\n\n// Public API\n\nexport const isOpera = () => isOpera_;\nexport const isWebkit = () => isWebkit_;\nexport const isGecko = () => isGecko_;\nexport const isIE = () => isIE_;\nexport const isChrome = () => isChrome_;\nexport const isWindows = () => isWindows_;\nexport const isMac = () => isMac_;\nexport const isTouch = () => isTouch_;\n\nexport const supportsSelectors = () => supportsSelectors_;\nexport const supportsXpath = () => supportsXpath_;\n\nexport const supportsPathReplaceItem = () => supportsPathReplaceItem_;\nexport const supportsPathInsertItemBefore = () => supportsPathInsertItemBefore_;\nexport const supportsPathBBox = () => supportsPathBBox_;\nexport const supportsHVLineContainerBBox = () => supportsHVLineContainerBBox_;\nexport const supportsGoodTextCharPos = () => supportsGoodTextCharPos_;\nexport const supportsEditableText = () => supportsEditableText_;\nexport const supportsGoodDecimals = () => supportsGoodDecimals_;\nexport const supportsNonScalingStroke = () => supportsNonScalingStroke_;\nexport const supportsNativeTransformLists = () => supportsNativeSVGTransformLists_;\n\n// Using for unit testing\nexport const disableSupportsNativeTransformLists = () => {\n  supportsNativeSVGTransformLists_ = false;\n};\n","/**\n * jQuery module to work with SVG.\n *\n * Licensed under the MIT License\n *\n */\n\n// This fixes $(...).attr() to work as expected with SVG elements.\n// Does not currently use *AttributeNS() since we rarely need that.\n\n// See https://api.jquery.com/attr/ for basic documentation of .attr()\n\n// Additional functionality:\n// - When getting attributes, a string that's a number is returned as type number.\n// - If an array is supplied as the first parameter, multiple values are returned\n//    as an object with values for each given attribute\n\nexport default function ($) {\n  const proxied = $.fn.attr,\n    svgns = 'http://www.w3.org/2000/svg';\n  $.fn.attr = function (key, value) {\n    const len = this.length;\n    if (!len) { return proxied.apply(this, arguments); }\n    for (let i = 0; i < len; ++i) {\n      const elem = this[i];\n      // set/get SVG attribute\n      if (elem.namespaceURI === svgns) {\n        // Setting attribute\n        if (value !== undefined) {\n          elem.setAttribute(key, value);\n        } else if (Array.isArray(key)) {\n          // Getting attributes from array\n          const obj = {};\n          let j = key.length;\n\n          while (j--) {\n            const aname = key[j];\n            let attr = elem.getAttribute(aname);\n            // This returns a number when appropriate\n            if (attr || attr === '0') {\n              attr = isNaN(attr) ? attr : (attr - 0);\n            }\n            obj[aname] = attr;\n          }\n          return obj;\n        }\n        if (typeof key === 'object') {\n          // Setting attributes from object\n          for (const v in key) {\n            elem.setAttribute(v, key[v]);\n          }\n        // Getting attribute\n        } else {\n          let attr = elem.getAttribute(key);\n          if (attr || attr === '0') {\n            attr = isNaN(attr) ? attr : (attr - 0);\n          }\n          return attr;\n        }\n      } else {\n        return proxied.apply(this, arguments);\n      }\n    }\n    return this;\n  };\n  return $;\n}\n","/**\n * SVGTransformList\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Jeff Schiller\n */\n\nimport {NS} from './svgedit.js';\nimport {supportsNativeTransformLists} from './browser.js';\n\nconst svgroot = document.createElementNS(NS.SVG, 'svg');\n\n// Helper function.\nfunction transformToString (xform) {\n  const m = xform.matrix;\n  let text = '';\n  switch (xform.type) {\n  case 1: // MATRIX\n    text = 'matrix(' + [m.a, m.b, m.c, m.d, m.e, m.f].join(',') + ')';\n    break;\n  case 2: // TRANSLATE\n    text = 'translate(' + m.e + ',' + m.f + ')';\n    break;\n  case 3: // SCALE\n    if (m.a === m.d) {\n      text = 'scale(' + m.a + ')';\n    } else {\n      text = 'scale(' + m.a + ',' + m.d + ')';\n    }\n    break;\n  case 4: { // ROTATE\n    let cx = 0;\n    let cy = 0;\n    // this prevents divide by zero\n    if (xform.angle !== 0) {\n      const K = 1 - m.a;\n      cy = (K * m.f + m.b * m.e) / (K * K + m.b * m.b);\n      cx = (m.e - m.b * cy) / K;\n    }\n    text = 'rotate(' + xform.angle + ' ' + cx + ',' + cy + ')';\n    break;\n  }\n  }\n  return text;\n}\n\n/**\n * Map of SVGTransformList objects.\n */\nlet listMap_ = {};\n\n// **************************************************************************************\n// SVGTransformList implementation for Webkit\n// These methods do not currently raise any exceptions.\n// These methods also do not check that transforms are being inserted.  This is basically\n// implementing as much of SVGTransformList that we need to get the job done.\n//\n//  interface SVGEditTransformList {\n//    attribute unsigned long numberOfItems;\n//    void   clear (  )\n//    SVGTransform initialize ( in SVGTransform newItem )\n//    SVGTransform getItem ( in unsigned long index ) (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n//    SVGTransform insertItemBefore ( in SVGTransform newItem, in unsigned long index ) (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n//    SVGTransform replaceItem ( in SVGTransform newItem, in unsigned long index ) (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n//    SVGTransform removeItem ( in unsigned long index ) (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n//    SVGTransform appendItem ( in SVGTransform newItem )\n//    NOT IMPLEMENTED: SVGTransform createSVGTransformFromMatrix ( in SVGMatrix matrix );\n//    NOT IMPLEMENTED: SVGTransform consolidate (  );\n//  }\n// **************************************************************************************\nexport class SVGTransformList {\n  constructor (elem) {\n    this._elem = elem || null;\n    this._xforms = [];\n    // TODO: how do we capture the undo-ability in the changed transform list?\n    this._update = function () {\n      let tstr = '';\n      /* const concatMatrix = */ svgroot.createSVGMatrix();\n      for (let i = 0; i < this.numberOfItems; ++i) {\n        const xform = this._list.getItem(i);\n        tstr += transformToString(xform) + ' ';\n      }\n      this._elem.setAttribute('transform', tstr);\n    };\n    this._list = this;\n    this._init = function () {\n      // Transform attribute parser\n      let str = this._elem.getAttribute('transform');\n      if (!str) { return; }\n\n      // TODO: Add skew support in future\n      const re = /\\s*((scale|matrix|rotate|translate)\\s*\\(.*?\\))\\s*,?\\s*/;\n      let m = true;\n      while (m) {\n        m = str.match(re);\n        str = str.replace(re, '');\n        if (m && m[1]) {\n          const x = m[1];\n          const bits = x.split(/\\s*\\(/);\n          const name = bits[0];\n          const valBits = bits[1].match(/\\s*(.*?)\\s*\\)/);\n          valBits[1] = valBits[1].replace(/(\\d)-/g, '$1 -');\n          const valArr = valBits[1].split(/[, ]+/);\n          const letters = 'abcdef'.split('');\n          const mtx = svgroot.createSVGMatrix();\n          Object.values(valArr).forEach(function (item, i) {\n            valArr[i] = parseFloat(item);\n            if (name === 'matrix') {\n              mtx[letters[i]] = valArr[i];\n            }\n          });\n          const xform = svgroot.createSVGTransform();\n          const fname = 'set' + name.charAt(0).toUpperCase() + name.slice(1);\n          const values = name === 'matrix' ? [mtx] : valArr;\n\n          if (name === 'scale' && values.length === 1) {\n            values.push(values[0]);\n          } else if (name === 'translate' && values.length === 1) {\n            values.push(0);\n          } else if (name === 'rotate' && values.length === 1) {\n            values.push(0, 0);\n          }\n          xform[fname].apply(xform, values);\n          this._list.appendItem(xform);\n        }\n      }\n    };\n    this._removeFromOtherLists = function (item) {\n      if (item) {\n        // Check if this transform is already in a transformlist, and\n        // remove it if so.\n        let found = false;\n        for (const id in listMap_) {\n          const tl = listMap_[id];\n          for (let i = 0, len = tl._xforms.length; i < len; ++i) {\n            if (tl._xforms[i] === item) {\n              found = true;\n              tl.removeItem(i);\n              break;\n            }\n          }\n          if (found) {\n            break;\n          }\n        }\n      }\n    };\n\n    this.numberOfItems = 0;\n    this.clear = function () {\n      this.numberOfItems = 0;\n      this._xforms = [];\n    };\n\n    this.initialize = function (newItem) {\n      this.numberOfItems = 1;\n      this._removeFromOtherLists(newItem);\n      this._xforms = [newItem];\n    };\n\n    this.getItem = function (index) {\n      if (index < this.numberOfItems && index >= 0) {\n        return this._xforms[index];\n      }\n      const err = new Error('DOMException with code=INDEX_SIZE_ERR');\n      err.code = 1;\n      throw err;\n    };\n\n    this.insertItemBefore = function (newItem, index) {\n      let retValue = null;\n      if (index >= 0) {\n        if (index < this.numberOfItems) {\n          this._removeFromOtherLists(newItem);\n          const newxforms = new Array(this.numberOfItems + 1);\n          // TODO: use array copying and slicing\n          let i;\n          for (i = 0; i < index; ++i) {\n            newxforms[i] = this._xforms[i];\n          }\n          newxforms[i] = newItem;\n          for (let j = i + 1; i < this.numberOfItems; ++j, ++i) {\n            newxforms[j] = this._xforms[i];\n          }\n          this.numberOfItems++;\n          this._xforms = newxforms;\n          retValue = newItem;\n          this._list._update();\n        } else {\n          retValue = this._list.appendItem(newItem);\n        }\n      }\n      return retValue;\n    };\n\n    this.replaceItem = function (newItem, index) {\n      let retValue = null;\n      if (index < this.numberOfItems && index >= 0) {\n        this._removeFromOtherLists(newItem);\n        this._xforms[index] = newItem;\n        retValue = newItem;\n        this._list._update();\n      }\n      return retValue;\n    };\n\n    this.removeItem = function (index) {\n      if (index < this.numberOfItems && index >= 0) {\n        const retValue = this._xforms[index];\n        const newxforms = new Array(this.numberOfItems - 1);\n        let i;\n        for (i = 0; i < index; ++i) {\n          newxforms[i] = this._xforms[i];\n        }\n        for (let j = i; j < this.numberOfItems - 1; ++j, ++i) {\n          newxforms[j] = this._xforms[i + 1];\n        }\n        this.numberOfItems--;\n        this._xforms = newxforms;\n        this._list._update();\n        return retValue;\n      }\n      const err = new Error('DOMException with code=INDEX_SIZE_ERR');\n      err.code = 1;\n      throw err;\n    };\n\n    this.appendItem = function (newItem) {\n      this._removeFromOtherLists(newItem);\n      this._xforms.push(newItem);\n      this.numberOfItems++;\n      this._list._update();\n      return newItem;\n    };\n  }\n}\n\nexport const resetListMap = function () {\n  listMap_ = {};\n};\n\n/**\n * Removes transforms of the given element from the map.\n * Parameters:\n * elem - a DOM Element\n */\nexport let removeElementFromListMap = function (elem) {\n  if (elem.id && listMap_[elem.id]) {\n    delete listMap_[elem.id];\n  }\n};\n\n/**\n* Returns an object that behaves like a SVGTransformList for the given DOM element\n* @param elem - DOM element to get a transformlist from\n*/\nexport const getTransformList = function (elem) {\n  if (!supportsNativeTransformLists()) {\n    const id = elem.id || 'temp';\n    let t = listMap_[id];\n    if (!t || id === 'temp') {\n      listMap_[id] = new SVGTransformList(elem);\n      listMap_[id]._init();\n      t = listMap_[id];\n    }\n    return t;\n  }\n  if (elem.transform) {\n    return elem.transform.baseVal;\n  }\n  if (elem.gradientTransform) {\n    return elem.gradientTransform.baseVal;\n  }\n  if (elem.patternTransform) {\n    return elem.patternTransform.baseVal;\n  }\n\n  return null;\n};\n\n// For unit-testing\nexport const changeRemoveElementFromListMap = function (cb) {\n  removeElementFromListMap = cb;\n};\n","/**\n * Package: svgedit.units\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Jeff Schiller\n */\n\nimport {NS} from './svgedit.js';\n\nconst wAttrs = ['x', 'x1', 'cx', 'rx', 'width'];\nconst hAttrs = ['y', 'y1', 'cy', 'ry', 'height'];\nconst unitAttrs = ['r', 'radius', ...wAttrs, ...hAttrs];\n// unused\n/*\nconst unitNumMap = {\n  '%': 2,\n  em: 3,\n  ex: 4,\n  px: 5,\n  cm: 6,\n  mm: 7,\n  in: 8,\n  pt: 9,\n  pc: 10\n};\n*/\n// Container of elements.\nlet elementContainer_;\n\n/**\n * Stores mapping of unit type to user coordinates.\n */\nlet typeMap_ = {};\n\n/**\n * ElementContainer interface\n *\n * function getBaseUnit() - Returns a string of the base unit type of the container ('em')\n * function getElement() - Returns an element in the container given an id\n * function getHeight() - Returns the container's height\n * function getWidth() - Returns the container's width\n * function getRoundDigits() - Returns the number of digits number should be rounded to\n */\n\n/**\n * Initializes this module.\n *\n * @param elementContainer - An object implementing the ElementContainer interface.\n */\nexport const init = function (elementContainer) {\n  elementContainer_ = elementContainer;\n\n  // Get correct em/ex values by creating a temporary SVG.\n  const svg = document.createElementNS(NS.SVG, 'svg');\n  document.body.append(svg);\n  const rect = document.createElementNS(NS.SVG, 'rect');\n  rect.setAttribute('width', '1em');\n  rect.setAttribute('height', '1ex');\n  rect.setAttribute('x', '1in');\n  svg.append(rect);\n  const bb = rect.getBBox();\n  svg.remove();\n\n  const inch = bb.x;\n  typeMap_ = {\n    em: bb.width,\n    ex: bb.height,\n    in: inch,\n    cm: inch / 2.54,\n    mm: inch / 25.4,\n    pt: inch / 72,\n    pc: inch / 6,\n    px: 1,\n    '%': 0\n  };\n};\n\n/**\n* Group: Unit conversion functions\n*/\n\n/**\n* @returns The unit object with values for each unit\n*/\nexport const getTypeMap = function () {\n  return typeMap_;\n};\n\n/**\n* Rounds a given value to a float with number of digits defined in save_options\n*\n* @param val - The value as a String, Number or Array of two numbers to be rounded\n*\n* @returns\n* If a string/number was given, returns a Float. If an array, return a string\n* with comma-separated floats\n*/\nexport const shortFloat = function (val) {\n  const digits = elementContainer_.getRoundDigits();\n  if (!isNaN(val)) {\n    // Note that + converts to Number\n    return +((+val).toFixed(digits));\n  }\n  if (Array.isArray(val)) {\n    return shortFloat(val[0]) + ',' + shortFloat(val[1]);\n  }\n  return parseFloat(val).toFixed(digits) - 0;\n};\n\n/**\n* Converts the number to given unit or baseUnit\n* @returns {number}\n*/\nexport const convertUnit = function (val, unit) {\n  unit = unit || elementContainer_.getBaseUnit();\n  // baseVal.convertToSpecifiedUnits(unitNumMap[unit]);\n  // const val = baseVal.valueInSpecifiedUnits;\n  // baseVal.convertToSpecifiedUnits(1);\n  return shortFloat(val / typeMap_[unit]);\n};\n\n/**\n* Sets an element's attribute based on the unit in its current value.\n*\n* @param elem - DOM element to be changed\n* @param attr - String with the name of the attribute associated with the value\n* @param val - String with the attribute value to convert\n*/\nexport const setUnitAttr = function (elem, attr, val) {\n  //  if (!isNaN(val)) {\n  // New value is a number, so check currently used unit\n  // const oldVal = elem.getAttribute(attr);\n\n  // Enable this for alternate mode\n  // if (oldVal !== null && (isNaN(oldVal) || elementContainer_.getBaseUnit() !== 'px')) {\n  //   // Old value was a number, so get unit, then convert\n  //   let unit;\n  //   if (oldVal.substr(-1) === '%') {\n  //     const res = getResolution();\n  //     unit = '%';\n  //     val *= 100;\n  //     if (wAttrs.includes(attr)) {\n  //       val = val / res.w;\n  //     } else if (hAttrs.includes(attr)) {\n  //       val = val / res.h;\n  //     } else {\n  //       return val / Math.sqrt((res.w*res.w) + (res.h*res.h))/Math.sqrt(2);\n  //     }\n  //   } else {\n  //     if (elementContainer_.getBaseUnit() !== 'px') {\n  //       unit = elementContainer_.getBaseUnit();\n  //     } else {\n  //       unit = oldVal.substr(-2);\n  //     }\n  //     val = val / typeMap_[unit];\n  //   }\n  //\n  // val += unit;\n  // }\n  // }\n  elem.setAttribute(attr, val);\n};\n\nconst attrsToConvert = {\n  line: ['x1', 'x2', 'y1', 'y2'],\n  circle: ['cx', 'cy', 'r'],\n  ellipse: ['cx', 'cy', 'rx', 'ry'],\n  foreignObject: ['x', 'y', 'width', 'height'],\n  rect: ['x', 'y', 'width', 'height'],\n  image: ['x', 'y', 'width', 'height'],\n  use: ['x', 'y', 'width', 'height'],\n  text: ['x', 'y']\n};\n\n/**\n* Converts all applicable attributes to the configured baseUnit\n* @param element - A DOM element whose attributes should be converted\n*/\nexport const convertAttrs = function (element) {\n  const elName = element.tagName;\n  const unit = elementContainer_.getBaseUnit();\n  const attrs = attrsToConvert[elName];\n  if (!attrs) { return; }\n\n  const len = attrs.length;\n  for (let i = 0; i < len; i++) {\n    const attr = attrs[i];\n    const cur = element.getAttribute(attr);\n    if (cur) {\n      if (!isNaN(cur)) {\n        element.setAttribute(attr, (cur / typeMap_[unit]) + unit);\n      }\n      // else {\n      // Convert existing?\n      // }\n    }\n  }\n};\n\n/**\n* Converts given values to numbers. Attributes must be supplied in\n* case a percentage is given\n*\n* @param attr - String with the name of the attribute associated with the value\n* @param val - String with the attribute value to convert\n*/\nexport const convertToNum = function (attr, val) {\n  // Return a number if that's what it already is\n  if (!isNaN(val)) { return val - 0; }\n  if (val.substr(-1) === '%') {\n    // Deal with percentage, depends on attribute\n    const num = val.substr(0, val.length - 1) / 100;\n    const width = elementContainer_.getWidth();\n    const height = elementContainer_.getHeight();\n\n    if (wAttrs.includes(attr)) {\n      return num * width;\n    }\n    if (hAttrs.includes(attr)) {\n      return num * height;\n    }\n    return num * Math.sqrt((width * width) + (height * height)) / Math.sqrt(2);\n  }\n  const unit = val.substr(-2);\n  const num = val.substr(0, val.length - 2);\n  // Note that this multiplication turns the string into a number\n  return num * typeMap_[unit];\n};\n\n/**\n* Check if an attribute's value is in a valid format\n* @param attr - String with the name of the attribute associated with the value\n* @param val - String with the attribute value to check\n*/\nexport const isValidUnit = function (attr, val, selectedElement) {\n  if (unitAttrs.includes(attr)) {\n    // True if it's just a number\n    if (!isNaN(val)) {\n      return true;\n    }\n    // Not a number, check if it has a valid unit\n    val = val.toLowerCase();\n    return Object.keys(typeMap_).some((unit) => {\n      const re = new RegExp('^-?[\\\\d\\\\.]+' + unit + '$');\n      return re.test(val);\n    });\n  }\n  if (attr === 'id') {\n    // if we're trying to change the id, make sure it's not already present in the doc\n    // and the id value is valid.\n\n    let result = false;\n    // because getElem() can throw an exception in the case of an invalid id\n    // (according to https://www.w3.org/TR/xml-id/ IDs must be a NCName)\n    // we wrap it in an exception and only return true if the ID was valid and\n    // not already present\n    try {\n      const elem = elementContainer_.getElement(val);\n      result = (elem == null || elem === selectedElement);\n    } catch (e) {}\n    return result;\n  }\n  return true;\n};\n","/**\n * Package: svedit.history\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Jeff Schiller\n */\n\nimport {getHref, setHref, getRotationAngle} from './svgutils.js';\nimport {removeElementFromListMap} from './svgtransformlist.js';\n\n/**\n* Group: Undo/Redo history management\n*/\nexport const HistoryEventTypes = {\n  BEFORE_APPLY: 'before_apply',\n  AFTER_APPLY: 'after_apply',\n  BEFORE_UNAPPLY: 'before_unapply',\n  AFTER_UNAPPLY: 'after_unapply'\n};\n\n// const removedElements = {};\n\n/**\n * An interface that all command objects must implement.\n * @typedef {Object} svgedit.history.HistoryCommand\n *   void apply(svgedit.history.HistoryEventHandler);\n *   void unapply(svgedit.history.HistoryEventHandler);\n *   Element[] elements();\n *   String getText();\n *\n *   static String type();\n * }\n *\n * Interface: svgedit.history.HistoryEventHandler\n * An interface for objects that will handle history events.\n *\n * interface svgedit.history.HistoryEventHandler {\n *   void handleHistoryEvent(eventType, command);\n * }\n *\n * eventType is a string conforming to one of the HistoryEvent types.\n * command is an object fulfilling the HistoryCommand interface.\n */\n\n/**\n * @class svgedit.history.MoveElementCommand\n * @implements svgedit.history.HistoryCommand\n * History command for an element that had its DOM position changed\n * @param {Element} elem - The DOM element that was moved\n * @param {Element} oldNextSibling - The element's next sibling before it was moved\n * @param {Element} oldParent - The element's parent before it was moved\n * @param {string} [text] - An optional string visible to user related to this change\n*/\nexport class MoveElementCommand {\n  constructor (elem, oldNextSibling, oldParent, text) {\n    this.elem = elem;\n    this.text = text ? ('Move ' + elem.tagName + ' to ' + text) : ('Move ' + elem.tagName);\n    this.oldNextSibling = oldNextSibling;\n    this.oldParent = oldParent;\n    this.newNextSibling = elem.nextSibling;\n    this.newParent = elem.parentNode;\n  }\n  getText () {\n    return this.text;\n  }\n  type () {\n    return 'svgedit.history.MoveElementCommand';\n  }\n\n  /**\n   * Re-positions the element\n   * @param {{handleHistoryEvent: function}} handler\n  */\n  apply (handler) {\n    // TODO(codedread): Refactor this common event code into a base HistoryCommand class.\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    this.elem = this.newParent.insertBefore(this.elem, this.newNextSibling);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  /**\n   * Positions the element back to its original location\n   * @param {{handleHistoryEvent: function}} handler\n  */\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    this.elem = this.oldParent.insertBefore(this.elem, this.oldNextSibling);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * @returns {Array} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nMoveElementCommand.type = MoveElementCommand.prototype.type;\n\n/**\n* @implements svgedit.history.HistoryCommand\n* History command for an element that was added to the DOM\n*\n* @param elem - The newly added DOM element\n* @param text - An optional string visible to user related to this change\n*/\nexport class InsertElementCommand {\n  constructor (elem, text) {\n    this.elem = elem;\n    this.text = text || ('Create ' + elem.tagName);\n    this.parent = elem.parentNode;\n    this.nextSibling = this.elem.nextSibling;\n  }\n\n  type () {\n    return 'svgedit.history.InsertElementCommand';\n  }\n\n  getText () {\n    return this.text;\n  }\n\n  // Re-Inserts the new element\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    this.elem = this.parent.insertBefore(this.elem, this.nextSibling);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  // Removes the element\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    this.parent = this.elem.parentNode;\n    this.elem = this.elem.parentNode.removeChild(this.elem);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * @returns {Array} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nInsertElementCommand.type = InsertElementCommand.prototype.type;\n\n/**\n* @implements svgedit.history.HistoryCommand\n* History command for an element removed from the DOM\n* @param elem - The removed DOM element\n* @param oldNextSibling - The DOM element's nextSibling when it was in the DOM\n* @param oldParent - The DOM element's parent\n* @param {String} [text] - An optional string visible to user related to this change\n*/\nexport class RemoveElementCommand {\n  constructor (elem, oldNextSibling, oldParent, text) {\n    this.elem = elem;\n    this.text = text || ('Delete ' + elem.tagName);\n    this.nextSibling = oldNextSibling;\n    this.parent = oldParent;\n\n    // special hack for webkit: remove this element's entry in the svgTransformLists map\n    removeElementFromListMap(elem);\n  }\n  type () {\n    return 'svgedit.history.RemoveElementCommand';\n  }\n\n  getText () {\n    return this.text;\n  }\n\n  // Re-removes the new element\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    removeElementFromListMap(this.elem);\n    this.parent = this.elem.parentNode;\n    this.elem = this.parent.removeChild(this.elem);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  // Re-adds the new element\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    removeElementFromListMap(this.elem);\n    if (this.nextSibling == null) {\n      if (window.console) {\n        console.log('Error: reference element was lost');\n      }\n    }\n    this.parent.insertBefore(this.elem, this.nextSibling); // Don't use `before` or `prepend` as `this.nextSibling` may be `null`\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * @returns {Array} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nRemoveElementCommand.type = RemoveElementCommand.prototype.type;\n\n/**\n* @implements svgedit.history.HistoryCommand\n* History command to make a change to an element.\n* Usually an attribute change, but can also be textcontent.\n* @param elem - The DOM element that was changed\n* @param attrs - An object with the attributes to be changed and the values they had *before* the change\n* @param {String} text - An optional string visible to user related to this change\n*/\nexport class ChangeElementCommand {\n  constructor (elem, attrs, text) {\n    this.elem = elem;\n    this.text = text ? ('Change ' + elem.tagName + ' ' + text) : ('Change ' + elem.tagName);\n    this.newValues = {};\n    this.oldValues = attrs;\n    for (const attr in attrs) {\n      if (attr === '#text') {\n        this.newValues[attr] = elem.textContent;\n      } else if (attr === '#href') {\n        this.newValues[attr] = getHref(elem);\n      } else {\n        this.newValues[attr] = elem.getAttribute(attr);\n      }\n    }\n  }\n  type () {\n    return 'svgedit.history.ChangeElementCommand';\n  }\n\n  getText () {\n    return this.text;\n  }\n\n  // Performs the stored change action\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    let bChangedTransform = false;\n    for (const attr in this.newValues) {\n      if (this.newValues[attr]) {\n        if (attr === '#text') {\n          this.elem.textContent = this.newValues[attr];\n        } else if (attr === '#href') {\n          setHref(this.elem, this.newValues[attr]);\n        } else {\n          this.elem.setAttribute(attr, this.newValues[attr]);\n        }\n      } else {\n        if (attr === '#text') {\n          this.elem.textContent = '';\n        } else {\n          this.elem.setAttribute(attr, '');\n          this.elem.removeAttribute(attr);\n        }\n      }\n\n      if (attr === 'transform') { bChangedTransform = true; }\n    }\n\n    // relocate rotational transform, if necessary\n    if (!bChangedTransform) {\n      const angle = getRotationAngle(this.elem);\n      if (angle) {\n        const bbox = this.elem.getBBox();\n        const cx = bbox.x + bbox.width / 2,\n          cy = bbox.y + bbox.height / 2;\n        const rotate = ['rotate(', angle, ' ', cx, ',', cy, ')'].join('');\n        if (rotate !== this.elem.getAttribute('transform')) {\n          this.elem.setAttribute('transform', rotate);\n        }\n      }\n    }\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n\n    return true;\n  }\n\n  // Reverses the stored change action\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    let bChangedTransform = false;\n    for (const attr in this.oldValues) {\n      if (this.oldValues[attr]) {\n        if (attr === '#text') {\n          this.elem.textContent = this.oldValues[attr];\n        } else if (attr === '#href') {\n          setHref(this.elem, this.oldValues[attr]);\n        } else {\n          this.elem.setAttribute(attr, this.oldValues[attr]);\n        }\n      } else {\n        if (attr === '#text') {\n          this.elem.textContent = '';\n        } else {\n          this.elem.removeAttribute(attr);\n        }\n      }\n      if (attr === 'transform') { bChangedTransform = true; }\n    }\n    // relocate rotational transform, if necessary\n    if (!bChangedTransform) {\n      const angle = getRotationAngle(this.elem);\n      if (angle) {\n        const bbox = this.elem.getBBox();\n        const cx = bbox.x + bbox.width / 2,\n          cy = bbox.y + bbox.height / 2;\n        const rotate = ['rotate(', angle, ' ', cx, ',', cy, ')'].join('');\n        if (rotate !== this.elem.getAttribute('transform')) {\n          this.elem.setAttribute('transform', rotate);\n        }\n      }\n    }\n\n    // Remove transformlist to prevent confusion that causes bugs like 575.\n    removeElementFromListMap(this.elem);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n\n    return true;\n  }\n\n  /**\n  * @returns {Array} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nChangeElementCommand.type = ChangeElementCommand.prototype.type;\n\n// TODO: create a 'typing' command object that tracks changes in text\n// if a new Typing command is created and the top command on the stack is also a Typing\n// and they both affect the same element, then collapse the two commands into one\n\n/**\n* @implements svgedit.history.HistoryCommand\n* History command that can contain/execute multiple other commands\n* @param {String} [text] - An optional string visible to user related to this change\n*/\nexport class BatchCommand {\n  constructor (text) {\n    this.text = text || 'Batch Command';\n    this.stack = [];\n  }\n\n  type () {\n    return 'svgedit.history.BatchCommand';\n  }\n\n  getText () {\n    return this.text;\n  }\n\n  // Runs \"apply\" on all subcommands\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    const len = this.stack.length;\n    for (let i = 0; i < len; ++i) {\n      this.stack[i].apply(handler);\n    }\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  // Runs \"unapply\" on all subcommands\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    for (let i = this.stack.length - 1; i >= 0; i--) {\n      this.stack[i].unapply(handler);\n    }\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  // Iterate through all our subcommands and returns all the elements we are changing\n  elements () {\n    const elems = [];\n    let cmd = this.stack.length;\n    while (cmd--) {\n      const thisElems = this.stack[cmd].elements();\n      let elem = thisElems.length;\n      while (elem--) {\n        if (!elems.includes(thisElems[elem])) { elems.push(thisElems[elem]); }\n      }\n    }\n    return elems;\n  }\n\n  /**\n  * Adds a given command to the history stack\n  * @param cmd - The undo command object to add\n  */\n  addSubCommand (cmd) {\n    this.stack.push(cmd);\n  }\n\n  /**\n  * @returns {Boolean} Indicates whether or not the batch command is empty\n  */\n  isEmpty () {\n    return !this.stack.length;\n  }\n}\nBatchCommand.type = BatchCommand.prototype.type;\n\n/**\n* @param historyEventHandler - an object that conforms to the HistoryEventHandler interface\n* (see above)\n*/\nexport class UndoManager {\n  constructor (historyEventHandler) {\n    this.handler_ = historyEventHandler || null;\n    this.undoStackPointer = 0;\n    this.undoStack = [];\n\n    // this is the stack that stores the original values, the elements and\n    // the attribute name for begin/finish\n    this.undoChangeStackPointer = -1;\n    this.undoableChangeStack = [];\n  }\n\n  // Resets the undo stack, effectively clearing the undo/redo history\n  resetUndoStack () {\n    this.undoStack = [];\n    this.undoStackPointer = 0;\n  }\n\n  /**\n  * @returns {Number} Integer with the current size of the undo history stack\n  */\n  getUndoStackSize () {\n    return this.undoStackPointer;\n  }\n\n  /**\n  * @returns {Number} Integer with the current size of the redo history stack\n  */\n  getRedoStackSize () {\n    return this.undoStack.length - this.undoStackPointer;\n  }\n\n  /**\n  * @returns {String} String associated with the next undo command\n  */\n  getNextUndoCommandText () {\n    return this.undoStackPointer > 0 ? this.undoStack[this.undoStackPointer - 1].getText() : '';\n  }\n\n  /**\n  * @returns {String} String associated with the next redo command\n  */\n  getNextRedoCommandText () {\n    return this.undoStackPointer < this.undoStack.length ? this.undoStack[this.undoStackPointer].getText() : '';\n  }\n\n  // Performs an undo step\n  undo () {\n    if (this.undoStackPointer > 0) {\n      const cmd = this.undoStack[--this.undoStackPointer];\n      cmd.unapply(this.handler_);\n    }\n  }\n\n  // Performs a redo step\n  redo () {\n    if (this.undoStackPointer < this.undoStack.length && this.undoStack.length > 0) {\n      const cmd = this.undoStack[this.undoStackPointer++];\n      cmd.apply(this.handler_);\n    }\n  }\n\n  /**\n  * Adds a command object to the undo history stack\n  * @param cmd - The command object to add\n  */\n  addCommandToHistory (cmd) {\n    // FIXME: we MUST compress consecutive text changes to the same element\n    // (right now each keystroke is saved as a separate command that includes the\n    // entire text contents of the text element)\n    // TODO: consider limiting the history that we store here (need to do some slicing)\n\n    // if our stack pointer is not at the end, then we have to remove\n    // all commands after the pointer and insert the new command\n    if (this.undoStackPointer < this.undoStack.length && this.undoStack.length > 0) {\n      this.undoStack = this.undoStack.splice(0, this.undoStackPointer);\n    }\n    this.undoStack.push(cmd);\n    this.undoStackPointer = this.undoStack.length;\n  }\n\n  /**\n  * This function tells the canvas to remember the old values of the\n  * attrName attribute for each element sent in.  The elements and values\n  * are stored on a stack, so the next call to finishUndoableChange() will\n  * pop the elements and old values off the stack, gets the current values\n  * from the DOM and uses all of these to construct the undo-able command.\n  * @param attrName - The name of the attribute being changed\n  * @param elems - Array of DOM elements being changed\n  */\n  beginUndoableChange (attrName, elems) {\n    const p = ++this.undoChangeStackPointer;\n    let i = elems.length;\n    const oldValues = new Array(i), elements = new Array(i);\n    while (i--) {\n      const elem = elems[i];\n      if (elem == null) { continue; }\n      elements[i] = elem;\n      oldValues[i] = elem.getAttribute(attrName);\n    }\n    this.undoableChangeStack[p] = {\n      attrName,\n      oldValues,\n      elements\n    };\n  }\n\n  /**\n  * This function returns a BatchCommand object which summarizes the\n  * change since beginUndoableChange was called.  The command can then\n  * be added to the command history\n  * @returns Batch command object with resulting changes\n  */\n  finishUndoableChange () {\n    const p = this.undoChangeStackPointer--;\n    const changeset = this.undoableChangeStack[p];\n    const {attrName} = changeset;\n    const batchCmd = new BatchCommand('Change ' + attrName);\n    let i = changeset.elements.length;\n    while (i--) {\n      const elem = changeset.elements[i];\n      if (elem == null) { continue; }\n      const changes = {};\n      changes[attrName] = changeset.oldValues[i];\n      if (changes[attrName] !== elem.getAttribute(attrName)) {\n        batchCmd.addSubCommand(new ChangeElementCommand(elem, changes, attrName));\n      }\n    }\n    this.undoableChangeStack[p] = null;\n    return batchCmd;\n  }\n}\n","/**\n * Package: svedit.math\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Jeff Schiller\n */\n\n/**\n* @typedef AngleCoord45\n* @type {Object}\n* @property {number} x - The angle-snapped x value\n* @property {number} y - The angle-snapped y value\n* @property {number} a - The angle at which to snap\n*/\n\nimport {NS} from './svgedit.js';\nimport {getTransformList} from './svgtransformlist.js';\n\n// Constants\nconst NEAR_ZERO = 1e-14;\n\n// Throw away SVGSVGElement used for creating matrices/transforms.\nconst svg = document.createElementNS(NS.SVG, 'svg');\n\n/**\n * A (hopefully) quicker function to transform a point by a matrix\n * (this function avoids any DOM calls and just does the math)\n * @param {number} x - Float representing the x coordinate\n * @param {number} y - Float representing the y coordinate\n * @param {SVGMatrix} m - Matrix object to transform the point with\n * @returns {Object} An x, y object representing the transformed point\n*/\nexport const transformPoint = function (x, y, m) {\n  return {x: m.a * x + m.c * y + m.e, y: m.b * x + m.d * y + m.f};\n};\n\n/**\n * Helper function to check if the matrix performs no actual transform\n * (i.e. exists for identity purposes)\n * @param {SVGMatrix} m - The matrix object to check\n * @returns {boolean} Indicates whether or not the matrix is 1,0,0,1,0,0\n*/\nexport const isIdentity = function (m) {\n  return (m.a === 1 && m.b === 0 && m.c === 0 && m.d === 1 && m.e === 0 && m.f === 0);\n};\n\n/**\n * This function tries to return a SVGMatrix that is the multiplication m1*m2.\n * We also round to zero when it's near zero\n * @param {...SVGMatrix} args - Matrix objects to multiply\n * @returns {SVGMatrix} The matrix object resulting from the calculation\n*/\nexport const matrixMultiply = function (...args) {\n  const m = args.reduceRight((prev, m1) => {\n    return m1.multiply(prev);\n  });\n\n  if (Math.abs(m.a) < NEAR_ZERO) { m.a = 0; }\n  if (Math.abs(m.b) < NEAR_ZERO) { m.b = 0; }\n  if (Math.abs(m.c) < NEAR_ZERO) { m.c = 0; }\n  if (Math.abs(m.d) < NEAR_ZERO) { m.d = 0; }\n  if (Math.abs(m.e) < NEAR_ZERO) { m.e = 0; }\n  if (Math.abs(m.f) < NEAR_ZERO) { m.f = 0; }\n\n  return m;\n};\n\n/**\n * See if the given transformlist includes a non-indentity matrix transform\n * @param {Object} [tlist] - The transformlist to check\n * @returns {boolean} Whether or not a matrix transform was found\n*/\nexport const hasMatrixTransform = function (tlist) {\n  if (!tlist) { return false; }\n  let num = tlist.numberOfItems;\n  while (num--) {\n    const xform = tlist.getItem(num);\n    if (xform.type === 1 && !isIdentity(xform.matrix)) { return true; }\n  }\n  return false;\n};\n\n/**\n * Transforms a rectangle based on the given matrix\n * @param {number} l - Float with the box's left coordinate\n * @param {number} t - Float with the box's top coordinate\n * @param {number} w - Float with the box width\n * @param {number} h - Float with the box height\n * @param {SVGMatrix} m - Matrix object to transform the box by\n * @returns {Object} An object with the following values:\n * tl - The top left coordinate (x,y object)\n * tr - The top right coordinate (x,y object)\n * bl - The bottom left coordinate (x,y object)\n * br - The bottom right coordinate (x,y object)\n * aabox - Object with the following values:\n * x - Float with the axis-aligned x coordinate\n * y - Float with the axis-aligned y coordinate\n * width - Float with the axis-aligned width coordinate\n * height - Float with the axis-aligned height coordinate\n*/\nexport const transformBox = function (l, t, w, h, m) {\n  const tl = transformPoint(l, t, m),\n    tr = transformPoint((l + w), t, m),\n    bl = transformPoint(l, (t + h), m),\n    br = transformPoint((l + w), (t + h), m),\n\n    minx = Math.min(tl.x, tr.x, bl.x, br.x),\n    maxx = Math.max(tl.x, tr.x, bl.x, br.x),\n    miny = Math.min(tl.y, tr.y, bl.y, br.y),\n    maxy = Math.max(tl.y, tr.y, bl.y, br.y);\n\n  return {\n    tl,\n    tr,\n    bl,\n    br,\n    aabox: {\n      x: minx,\n      y: miny,\n      width: (maxx - minx),\n      height: (maxy - miny)\n    }\n  };\n};\n\n/**\n * This returns a single matrix Transform for a given Transform List\n * (this is the equivalent of SVGTransformList.consolidate() but unlike\n * that method, this one does not modify the actual SVGTransformList)\n * This function is very liberal with its min, max arguments\n * @param {Object} tlist - The transformlist object\n * @param {integer} [min=0] - Optional integer indicating start transform position\n * @param {integer} [max] - Optional integer indicating end transform position;\n *   defaults to one less than the tlist's numberOfItems\n * @returns {Object} A single matrix transform object\n*/\nexport const transformListToTransform = function (tlist, min, max) {\n  if (tlist == null) {\n    // Or should tlist = null have been prevented before this?\n    return svg.createSVGTransformFromMatrix(svg.createSVGMatrix());\n  }\n  min = min || 0;\n  max = max || (tlist.numberOfItems - 1);\n  min = parseInt(min, 10);\n  max = parseInt(max, 10);\n  if (min > max) { const temp = max; max = min; min = temp; }\n  let m = svg.createSVGMatrix();\n  for (let i = min; i <= max; ++i) {\n    // if our indices are out of range, just use a harmless identity matrix\n    const mtom = (i >= 0 && i < tlist.numberOfItems\n      ? tlist.getItem(i).matrix\n      : svg.createSVGMatrix());\n    m = matrixMultiply(m, mtom);\n  }\n  return svg.createSVGTransformFromMatrix(m);\n};\n\n/**\n * Get the matrix object for a given element\n * @param {Element} elem - The DOM element to check\n * @returns {SVGMatrix} The matrix object associated with the element's transformlist\n*/\nexport const getMatrix = function (elem) {\n  const tlist = getTransformList(elem);\n  return transformListToTransform(tlist).matrix;\n};\n\n/**\n * Returns a 45 degree angle coordinate associated with the two given\n * coordinates\n * @param {number} x1 - First coordinate's x value\n * @param {number} x2 - Second coordinate's x value\n * @param {number} y1 - First coordinate's y value\n * @param {number} y2 - Second coordinate's y value\n * @returns {AngleCoord45}\n*/\nexport const snapToAngle = function (x1, y1, x2, y2) {\n  const snap = Math.PI / 4; // 45 degrees\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const angle = Math.atan2(dy, dx);\n  const dist = Math.sqrt(dx * dx + dy * dy);\n  const snapangle = Math.round(angle / snap) * snap;\n\n  return {\n    x: x1 + dist * Math.cos(snapangle),\n    y: y1 + dist * Math.sin(snapangle),\n    a: snapangle\n  };\n};\n\n/**\n * Check if two rectangles (BBoxes objects) intersect each other\n * @param {SVGRect} r1 - The first BBox-like object\n * @param {SVGRect} r2 - The second BBox-like object\n * @returns {boolean} True if rectangles intersect\n */\nexport const rectsIntersect = function (r1, r2) {\n  return r2.x < (r1.x + r1.width) &&\n    (r2.x + r2.width) > r1.x &&\n    r2.y < (r1.y + r1.height) &&\n    (r2.y + r2.height) > r1.y;\n};\n","/* globals jQuery */\n/**\n * Package: svgedit.path\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2011 Alexis Deveria\n * Copyright(c) 2011 Jeff Schiller\n */\n\nimport './pathseg.js';\nimport {NS} from './svgedit.js';\nimport {getTransformList} from './svgtransformlist.js';\nimport {shortFloat} from './units.js';\nimport {ChangeElementCommand, BatchCommand} from './history.js';\nimport {\n  transformPoint, getMatrix, snapToAngle, rectsIntersect,\n  transformListToTransform\n} from './math.js';\nimport {\n  assignAttributes, getElem, getRotationAngle, getBBox,\n  getRefElem, findDefs, snapToGrid,\n  getBBox as utilsGetBBox\n} from './svgutils.js';\nimport {\n  supportsPathInsertItemBefore, supportsPathReplaceItem, isWebkit\n} from './browser.js';\n\nconst $ = jQuery;\n\nconst segData = {\n  2: ['x', 'y'],\n  4: ['x', 'y'],\n  6: ['x', 'y', 'x1', 'y1', 'x2', 'y2'],\n  8: ['x', 'y', 'x1', 'y1'],\n  10: ['x', 'y', 'r1', 'r2', 'angle', 'largeArcFlag', 'sweepFlag'],\n  12: ['x'],\n  14: ['y'],\n  16: ['x', 'y', 'x2', 'y2'],\n  18: ['x', 'y']\n};\n\nconst uiStrings = {};\nexport const setUiStrings = function (strs) {\n  Object.assign(uiStrings, strs.ui);\n};\n\nlet pathFuncs = [];\n\nlet linkControlPts = true;\n\n// Stores references to paths via IDs.\n// TODO: Make this cross-document happy.\nlet pathData = {};\n\nexport const setLinkControlPoints = function (lcp) {\n  linkControlPts = lcp;\n};\n\nexport let path = null;\n\nlet editorContext_ = null;\n\nexport const init = function (editorContext) {\n  editorContext_ = editorContext;\n\n  pathFuncs = [0, 'ClosePath'];\n  const pathFuncsStrs = ['Moveto', 'Lineto', 'CurvetoCubic', 'CurvetoQuadratic', 'Arc',\n    'LinetoHorizontal', 'LinetoVertical', 'CurvetoCubicSmooth', 'CurvetoQuadraticSmooth'];\n  $.each(pathFuncsStrs, function (i, s) {\n    pathFuncs.push(s + 'Abs');\n    pathFuncs.push(s + 'Rel');\n  });\n};\n\nexport const insertItemBefore = function (elem, newseg, index) {\n  // Support insertItemBefore on paths for FF2\n  const list = elem.pathSegList;\n\n  if (supportsPathInsertItemBefore()) {\n    list.insertItemBefore(newseg, index);\n    return;\n  }\n  const len = list.numberOfItems;\n  const arr = [];\n  for (let i = 0; i < len; i++) {\n    const curSeg = list.getItem(i);\n    arr.push(curSeg);\n  }\n  list.clear();\n  for (let i = 0; i < len; i++) {\n    if (i === index) { // index + 1\n      list.appendItem(newseg);\n    }\n    list.appendItem(arr[i]);\n  }\n};\n\n// TODO: See if this should just live in replacePathSeg\nexport const ptObjToArr = function (type, segItem) {\n  const arr = segData[type], len = arr.length;\n  const out = [];\n  for (let i = 0; i < len; i++) {\n    out[i] = segItem[arr[i]];\n  }\n  return out;\n};\n\nexport const getGripPt = function (seg, altPt) {\n  const {path} = seg;\n  let out = {\n    x: altPt ? altPt.x : seg.item.x,\n    y: altPt ? altPt.y : seg.item.y\n  };\n\n  if (path.matrix) {\n    const pt = transformPoint(out.x, out.y, path.matrix);\n    out = pt;\n  }\n\n  const currentZoom = editorContext_.getCurrentZoom();\n  out.x *= currentZoom;\n  out.y *= currentZoom;\n\n  return out;\n};\n\nexport const getPointFromGrip = function (pt, path) {\n  const out = {\n    x: pt.x,\n    y: pt.y\n  };\n\n  if (path.matrix) {\n    pt = transformPoint(out.x, out.y, path.imatrix);\n    out.x = pt.x;\n    out.y = pt.y;\n  }\n\n  const currentZoom = editorContext_.getCurrentZoom();\n  out.x /= currentZoom;\n  out.y /= currentZoom;\n\n  return out;\n};\n\n/**\n* Requires prior call to `setUiStrings` if `xlink:title`\n*    to be set on the grip\n*/\nexport const addPointGrip = function (index, x, y) {\n  // create the container of all the point grips\n  const pointGripContainer = getGripContainer();\n\n  let pointGrip = getElem('pathpointgrip_' + index);\n  // create it\n  if (!pointGrip) {\n    pointGrip = document.createElementNS(NS.SVG, 'circle');\n    const atts = {\n      id: 'pathpointgrip_' + index,\n      display: 'none',\n      r: 4,\n      fill: '#0FF',\n      stroke: '#00F',\n      'stroke-width': 2,\n      cursor: 'move',\n      style: 'pointer-events:all'\n    };\n    if ('pathNodeTooltip' in uiStrings) { // May be empty if running path.js without svg-editor\n      atts['xlink:title'] = uiStrings.pathNodeTooltip;\n    }\n    assignAttributes(pointGrip, atts);\n    pointGrip = pointGripContainer.appendChild(pointGrip);\n\n    const grip = $('#pathpointgrip_' + index);\n    grip.dblclick(function () {\n      if (path) {\n        path.setSegType();\n      }\n    });\n  }\n  if (x && y) {\n    // set up the point grip element and display it\n    assignAttributes(pointGrip, {\n      cx: x,\n      cy: y,\n      display: 'inline'\n    });\n  }\n  return pointGrip;\n};\n\nexport const getGripContainer = function () {\n  let c = getElem('pathpointgrip_container');\n  if (!c) {\n    const parent = getElem('selectorParentGroup');\n    c = parent.appendChild(document.createElementNS(NS.SVG, 'g'));\n    c.id = 'pathpointgrip_container';\n  }\n  return c;\n};\n\n/**\n* Requires prior call to `setUiStrings` if `xlink:title`\n*    to be set on the grip\n*/\nexport const addCtrlGrip = function (id) {\n  let pointGrip = getElem('ctrlpointgrip_' + id);\n  if (pointGrip) { return pointGrip; }\n\n  pointGrip = document.createElementNS(NS.SVG, 'circle');\n  const atts = {\n    id: 'ctrlpointgrip_' + id,\n    display: 'none',\n    r: 4,\n    fill: '#0FF',\n    stroke: '#55F',\n    'stroke-width': 1,\n    cursor: 'move',\n    style: 'pointer-events:all'\n  };\n  if ('pathCtrlPtTooltip' in uiStrings) { // May be empty if running path.js without svg-editor\n    atts['xlink:title'] = uiStrings.pathCtrlPtTooltip;\n  }\n  assignAttributes(pointGrip, atts);\n  getGripContainer().append(pointGrip);\n  return pointGrip;\n};\n\nexport const getCtrlLine = function (id) {\n  let ctrlLine = getElem('ctrlLine_' + id);\n  if (ctrlLine) { return ctrlLine; }\n\n  ctrlLine = document.createElementNS(NS.SVG, 'line');\n  assignAttributes(ctrlLine, {\n    id: 'ctrlLine_' + id,\n    stroke: '#555',\n    'stroke-width': 1,\n    style: 'pointer-events:none'\n  });\n  getGripContainer().append(ctrlLine);\n  return ctrlLine;\n};\n\nexport const getPointGrip = function (seg, update) {\n  const {index} = seg;\n  const pointGrip = addPointGrip(index);\n\n  if (update) {\n    const pt = getGripPt(seg);\n    assignAttributes(pointGrip, {\n      cx: pt.x,\n      cy: pt.y,\n      display: 'inline'\n    });\n  }\n\n  return pointGrip;\n};\n\nexport const getControlPoints = function (seg) {\n  const {item, index} = seg;\n  if (!('x1' in item) || !('x2' in item)) { return null; }\n  const cpt = {};\n  /* const pointGripContainer = */ getGripContainer();\n\n  // Note that this is intentionally not seg.prev.item\n  const prev = path.segs[index - 1].item;\n\n  const segItems = [prev, item];\n\n  for (let i = 1; i < 3; i++) {\n    const id = index + 'c' + i;\n\n    const ctrlLine = cpt['c' + i + '_line'] = getCtrlLine(id);\n\n    const pt = getGripPt(seg, {x: item['x' + i], y: item['y' + i]});\n    const gpt = getGripPt(seg, {x: segItems[i - 1].x, y: segItems[i - 1].y});\n\n    assignAttributes(ctrlLine, {\n      x1: pt.x,\n      y1: pt.y,\n      x2: gpt.x,\n      y2: gpt.y,\n      display: 'inline'\n    });\n\n    cpt['c' + i + '_line'] = ctrlLine;\n\n    // create it\n    const pointGrip = cpt['c' + i] = addCtrlGrip(id);\n\n    assignAttributes(pointGrip, {\n      cx: pt.x,\n      cy: pt.y,\n      display: 'inline'\n    });\n    cpt['c' + i] = pointGrip;\n  }\n  return cpt;\n};\n\n// This replaces the segment at the given index. Type is given as number.\nexport const replacePathSeg = function (type, index, pts, elem) {\n  const pth = elem || path.elem;\n\n  const func = 'createSVGPathSeg' + pathFuncs[type];\n  const seg = pth[func].apply(pth, pts);\n\n  if (supportsPathReplaceItem()) {\n    pth.pathSegList.replaceItem(seg, index);\n  } else {\n    const segList = pth.pathSegList;\n    const len = segList.numberOfItems;\n    const arr = [];\n    for (let i = 0; i < len; i++) {\n      const curSeg = segList.getItem(i);\n      arr.push(curSeg);\n    }\n    segList.clear();\n    for (let i = 0; i < len; i++) {\n      if (i === index) {\n        segList.appendItem(seg);\n      } else {\n        segList.appendItem(arr[i]);\n      }\n    }\n  }\n};\n\nexport const getSegSelector = function (seg, update) {\n  const {index} = seg;\n  let segLine = getElem('segline_' + index);\n  if (!segLine) {\n    const pointGripContainer = getGripContainer();\n    // create segline\n    segLine = document.createElementNS(NS.SVG, 'path');\n    assignAttributes(segLine, {\n      id: 'segline_' + index,\n      display: 'none',\n      fill: 'none',\n      stroke: '#0FF',\n      'stroke-width': 2,\n      style: 'pointer-events:none',\n      d: 'M0,0 0,0'\n    });\n    pointGripContainer.append(segLine);\n  }\n\n  if (update) {\n    const {prev} = seg;\n    if (!prev) {\n      segLine.setAttribute('display', 'none');\n      return segLine;\n    }\n\n    const pt = getGripPt(prev);\n    // Set start point\n    replacePathSeg(2, 0, [pt.x, pt.y], segLine);\n\n    const pts = ptObjToArr(seg.type, seg.item, true);\n    for (let i = 0; i < pts.length; i += 2) {\n      const pt = getGripPt(seg, {x: pts[i], y: pts[i + 1]});\n      pts[i] = pt.x;\n      pts[i + 1] = pt.y;\n    }\n\n    replacePathSeg(seg.type, 1, pts, segLine);\n  }\n  return segLine;\n};\n\n/**\n* Takes three points and creates a smoother line based on them\n* @param ct1 - Object with x and y values (first control point)\n* @param ct2 - Object with x and y values (second control point)\n* @param pt - Object with x and y values (third point)\n* @returns Array of two \"smoothed\" point objects\n*/\nexport const smoothControlPoints = function (ct1, ct2, pt) {\n  // each point must not be the origin\n  const x1 = ct1.x - pt.x,\n    y1 = ct1.y - pt.y,\n    x2 = ct2.x - pt.x,\n    y2 = ct2.y - pt.y;\n\n  if ((x1 !== 0 || y1 !== 0) && (x2 !== 0 || y2 !== 0)) {\n    const\n      r1 = Math.sqrt(x1 * x1 + y1 * y1),\n      r2 = Math.sqrt(x2 * x2 + y2 * y2),\n      nct1 = editorContext_.getSVGRoot().createSVGPoint(),\n      nct2 = editorContext_.getSVGRoot().createSVGPoint();\n    let anglea = Math.atan2(y1, x1),\n      angleb = Math.atan2(y2, x2);\n    if (anglea < 0) { anglea += 2 * Math.PI; }\n    if (angleb < 0) { angleb += 2 * Math.PI; }\n\n    const angleBetween = Math.abs(anglea - angleb),\n      angleDiff = Math.abs(Math.PI - angleBetween) / 2;\n\n    let newAnglea, newAngleb;\n    if (anglea - angleb > 0) {\n      newAnglea = angleBetween < Math.PI ? (anglea + angleDiff) : (anglea - angleDiff);\n      newAngleb = angleBetween < Math.PI ? (angleb - angleDiff) : (angleb + angleDiff);\n    } else {\n      newAnglea = angleBetween < Math.PI ? (anglea - angleDiff) : (anglea + angleDiff);\n      newAngleb = angleBetween < Math.PI ? (angleb + angleDiff) : (angleb - angleDiff);\n    }\n\n    // rotate the points\n    nct1.x = r1 * Math.cos(newAnglea) + pt.x;\n    nct1.y = r1 * Math.sin(newAnglea) + pt.y;\n    nct2.x = r2 * Math.cos(newAngleb) + pt.x;\n    nct2.y = r2 * Math.sin(newAngleb) + pt.y;\n\n    return [nct1, nct2];\n  }\n  return undefined;\n};\n\nexport class Segment {\n  constructor (index, item) {\n    this.selected = false;\n    this.index = index;\n    this.item = item;\n    this.type = item.pathSegType;\n\n    this.ctrlpts = [];\n    this.ptgrip = null;\n    this.segsel = null;\n  }\n\n  showCtrlPts (y) {\n    for (const i in this.ctrlpts) {\n      if (this.ctrlpts.hasOwnProperty(i)) {\n        this.ctrlpts[i].setAttribute('display', y ? 'inline' : 'none');\n      }\n    }\n  }\n\n  selectCtrls (y) {\n    $('#ctrlpointgrip_' + this.index + 'c1, #ctrlpointgrip_' + this.index + 'c2')\n      .attr('fill', y ? '#0FF' : '#EEE');\n  }\n\n  show (y) {\n    if (this.ptgrip) {\n      this.ptgrip.setAttribute('display', y ? 'inline' : 'none');\n      this.segsel.setAttribute('display', y ? 'inline' : 'none');\n      // Show/hide all control points if available\n      this.showCtrlPts(y);\n    }\n  }\n\n  select (y) {\n    if (this.ptgrip) {\n      this.ptgrip.setAttribute('stroke', y ? '#0FF' : '#00F');\n      this.segsel.setAttribute('display', y ? 'inline' : 'none');\n      if (this.ctrlpts) {\n        this.selectCtrls(y);\n      }\n      this.selected = y;\n    }\n  }\n\n  addGrip () {\n    this.ptgrip = getPointGrip(this, true);\n    this.ctrlpts = getControlPoints(this, true);\n    this.segsel = getSegSelector(this, true);\n  }\n\n  update (full) {\n    if (this.ptgrip) {\n      const pt = getGripPt(this);\n      assignAttributes(this.ptgrip, {\n        cx: pt.x,\n        cy: pt.y\n      });\n\n      getSegSelector(this, true);\n\n      if (this.ctrlpts) {\n        if (full) {\n          this.item = path.elem.pathSegList.getItem(this.index);\n          this.type = this.item.pathSegType;\n        }\n        getControlPoints(this);\n      }\n      // this.segsel.setAttribute('display', y ? 'inline' : 'none');\n    }\n  }\n\n  move (dx, dy) {\n    const {item} = this;\n\n    const curPts = this.ctrlpts\n      ? [item.x += dx, item.y += dy,\n        item.x1, item.y1, item.x2 += dx, item.y2 += dy\n      ]\n      : [item.x += dx, item.y += dy];\n\n    replacePathSeg(this.type, this.index, curPts);\n\n    if (this.next && this.next.ctrlpts) {\n      const next = this.next.item;\n      const nextPts = [next.x, next.y,\n        next.x1 += dx, next.y1 += dy, next.x2, next.y2];\n      replacePathSeg(this.next.type, this.next.index, nextPts);\n    }\n\n    if (this.mate) {\n      // The last point of a closed subpath has a 'mate',\n      // which is the 'M' segment of the subpath\n      const {item} = this.mate;\n      const pts = [item.x += dx, item.y += dy];\n      replacePathSeg(this.mate.type, this.mate.index, pts);\n      // Has no grip, so does not need 'updating'?\n    }\n\n    this.update(true);\n    if (this.next) { this.next.update(true); }\n  }\n\n  setLinked (num) {\n    let seg, anum, pt;\n    if (num === 2) {\n      anum = 1;\n      seg = this.next;\n      if (!seg) { return; }\n      pt = this.item;\n    } else {\n      anum = 2;\n      seg = this.prev;\n      if (!seg) { return; }\n      pt = seg.item;\n    }\n\n    const {item} = seg;\n    item['x' + anum] = pt.x + (pt.x - this.item['x' + num]);\n    item['y' + anum] = pt.y + (pt.y - this.item['y' + num]);\n\n    const pts = [item.x, item.y,\n      item.x1, item.y1,\n      item.x2, item.y2];\n\n    replacePathSeg(seg.type, seg.index, pts);\n    seg.update(true);\n  }\n\n  moveCtrl (num, dx, dy) {\n    const {item} = this;\n    item['x' + num] += dx;\n    item['y' + num] += dy;\n\n    const pts = [item.x, item.y,\n      item.x1, item.y1, item.x2, item.y2];\n\n    replacePathSeg(this.type, this.index, pts);\n    this.update(true);\n  }\n\n  setType (newType, pts) {\n    replacePathSeg(newType, this.index, pts);\n    this.type = newType;\n    this.item = path.elem.pathSegList.getItem(this.index);\n    this.showCtrlPts(newType === 6);\n    this.ctrlpts = getControlPoints(this);\n    this.update(true);\n  }\n}\n\nexport class Path {\n  constructor (elem) {\n    if (!elem || elem.tagName !== 'path') {\n      throw new Error('svgedit.path.Path constructed without a <path> element');\n    }\n\n    this.elem = elem;\n    this.segs = [];\n    this.selected_pts = [];\n    path = this;\n\n    this.init();\n  }\n\n  // Reset path data\n  init () {\n    // Hide all grips, etc\n\n    // fixed, needed to work on all found elements, not just first\n    $(getGripContainer()).find('*').each(function () {\n      $(this).attr('display', 'none');\n    });\n\n    const segList = this.elem.pathSegList;\n    const len = segList.numberOfItems;\n    this.segs = [];\n    this.selected_pts = [];\n    this.first_seg = null;\n\n    // Set up segs array\n    for (let i = 0; i < len; i++) {\n      const item = segList.getItem(i);\n      const segment = new Segment(i, item);\n      segment.path = this;\n      this.segs.push(segment);\n    }\n\n    const {segs} = this;\n\n    let startI = null;\n    for (let i = 0; i < len; i++) {\n      const seg = segs[i];\n      const nextSeg = (i + 1) >= len ? null : segs[i + 1];\n      const prevSeg = (i - 1) < 0 ? null : segs[i - 1];\n      if (seg.type === 2) {\n        if (prevSeg && prevSeg.type !== 1) {\n          // New sub-path, last one is open,\n          // so add a grip to last sub-path's first point\n          const startSeg = segs[startI];\n          startSeg.next = segs[startI + 1];\n          startSeg.next.prev = startSeg;\n          startSeg.addGrip();\n        }\n        // Remember that this is a starter seg\n        startI = i;\n      } else if (nextSeg && nextSeg.type === 1) {\n        // This is the last real segment of a closed sub-path\n        // Next is first seg after \"M\"\n        seg.next = segs[startI + 1];\n\n        // First seg after \"M\"'s prev is this\n        seg.next.prev = seg;\n        seg.mate = segs[startI];\n        seg.addGrip();\n        if (this.first_seg == null) {\n          this.first_seg = seg;\n        }\n      } else if (!nextSeg) {\n        if (seg.type !== 1) {\n          // Last seg, doesn't close so add a grip\n          // to last sub-path's first point\n          const startSeg = segs[startI];\n          startSeg.next = segs[startI + 1];\n          startSeg.next.prev = startSeg;\n          startSeg.addGrip();\n          seg.addGrip();\n\n          if (!this.first_seg) {\n            // Open path, so set first as real first and add grip\n            this.first_seg = segs[startI];\n          }\n        }\n      } else if (seg.type !== 1) {\n        // Regular segment, so add grip and its \"next\"\n        seg.addGrip();\n\n        // Don't set its \"next\" if it's an \"M\"\n        if (nextSeg && nextSeg.type !== 2) {\n          seg.next = nextSeg;\n          seg.next.prev = seg;\n        }\n      }\n    }\n    return this;\n  }\n\n  eachSeg (fn) {\n    const len = this.segs.length;\n    for (let i = 0; i < len; i++) {\n      const ret = fn.call(this.segs[i], i);\n      if (ret === false) { break; }\n    }\n  }\n\n  addSeg (index) {\n    // Adds a new segment\n    const seg = this.segs[index];\n    if (!seg.prev) { return; }\n\n    const {prev} = seg;\n    let newseg, newX, newY;\n    switch (seg.item.pathSegType) {\n    case 4: {\n      newX = (seg.item.x + prev.item.x) / 2;\n      newY = (seg.item.y + prev.item.y) / 2;\n      newseg = this.elem.createSVGPathSegLinetoAbs(newX, newY);\n      break;\n    } case 6: { // make it a curved segment to preserve the shape (WRS)\n      // https://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm#Geometric_interpretation\n      const p0x = (prev.item.x + seg.item.x1) / 2;\n      const p1x = (seg.item.x1 + seg.item.x2) / 2;\n      const p2x = (seg.item.x2 + seg.item.x) / 2;\n      const p01x = (p0x + p1x) / 2;\n      const p12x = (p1x + p2x) / 2;\n      newX = (p01x + p12x) / 2;\n      const p0y = (prev.item.y + seg.item.y1) / 2;\n      const p1y = (seg.item.y1 + seg.item.y2) / 2;\n      const p2y = (seg.item.y2 + seg.item.y) / 2;\n      const p01y = (p0y + p1y) / 2;\n      const p12y = (p1y + p2y) / 2;\n      newY = (p01y + p12y) / 2;\n      newseg = this.elem.createSVGPathSegCurvetoCubicAbs(newX, newY, p0x, p0y, p01x, p01y);\n      const pts = [seg.item.x, seg.item.y, p12x, p12y, p2x, p2y];\n      replacePathSeg(seg.type, index, pts);\n      break;\n    }\n    }\n\n    insertItemBefore(this.elem, newseg, index);\n  }\n\n  deleteSeg (index) {\n    const seg = this.segs[index];\n    const list = this.elem.pathSegList;\n\n    seg.show(false);\n    const {next} = seg;\n    if (seg.mate) {\n      // Make the next point be the \"M\" point\n      const pt = [next.item.x, next.item.y];\n      replacePathSeg(2, next.index, pt);\n\n      // Reposition last node\n      replacePathSeg(4, seg.index, pt);\n\n      list.removeItem(seg.mate.index);\n    } else if (!seg.prev) {\n      // First node of open path, make next point the M\n      // const {item} = seg;\n      const pt = [next.item.x, next.item.y];\n      replacePathSeg(2, seg.next.index, pt);\n      list.removeItem(index);\n    } else {\n      list.removeItem(index);\n    }\n  }\n\n  subpathIsClosed (index) {\n    let closed = false;\n    // Check if subpath is already open\n    path.eachSeg(function (i) {\n      if (i <= index) { return true; }\n      if (this.type === 2) {\n        // Found M first, so open\n        return false;\n      }\n      if (this.type === 1) {\n        // Found Z first, so closed\n        closed = true;\n        return false;\n      }\n    });\n\n    return closed;\n  }\n\n  removePtFromSelection (index) {\n    const pos = this.selected_pts.indexOf(index);\n    if (pos === -1) {\n      return;\n    }\n    this.segs[index].select(false);\n    this.selected_pts.splice(pos, 1);\n  }\n\n  clearSelection () {\n    this.eachSeg(function () {\n      // 'this' is the segment here\n      this.select(false);\n    });\n    this.selected_pts = [];\n  }\n\n  storeD () {\n    this.last_d = this.elem.getAttribute('d');\n  }\n\n  show (y) {\n    // Shows this path's segment grips\n    this.eachSeg(function () {\n      // 'this' is the segment here\n      this.show(y);\n    });\n    if (y) {\n      this.selectPt(this.first_seg.index);\n    }\n    return this;\n  }\n\n  // Move selected points\n  movePts (dx, dy) {\n    let i = this.selected_pts.length;\n    while (i--) {\n      const seg = this.segs[this.selected_pts[i]];\n      seg.move(dx, dy);\n    }\n  }\n\n  moveCtrl (dx, dy) {\n    const seg = this.segs[this.selected_pts[0]];\n    seg.moveCtrl(this.dragctrl, dx, dy);\n    if (linkControlPts) {\n      seg.setLinked(this.dragctrl);\n    }\n  }\n\n  setSegType (newType) {\n    this.storeD();\n    let i = this.selected_pts.length;\n    let text;\n    while (i--) {\n      const selPt = this.selected_pts[i];\n\n      // Selected seg\n      const cur = this.segs[selPt];\n      const {prev} = cur;\n      if (!prev) { continue; }\n\n      if (!newType) { // double-click, so just toggle\n        text = 'Toggle Path Segment Type';\n\n        // Toggle segment to curve/straight line\n        const oldType = cur.type;\n\n        newType = (oldType === 6) ? 4 : 6;\n      }\n\n      newType = Number(newType);\n\n      const curX = cur.item.x;\n      const curY = cur.item.y;\n      const prevX = prev.item.x;\n      const prevY = prev.item.y;\n      let points;\n      switch (newType) {\n      case 6: {\n        if (cur.olditem) {\n          const old = cur.olditem;\n          points = [curX, curY, old.x1, old.y1, old.x2, old.y2];\n        } else {\n          const diffX = curX - prevX;\n          const diffY = curY - prevY;\n          // get control points from straight line segment\n          /*\n          const ct1x = (prevX + (diffY/2));\n          const ct1y = (prevY - (diffX/2));\n          const ct2x = (curX + (diffY/2));\n          const ct2y = (curY - (diffX/2));\n          */\n          // create control points on the line to preserve the shape (WRS)\n          const ct1x = (prevX + (diffX / 3));\n          const ct1y = (prevY + (diffY / 3));\n          const ct2x = (curX - (diffX / 3));\n          const ct2y = (curY - (diffY / 3));\n          points = [curX, curY, ct1x, ct1y, ct2x, ct2y];\n        }\n        break;\n      } case 4: {\n        points = [curX, curY];\n\n        // Store original prevve segment nums\n        cur.olditem = cur.item;\n        break;\n      }\n      }\n\n      cur.setType(newType, points);\n    }\n    path.endChanges(text);\n  }\n\n  selectPt (pt, ctrlNum) {\n    this.clearSelection();\n    if (pt == null) {\n      this.eachSeg(function (i) {\n        // 'this' is the segment here.\n        if (this.prev) {\n          pt = i;\n        }\n      });\n    }\n    this.addPtsToSelection(pt);\n    if (ctrlNum) {\n      this.dragctrl = ctrlNum;\n\n      if (linkControlPts) {\n        this.segs[pt].setLinked(ctrlNum);\n      }\n    }\n  }\n\n  // Update position of all points\n  update () {\n    const {elem} = this;\n    if (getRotationAngle(elem)) {\n      this.matrix = getMatrix(elem);\n      this.imatrix = this.matrix.inverse();\n    } else {\n      this.matrix = null;\n      this.imatrix = null;\n    }\n\n    this.eachSeg(function (i) {\n      this.item = elem.pathSegList.getItem(i);\n      this.update();\n    });\n\n    return this;\n  }\n\n  endChanges (text) {\n    if (isWebkit()) { editorContext_.resetD(this.elem); }\n    const cmd = new ChangeElementCommand(this.elem, {d: this.last_d}, text);\n    editorContext_.endChanges({cmd, elem: this.elem});\n  }\n\n  addPtsToSelection (indexes) {\n    if (!Array.isArray(indexes)) { indexes = [indexes]; }\n    for (let i = 0; i < indexes.length; i++) {\n      const index = indexes[i];\n      const seg = this.segs[index];\n      if (seg.ptgrip) {\n        if (!this.selected_pts.includes(index) && index >= 0) {\n          this.selected_pts.push(index);\n        }\n      }\n    }\n    this.selected_pts.sort();\n    let i = this.selected_pts.length;\n    const grips = [];\n    grips.length = i;\n    // Loop through points to be selected and highlight each\n    while (i--) {\n      const pt = this.selected_pts[i];\n      const seg = this.segs[pt];\n      seg.select(true);\n      grips[i] = seg.ptgrip;\n    }\n\n    const closedSubpath = this.subpathIsClosed(this.selected_pts[0]);\n    editorContext_.addPtsToSelection({grips, closedSubpath});\n  }\n}\n\nexport const getPath_ = function (elem) {\n  let p = pathData[elem.id];\n  if (!p) {\n    p = pathData[elem.id] = new Path(elem);\n  }\n  return p;\n};\n\nexport const removePath_ = function (id) {\n  if (id in pathData) { delete pathData[id]; }\n};\n\nlet newcx, newcy, oldcx, oldcy, angle;\n\nconst getRotVals = function (x, y) {\n  let dx = x - oldcx;\n  let dy = y - oldcy;\n\n  // rotate the point around the old center\n  let r = Math.sqrt(dx * dx + dy * dy);\n  let theta = Math.atan2(dy, dx) + angle;\n  dx = r * Math.cos(theta) + oldcx;\n  dy = r * Math.sin(theta) + oldcy;\n\n  // dx,dy should now hold the actual coordinates of each\n  // point after being rotated\n\n  // now we want to rotate them around the new center in the reverse direction\n  dx -= newcx;\n  dy -= newcy;\n\n  r = Math.sqrt(dx * dx + dy * dy);\n  theta = Math.atan2(dy, dx) - angle;\n\n  return {x: r * Math.cos(theta) + newcx,\n    y: r * Math.sin(theta) + newcy};\n};\n\n// If the path was rotated, we must now pay the piper:\n// Every path point must be rotated into the rotated coordinate system of\n// its old center, then determine the new center, then rotate it back\n// This is because we want the path to remember its rotation\n\n// TODO: This is still using ye olde transform methods, can probably\n// be optimized or even taken care of by `recalculateDimensions`\nexport const recalcRotatedPath = function () {\n  const currentPath = path.elem;\n  angle = getRotationAngle(currentPath, true);\n  if (!angle) { return; }\n  // selectedBBoxes[0] = path.oldbbox;\n  const oldbox = path.oldbbox; // selectedBBoxes[0],\n  oldcx = oldbox.x + oldbox.width / 2;\n  oldcy = oldbox.y + oldbox.height / 2;\n  let box = getBBox(currentPath);\n  newcx = box.x + box.width / 2;\n  newcy = box.y + box.height / 2;\n\n  // un-rotate the new center to the proper position\n  const dx = newcx - oldcx,\n    dy = newcy - oldcy,\n    r = Math.sqrt(dx * dx + dy * dy),\n    theta = Math.atan2(dy, dx) + angle;\n\n  newcx = r * Math.cos(theta) + oldcx;\n  newcy = r * Math.sin(theta) + oldcy;\n\n  const list = currentPath.pathSegList;\n\n  let i = list.numberOfItems;\n  while (i) {\n    i -= 1;\n    const seg = list.getItem(i),\n      type = seg.pathSegType;\n    if (type === 1) { continue; }\n\n    const rvals = getRotVals(seg.x, seg.y),\n      points = [rvals.x, rvals.y];\n    if (seg.x1 != null && seg.x2 != null) {\n      const cVals1 = getRotVals(seg.x1, seg.y1);\n      const cVals2 = getRotVals(seg.x2, seg.y2);\n      points.splice(points.length, 0, cVals1.x, cVals1.y, cVals2.x, cVals2.y);\n    }\n    replacePathSeg(type, i, points);\n  } // loop for each point\n\n  box = getBBox(currentPath);\n  // selectedBBoxes[0].x = box.x; selectedBBoxes[0].y = box.y;\n  // selectedBBoxes[0].width = box.width; selectedBBoxes[0].height = box.height;\n\n  // now we must set the new transform to be rotated around the new center\n  const Rnc = editorContext_.getSVGRoot().createSVGTransform(),\n    tlist = getTransformList(currentPath);\n  Rnc.setRotate((angle * 180.0 / Math.PI), newcx, newcy);\n  tlist.replaceItem(Rnc, 0);\n};\n\n// ====================================\n// Public API starts here\n\nexport const clearData = function () {\n  pathData = {};\n};\n\n// Making public for mocking\nexport const reorientGrads = function (elem, m) {\n  const bb = utilsGetBBox(elem);\n  for (let i = 0; i < 2; i++) {\n    const type = i === 0 ? 'fill' : 'stroke';\n    const attrVal = elem.getAttribute(type);\n    if (attrVal && attrVal.startsWith('url(')) {\n      const grad = getRefElem(attrVal);\n      if (grad.tagName === 'linearGradient') {\n        let x1 = grad.getAttribute('x1') || 0;\n        let y1 = grad.getAttribute('y1') || 0;\n        let x2 = grad.getAttribute('x2') || 1;\n        let y2 = grad.getAttribute('y2') || 0;\n\n        // Convert to USOU points\n        x1 = (bb.width * x1) + bb.x;\n        y1 = (bb.height * y1) + bb.y;\n        x2 = (bb.width * x2) + bb.x;\n        y2 = (bb.height * y2) + bb.y;\n\n        // Transform those points\n        const pt1 = transformPoint(x1, y1, m);\n        const pt2 = transformPoint(x2, y2, m);\n\n        // Convert back to BB points\n        const gCoords = {};\n\n        gCoords.x1 = (pt1.x - bb.x) / bb.width;\n        gCoords.y1 = (pt1.y - bb.y) / bb.height;\n        gCoords.x2 = (pt2.x - bb.x) / bb.width;\n        gCoords.y2 = (pt2.y - bb.y) / bb.height;\n\n        const newgrad = grad.cloneNode(true);\n        $(newgrad).attr(gCoords);\n\n        newgrad.id = editorContext_.getNextId();\n        findDefs().append(newgrad);\n        elem.setAttribute(type, 'url(#' + newgrad.id + ')');\n      }\n    }\n  }\n};\n\n// this is how we map paths to our preferred relative segment types\nconst pathMap = [0, 'z', 'M', 'm', 'L', 'l', 'C', 'c', 'Q', 'q', 'A', 'a',\n  'H', 'h', 'V', 'v', 'S', 's', 'T', 't'];\n\n/**\n * TODO: move to pathActions.js\n * Convert a path to one with only absolute or relative values\n * @param {Object} path - the path to convert\n * @param {boolean} toRel - true of convert to relative\n * @returns {string}\n */\nexport const convertPath = function (path, toRel) {\n  const segList = path.pathSegList;\n  const len = segList.numberOfItems;\n  let curx = 0, cury = 0;\n  let d = '';\n  let lastM = null;\n\n  for (let i = 0; i < len; ++i) {\n    const seg = segList.getItem(i);\n    // if these properties are not in the segment, set them to zero\n    let x = seg.x || 0,\n      y = seg.y || 0,\n      x1 = seg.x1 || 0,\n      y1 = seg.y1 || 0,\n      x2 = seg.x2 || 0,\n      y2 = seg.y2 || 0;\n\n    const type = seg.pathSegType;\n    let letter = pathMap[type]['to' + (toRel ? 'Lower' : 'Upper') + 'Case']();\n\n    switch (type) {\n    case 1: // z,Z closepath (Z/z)\n      d += 'z';\n      if (lastM && !toRel) {\n        curx = lastM[0];\n        cury = lastM[1];\n      }\n      break;\n    case 12: // absolute horizontal line (H)\n      x -= curx;\n      // Fallthrough\n    case 13: // relative horizontal line (h)\n      if (toRel) {\n        curx += x;\n        letter = 'l';\n      } else {\n        x += curx;\n        curx = x;\n        letter = 'L';\n      }\n      // Convert to \"line\" for easier editing\n      d += pathDSegment(letter, [[x, cury]]);\n      break;\n    case 14: // absolute vertical line (V)\n      y -= cury;\n      // Fallthrough\n    case 15: // relative vertical line (v)\n      if (toRel) {\n        cury += y;\n        letter = 'l';\n      } else {\n        y += cury;\n        cury = y;\n        letter = 'L';\n      }\n      // Convert to \"line\" for easier editing\n      d += pathDSegment(letter, [[curx, y]]);\n      break;\n    case 2: // absolute move (M)\n    case 4: // absolute line (L)\n    case 18: // absolute smooth quad (T)\n      x -= curx;\n      y -= cury;\n      // Fallthrough\n    case 5: // relative line (l)\n    case 3: // relative move (m)\n    case 19: // relative smooth quad (t)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx;\n        y += cury;\n        curx = x;\n        cury = y;\n      }\n      if (type === 2 || type === 3) { lastM = [curx, cury]; }\n\n      d += pathDSegment(letter, [[x, y]]);\n      break;\n    case 6: // absolute cubic (C)\n      x -= curx; x1 -= curx; x2 -= curx;\n      y -= cury; y1 -= cury; y2 -= cury;\n      // Fallthrough\n    case 7: // relative cubic (c)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx; x1 += curx; x2 += curx;\n        y += cury; y1 += cury; y2 += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[x1, y1], [x2, y2], [x, y]]);\n      break;\n    case 8: // absolute quad (Q)\n      x -= curx; x1 -= curx;\n      y -= cury; y1 -= cury;\n      // Fallthrough\n    case 9: // relative quad (q)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx; x1 += curx;\n        y += cury; y1 += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[x1, y1], [x, y]]);\n      break;\n    case 10: // absolute elliptical arc (A)\n      x -= curx;\n      y -= cury;\n      // Fallthrough\n    case 11: // relative elliptical arc (a)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx;\n        y += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[seg.r1, seg.r2]], [\n        seg.angle,\n        (seg.largeArcFlag ? 1 : 0),\n        (seg.sweepFlag ? 1 : 0)\n      ], [x, y]);\n      break;\n    case 16: // absolute smooth cubic (S)\n      x -= curx; x2 -= curx;\n      y -= cury; y2 -= cury;\n      // Fallthrough\n    case 17: // relative smooth cubic (s)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx; x2 += curx;\n        y += cury; y2 += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[x2, y2], [x, y]]);\n      break;\n    } // switch on path segment type\n  } // for each segment\n  return d;\n};\n\n/**\n * TODO: refactor callers in convertPath to use getPathDFromSegments instead of this function.\n * Legacy code refactored from svgcanvas.pathActions.convertPath\n * @param letter - path segment command\n * @param {Array.<Array.<number>>} points - x,y points.\n * @param {Array.<Array.<number>>=} morePoints - x,y points\n * @param {Array.<number>=}lastPoint - x,y point\n * @returns {string}\n */\nfunction pathDSegment (letter, points, morePoints, lastPoint) {\n  $.each(points, function (i, pnt) {\n    points[i] = shortFloat(pnt);\n  });\n  let segment = letter + points.join(' ');\n  if (morePoints) {\n    segment += ' ' + morePoints.join(' ');\n  }\n  if (lastPoint) {\n    segment += ' ' + shortFloat(lastPoint);\n  }\n  return segment;\n}\n\n/**\n* Group: Path edit functions\n* Functions relating to editing path elements\n*/\nexport const pathActions = (function () {\n  let subpath = false;\n  let newPoint, firstCtrl;\n\n  let currentPath = null;\n  let hasMoved = false;\n  // No `editorContext_` yet but should be ok as is `null` by default\n  // editorContext_.setDrawnPath(null);\n\n  // This function converts a polyline (created by the fh_path tool) into\n  // a path element and coverts every three line segments into a single bezier\n  // curve in an attempt to smooth out the free-hand\n  const smoothPolylineIntoPath = function (element) {\n    let i;\n    const {points} = element;\n    const N = points.numberOfItems;\n    if (N >= 4) {\n      // loop through every 3 points and convert to a cubic bezier curve segment\n      //\n      // NOTE: this is cheating, it means that every 3 points has the potential to\n      // be a corner instead of treating each point in an equal manner. In general,\n      // this technique does not look that good.\n      //\n      // I am open to better ideas!\n      //\n      // Reading:\n      // - http://www.efg2.com/Lab/Graphics/Jean-YvesQueinecBezierCurves.htm\n      // - https://www.codeproject.com/KB/graphics/BezierSpline.aspx?msg=2956963\n      // - https://www.ian-ko.com/ET_GeoWizards/UserGuide/smooth.htm\n      // - https://www.cs.mtu.edu/~shene/COURSES/cs3621/NOTES/spline/Bezier/bezier-der.html\n      let curpos = points.getItem(0), prevCtlPt = null;\n      let d = [];\n      d.push(['M', curpos.x, ',', curpos.y, ' C'].join(''));\n      for (i = 1; i <= (N - 4); i += 3) {\n        let ct1 = points.getItem(i);\n        const ct2 = points.getItem(i + 1);\n        const end = points.getItem(i + 2);\n\n        // if the previous segment had a control point, we want to smooth out\n        // the control points on both sides\n        if (prevCtlPt) {\n          const newpts = smoothControlPoints(prevCtlPt, ct1, curpos);\n          if (newpts && newpts.length === 2) {\n            const prevArr = d[d.length - 1].split(',');\n            prevArr[2] = newpts[0].x;\n            prevArr[3] = newpts[0].y;\n            d[d.length - 1] = prevArr.join(',');\n            ct1 = newpts[1];\n          }\n        }\n\n        d.push([ct1.x, ct1.y, ct2.x, ct2.y, end.x, end.y].join(','));\n\n        curpos = end;\n        prevCtlPt = ct2;\n      }\n      // handle remaining line segments\n      d.push('L');\n      while (i < N) {\n        const pt = points.getItem(i);\n        d.push([pt.x, pt.y].join(','));\n        i++;\n      }\n      d = d.join(' ');\n\n      // create new path element\n      element = editorContext_.addSvgElementFromJson({\n        element: 'path',\n        curStyles: true,\n        attr: {\n          id: editorContext_.getId(),\n          d,\n          fill: 'none'\n        }\n      });\n      // No need to call \"changed\", as this is already done under mouseUp\n    }\n    return element;\n  };\n\n  return {\n    mouseDown (evt, mouseTarget, startX, startY) {\n      let id;\n      if (editorContext_.getCurrentMode() === 'path') {\n        let mouseX = startX; // Was this meant to work with the other `mouseX`? (was defined globally so adding `let` to at least avoid a global)\n        let mouseY = startY; // Was this meant to work with the other `mouseY`? (was defined globally so adding `let` to at least avoid a global)\n\n        const currentZoom = editorContext_.getCurrentZoom();\n        let x = mouseX / currentZoom,\n          y = mouseY / currentZoom,\n          stretchy = getElem('path_stretch_line');\n        newPoint = [x, y];\n\n        if (editorContext_.getGridSnapping()) {\n          x = snapToGrid(x);\n          y = snapToGrid(y);\n          mouseX = snapToGrid(mouseX);\n          mouseY = snapToGrid(mouseY);\n        }\n\n        if (!stretchy) {\n          stretchy = document.createElementNS(NS.SVG, 'path');\n          assignAttributes(stretchy, {\n            id: 'path_stretch_line',\n            stroke: '#22C',\n            'stroke-width': '0.5',\n            fill: 'none'\n          });\n          stretchy = getElem('selectorParentGroup').appendChild(stretchy);\n        }\n        stretchy.setAttribute('display', 'inline');\n\n        let keep = null;\n        let index;\n        // if pts array is empty, create path element with M at current point\n        let drawnPath = editorContext_.getDrawnPath();\n        if (!drawnPath) {\n          const dAttr = 'M' + x + ',' + y + ' '; // Was this meant to work with the other `dAttr`? (was defined globally so adding `var` to at least avoid a global)\n          drawnPath = editorContext_.setDrawnPath(editorContext_.addSvgElementFromJson({\n            element: 'path',\n            curStyles: true,\n            attr: {\n              d: dAttr,\n              id: editorContext_.getNextId(),\n              opacity: editorContext_.getOpacity() / 2\n            }\n          }));\n          // set stretchy line to first point\n          stretchy.setAttribute('d', ['M', mouseX, mouseY, mouseX, mouseY].join(' '));\n          index = subpath ? path.segs.length : 0;\n          addPointGrip(index, mouseX, mouseY);\n        } else {\n          // determine if we clicked on an existing point\n          const seglist = drawnPath.pathSegList;\n          let i = seglist.numberOfItems;\n          const FUZZ = 6 / currentZoom;\n          let clickOnPoint = false;\n          while (i) {\n            i--;\n            const item = seglist.getItem(i);\n            const px = item.x, py = item.y;\n            // found a matching point\n            if (x >= (px - FUZZ) && x <= (px + FUZZ) &&\n              y >= (py - FUZZ) && y <= (py + FUZZ)\n            ) {\n              clickOnPoint = true;\n              break;\n            }\n          }\n\n          // get path element that we are in the process of creating\n          id = editorContext_.getId();\n\n          // Remove previous path object if previously created\n          removePath_(id);\n\n          const newpath = getElem(id);\n          let newseg;\n          let sSeg;\n          const len = seglist.numberOfItems;\n          // if we clicked on an existing point, then we are done this path, commit it\n          // (i, i+1) are the x,y that were clicked on\n          if (clickOnPoint) {\n            // if clicked on any other point but the first OR\n            // the first point was clicked on and there are less than 3 points\n            // then leave the path open\n            // otherwise, close the path\n            if (i <= 1 && len >= 2) {\n              // Create end segment\n              const absX = seglist.getItem(0).x;\n              const absY = seglist.getItem(0).y;\n\n              sSeg = stretchy.pathSegList.getItem(1);\n              if (sSeg.pathSegType === 4) {\n                newseg = drawnPath.createSVGPathSegLinetoAbs(absX, absY);\n              } else {\n                newseg = drawnPath.createSVGPathSegCurvetoCubicAbs(\n                  absX,\n                  absY,\n                  sSeg.x1 / currentZoom,\n                  sSeg.y1 / currentZoom,\n                  absX,\n                  absY\n                );\n              }\n\n              const endseg = drawnPath.createSVGPathSegClosePath();\n              seglist.appendItem(newseg);\n              seglist.appendItem(endseg);\n            } else if (len < 3) {\n              keep = false;\n              return keep;\n            }\n            $(stretchy).remove();\n\n            // This will signal to commit the path\n            // const element = newpath; // Other event handlers define own `element`, so this was probably not meant to interact with them or one which shares state (as there were none); I therefore adding a missing `var` to avoid a global\n            drawnPath = editorContext_.setDrawnPath(null);\n            editorContext_.setStarted(false);\n\n            if (subpath) {\n              if (path.matrix) {\n                editorContext_.remapElement(newpath, {}, path.matrix.inverse());\n              }\n\n              const newD = newpath.getAttribute('d');\n              const origD = $(path.elem).attr('d');\n              $(path.elem).attr('d', origD + newD);\n              $(newpath).remove();\n              if (path.matrix) {\n                recalcRotatedPath();\n              }\n              init();\n              pathActions.toEditMode(path.elem);\n              path.selectPt();\n              return false;\n            }\n          // else, create a new point, update path element\n          } else {\n            // Checks if current target or parents are #svgcontent\n            if (!$.contains(\n              editorContext_.getContainer(),\n              editorContext_.getMouseTarget(evt)\n            )) {\n              // Clicked outside canvas, so don't make point\n              console.log('Clicked outside canvas');\n              return false;\n            }\n\n            const num = drawnPath.pathSegList.numberOfItems;\n            const last = drawnPath.pathSegList.getItem(num - 1);\n            const lastx = last.x, lasty = last.y;\n\n            if (evt.shiftKey) {\n              const xya = snapToAngle(lastx, lasty, x, y);\n              ({x, y} = xya);\n            }\n\n            // Use the segment defined by stretchy\n            sSeg = stretchy.pathSegList.getItem(1);\n            if (sSeg.pathSegType === 4) {\n              newseg = drawnPath.createSVGPathSegLinetoAbs(\n                editorContext_.round(x),\n                editorContext_.round(y)\n              );\n            } else {\n              newseg = drawnPath.createSVGPathSegCurvetoCubicAbs(\n                editorContext_.round(x),\n                editorContext_.round(y),\n                sSeg.x1 / currentZoom,\n                sSeg.y1 / currentZoom,\n                sSeg.x2 / currentZoom,\n                sSeg.y2 / currentZoom\n              );\n            }\n\n            drawnPath.pathSegList.appendItem(newseg);\n\n            x *= currentZoom;\n            y *= currentZoom;\n\n            // set stretchy line to latest point\n            stretchy.setAttribute('d', ['M', x, y, x, y].join(' '));\n            index = num;\n            if (subpath) { index += path.segs.length; }\n            addPointGrip(index, x, y);\n          }\n          // keep = true;\n        }\n\n        return;\n      }\n\n      // TODO: Make sure currentPath isn't null at this point\n      if (!path) { return; }\n\n      path.storeD();\n\n      ({id} = evt.target);\n      let curPt;\n      if (id.substr(0, 14) === 'pathpointgrip_') {\n        // Select this point\n        curPt = path.cur_pt = parseInt(id.substr(14), 10);\n        path.dragging = [startX, startY];\n        const seg = path.segs[curPt];\n\n        // only clear selection if shift is not pressed (otherwise, add\n        // node to selection)\n        if (!evt.shiftKey) {\n          if (path.selected_pts.length <= 1 || !seg.selected) {\n            path.clearSelection();\n          }\n          path.addPtsToSelection(curPt);\n        } else if (seg.selected) {\n          path.removePtFromSelection(curPt);\n        } else {\n          path.addPtsToSelection(curPt);\n        }\n      } else if (id.startsWith('ctrlpointgrip_')) {\n        path.dragging = [startX, startY];\n\n        const parts = id.split('_')[1].split('c');\n        curPt = Number(parts[0]);\n        const ctrlNum = Number(parts[1]);\n        path.selectPt(curPt, ctrlNum);\n      }\n\n      // Start selection box\n      if (!path.dragging) {\n        let rubberBox = editorContext_.getRubberBox();\n        if (rubberBox == null) {\n          rubberBox = editorContext_.setRubberBox(\n            editorContext_.selectorManager.getRubberBandBox()\n          );\n        }\n        const currentZoom = editorContext_.getCurrentZoom();\n        assignAttributes(rubberBox, {\n          x: startX * currentZoom,\n          y: startY * currentZoom,\n          width: 0,\n          height: 0,\n          display: 'inline'\n        }, 100);\n      }\n    },\n    mouseMove (mouseX, mouseY) {\n      const currentZoom = editorContext_.getCurrentZoom();\n      hasMoved = true;\n      const drawnPath = editorContext_.getDrawnPath();\n      if (editorContext_.getCurrentMode() === 'path') {\n        if (!drawnPath) { return; }\n        const seglist = drawnPath.pathSegList;\n        const index = seglist.numberOfItems - 1;\n\n        if (newPoint) {\n          // First point\n          // if (!index) { return; }\n\n          // Set control points\n          const pointGrip1 = addCtrlGrip('1c1');\n          const pointGrip2 = addCtrlGrip('0c2');\n\n          // dragging pointGrip1\n          pointGrip1.setAttribute('cx', mouseX);\n          pointGrip1.setAttribute('cy', mouseY);\n          pointGrip1.setAttribute('display', 'inline');\n\n          const ptX = newPoint[0];\n          const ptY = newPoint[1];\n\n          // set curve\n          // const seg = seglist.getItem(index);\n          const curX = mouseX / currentZoom;\n          const curY = mouseY / currentZoom;\n          const altX = (ptX + (ptX - curX));\n          const altY = (ptY + (ptY - curY));\n\n          pointGrip2.setAttribute('cx', altX * currentZoom);\n          pointGrip2.setAttribute('cy', altY * currentZoom);\n          pointGrip2.setAttribute('display', 'inline');\n\n          const ctrlLine = getCtrlLine(1);\n          assignAttributes(ctrlLine, {\n            x1: mouseX,\n            y1: mouseY,\n            x2: altX * currentZoom,\n            y2: altY * currentZoom,\n            display: 'inline'\n          });\n\n          if (index === 0) {\n            firstCtrl = [mouseX, mouseY];\n          } else {\n            const last = seglist.getItem(index - 1);\n            let lastX = last.x;\n            let lastY = last.y;\n\n            if (last.pathSegType === 6) {\n              lastX += (lastX - last.x2);\n              lastY += (lastY - last.y2);\n            } else if (firstCtrl) {\n              lastX = firstCtrl[0] / currentZoom;\n              lastY = firstCtrl[1] / currentZoom;\n            }\n            replacePathSeg(6, index, [ptX, ptY, lastX, lastY, altX, altY], drawnPath);\n          }\n        } else {\n          const stretchy = getElem('path_stretch_line');\n          if (stretchy) {\n            const prev = seglist.getItem(index);\n            if (prev.pathSegType === 6) {\n              const prevX = prev.x + (prev.x - prev.x2);\n              const prevY = prev.y + (prev.y - prev.y2);\n              replacePathSeg(6, 1, [mouseX, mouseY, prevX * currentZoom, prevY * currentZoom, mouseX, mouseY], stretchy);\n            } else if (firstCtrl) {\n              replacePathSeg(6, 1, [mouseX, mouseY, firstCtrl[0], firstCtrl[1], mouseX, mouseY], stretchy);\n            } else {\n              replacePathSeg(4, 1, [mouseX, mouseY], stretchy);\n            }\n          }\n        }\n        return;\n      }\n      // if we are dragging a point, let's move it\n      if (path.dragging) {\n        const pt = getPointFromGrip({\n          x: path.dragging[0],\n          y: path.dragging[1]\n        }, path);\n        const mpt = getPointFromGrip({\n          x: mouseX,\n          y: mouseY\n        }, path);\n        const diffX = mpt.x - pt.x;\n        const diffY = mpt.y - pt.y;\n        path.dragging = [mouseX, mouseY];\n\n        if (path.dragctrl) {\n          path.moveCtrl(diffX, diffY);\n        } else {\n          path.movePts(diffX, diffY);\n        }\n      } else {\n        path.selected_pts = [];\n        path.eachSeg(function (i) {\n          const seg = this;\n          if (!seg.next && !seg.prev) { return; }\n\n          // const {item} = seg;\n          const rubberBox = editorContext_.getRubberBox();\n          const rbb = rubberBox.getBBox();\n\n          const pt = getGripPt(seg);\n          const ptBb = {\n            x: pt.x,\n            y: pt.y,\n            width: 0,\n            height: 0\n          };\n\n          const sel = rectsIntersect(rbb, ptBb);\n\n          this.select(sel);\n          // Note that addPtsToSelection is not being run\n          if (sel) { path.selected_pts.push(seg.index); }\n        });\n      }\n    },\n    mouseUp (evt, element, mouseX, mouseY) {\n      const drawnPath = editorContext_.getDrawnPath();\n      // Create mode\n      if (editorContext_.getCurrentMode() === 'path') {\n        newPoint = null;\n        if (!drawnPath) {\n          element = getElem(editorContext_.getId());\n          editorContext_.setStarted(false);\n          firstCtrl = null;\n        }\n\n        return {\n          keep: true,\n          element\n        };\n      }\n\n      // Edit mode\n      const rubberBox = editorContext_.getRubberBox();\n      if (path.dragging) {\n        const lastPt = path.cur_pt;\n\n        path.dragging = false;\n        path.dragctrl = false;\n        path.update();\n\n        if (hasMoved) {\n          path.endChanges('Move path point(s)');\n        }\n\n        if (!evt.shiftKey && !hasMoved) {\n          path.selectPt(lastPt);\n        }\n      } else if (rubberBox && rubberBox.getAttribute('display') !== 'none') {\n        // Done with multi-node-select\n        rubberBox.setAttribute('display', 'none');\n\n        if (rubberBox.getAttribute('width') <= 2 && rubberBox.getAttribute('height') <= 2) {\n          pathActions.toSelectMode(evt.target);\n        }\n\n      // else, move back to select mode\n      } else {\n        pathActions.toSelectMode(evt.target);\n      }\n      hasMoved = false;\n    },\n    toEditMode (element) {\n      path = getPath_(element);\n      editorContext_.setCurrentMode('pathedit');\n      editorContext_.clearSelection();\n      path.show(true).update();\n      path.oldbbox = utilsGetBBox(path.elem);\n      subpath = false;\n    },\n    toSelectMode (elem) {\n      const selPath = (elem === path.elem);\n      editorContext_.setCurrentMode('select');\n      path.show(false);\n      currentPath = false;\n      editorContext_.clearSelection();\n\n      if (path.matrix) {\n        // Rotated, so may need to re-calculate the center\n        recalcRotatedPath();\n      }\n\n      if (selPath) {\n        editorContext_.call('selected', [elem]);\n        editorContext_.addToSelection([elem], true);\n      }\n    },\n    addSubPath (on) {\n      if (on) {\n        // Internally we go into \"path\" mode, but in the UI it will\n        // still appear as if in \"pathedit\" mode.\n        editorContext_.setCurrentMode('path');\n        subpath = true;\n      } else {\n        pathActions.clear(true);\n        pathActions.toEditMode(path.elem);\n      }\n    },\n    select (target) {\n      if (currentPath === target) {\n        pathActions.toEditMode(target);\n        editorContext_.setCurrentMode('pathedit');\n      // going into pathedit mode\n      } else {\n        currentPath = target;\n      }\n    },\n    reorient () {\n      const elem = editorContext_.getSelectedElements()[0];\n      if (!elem) { return; }\n      const angle = getRotationAngle(elem);\n      if (angle === 0) { return; }\n\n      const batchCmd = new BatchCommand('Reorient path');\n      const changes = {\n        d: elem.getAttribute('d'),\n        transform: elem.getAttribute('transform')\n      };\n      batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n      editorContext_.clearSelection();\n      this.resetOrientation(elem);\n\n      editorContext_.addCommandToHistory(batchCmd);\n\n      // Set matrix to null\n      getPath_(elem).show(false).matrix = null;\n\n      this.clear();\n\n      editorContext_.addToSelection([elem], true);\n      editorContext_.call('changed', editorContext_.getSelectedElements());\n    },\n\n    clear (remove) {\n      const drawnPath = editorContext_.getDrawnPath();\n      currentPath = null;\n      if (drawnPath) {\n        const elem = getElem(editorContext_.getId());\n        $(getElem('path_stretch_line')).remove();\n        $(elem).remove();\n        $(getElem('pathpointgrip_container')).find('*').attr('display', 'none');\n        firstCtrl = null;\n        editorContext_.setDrawnPath(null);\n        editorContext_.setStarted(false);\n      } else if (editorContext_.getCurrentMode() === 'pathedit') {\n        this.toSelectMode();\n      }\n      if (path) { path.init().show(false); }\n    },\n    resetOrientation (pth) {\n      if (pth == null || pth.nodeName !== 'path') { return false; }\n      const tlist = getTransformList(pth);\n      const m = transformListToTransform(tlist).matrix;\n      tlist.clear();\n      pth.removeAttribute('transform');\n      const segList = pth.pathSegList;\n\n      // Opera/win/non-EN throws an error here.\n      // TODO: Find out why!\n      // Presumed fixed in Opera 10.5, so commented out for now\n\n      // try {\n      const len = segList.numberOfItems;\n      // } catch(err) {\n      //   const fixed_d = pathActions.convertPath(pth);\n      //   pth.setAttribute('d', fixed_d);\n      //   segList = pth.pathSegList;\n      //   const len = segList.numberOfItems;\n      // }\n      // let lastX, lastY;\n      for (let i = 0; i < len; ++i) {\n        const seg = segList.getItem(i);\n        const type = seg.pathSegType;\n        if (type === 1) { continue; }\n        const pts = [];\n        $.each(['', 1, 2], function (j, n) {\n          const x = seg['x' + n], y = seg['y' + n];\n          if (x !== undefined && y !== undefined) {\n            const pt = transformPoint(x, y, m);\n            pts.splice(pts.length, 0, pt.x, pt.y);\n          }\n        });\n        replacePathSeg(type, i, pts, pth);\n      }\n\n      reorientGrads(pth, m);\n    },\n    zoomChange () {\n      if (editorContext_.getCurrentMode() === 'pathedit') {\n        path.update();\n      }\n    },\n    getNodePoint () {\n      const selPt = path.selected_pts.length ? path.selected_pts[0] : 1;\n\n      const seg = path.segs[selPt];\n      return {\n        x: seg.item.x,\n        y: seg.item.y,\n        type: seg.type\n      };\n    },\n    linkControlPoints (linkPoints) {\n      setLinkControlPoints(linkPoints);\n    },\n    clonePathNode () {\n      path.storeD();\n\n      const selPts = path.selected_pts;\n      // const {segs} = path;\n\n      let i = selPts.length;\n      const nums = [];\n\n      while (i--) {\n        const pt = selPts[i];\n        path.addSeg(pt);\n\n        nums.push(pt + i);\n        nums.push(pt + i + 1);\n      }\n      path.init().addPtsToSelection(nums);\n\n      path.endChanges('Clone path node(s)');\n    },\n    opencloseSubPath () {\n      const selPts = path.selected_pts;\n      // Only allow one selected node for now\n      if (selPts.length !== 1) { return; }\n\n      const {elem} = path;\n      const list = elem.pathSegList;\n\n      // const len = list.numberOfItems;\n\n      const index = selPts[0];\n\n      let openPt = null;\n      let startItem = null;\n\n      // Check if subpath is already open\n      path.eachSeg(function (i) {\n        if (this.type === 2 && i <= index) {\n          startItem = this.item;\n        }\n        if (i <= index) { return true; }\n        if (this.type === 2) {\n          // Found M first, so open\n          openPt = i;\n          return false;\n        }\n        if (this.type === 1) {\n          // Found Z first, so closed\n          openPt = false;\n          return false;\n        }\n      });\n\n      if (openPt == null) {\n        // Single path, so close last seg\n        openPt = path.segs.length - 1;\n      }\n\n      if (openPt !== false) {\n        // Close this path\n\n        // Create a line going to the previous \"M\"\n        const newseg = elem.createSVGPathSegLinetoAbs(startItem.x, startItem.y);\n\n        const closer = elem.createSVGPathSegClosePath();\n        if (openPt === path.segs.length - 1) {\n          list.appendItem(newseg);\n          list.appendItem(closer);\n        } else {\n          insertItemBefore(elem, closer, openPt);\n          insertItemBefore(elem, newseg, openPt);\n        }\n\n        path.init().selectPt(openPt + 1);\n        return;\n      }\n\n      // M 1,1 L 2,2 L 3,3 L 1,1 z // open at 2,2\n      // M 2,2 L 3,3 L 1,1\n\n      // M 1,1 L 2,2 L 1,1 z M 4,4 L 5,5 L6,6 L 5,5 z\n      // M 1,1 L 2,2 L 1,1 z [M 4,4] L 5,5 L(M)6,6 L 5,5 z\n\n      const seg = path.segs[index];\n\n      if (seg.mate) {\n        list.removeItem(index); // Removes last \"L\"\n        list.removeItem(index); // Removes the \"Z\"\n        path.init().selectPt(index - 1);\n        return;\n      }\n\n      let lastM, zSeg;\n\n      // Find this sub-path's closing point and remove\n      for (let i = 0; i < list.numberOfItems; i++) {\n        const item = list.getItem(i);\n\n        if (item.pathSegType === 2) {\n          // Find the preceding M\n          lastM = i;\n        } else if (i === index) {\n          // Remove it\n          list.removeItem(lastM);\n          // index--;\n        } else if (item.pathSegType === 1 && index < i) {\n          // Remove the closing seg of this subpath\n          zSeg = i - 1;\n          list.removeItem(i);\n          break;\n        }\n      }\n\n      let num = (index - lastM) - 1;\n\n      while (num--) {\n        insertItemBefore(elem, list.getItem(lastM), zSeg);\n      }\n\n      const pt = list.getItem(lastM);\n\n      // Make this point the new \"M\"\n      replacePathSeg(2, lastM, [pt.x, pt.y]);\n\n      // i = index; // i is local here, so has no effect; what was the intent for this?\n\n      path.init().selectPt(0);\n    },\n    deletePathNode () {\n      if (!pathActions.canDeleteNodes) { return; }\n      path.storeD();\n\n      const selPts = path.selected_pts;\n\n      let i = selPts.length;\n      while (i--) {\n        const pt = selPts[i];\n        path.deleteSeg(pt);\n      }\n\n      // Cleanup\n      const cleanup = function () {\n        const segList = path.elem.pathSegList;\n        let len = segList.numberOfItems;\n\n        const remItems = function (pos, count) {\n          while (count--) {\n            segList.removeItem(pos);\n          }\n        };\n\n        if (len <= 1) { return true; }\n\n        while (len--) {\n          const item = segList.getItem(len);\n          if (item.pathSegType === 1) {\n            const prev = segList.getItem(len - 1);\n            const nprev = segList.getItem(len - 2);\n            if (prev.pathSegType === 2) {\n              remItems(len - 1, 2);\n              cleanup();\n              break;\n            } else if (nprev.pathSegType === 2) {\n              remItems(len - 2, 3);\n              cleanup();\n              break;\n            }\n          } else if (item.pathSegType === 2) {\n            if (len > 0) {\n              const prevType = segList.getItem(len - 1).pathSegType;\n              // Path has M M\n              if (prevType === 2) {\n                remItems(len - 1, 1);\n                cleanup();\n                break;\n              // Entire path ends with Z M\n              } else if (prevType === 1 && segList.numberOfItems - 1 === len) {\n                remItems(len, 1);\n                cleanup();\n                break;\n              }\n            }\n          }\n        }\n        return false;\n      };\n\n      cleanup();\n\n      // Completely delete a path with 1 or 0 segments\n      if (path.elem.pathSegList.numberOfItems <= 1) {\n        pathActions.toSelectMode(path.elem);\n        editorContext_.canvas.deleteSelectedElements();\n        return;\n      }\n\n      path.init();\n      path.clearSelection();\n\n      // TODO: Find right way to select point now\n      // path.selectPt(selPt);\n      if (window.opera) { // Opera repaints incorrectly\n        const cp = $(path.elem);\n        cp.attr('d', cp.attr('d'));\n      }\n      path.endChanges('Delete path node(s)');\n    },\n    smoothPolylineIntoPath,\n    setSegType (v) {\n      path.setSegType(v);\n    },\n    moveNode (attr, newValue) {\n      const selPts = path.selected_pts;\n      if (!selPts.length) { return; }\n\n      path.storeD();\n\n      // Get first selected point\n      const seg = path.segs[selPts[0]];\n      const diff = {x: 0, y: 0};\n      diff[attr] = newValue - seg.item[attr];\n\n      seg.move(diff.x, diff.y);\n      path.endChanges('Move path point');\n    },\n    fixEnd (elem) {\n      // Adds an extra segment if the last seg before a Z doesn't end\n      // at its M point\n      // M0,0 L0,100 L100,100 z\n      const segList = elem.pathSegList;\n      const len = segList.numberOfItems;\n      let lastM;\n      for (let i = 0; i < len; ++i) {\n        const item = segList.getItem(i);\n        if (item.pathSegType === 2) {\n          lastM = item;\n        }\n\n        if (item.pathSegType === 1) {\n          const prev = segList.getItem(i - 1);\n          if (prev.x !== lastM.x || prev.y !== lastM.y) {\n            // Add an L segment here\n            const newseg = elem.createSVGPathSegLinetoAbs(lastM.x, lastM.y);\n            insertItemBefore(elem, newseg, i);\n            // Can this be done better?\n            pathActions.fixEnd(elem);\n            break;\n          }\n        }\n      }\n      if (isWebkit()) { editorContext_.resetD(elem); }\n    },\n    // Convert a path to one with only absolute or relative values\n    convertPath\n  };\n})();\n// end pathActions\n","/* globals jQuery */\n/**\n * Package: svgedit.utilities\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Jeff Schiller\n */\n\nimport './pathseg.js';\nimport jqPluginSVG from './jquery-svg.js'; // Needed for SVG attribute setting and array form with `attr`\nimport {NS} from './svgedit.js';\nimport {getTransformList} from './svgtransformlist.js';\nimport {setUnitAttr, getTypeMap} from './units.js';\nimport {convertPath} from './path.js';\nimport {\n  hasMatrixTransform, transformListToTransform, transformBox\n} from './math.js';\nimport {\n  isWebkit, supportsHVLineContainerBBox, supportsPathBBox, supportsXpath,\n  supportsSelectors\n} from './browser.js';\n\n// Constants\nconst $ = jqPluginSVG(jQuery);\n\n// String used to encode base64.\nconst KEYSTR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n// Much faster than running getBBox() every time\nconst visElems = 'a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use';\nconst visElemsArr = visElems.split(',');\n// const hidElems = 'clipPath,defs,desc,feGaussianBlur,filter,linearGradient,marker,mask,metadata,pattern,radialGradient,stop,switch,symbol,title,textPath';\n\nlet editorContext_ = null;\nlet domdoc_ = null;\nlet domcontainer_ = null;\nlet svgroot_ = null;\n\nexport const init = function (editorContext) {\n  editorContext_ = editorContext;\n  domdoc_ = editorContext.getDOMDocument();\n  domcontainer_ = editorContext.getDOMContainer();\n  svgroot_ = editorContext.getSVGRoot();\n};\n\n/**\n* Converts characters in a string to XML-friendly entities.\n* @example: '&' becomes '&amp;'\n* @param str - The string to be converted\n* @returns {String} The converted string\n*/\nexport const toXml = function (str) {\n  // &apos; is ok in XML, but not HTML\n  // &gt; does not normally need escaping, though it can if within a CDATA expression (and preceded by \"]]\")\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/, '&#x27;');\n};\n\n/**\n* Converts XML entities in a string to single characters.\n* @example '&amp;amp;' becomes '&amp;'\n* @param str - The string to be converted\n* @returns The converted string\n*/\nexport const fromXml = function (str) {\n  return $('<p/>').html(str).text();\n};\n\n// This code was written by Tyler Akins and has been placed in the\n// public domain.  It would be nice if you left this header intact.\n// Base64 code from Tyler Akins -- http://rumkin.com\n\n// schiller: Removed string concatenation in favour of Array.join() optimization,\n//        also precalculate the size of the array needed.\n\n// Converts a string to base64\nexport const encode64 = function (input) {\n  // base64 strings are 4/3 larger than the original string\n  input = encodeUTF8(input); // convert non-ASCII characters\n  // input = convertToXMLReferences(input);\n  if (window.btoa) {\n    return window.btoa(input); // Use native if available\n  }\n  const output = [];\n  output.length = Math.floor((input.length + 2) / 3) * 4;\n\n  let i = 0, p = 0;\n  do {\n    const chr1 = input.charCodeAt(i++);\n    const chr2 = input.charCodeAt(i++);\n    const chr3 = input.charCodeAt(i++);\n\n    const enc1 = chr1 >> 2;\n    const enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n\n    let enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n    let enc4 = chr3 & 63;\n\n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64;\n    } else if (isNaN(chr3)) {\n      enc4 = 64;\n    }\n\n    output[p++] = KEYSTR.charAt(enc1);\n    output[p++] = KEYSTR.charAt(enc2);\n    output[p++] = KEYSTR.charAt(enc3);\n    output[p++] = KEYSTR.charAt(enc4);\n  } while (i < input.length);\n\n  return output.join('');\n};\n\n// Converts a string from base64\nexport const decode64 = function (input) {\n  if (window.atob) {\n    return decodeUTF8(window.atob(input));\n  }\n\n  // remove all characters that are not A-Z, a-z, 0-9, +, /, or =\n  input = input.replace(/[^A-Za-z0-9+/=]/g, '');\n\n  let output = '';\n  let i = 0;\n\n  do {\n    const enc1 = KEYSTR.indexOf(input.charAt(i++));\n    const enc2 = KEYSTR.indexOf(input.charAt(i++));\n    const enc3 = KEYSTR.indexOf(input.charAt(i++));\n    const enc4 = KEYSTR.indexOf(input.charAt(i++));\n\n    const chr1 = (enc1 << 2) | (enc2 >> 4);\n    const chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n    const chr3 = ((enc3 & 3) << 6) | enc4;\n\n    output += String.fromCharCode(chr1);\n\n    if (enc3 !== 64) {\n      output = output + String.fromCharCode(chr2);\n    }\n    if (enc4 !== 64) {\n      output = output + String.fromCharCode(chr3);\n    }\n  } while (i < input.length);\n  return decodeUTF8(output);\n};\n\nexport const decodeUTF8 = function (argString) {\n  return decodeURIComponent(escape(argString));\n};\n\n// codedread:does not seem to work with webkit-based browsers on OSX // Brettz9: please test again as function upgraded\nexport const encodeUTF8 = function (argString) {\n  return unescape(encodeURIComponent(argString));\n};\n\n/**\n * convert dataURL to object URL\n * @param {string} dataurl\n * @return {string} object URL or empty string\n */\nexport const dataURLToObjectURL = function (dataurl) {\n  if (typeof Uint8Array === 'undefined' || typeof Blob === 'undefined' || typeof URL === 'undefined' || !URL.createObjectURL) {\n    return '';\n  }\n  const arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n    bstr = atob(arr[1]);\n  let n = bstr.length;\n  const u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  const blob = new Blob([u8arr], {type: mime});\n  return URL.createObjectURL(blob);\n};\n\n/**\n * get object URL for a blob object\n * @param {Blob} blob A Blob object or File object\n * @return {string} object URL or empty string\n */\nexport const createObjectURL = function (blob) {\n  if (!blob || typeof URL === 'undefined' || !URL.createObjectURL) {\n    return '';\n  }\n  return URL.createObjectURL(blob);\n};\n\n/**\n * @property {string} blankPageObjectURL\n */\nexport const blankPageObjectURL = (function () {\n  if (typeof Blob === 'undefined') {\n    return '';\n  }\n  const blob = new Blob(['<html><head><title>SVG-edit</title></head><body>&nbsp;</body></html>'], {type: 'text/html'});\n  return createObjectURL(blob);\n})();\n\n// Converts a string to use XML references\nexport const convertToXMLReferences = function (input) {\n  let n,\n    output = '';\n  for (n = 0; n < input.length; n++) {\n    const c = input.charCodeAt(n);\n    if (c < 128) {\n      output += input[n];\n    } else if (c > 127) {\n      output += ('&#' + c + ';');\n    }\n  }\n  return output;\n};\n\n// Cross-browser compatible method of converting a string to an XML tree\n// found this function here: http://groups.google.com/group/jquery-dev/browse_thread/thread/c6d11387c580a77f\nexport const text2xml = function (sXML) {\n  if (sXML.includes('<svg:svg')) {\n    sXML = sXML.replace(/<(\\/?)svg:/g, '<$1').replace('xmlns:svg', 'xmlns');\n  }\n\n  let out, dXML;\n  try {\n    dXML = (window.DOMParser) ? new DOMParser() : new window.ActiveXObject('Microsoft.XMLDOM');\n    dXML.async = false;\n  } catch (e) {\n    throw new Error('XML Parser could not be instantiated');\n  }\n  try {\n    if (dXML.loadXML) {\n      out = (dXML.loadXML(sXML)) ? dXML : false;\n    } else {\n      out = dXML.parseFromString(sXML, 'text/xml');\n    }\n  } catch (e2) { throw new Error('Error parsing XML string'); }\n  return out;\n};\n\n/**\n* Converts a SVGRect into an object.\n* @param bbox - a SVGRect\n* @returns An object with properties names x, y, width, height.\n*/\nexport const bboxToObj = function (bbox) {\n  return {\n    x: bbox.x,\n    y: bbox.y,\n    width: bbox.width,\n    height: bbox.height\n  };\n};\n\n/**\n* Walks the tree and executes the callback on each element in a top-down fashion\n* @param elem - DOM element to traverse\n* @param {Function} cbFn - Callback function to run on each element\n*/\nexport const walkTree = function (elem, cbFn) {\n  if (elem && elem.nodeType === 1) {\n    cbFn(elem);\n    let i = elem.childNodes.length;\n    while (i--) {\n      walkTree(elem.childNodes.item(i), cbFn);\n    }\n  }\n};\n\n/**\n* Walks the tree and executes the callback on each element in a depth-first fashion\n* @todo FIXME: Shouldn't this be calling walkTreePost?\n* @param elem - DOM element to traverse\n* @param {Function} cbFn - Callback function to run on each element\n*/\nexport const walkTreePost = function (elem, cbFn) {\n  if (elem && elem.nodeType === 1) {\n    let i = elem.childNodes.length;\n    while (i--) {\n      walkTree(elem.childNodes.item(i), cbFn);\n    }\n    cbFn(elem);\n  }\n};\n\n/**\n* Extracts the URL from the url(...) syntax of some attributes.\n* Three variants:\n*  - <circle fill=\"url(someFile.svg#foo)\" />\n*  - <circle fill=\"url('someFile.svg#foo')\" />\n*  - <circle fill='url(\"someFile.svg#foo\")' />\n* @param attrVal - The attribute value as a string\n* @returns {String} String with just the URL, like \"someFile.svg#foo\"\n*/\nexport const getUrlFromAttr = function (attrVal) {\n  if (attrVal) {\n    // url('#somegrad')\n    if (attrVal.startsWith('url(\"')) {\n      return attrVal.substring(5, attrVal.indexOf('\"', 6));\n    }\n    // url('#somegrad')\n    if (attrVal.startsWith(\"url('\")) {\n      return attrVal.substring(5, attrVal.indexOf(\"'\", 6));\n    }\n    if (attrVal.startsWith('url(')) {\n      return attrVal.substring(4, attrVal.indexOf(')'));\n    }\n  }\n  return null;\n};\n\n/**\n* @returns The given element's xlink:href value\n*/\nexport let getHref = function (elem) {\n  return elem.getAttributeNS(NS.XLINK, 'href');\n};\n\n/**\n* Sets the given element's xlink:href value\n* @param elem\n* @param {String} val\n*/\nexport let setHref = function (elem, val) {\n  elem.setAttributeNS(NS.XLINK, 'xlink:href', val);\n};\n\n/**\n* @returns The document's &lt;defs> element, create it first if necessary\n*/\nexport const findDefs = function () {\n  const svgElement = editorContext_.getSVGContent();\n  let defs = svgElement.getElementsByTagNameNS(NS.SVG, 'defs');\n  if (defs.length > 0) {\n    defs = defs[0];\n  } else {\n    defs = svgElement.ownerDocument.createElementNS(NS.SVG, 'defs');\n    if (svgElement.firstChild) {\n      // first child is a comment, so call nextSibling\n      svgElement.insertBefore(defs, svgElement.firstChild.nextSibling);\n      // svgElement.firstChild.nextSibling.before(defs); // Not safe\n    } else {\n      svgElement.append(defs);\n    }\n  }\n  return defs;\n};\n\n// TODO(codedread): Consider moving the next to functions to bbox.js\n\n/**\n* Get correct BBox for a path in Webkit\n* Converted from code found here:\n* http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\n* @param path - The path DOM element to get the BBox for\n* @returns A BBox-like object\n*/\nexport const getPathBBox = function (path) {\n  const seglist = path.pathSegList;\n  const tot = seglist.numberOfItems;\n\n  const bounds = [[], []];\n  const start = seglist.getItem(0);\n  let P0 = [start.x, start.y];\n\n  for (let i = 0; i < tot; i++) {\n    const seg = seglist.getItem(i);\n\n    if (seg.x === undefined) { continue; }\n\n    // Add actual points to limits\n    bounds[0].push(P0[0]);\n    bounds[1].push(P0[1]);\n\n    if (seg.x1) {\n      const P1 = [seg.x1, seg.y1],\n        P2 = [seg.x2, seg.y2],\n        P3 = [seg.x, seg.y];\n\n      for (let j = 0; j < 2; j++) {\n        const calc = function (t) {\n          return Math.pow(1 - t, 3) * P0[j] +\n            3 * Math.pow(1 - t, 2) * t * P1[j] +\n            3 * (1 - t) * Math.pow(t, 2) * P2[j] +\n            Math.pow(t, 3) * P3[j];\n        };\n\n        const b = 6 * P0[j] - 12 * P1[j] + 6 * P2[j];\n        const a = -3 * P0[j] + 9 * P1[j] - 9 * P2[j] + 3 * P3[j];\n        const c = 3 * P1[j] - 3 * P0[j];\n\n        if (a === 0) {\n          if (b === 0) {\n            continue;\n          }\n          const t = -c / b;\n          if (t > 0 && t < 1) {\n            bounds[j].push(calc(t));\n          }\n          continue;\n        }\n        const b2ac = Math.pow(b, 2) - 4 * c * a;\n        if (b2ac < 0) { continue; }\n        const t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\n        if (t1 > 0 && t1 < 1) { bounds[j].push(calc(t1)); }\n        const t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\n        if (t2 > 0 && t2 < 1) { bounds[j].push(calc(t2)); }\n      }\n      P0 = P3;\n    } else {\n      bounds[0].push(seg.x);\n      bounds[1].push(seg.y);\n    }\n  }\n\n  const x = Math.min.apply(null, bounds[0]);\n  const w = Math.max.apply(null, bounds[0]) - x;\n  const y = Math.min.apply(null, bounds[1]);\n  const h = Math.max.apply(null, bounds[1]) - y;\n  return {\n    x,\n    y,\n    width: w,\n    height: h\n  };\n};\n\n/**\n* Get the given/selected element's bounding box object, checking for\n* horizontal/vertical lines (see issue 717)\n* Note that performance is currently terrible, so some way to improve would\n* be great.\n* @param selected - Container or &lt;use> DOM element\n* @returns Bounding box object\n*/\nfunction groupBBFix (selected) {\n  if (supportsHVLineContainerBBox()) {\n    try { return selected.getBBox(); } catch (e) {}\n  }\n  const ref = $.data(selected, 'ref');\n  let matched = null;\n  let ret, copy;\n\n  if (ref) {\n    copy = $(ref).children().clone().attr('visibility', 'hidden');\n    $(svgroot_).append(copy);\n    matched = copy.filter('line, path');\n  } else {\n    matched = $(selected).find('line, path');\n  }\n\n  let issue = false;\n  if (matched.length) {\n    matched.each(function () {\n      const bb = this.getBBox();\n      if (!bb.width || !bb.height) {\n        issue = true;\n      }\n    });\n    if (issue) {\n      const elems = ref ? copy : $(selected).children();\n      ret = getStrokedBBox(elems); // getStrokedBBox defined in svgcanvas\n    } else {\n      ret = selected.getBBox();\n    }\n  } else {\n    ret = selected.getBBox();\n  }\n  if (ref) {\n    copy.remove();\n  }\n  return ret;\n}\n\n/**\n* Get the given/selected element's bounding box object, convert it to be more\n* usable when necessary\n* @param elem - Optional DOM element to get the BBox for\n* @returns Bounding box object\n*/\nexport const getBBox = function (elem) {\n  const selected = elem || editorContext_.geSelectedElements()[0];\n  if (elem.nodeType !== 1) { return null; }\n  const elname = selected.nodeName;\n\n  let ret = null;\n  switch (elname) {\n  case 'text':\n    if (selected.textContent === '') {\n      selected.textContent = 'a'; // Some character needed for the selector to use.\n      ret = selected.getBBox();\n      selected.textContent = '';\n    } else {\n      if (selected.getBBox) { ret = selected.getBBox(); }\n    }\n    break;\n  case 'path':\n    if (!supportsPathBBox()) {\n      ret = getPathBBox(selected);\n    } else {\n      if (selected.getBBox) { ret = selected.getBBox(); }\n    }\n    break;\n  case 'g':\n  case 'a':\n    ret = groupBBFix(selected);\n    break;\n  default:\n\n    if (elname === 'use') {\n      ret = groupBBFix(selected, true);\n    }\n    if (elname === 'use' || (elname === 'foreignObject' && isWebkit())) {\n      if (!ret) { ret = selected.getBBox(); }\n      // This is resolved in later versions of webkit, perhaps we should\n      // have a featured detection for correct 'use' behavior?\n      // ——————————\n      if (!isWebkit()) {\n        const bb = {};\n        bb.width = ret.width;\n        bb.height = ret.height;\n        bb.x = ret.x + parseFloat(selected.getAttribute('x') || 0);\n        bb.y = ret.y + parseFloat(selected.getAttribute('y') || 0);\n        ret = bb;\n      }\n    } else if (visElemsArr.includes(elname)) {\n      if (selected) {\n        try {\n          ret = selected.getBBox();\n        } catch (err) {\n          // tspan (and textPath apparently) have no `getBBox` in Firefox: https://bugzilla.mozilla.org/show_bug.cgi?id=937268\n          // Re: Chrome returning bbox for containing text element, see: https://bugs.chromium.org/p/chromium/issues/detail?id=349835\n          const extent = selected.getExtentOfChar(0); // pos+dimensions of the first glyph\n          const width = selected.getComputedTextLength(); // width of the tspan\n          ret = {\n            x: extent.x,\n            y: extent.y,\n            width,\n            height: extent.height\n          };\n        }\n      } else {\n        // Check if element is child of a foreignObject\n        const fo = $(selected).closest('foreignObject');\n        if (fo.length) {\n          if (fo[0].getBBox) {\n            ret = fo[0].getBBox();\n          }\n        }\n      }\n    }\n  }\n  if (ret) {\n    ret = bboxToObj(ret);\n  }\n\n  // get the bounding box from the DOM (which is in that element's coordinate system)\n  return ret;\n};\n\n/**\n* Create a path 'd' attribute from path segments.\n* Each segment is an array of the form: [singleChar, [x,y, x,y, ...]]\n* @param pathSegments - An array of path segments to be converted\n* @returns The converted path d attribute.\n*/\nexport const getPathDFromSegments = function (pathSegments) {\n  let d = '';\n\n  $.each(pathSegments, function (j, seg) {\n    const pts = seg[1];\n    d += seg[0];\n    for (let i = 0; i < pts.length; i += 2) {\n      d += (pts[i] + ',' + pts[i + 1]) + ' ';\n    }\n  });\n\n  return d;\n};\n\n/**\n* Make a path 'd' attribute from a simple SVG element shape.\n* @param elem - The element to be converted\n* @returns The path d attribute or `undefined` if the element type is unknown.\n*/\nexport const getPathDFromElement = function (elem) {\n  // Possibly the cubed root of 6, but 1.81 works best\n  let num = 1.81;\n  let d, a, rx, ry;\n  switch (elem.tagName) {\n  case 'ellipse':\n  case 'circle':\n    a = $(elem).attr(['rx', 'ry', 'cx', 'cy']);\n    const {cx, cy} = a;\n    ({rx, ry} = a);\n    if (elem.tagName === 'circle') {\n      rx = ry = $(elem).attr('r');\n    }\n\n    d = getPathDFromSegments([\n      ['M', [(cx - rx), (cy)]],\n      ['C', [(cx - rx), (cy - ry / num), (cx - rx / num), (cy - ry), (cx), (cy - ry)]],\n      ['C', [(cx + rx / num), (cy - ry), (cx + rx), (cy - ry / num), (cx + rx), (cy)]],\n      ['C', [(cx + rx), (cy + ry / num), (cx + rx / num), (cy + ry), (cx), (cy + ry)]],\n      ['C', [(cx - rx / num), (cy + ry), (cx - rx), (cy + ry / num), (cx - rx), (cy)]],\n      ['Z', []]\n    ]);\n    break;\n  case 'path':\n    d = elem.getAttribute('d');\n    break;\n  case 'line':\n    a = $(elem).attr(['x1', 'y1', 'x2', 'y2']);\n    d = 'M' + a.x1 + ',' + a.y1 + 'L' + a.x2 + ',' + a.y2;\n    break;\n  case 'polyline':\n    d = 'M' + elem.getAttribute('points');\n    break;\n  case 'polygon':\n    d = 'M' + elem.getAttribute('points') + ' Z';\n    break;\n  case 'rect':\n    const r = $(elem).attr(['rx', 'ry']);\n    ({rx, ry} = r);\n    const b = elem.getBBox();\n    const {x, y} = b, w = b.width, h = b.height;\n    num = 4 - num; // Why? Because!\n\n    if (!rx && !ry) {\n      // Regular rect\n      d = getPathDFromSegments([\n        ['M', [x, y]],\n        ['L', [x + w, y]],\n        ['L', [x + w, y + h]],\n        ['L', [x, y + h]],\n        ['L', [x, y]],\n        ['Z', []]\n      ]);\n    } else {\n      d = getPathDFromSegments([\n        ['M', [x, y + ry]],\n        ['C', [x, y + ry / num, x + rx / num, y, x + rx, y]],\n        ['L', [x + w - rx, y]],\n        ['C', [x + w - rx / num, y, x + w, y + ry / num, x + w, y + ry]],\n        ['L', [x + w, y + h - ry]],\n        ['C', [x + w, y + h - ry / num, x + w - rx / num, y + h, x + w - rx, y + h]],\n        ['L', [x + rx, y + h]],\n        ['C', [x + rx / num, y + h, x, y + h - ry / num, x, y + h - ry]],\n        ['L', [x, y + ry]],\n        ['Z', []]\n      ]);\n    }\n    break;\n  default:\n    break;\n  }\n\n  return d;\n};\n\n/**\n* Get a set of attributes from an element that is useful for convertToPath.\n* @param elem - The element to be probed\n* @returns {Object} An object with attributes.\n*/\nexport const getExtraAttributesForConvertToPath = function (elem) {\n  const attrs = {};\n  // TODO: make this list global so that we can properly maintain it\n  // TODO: what about @transform, @clip-rule, @fill-rule, etc?\n  $.each(['marker-start', 'marker-end', 'marker-mid', 'filter', 'clip-path'], function () {\n    const a = elem.getAttribute(this);\n    if (a) {\n      attrs[this] = a;\n    }\n  });\n  return attrs;\n};\n\n/**\n* Get the BBox of an element-as-path\n* @param elem - The DOM element to be probed\n* @param addSvgElementFromJson - Function to add the path element to the current layer. See canvas.addSvgElementFromJson\n* @param pathActions - If a transform exists, `pathActions.resetOrientation()` is used. See: canvas.pathActions.\n* @returns The resulting path's bounding box object.\n*/\nexport const getBBoxOfElementAsPath = function (elem, addSvgElementFromJson, pathActions) {\n  const path = addSvgElementFromJson({\n    element: 'path',\n    attr: getExtraAttributesForConvertToPath(elem)\n  });\n\n  const eltrans = elem.getAttribute('transform');\n  if (eltrans) {\n    path.setAttribute('transform', eltrans);\n  }\n\n  const parent = elem.parentNode;\n  if (elem.nextSibling) {\n    elem.before(path);\n  } else {\n    parent.append(path);\n  }\n\n  const d = getPathDFromElement(elem);\n  if (d) {\n    path.setAttribute('d', d);\n  } else {\n    path.remove();\n  }\n\n  // Get the correct BBox of the new path, then discard it\n  pathActions.resetOrientation(path);\n  let bb = false;\n  try {\n    bb = path.getBBox();\n  } catch (e) {\n    // Firefox fails\n  }\n  path.remove();\n  return bb;\n};\n\n/**\n* Convert selected element to a path.\n* @param elem - The DOM element to be converted\n* @param attrs - Apply attributes to new path. see canvas.convertToPath\n* @param addSvgElementFromJson - Function to add the path element to the current layer. See canvas.addSvgElementFromJson\n* @param pathActions - If a transform exists, pathActions.resetOrientation() is used. See: canvas.pathActions.\n* @param clearSelection - see canvas.clearSelection\n* @param addToSelection - see canvas.addToSelection\n* @param history - see svgedit.history\n* @param addCommandToHistory - see canvas.addCommandToHistory\n* @returns The converted path element or null if the DOM element was not recognized.\n*/\nexport const convertToPath = function (elem, attrs, addSvgElementFromJson, pathActions, clearSelection, addToSelection, history, addCommandToHistory) {\n  const batchCmd = new history.BatchCommand('Convert element to Path');\n\n  // Any attribute on the element not covered by the passed-in attributes\n  attrs = $.extend({}, attrs, getExtraAttributesForConvertToPath(elem));\n\n  const path = addSvgElementFromJson({\n    element: 'path',\n    attr: attrs\n  });\n\n  const eltrans = elem.getAttribute('transform');\n  if (eltrans) {\n    path.setAttribute('transform', eltrans);\n  }\n\n  const {id} = elem;\n  const parent = elem.parentNode;\n  if (elem.nextSibling) {\n    elem.before(path);\n  } else {\n    parent.append(path);\n  }\n\n  const d = getPathDFromElement(elem);\n  if (d) {\n    path.setAttribute('d', d);\n\n    // Replace the current element with the converted one\n\n    // Reorient if it has a matrix\n    if (eltrans) {\n      const tlist = getTransformList(path);\n      if (hasMatrixTransform(tlist)) {\n        pathActions.resetOrientation(path);\n      }\n    }\n\n    const {nextSibling} = elem;\n    batchCmd.addSubCommand(new history.RemoveElementCommand(elem, nextSibling, parent));\n    batchCmd.addSubCommand(new history.InsertElementCommand(path));\n\n    clearSelection();\n    elem.remove();\n    path.setAttribute('id', id);\n    path.removeAttribute('visibility');\n    addToSelection([path], true);\n\n    addCommandToHistory(batchCmd);\n\n    return path;\n  } else {\n    // the elem.tagName was not recognized, so no \"d\" attribute. Remove it, so we've haven't changed anything.\n    path.remove();\n    return null;\n  }\n};\n\n/**\n* Can the bbox be optimized over the native getBBox? The optimized bbox is the same as the native getBBox when\n* the rotation angle is a multiple of 90 degrees and there are no complex transforms.\n* Getting an optimized bbox can be dramatically slower, so we want to make sure it's worth it.\n*\n* The best example for this is a circle rotate 45 degrees. The circle doesn't get wider or taller when rotated\n* about it's center.\n*\n* The standard, unoptimized technique gets the native bbox of the circle, rotates the box 45 degrees, uses\n* that width and height, and applies any transforms to get the final bbox. This means the calculated bbox\n* is much wider than the original circle. If the angle had been 0, 90, 180, etc. both techniques render the\n* same bbox.\n*\n* The optimization is not needed if the rotation is a multiple 90 degrees. The default technique is to call\n* getBBox then apply the angle and any transforms.\n*\n* @param angle - The rotation angle in degrees\n* @param {Boolean} hasMatrixTransform - True if there is a matrix transform\n* @returns {Boolean} True if the bbox can be optimized.\n*/\nfunction bBoxCanBeOptimizedOverNativeGetBBox (angle, hasMatrixTransform) {\n  const angleModulo90 = angle % 90;\n  const closeTo90 = angleModulo90 < -89.99 || angleModulo90 > 89.99;\n  const closeTo0 = angleModulo90 > -0.001 && angleModulo90 < 0.001;\n  return hasMatrixTransform || !(closeTo0 || closeTo90);\n}\n\n/**\n* Get bounding box that includes any transforms.\n* @param elem - The DOM element to be converted\n* @param  addSvgElementFromJson - Function to add the path element to the current layer. See canvas.addSvgElementFromJson\n* @param  pathActions - If a transform exists, pathActions.resetOrientation() is used. See: canvas.pathActions.\n* @returns A single bounding box object\n*/\nexport const getBBoxWithTransform = function (elem, addSvgElementFromJson, pathActions) {\n  // TODO: Fix issue with rotated groups. Currently they work\n  // fine in FF, but not in other browsers (same problem mentioned\n  // in Issue 339 comment #2).\n\n  let bb = getBBox(elem);\n\n  if (!bb) {\n    return null;\n  }\n\n  const tlist = getTransformList(elem);\n  const angle = getRotationAngleFromTransformList(tlist);\n  const hasMatrixXForm = hasMatrixTransform(tlist);\n\n  if (angle || hasMatrixXForm) {\n    let goodBb = false;\n    if (bBoxCanBeOptimizedOverNativeGetBBox(angle, hasMatrixXForm)) {\n      // Get the BBox from the raw path for these elements\n      // TODO: why ellipse and not circle\n      const elemNames = ['ellipse', 'path', 'line', 'polyline', 'polygon'];\n      if (elemNames.includes(elem.tagName)) {\n        bb = goodBb = getBBoxOfElementAsPath(elem, addSvgElementFromJson, pathActions);\n      } else if (elem.tagName === 'rect') {\n        // Look for radius\n        const rx = elem.getAttribute('rx');\n        const ry = elem.getAttribute('ry');\n        if (rx || ry) {\n          bb = goodBb = getBBoxOfElementAsPath(elem, addSvgElementFromJson, pathActions);\n        }\n      }\n    }\n\n    if (!goodBb) {\n      const {matrix} = transformListToTransform(tlist);\n      bb = transformBox(bb.x, bb.y, bb.width, bb.height, matrix).aabox;\n\n      // Old technique that was exceedingly slow with large documents.\n      //\n      // Accurate way to get BBox of rotated element in Firefox:\n      // Put element in group and get its BBox\n      //\n      // Must use clone else FF freaks out\n      // const clone = elem.cloneNode(true);\n      // const g = document.createElementNS(NS.SVG, 'g');\n      // const parent = elem.parentNode;\n      // parent.append(g);\n      // g.append(clone);\n      // const bb2 = bboxToObj(g.getBBox());\n      // g.remove();\n    }\n  }\n  return bb;\n};\n\n// TODO: This is problematic with large stroke-width and, for example, a single horizontal line. The calculated BBox extends way beyond left and right sides.\nfunction getStrokeOffsetForBBox (elem) {\n  const sw = elem.getAttribute('stroke-width');\n  return (!isNaN(sw) && elem.getAttribute('stroke') !== 'none') ? sw / 2 : 0;\n}\n\n/**\n* Get the bounding box for one or more stroked and/or transformed elements\n* @param elems - Array with DOM elements to check\n* @param addSvgElementFromJson - Function to add the path element to the current layer. See canvas.addSvgElementFromJson\n* @param pathActions - If a transform exists, pathActions.resetOrientation() is used. See: canvas.pathActions.\n* @returns A single bounding box object\n*/\nexport const getStrokedBBox = function (elems, addSvgElementFromJson, pathActions) {\n  if (!elems || !elems.length) { return false; }\n\n  let fullBb;\n  $.each(elems, function () {\n    if (fullBb) { return; }\n    if (!this.parentNode) { return; }\n    fullBb = getBBoxWithTransform(this, addSvgElementFromJson, pathActions);\n  });\n\n  // This shouldn't ever happen...\n  if (fullBb === undefined) { return null; }\n\n  // fullBb doesn't include the stoke, so this does no good!\n  // if (elems.length == 1) return fullBb;\n\n  let maxX = fullBb.x + fullBb.width;\n  let maxY = fullBb.y + fullBb.height;\n  let minX = fullBb.x;\n  let minY = fullBb.y;\n\n  // If only one elem, don't call the potentially slow getBBoxWithTransform method again.\n  if (elems.length === 1) {\n    const offset = getStrokeOffsetForBBox(elems[0]);\n    minX -= offset;\n    minY -= offset;\n    maxX += offset;\n    maxY += offset;\n  } else {\n    $.each(elems, function (i, elem) {\n      const curBb = getBBoxWithTransform(elem, addSvgElementFromJson, pathActions);\n      if (curBb) {\n        const offset = getStrokeOffsetForBBox(elem);\n        minX = Math.min(minX, curBb.x - offset);\n        minY = Math.min(minY, curBb.y - offset);\n        // TODO: The old code had this test for max, but not min. I suspect this test should be for both min and max\n        if (elem.nodeType === 1) {\n          maxX = Math.max(maxX, curBb.x + curBb.width + offset);\n          maxY = Math.max(maxY, curBb.y + curBb.height + offset);\n        }\n      }\n    });\n  }\n\n  fullBb.x = minX;\n  fullBb.y = minY;\n  fullBb.width = maxX - minX;\n  fullBb.height = maxY - minY;\n  return fullBb;\n};\n\n/**\n* Get all elements that have a BBox (excludes `&lt;defs>`, `&lt;title>`, etc).\n* Note that 0-opacity, off-screen etc elements are still considered \"visible\"\n* for this function\n* @param parent - The parent DOM element to search within\n* @returns {Array} All \"visible\" elements.\n*/\nexport const getVisibleElements = function (parent) {\n  if (!parent) {\n    parent = $(editorContext_.getSVGContent()).children(); // Prevent layers from being included\n  }\n\n  const contentElems = [];\n  $(parent).children().each(function (i, elem) {\n    if (elem.getBBox) {\n      contentElems.push(elem);\n    }\n  });\n  return contentElems.reverse();\n};\n\n/**\n* Get the bounding box for one or more stroked and/or transformed elements\n* @param elems - Array with DOM elements to check\n* @returns A single bounding box object\n*/\nexport const getStrokedBBoxDefaultVisible = function (elems) {\n  if (!elems) { elems = getVisibleElements(); }\n  return getStrokedBBox(\n    elems,\n    editorContext_.addSvgElementFromJson,\n    editorContext_.pathActions\n  );\n};\n\n/**\n* Get the rotation angle of the given transform list.\n* @param tlist - List of transforms\n* @param {Boolean} toRad - When true returns the value in radians rather than degrees\n* @returns {Number} Float with the angle in degrees or radians\n*/\nexport const getRotationAngleFromTransformList = function (tlist, toRad) {\n  if (!tlist) { return 0; } // <svg> elements have no tlist\n  const N = tlist.numberOfItems;\n  for (let i = 0; i < N; ++i) {\n    const xform = tlist.getItem(i);\n    if (xform.type === 4) {\n      return toRad ? xform.angle * Math.PI / 180.0 : xform.angle;\n    }\n  }\n  return 0.0;\n};\n\n/**\n* Get the rotation angle of the given/selected DOM element\n* @param elem - Optional DOM element to get the angle for\n* @param {Boolean} toRad - When true returns the value in radians rather than degrees\n* @returns {Number} Float with the angle in degrees or radians\n*/\nexport let getRotationAngle = function (elem, toRad) {\n  const selected = elem || editorContext_.getSelectedElements()[0];\n  // find the rotation transform (if any) and set it\n  const tlist = getTransformList(selected);\n  return getRotationAngleFromTransformList(tlist, toRad);\n};\n\n/**\n* Get the reference element associated with the given attribute value\n* @param {String} attrVal - The attribute value as a string\n* @returns Reference element\n*/\nexport const getRefElem = function (attrVal) {\n  return getElem(getUrlFromAttr(attrVal).substr(1));\n};\n\n/**\n* Get a DOM element by ID within the SVG root element.\n* @param {String} id - String with the element's new ID\n*/\nexport const getElem = (supportsSelectors())\n  ? function (id) {\n    // querySelector lookup\n    return svgroot_.querySelector('#' + id);\n  } : supportsXpath()\n    ? function (id) {\n      // xpath lookup\n      return domdoc_.evaluate(\n        'svg:svg[@id=\"svgroot\"]//svg:*[@id=\"' + id + '\"]',\n        domcontainer_,\n        function () { return NS.SVG; },\n        9,\n        null).singleNodeValue;\n    }\n    : function (id) {\n      // jQuery lookup: twice as slow as xpath in FF\n      return $(svgroot_).find('[id=' + id + ']')[0];\n    };\n\n/**\n* Assigns multiple attributes to an element.\n* @param node - DOM element to apply new attribute values to\n* @param {Object} attrs - Object with attribute keys/values\n* @param {Number} suspendLength - Optional integer of milliseconds to suspend redraw\n* @param {Boolean} unitCheck - Boolean to indicate the need to use svgedit.units.setUnitAttr\n*/\nexport const assignAttributes = function (node, attrs, suspendLength, unitCheck) {\n  for (const i in attrs) {\n    const ns = (i.substr(0, 4) === 'xml:'\n      ? NS.XML\n      : i.substr(0, 6) === 'xlink:' ? NS.XLINK : null);\n\n    if (ns) {\n      node.setAttributeNS(ns, i, attrs[i]);\n    } else if (!unitCheck) {\n      node.setAttribute(i, attrs[i]);\n    } else {\n      setUnitAttr(node, i, attrs[i]);\n    }\n  }\n};\n\n/**\n* Remove unneeded (default) attributes, makes resulting SVG smaller\n* @param element - DOM element to clean up\n*/\nexport const cleanupElement = function (element) {\n  const defaults = {\n    'fill-opacity': 1,\n    'stop-opacity': 1,\n    opacity: 1,\n    stroke: 'none',\n    'stroke-dasharray': 'none',\n    'stroke-linejoin': 'miter',\n    'stroke-linecap': 'butt',\n    'stroke-opacity': 1,\n    'stroke-width': 1,\n    rx: 0,\n    ry: 0\n  };\n\n  if (element.nodeName === 'ellipse') {\n    // Ellipse elements requires rx and ry attributes\n    delete defaults.rx;\n    delete defaults.ry;\n  }\n\n  for (const attr in defaults) {\n    const val = defaults[attr];\n    if (element.getAttribute(attr) === String(val)) {\n      element.removeAttribute(attr);\n    }\n  }\n};\n\n// round value to for snapping\nexport const snapToGrid = function (value) {\n  const unit = editorContext_.getBaseUnit();\n  let stepSize = editorContext_.getSnappingStep();\n  if (unit !== 'px') {\n    stepSize *= getTypeMap()[unit];\n  }\n  value = Math.round(value / stepSize) * stepSize;\n  return value;\n};\n\nexport const regexEscape = function (str, delimiter) {\n  // From: http://phpjs.org/functions\n  return String(str).replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\' + (delimiter || '') + '-]', 'g'), '\\\\$&');\n};\n\n/**\n * Prevents default browser click behaviour on the given element\n * @param img - The DOM element to prevent the click on\n */\nexport const preventClickDefault = function (img) {\n  $(img).click(function (e) { e.preventDefault(); });\n};\n\n/**\n * Create a clone of an element, updating its ID and its children's IDs when needed\n * @param {Element} el - DOM element to clone\n * @param {Function} getNextId - The getter of the next unique ID.\n * @returns {Element}\n */\nexport const copyElem = function (el, getNextId) {\n  // manually create a copy of the element\n  const newEl = document.createElementNS(el.namespaceURI, el.nodeName);\n  $.each(el.attributes, function (i, attr) {\n    if (attr.localName !== '-moz-math-font-style') {\n      newEl.setAttributeNS(attr.namespaceURI, attr.nodeName, attr.value);\n    }\n  });\n  // set the copied element's new id\n  newEl.removeAttribute('id');\n  newEl.id = getNextId();\n\n  // Opera's \"d\" value needs to be reset for Opera/Win/non-EN\n  // Also needed for webkit (else does not keep curved segments on clone)\n  if (isWebkit() && el.nodeName === 'path') {\n    const fixedD = convertPath(el);\n    newEl.setAttribute('d', fixedD);\n  }\n\n  // now create copies of all children\n  $.each(el.childNodes, function (i, child) {\n    switch (child.nodeType) {\n    case 1: // element node\n      newEl.append(copyElem(child, getNextId));\n      break;\n    case 3: // text node\n      newEl.textContent = child.nodeValue;\n      break;\n    default:\n      break;\n    }\n  });\n\n  if ($(el).data('gsvg')) {\n    $(newEl).data('gsvg', newEl.firstChild);\n  } else if ($(el).data('symbol')) {\n    const ref = $(el).data('symbol');\n    $(newEl).data('ref', ref).data('symbol', ref);\n  } else if (newEl.tagName === 'image') {\n    preventClickDefault(newEl);\n  }\n\n  return newEl;\n};\n\n// Unit testing\nexport const mock = ({\n  getHref: getHrefUser, setHref: setHrefUser, getRotationAngle: getRotationAngleUser\n}) => {\n  getHref = getHrefUser;\n  setHref = setHrefUser;\n  getRotationAngle = getRotationAngleUser;\n};\n","/* globals jQuery */\n/**\n * Package: svgedit.contextmenu\n *\n * Licensed under the Apache License, Version 2\n *\n * Author: Adam Bender\n */\n// Dependencies:\n// 1) jQuery (for dom injection of context menus)\n\nconst $ = jQuery;\n\nlet contextMenuExtensions = {};\n\nconst menuItemIsValid = function (menuItem) {\n  return menuItem && menuItem.id && menuItem.label && menuItem.action && typeof menuItem.action === 'function';\n};\nexport const add = function (menuItem) {\n  // menuItem: {id, label, shortcut, action}\n  if (!menuItemIsValid(menuItem)) {\n    console.error('Menu items must be defined and have at least properties: id, label, action, where action must be a function');\n    return;\n  }\n  if (menuItem.id in contextMenuExtensions) {\n    console.error('Cannot add extension \"' + menuItem.id + '\", an extension by that name already exists\"');\n    return;\n  }\n  // Register menuItem action, see below for deferred menu dom injection\n  console.log('Registed contextmenu item: {id:' + menuItem.id + ', label:' + menuItem.label + '}');\n  contextMenuExtensions[menuItem.id] = menuItem;\n  // TODO: Need to consider how to handle custom enable/disable behavior\n};\nexport const hasCustomHandler = function (handlerKey) {\n  return Boolean(contextMenuExtensions[handlerKey]);\n};\nexport const getCustomHandler = function (handlerKey) {\n  return contextMenuExtensions[handlerKey].action;\n};\nconst injectExtendedContextMenuItemIntoDom = function (menuItem) {\n  if (!Object.keys(contextMenuExtensions).length) {\n    // all menuItems appear at the bottom of the menu in their own container.\n    // if this is the first extension menu we need to add the separator.\n    $('#cmenu_canvas').append(\"<li class='separator'>\");\n  }\n  const shortcut = menuItem.shortcut || '';\n  $('#cmenu_canvas').append(\"<li class='disabled'><a href='#\" + menuItem.id + \"'>\" +\n    menuItem.label + \"<span class='shortcut'>\" +\n    shortcut + '</span></a></li>');\n};\n\nexport const injectExtendedContextMenuItemsIntoDom = function () {\n  for (const menuItem in contextMenuExtensions) {\n    injectExtendedContextMenuItemIntoDom(contextMenuExtensions[menuItem]);\n  }\n};\nexport const resetCustomMenus = function () { contextMenuExtensions = {}; };\n","// MIT License\n// From: https://github.com/uupaa/dynamic-import-polyfill/blob/master/importModule.js\n\nfunction toAbsoluteURL (url) {\n  const a = document.createElement('a');\n  a.setAttribute('href', url); // <a href=\"hoge.html\">\n  return a.cloneNode(false).href; // -> \"http://example.com/hoge.html\"\n}\n\nfunction addScriptAtts (script, atts) {\n  ['id', 'class', 'type'].forEach((prop) => {\n    if (prop in atts) {\n      script[prop] = atts[prop];\n    }\n  });\n}\n\n// Additions by Brett\nexport async function importSetGlobalDefault (url, config) {\n  return importSetGlobal(url, {...config, returnDefault: true});\n}\nexport async function importSetGlobal (url, {global, returnDefault}) {\n  // Todo: Replace calls to this function with `import()` when supported\n  const modularVersion = !('svgEditor' in window) ||\n    !window.svgEditor ||\n    window.svgEditor.modules !== false;\n  if (modularVersion) {\n    return importModule(url, undefined, {returnDefault});\n  }\n  await importScript(url);\n  return window[global];\n}\n// Addition by Brett\nexport function importScript (url, atts = {}) {\n  if (Array.isArray(url)) {\n    return Promise.all(url.map((u) => {\n      return importScript(u, atts);\n    }));\n  }\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    const destructor = () => {\n      script.onerror = null;\n      script.onload = null;\n      script.remove();\n      script.src = '';\n    };\n    script.defer = 'defer';\n    addScriptAtts(script, atts);\n    script.onerror = () => {\n      reject(new Error(`Failed to import: ${url}`));\n      destructor();\n    };\n    script.onload = () => {\n      resolve();\n      destructor();\n    };\n    script.src = url;\n\n    document.head.append(script);\n  });\n}\n\nexport function importModule (url, atts = {}, {returnDefault = false} = {}) {\n  if (Array.isArray(url)) {\n    return Promise.all(url.map((u) => {\n      return importModule(u, atts);\n    }));\n  }\n  return new Promise((resolve, reject) => {\n    const vector = '$importModule$' + Math.random().toString(32).slice(2);\n    const script = document.createElement('script');\n    const destructor = () => {\n      delete window[vector];\n      script.onerror = null;\n      script.onload = null;\n      script.remove();\n      URL.revokeObjectURL(script.src);\n      script.src = '';\n    };\n    addScriptAtts(script, atts);\n    script.defer = 'defer';\n    script.type = 'module';\n    script.onerror = () => {\n      reject(new Error(`Failed to import: ${url}`));\n      destructor();\n    };\n    script.onload = () => {\n      resolve(window[vector]);\n      destructor();\n    };\n    const absURL = toAbsoluteURL(url);\n    const loader = `import * as m from '${absURL.replace(/'/g, \"\\\\'\")}'; window.${vector} = ${returnDefault ? 'm.default || ' : ''}m;`; // export Module\n    const blob = new Blob([loader], { type: 'text/javascript' });\n    script.src = URL.createObjectURL(blob);\n\n    document.head.append(script);\n  });\n}\n\nexport default importModule;\n","/* globals jQuery */\n/**\n * Licensed under the MIT License\n *\n * Copyright(c) 2011 Jeff Schiller\n * Copyright(c) 2016 Flint O'Brien\n */\n\nimport {NS} from './svgedit.js';\nimport {toXml, walkTree} from './svgutils.js';\n\nconst $ = jQuery;\n\n/**\n * This class encapsulates the concept of a layer in the drawing. It can be constructed with\n * an existing group element or, with three parameters, will create a new layer group element.\n *\n * Usage:\n * new Layer'name', group)          // Use the existing group for this layer.\n * new Layer('name', group, svgElem) // Create a new group and add it to the DOM after group.\n * new Layer('name', null, svgElem)  // Create a new group and add it to the DOM as the last layer.\n *\n * @param {string} name - Layer name\n * @param {SVGGElement|null} group - An existing SVG group element or null.\n *     If group and no svgElem, use group for this layer.\n *     If group and svgElem, create a new group element and insert it in the DOM after group.\n *     If no group and svgElem, create a new group element and insert it in the DOM as the last layer.\n * @param {SVGGElement=} svgElem - The SVG DOM element. If defined, use this to add\n *     a new layer to the document.\n */\nclass Layer {\n  constructor (name, group, svgElem) {\n    this.name_ = name;\n    this.group_ = svgElem ? null : group;\n\n    if (svgElem) {\n      // Create a group element with title and add it to the DOM.\n      const svgdoc = svgElem.ownerDocument;\n      this.group_ = svgdoc.createElementNS(NS.SVG, 'g');\n      const layerTitle = svgdoc.createElementNS(NS.SVG, 'title');\n      layerTitle.textContent = name;\n      this.group_.append(layerTitle);\n      if (group) {\n        $(group).after(this.group_);\n      } else {\n        svgElem.append(this.group_);\n      }\n    }\n\n    addLayerClass(this.group_);\n    walkTree(this.group_, function (e) {\n      e.setAttribute('style', 'pointer-events:inherit');\n    });\n\n    this.group_.setAttribute('style', svgElem ? 'pointer-events:all' : 'pointer-events:none');\n  }\n\n  /**\n   * Get the layer's name.\n   * @returns {string} The layer name\n   */\n  getName () {\n    return this.name_;\n  }\n\n  /**\n   * Get the group element for this layer.\n   * @returns {SVGGElement} The layer SVG group\n   */\n  getGroup () {\n    return this.group_;\n  }\n\n  /**\n   * Active this layer so it takes pointer events.\n   */\n  activate () {\n    this.group_.setAttribute('style', 'pointer-events:all');\n  }\n\n  /**\n   * Deactive this layer so it does NOT take pointer events.\n   */\n  deactivate () {\n    this.group_.setAttribute('style', 'pointer-events:none');\n  }\n\n  /**\n   * Set this layer visible or hidden based on 'visible' parameter.\n   * @param {boolean} visible - If true, make visible; otherwise, hide it.\n   */\n  setVisible (visible) {\n    const expected = visible === undefined || visible ? 'inline' : 'none';\n    const oldDisplay = this.group_.getAttribute('display');\n    if (oldDisplay !== expected) {\n      this.group_.setAttribute('display', expected);\n    }\n  }\n\n  /**\n   * Is this layer visible?\n   * @returns {boolean} True if visible.\n   */\n  isVisible () {\n    return this.group_.getAttribute('display') !== 'none';\n  }\n\n  /**\n   * Get layer opacity.\n   * @returns {number} Opacity value.\n   */\n  getOpacity () {\n    const opacity = this.group_.getAttribute('opacity');\n    if (opacity === null || opacity === undefined) {\n      return 1;\n    }\n    return parseFloat(opacity);\n  }\n\n  /**\n   * Sets the opacity of this layer. If opacity is not a value between 0.0 and 1.0,\n   * nothing happens.\n   * @param {number} opacity - A float value in the range 0.0-1.0\n   */\n  setOpacity (opacity) {\n    if (typeof opacity === 'number' && opacity >= 0.0 && opacity <= 1.0) {\n      this.group_.setAttribute('opacity', opacity);\n    }\n  }\n\n  /**\n   * Append children to this layer.\n   * @param {SVGGElement} children - The children to append to this layer.\n   */\n  appendChildren (children) {\n    for (let i = 0; i < children.length; ++i) {\n      this.group_.append(children[i]);\n    }\n  }\n\n  getTitleElement () {\n    const len = this.group_.childNodes.length;\n    for (let i = 0; i < len; ++i) {\n      const child = this.group_.childNodes.item(i);\n      if (child && child.tagName === 'title') {\n        return child;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the name of this layer.\n   * @param {string} name - The new name.\n   * @param {svgedit.history.HistoryRecordingService} hrService - History recording service\n   * @returns {string|null} The new name if changed; otherwise, null.\n   */\n  setName (name, hrService) {\n    const previousName = this.name_;\n    name = toXml(name);\n    // now change the underlying title element contents\n    const title = this.getTitleElement();\n    if (title) {\n      $(title).empty();\n      title.textContent = name;\n      this.name_ = name;\n      if (hrService) {\n        hrService.changeElement(title, {'#text': previousName});\n      }\n      return this.name_;\n    }\n    return null;\n  }\n\n  /**\n   * Remove this layer's group from the DOM. No more functions on group can be called after this.\n   * @param {SVGGElement} children - The children to append to this layer.\n   * @returns {SVGGElement} The layer SVG group that was just removed.\n   */\n  removeGroup () {\n    const parent = this.group_.parentNode;\n    const group = parent.removeChild(this.group_);\n    this.group_ = undefined;\n    return group;\n  }\n}\n/**\n * @property {string} CLASS_NAME - class attribute assigned to all layer groups.\n */\nLayer.CLASS_NAME = 'layer';\n\n/**\n * @property {RegExp} CLASS_REGEX - Used to test presence of class Layer.CLASS_NAME\n */\nLayer.CLASS_REGEX = new RegExp('(\\\\s|^)' + Layer.CLASS_NAME + '(\\\\s|$)');\n\n/**\n * Add class Layer.CLASS_NAME to the element (usually class='layer').\n *\n * Parameters:\n * @param {SVGGElement} elem - The SVG element to update\n */\nfunction addLayerClass (elem) {\n  const classes = elem.getAttribute('class');\n  if (classes === null || classes === undefined || !classes.length) {\n    elem.setAttribute('class', Layer.CLASS_NAME);\n  } else if (!Layer.CLASS_REGEX.test(classes)) {\n    elem.setAttribute('class', classes + ' ' + Layer.CLASS_NAME);\n  }\n}\n\nexport default Layer;\n","/**\n * Package: svgedit.history\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2016 Flint O'Brien\n */\n\nimport {\n  BatchCommand, MoveElementCommand, InsertElementCommand, RemoveElementCommand,\n  ChangeElementCommand\n} from './history.js';\n\n/**\n * History recording service.\n *\n * A self-contained service interface for recording history. Once injected, no other dependencies\n * or globals are required (example: UndoManager, command types, etc.). Easy to mock for unit tests.\n * Built on top of history classes in history.js.\n *\n * There is a simple start/end interface for batch commands.\n *\n * HistoryRecordingService.NO_HISTORY is a singleton that can be passed in to functions\n * that record history. This helps when the caller requires that no history be recorded.\n *\n * Usage:\n * The following will record history: insert, batch, insert.\n * ```\n * hrService = new svgedit.history.HistoryRecordingService(this.undoMgr);\n * hrService.insertElement(elem, text);         // add simple command to history.\n * hrService.startBatchCommand('create two elements');\n * hrService.changeElement(elem, attrs, text);  // add to batchCommand\n * hrService.changeElement(elem, attrs2, text); // add to batchCommand\n * hrService.endBatchCommand();                  // add batch command with two change commands to history.\n * hrService.insertElement(elem, text);         // add simple command to history.\n * ```\n *\n * Note that all functions return this, so commands can be chained, like so:\n *\n * ```\n * hrService\n *   .startBatchCommand('create two elements')\n *   .insertElement(elem, text)\n *   .changeElement(elem, attrs, text)\n *   .endBatchCommand();\n * ```\n *\n * @param {svgedit.history.UndoManager} undoManager - The undo manager.\n *     A value of null is valid for cases where no history recording is required.\n *     See singleton: HistoryRecordingService.NO_HISTORY\n */\nclass HistoryRecordingService {\n  constructor (undoManager) {\n    this.undoManager_ = undoManager;\n    this.currentBatchCommand_ = null;\n    this.batchCommandStack_ = [];\n  }\n\n  /**\n   * Start a batch command so multiple commands can recorded as a single history command.\n   * Requires a corresponding call to endBatchCommand. Start and end commands can be nested.\n   *\n   * @param {string} text - Optional string describing the batch command.\n   * @returns {svgedit.history.HistoryRecordingService}\n   */\n  startBatchCommand (text) {\n    if (!this.undoManager_) { return this; }\n    this.currentBatchCommand_ = new BatchCommand(text);\n    this.batchCommandStack_.push(this.currentBatchCommand_);\n    return this;\n  }\n\n  /**\n   * End a batch command and add it to the history or a parent batch command.\n   * @returns {svgedit.history.HistoryRecordingService}\n   */\n  endBatchCommand () {\n    if (!this.undoManager_) { return this; }\n    if (this.currentBatchCommand_) {\n      const batchCommand = this.currentBatchCommand_;\n      this.batchCommandStack_.pop();\n      const {length} = this.batchCommandStack_;\n      this.currentBatchCommand_ = length ? this.batchCommandStack_[length - 1] : null;\n      this.addCommand_(batchCommand);\n    }\n    return this;\n  }\n\n  /**\n   * Add a MoveElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was moved\n   * @param {Element} oldNextSibling - The element's next sibling before it was moved\n   * @param {Element} oldParent - The element's parent before it was moved\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {svgedit.history.HistoryRecordingService}\n   */\n  moveElement (elem, oldNextSibling, oldParent, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new MoveElementCommand(elem, oldNextSibling, oldParent, text));\n    return this;\n  }\n\n  /**\n   * Add an InsertElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was added\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {svgedit.history.HistoryRecordingService}\n   */\n  insertElement (elem, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new InsertElementCommand(elem, text));\n    return this;\n  }\n\n  /**\n   * Add a RemoveElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was removed\n   * @param {Element} oldNextSibling - The element's next sibling before it was removed\n   * @param {Element} oldParent - The element's parent before it was removed\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {svgedit.history.HistoryRecordingService}\n   */\n  removeElement (elem, oldNextSibling, oldParent, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new RemoveElementCommand(elem, oldNextSibling, oldParent, text));\n    return this;\n  }\n\n  /**\n   * Add a ChangeElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was changed\n   * @param {Object} attrs - An object with the attributes to be changed and the values they had *before* the change\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {svgedit.history.HistoryRecordingService}\n   */\n  changeElement (elem, attrs, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new ChangeElementCommand(elem, attrs, text));\n    return this;\n  }\n\n  /**\n   * Private function to add a command to the history or current batch command.\n   * @param cmd\n   * @returns {svgedit.history.HistoryRecordingService}\n   * @private\n   */\n  addCommand_ (cmd) {\n    if (!this.undoManager_) { return this; }\n    if (this.currentBatchCommand_) {\n      this.currentBatchCommand_.addSubCommand(cmd);\n    } else {\n      this.undoManager_.addCommandToHistory(cmd);\n    }\n  }\n}\n/**\n * @property {HistoryRecordingService} NO_HISTORY - Singleton that can be passed to functions that record history, but the caller requires that no history be recorded.\n */\nHistoryRecordingService.NO_HISTORY = new HistoryRecordingService();\nexport default HistoryRecordingService;\n","/* globals jQuery */\n/**\n * Package: svgedit.draw\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2011 Jeff Schiller\n */\n\nimport Layer from './layer.js';\nimport HistoryRecordingService from './historyrecording.js';\n\nimport {NS} from './svgedit.js';\nimport {isOpera} from './browser.js';\nimport {\n  toXml, getElem,\n  copyElem as utilCopyElem\n} from './svgutils.js';\nimport {\n  BatchCommand, RemoveElementCommand, MoveElementCommand, ChangeElementCommand\n} from './history.js';\n\nconst $ = jQuery;\n\nconst visElems = 'a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use'.split(',');\n\nconst RandomizeModes = {\n  LET_DOCUMENT_DECIDE: 0,\n  ALWAYS_RANDOMIZE: 1,\n  NEVER_RANDOMIZE: 2\n};\nlet randIds = RandomizeModes.LET_DOCUMENT_DECIDE;\n// Array with current disabled elements (for in-group editing)\nlet disabledElems = [];\n\n/**\n * Get a HistoryRecordingService.\n * @param {svgedit.history.HistoryRecordingService=} hrService - if exists, return it instead of creating a new service.\n * @returns {svgedit.history.HistoryRecordingService}\n */\nfunction historyRecordingService (hrService) {\n  return hrService || new HistoryRecordingService(canvas_.undoMgr);\n}\n\n/**\n * Find the layer name in a group element.\n * @param group The group element to search in.\n * @returns {string} The layer name or empty string.\n */\nfunction findLayerNameInGroup (group) {\n  return $('title', group).text() ||\n    (isOpera() && group.querySelectorAll\n      // Hack for Opera 10.60\n      ? $(group.querySelectorAll('title')).text()\n      : '');\n}\n\n/**\n * Given a set of names, return a new unique name.\n * @param {Array.<string>} existingLayerNames - Existing layer names.\n * @returns {string} - The new name.\n */\nfunction getNewLayerName (existingLayerNames) {\n  let i = 1;\n  // TODO(codedread): What about internationalization of \"Layer\"?\n  while (existingLayerNames.includes(('Layer ' + i))) { i++; }\n  return 'Layer ' + i;\n}\n\n/**\n * This class encapsulates the concept of a SVG-edit drawing\n * @param {SVGSVGElement} svgElem - The SVG DOM Element that this JS object\n *     encapsulates.  If the svgElem has a se:nonce attribute on it, then\n *     IDs will use the nonce as they are generated.\n * @param {String} [optIdPrefix=svg_] - The ID prefix to use.\n */\nexport class Drawing {\n  constructor (svgElem, optIdPrefix) {\n    if (!svgElem || !svgElem.tagName || !svgElem.namespaceURI ||\n      svgElem.tagName !== 'svg' || svgElem.namespaceURI !== NS.SVG) {\n      throw new Error('Error: svgedit.draw.Drawing instance initialized without a <svg> element');\n    }\n\n    /**\n    * The SVG DOM Element that represents this drawing.\n    * @type {SVGSVGElement}\n    */\n    this.svgElem_ = svgElem;\n\n    /**\n    * The latest object number used in this drawing.\n    * @type {number}\n    */\n    this.obj_num = 0;\n\n    /**\n    * The prefix to prepend to each element id in the drawing.\n    * @type {String}\n    */\n    this.idPrefix = optIdPrefix || 'svg_';\n\n    /**\n    * An array of released element ids to immediately reuse.\n    * @type {Array.<number>}\n    */\n    this.releasedNums = [];\n\n    /**\n    * The z-ordered array of Layer objects. Each layer has a name\n    * and group element.\n    * The first layer is the one at the bottom of the rendering.\n    * @type {Array.<Layer>}\n    */\n    this.all_layers = [];\n\n    /**\n    * Map of all_layers by name.\n    *\n    * Note: Layers are ordered, but referenced externally by name; so, we need both container\n    * types depending on which function is called (i.e. all_layers and layer_map).\n    *\n    * @type {Object.<string, Layer>}\n    */\n    this.layer_map = {};\n\n    /**\n    * The current layer being used.\n    * @type {Layer}\n    */\n    this.current_layer = null;\n\n    /**\n    * The nonce to use to uniquely identify elements across drawings.\n    * @type {!String}\n    */\n    this.nonce_ = '';\n    const n = this.svgElem_.getAttributeNS(NS.SE, 'nonce');\n    // If already set in the DOM, use the nonce throughout the document\n    // else, if randomizeIds(true) has been called, create and set the nonce.\n    if (!!n && randIds !== RandomizeModes.NEVER_RANDOMIZE) {\n      this.nonce_ = n;\n    } else if (randIds === RandomizeModes.ALWAYS_RANDOMIZE) {\n      this.setNonce(Math.floor(Math.random() * 100001));\n    }\n  }\n\n  /**\n   * @param {string} id Element ID to retrieve\n   * @returns {Element} SVG element within the root SVGSVGElement\n  */\n  getElem_ (id) {\n    if (this.svgElem_.querySelector) {\n      // querySelector lookup\n      return this.svgElem_.querySelector('#' + id);\n    }\n    // jQuery lookup: twice as slow as xpath in FF\n    return $(this.svgElem_).find('[id=' + id + ']')[0];\n  }\n\n  /**\n   * @returns {SVGSVGElement}\n   */\n  getSvgElem () {\n    return this.svgElem_;\n  }\n\n  /**\n   * @returns {!string|number} The previously set nonce\n   */\n  getNonce () {\n    return this.nonce_;\n  }\n\n  /**\n   * @param {!string|number} n The nonce to set\n   */\n  setNonce (n) {\n    this.svgElem_.setAttributeNS(NS.XMLNS, 'xmlns:se', NS.SE);\n    this.svgElem_.setAttributeNS(NS.SE, 'se:nonce', n);\n    this.nonce_ = n;\n  }\n\n  /**\n   * Clears any previously set nonce\n   */\n  clearNonce () {\n    // We deliberately leave any se:nonce attributes alone,\n    // we just don't use it to randomize ids.\n    this.nonce_ = '';\n  }\n\n  /**\n   * Returns the latest object id as a string.\n   * @return {String} The latest object Id.\n   */\n  getId () {\n    return this.nonce_\n      ? this.idPrefix + this.nonce_ + '_' + this.obj_num\n      : this.idPrefix + this.obj_num;\n  }\n\n  /**\n   * Returns the next object Id as a string.\n   * @return {String} The next object Id to use.\n   */\n  getNextId () {\n    const oldObjNum = this.obj_num;\n    let restoreOldObjNum = false;\n\n    // If there are any released numbers in the release stack,\n    // use the last one instead of the next obj_num.\n    // We need to temporarily use obj_num as that is what getId() depends on.\n    if (this.releasedNums.length > 0) {\n      this.obj_num = this.releasedNums.pop();\n      restoreOldObjNum = true;\n    } else {\n      // If we are not using a released id, then increment the obj_num.\n      this.obj_num++;\n    }\n\n    // Ensure the ID does not exist.\n    let id = this.getId();\n    while (this.getElem_(id)) {\n      if (restoreOldObjNum) {\n        this.obj_num = oldObjNum;\n        restoreOldObjNum = false;\n      }\n      this.obj_num++;\n      id = this.getId();\n    }\n    // Restore the old object number if required.\n    if (restoreOldObjNum) {\n      this.obj_num = oldObjNum;\n    }\n    return id;\n  }\n\n  /**\n   * Releases the object Id, letting it be used as the next id in getNextId().\n   * This method DOES NOT remove any elements from the DOM, it is expected\n   * that client code will do this.\n   * @param {string} id - The id to release.\n   * @returns {boolean} True if the id was valid to be released, false otherwise.\n  */\n  releaseId (id) {\n    // confirm if this is a valid id for this Document, else return false\n    const front = this.idPrefix + (this.nonce_ ? this.nonce_ + '_' : '');\n    if (typeof id !== 'string' || !id.startsWith(front)) {\n      return false;\n    }\n    // extract the obj_num of this id\n    const num = parseInt(id.substr(front.length), 10);\n\n    // if we didn't get a positive number or we already released this number\n    // then return false.\n    if (typeof num !== 'number' || num <= 0 || this.releasedNums.includes(num)) {\n      return false;\n    }\n\n    // push the released number into the released queue\n    this.releasedNums.push(num);\n\n    return true;\n  }\n\n  /**\n   * Returns the number of layers in the current drawing.\n   * @returns {integer} The number of layers in the current drawing.\n  */\n  getNumLayers () {\n    return this.all_layers.length;\n  }\n\n  /**\n   * Check if layer with given name already exists\n   * @param {string} name - The layer name to check\n  */\n  hasLayer (name) {\n    return this.layer_map[name] !== undefined;\n  }\n\n  /**\n   * Returns the name of the ith layer. If the index is out of range, an empty string is returned.\n   * @param {integer} i - The zero-based index of the layer you are querying.\n   * @returns {string} The name of the ith layer (or the empty string if none found)\n  */\n  getLayerName (i) {\n    return i >= 0 && i < this.getNumLayers() ? this.all_layers[i].getName() : '';\n  }\n\n  /**\n   * @returns {SVGGElement} The SVGGElement representing the current layer.\n   */\n  getCurrentLayer () {\n    return this.current_layer ? this.current_layer.getGroup() : null;\n  }\n\n  /**\n   * Get a layer by name.\n   * @returns {SVGGElement} The SVGGElement representing the named layer or null.\n   */\n  getLayerByName (name) {\n    const layer = this.layer_map[name];\n    return layer ? layer.getGroup() : null;\n  }\n\n  /**\n   * Returns the name of the currently selected layer. If an error occurs, an empty string\n   * is returned.\n   * @returns {string} The name of the currently active layer (or the empty string if none found).\n  */\n  getCurrentLayerName () {\n    return this.current_layer ? this.current_layer.getName() : '';\n  }\n\n  /**\n   * Set the current layer's name.\n   * @param {string} name - The new name.\n   * @param {svgedit.history.HistoryRecordingService} hrService - History recording service\n   * @returns {string|null} The new name if changed; otherwise, null.\n   */\n  setCurrentLayerName (name, hrService) {\n    let finalName = null;\n    if (this.current_layer) {\n      const oldName = this.current_layer.getName();\n      finalName = this.current_layer.setName(name, hrService);\n      if (finalName) {\n        delete this.layer_map[oldName];\n        this.layer_map[finalName] = this.current_layer;\n      }\n    }\n    return finalName;\n  }\n\n  /**\n   * Set the current layer's position.\n   * @param {number} newpos - The zero-based index of the new position of the layer. Range should be 0 to layers-1\n   * @returns {Object} If the name was changed, returns {title:SVGGElement, previousName:string}; otherwise null.\n   */\n  setCurrentLayerPosition (newpos) {\n    const layerCount = this.getNumLayers();\n    if (!this.current_layer || newpos < 0 || newpos >= layerCount) {\n      return null;\n    }\n\n    let oldpos;\n    for (oldpos = 0; oldpos < layerCount; ++oldpos) {\n      if (this.all_layers[oldpos] === this.current_layer) { break; }\n    }\n    // some unknown error condition (current_layer not in all_layers)\n    if (oldpos === layerCount) { return null; }\n\n    if (oldpos !== newpos) {\n      // if our new position is below us, we need to insert before the node after newpos\n      const currentGroup = this.current_layer.getGroup();\n      const oldNextSibling = currentGroup.nextSibling;\n\n      let refGroup = null;\n      if (newpos > oldpos) {\n        if (newpos < layerCount - 1) {\n          refGroup = this.all_layers[newpos + 1].getGroup();\n        }\n      // if our new position is above us, we need to insert before the node at newpos\n      } else {\n        refGroup = this.all_layers[newpos].getGroup();\n      }\n      this.svgElem_.insertBefore(currentGroup, refGroup); // Ok to replace with `refGroup.before(currentGroup);`?\n\n      this.identifyLayers();\n      this.setCurrentLayer(this.getLayerName(newpos));\n\n      return {\n        currentGroup,\n        oldNextSibling\n      };\n    }\n    return null;\n  }\n\n  mergeLayer (hrService) {\n    const currentGroup = this.current_layer.getGroup();\n    const prevGroup = $(currentGroup).prev()[0];\n    if (!prevGroup) { return; }\n\n    hrService.startBatchCommand('Merge Layer');\n\n    const layerNextSibling = currentGroup.nextSibling;\n    hrService.removeElement(currentGroup, layerNextSibling, this.svgElem_);\n\n    while (currentGroup.firstChild) {\n      const child = currentGroup.firstChild;\n      if (child.localName === 'title') {\n        hrService.removeElement(child, child.nextSibling, currentGroup);\n        child.remove();\n        continue;\n      }\n      const oldNextSibling = child.nextSibling;\n      prevGroup.append(child);\n      hrService.moveElement(child, oldNextSibling, currentGroup);\n    }\n\n    // Remove current layer's group\n    this.current_layer.removeGroup();\n    // Remove the current layer and set the previous layer as the new current layer\n    const index = this.all_layers.indexOf(this.current_layer);\n    if (index > 0) {\n      const name = this.current_layer.getName();\n      this.current_layer = this.all_layers[index - 1];\n      this.all_layers.splice(index, 1);\n      delete this.layer_map[name];\n    }\n\n    hrService.endBatchCommand();\n  }\n\n  mergeAllLayers (hrService) {\n    // Set the current layer to the last layer.\n    this.current_layer = this.all_layers[this.all_layers.length - 1];\n\n    hrService.startBatchCommand('Merge all Layers');\n    while (this.all_layers.length > 1) {\n      this.mergeLayer(hrService);\n    }\n    hrService.endBatchCommand();\n  }\n\n  /**\n   * Sets the current layer. If the name is not a valid layer name, then this\n   * function returns false. Otherwise it returns true. This is not an\n   * undo-able action.\n   * @param {string} name - The name of the layer you want to switch to.\n   * @returns {boolean} true if the current layer was switched, otherwise false\n   */\n  setCurrentLayer (name) {\n    const layer = this.layer_map[name];\n    if (layer) {\n      if (this.current_layer) {\n        this.current_layer.deactivate();\n      }\n      this.current_layer = layer;\n      this.current_layer.activate();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Deletes the current layer from the drawing and then clears the selection.\n   * This function then calls the 'changed' handler.  This is an undoable action.\n   * @returns {SVGGElement} The SVGGElement of the layer removed or null.\n   */\n  deleteCurrentLayer () {\n    if (this.current_layer && this.getNumLayers() > 1) {\n      const oldLayerGroup = this.current_layer.removeGroup();\n      this.identifyLayers();\n      return oldLayerGroup;\n    }\n    return null;\n  }\n\n  /**\n   * Updates layer system and sets the current layer to the\n   * top-most layer (last <g> child of this drawing).\n  */\n  identifyLayers () {\n    this.all_layers = [];\n    this.layer_map = {};\n    const numchildren = this.svgElem_.childNodes.length;\n    // loop through all children of SVG element\n    const orphans = [], layernames = [];\n    let layer = null;\n    let childgroups = false;\n    for (let i = 0; i < numchildren; ++i) {\n      const child = this.svgElem_.childNodes.item(i);\n      // for each g, find its layer name\n      if (child && child.nodeType === 1) {\n        if (child.tagName === 'g') {\n          childgroups = true;\n          const name = findLayerNameInGroup(child);\n          if (name) {\n            layernames.push(name);\n            layer = new Layer(name, child);\n            this.all_layers.push(layer);\n            this.layer_map[name] = layer;\n          } else {\n            // if group did not have a name, it is an orphan\n            orphans.push(child);\n          }\n        } else if (visElems.includes(child.nodeName)) {\n          // Child is \"visible\" (i.e. not a <title> or <defs> element), so it is an orphan\n          orphans.push(child);\n        }\n      }\n    }\n\n    // If orphans or no layers found, create a new layer and add all the orphans to it\n    if (orphans.length > 0 || !childgroups) {\n      layer = new Layer(getNewLayerName(layernames), null, this.svgElem_);\n      layer.appendChildren(orphans);\n      this.all_layers.push(layer);\n      this.layer_map[name] = layer;\n    } else {\n      layer.activate();\n    }\n    this.current_layer = layer;\n  }\n\n  /**\n   * Creates a new top-level layer in the drawing with the given name and\n   * makes it the current layer.\n   * @param {string} name - The given name. If the layer name exists, a new name will be generated.\n   * @param {svgedit.history.HistoryRecordingService} hrService - History recording service\n   * @returns {SVGGElement} The SVGGElement of the new layer, which is\n   *     also the current layer of this drawing.\n  */\n  createLayer (name, hrService) {\n    if (this.current_layer) {\n      this.current_layer.deactivate();\n    }\n    // Check for duplicate name.\n    if (name === undefined || name === null || name === '' || this.layer_map[name]) {\n      name = getNewLayerName(Object.keys(this.layer_map));\n    }\n\n    // Crate new layer and add to DOM as last layer\n    const layer = new Layer(name, null, this.svgElem_);\n    // Like to assume hrService exists, but this is backwards compatible with old version of createLayer.\n    if (hrService) {\n      hrService.startBatchCommand('Create Layer');\n      hrService.insertElement(layer.getGroup());\n      hrService.endBatchCommand();\n    }\n\n    this.all_layers.push(layer);\n    this.layer_map[name] = layer;\n    this.current_layer = layer;\n    return layer.getGroup();\n  }\n\n  /**\n   * Creates a copy of the current layer with the given name and makes it the current layer.\n   * @param {string} name - The given name. If the layer name exists, a new name will be generated.\n   * @param {svgedit.history.HistoryRecordingService} hrService - History recording service\n   * @returns {SVGGElement} The SVGGElement of the new layer, which is\n   *     also the current layer of this drawing.\n  */\n  cloneLayer (name, hrService) {\n    if (!this.current_layer) { return null; }\n    this.current_layer.deactivate();\n    // Check for duplicate name.\n    if (name === undefined || name === null || name === '' || this.layer_map[name]) {\n      name = getNewLayerName(Object.keys(this.layer_map));\n    }\n\n    // Create new group and add to DOM just after current_layer\n    const currentGroup = this.current_layer.getGroup();\n    const layer = new Layer(name, currentGroup, this.svgElem_);\n    const group = layer.getGroup();\n\n    // Clone children\n    const children = currentGroup.childNodes;\n    for (let index = 0; index < children.length; index++) {\n      const ch = children[index];\n      if (ch.localName === 'title') { continue; }\n      group.append(this.copyElem(ch));\n    }\n\n    if (hrService) {\n      hrService.startBatchCommand('Duplicate Layer');\n      hrService.insertElement(group);\n      hrService.endBatchCommand();\n    }\n\n    // Update layer containers and current_layer.\n    const index = this.all_layers.indexOf(this.current_layer);\n    if (index >= 0) {\n      this.all_layers.splice(index + 1, 0, layer);\n    } else {\n      this.all_layers.push(layer);\n    }\n    this.layer_map[name] = layer;\n    this.current_layer = layer;\n    return group;\n  }\n\n  /**\n   * Returns whether the layer is visible.  If the layer name is not valid,\n   * then this function returns false.\n   * @param {string} layername - The name of the layer which you want to query.\n   * @returns {boolean} The visibility state of the layer, or false if the layer name was invalid.\n  */\n  getLayerVisibility (layername) {\n    const layer = this.layer_map[layername];\n    return layer ? layer.isVisible() : false;\n  }\n\n  /**\n   * Sets the visibility of the layer. If the layer name is not valid, this\n   * function returns false, otherwise it returns true. This is an\n   * undo-able action.\n   * @param {string} layername - The name of the layer to change the visibility\n   * @param {boolean} bVisible - Whether the layer should be visible\n   * @returns {?SVGGElement} The SVGGElement representing the layer if the\n   *   layername was valid, otherwise null.\n  */\n  setLayerVisibility (layername, bVisible) {\n    if (typeof bVisible !== 'boolean') {\n      return null;\n    }\n    const layer = this.layer_map[layername];\n    if (!layer) { return null; }\n    layer.setVisible(bVisible);\n    return layer.getGroup();\n  }\n\n  /**\n   * Returns the opacity of the given layer.  If the input name is not a layer, null is returned.\n   * @param {string} layername - name of the layer on which to get the opacity\n   * @returns {?number} The opacity value of the given layer.  This will be a value between 0.0 and 1.0, or null\n   * if layername is not a valid layer\n  */\n  getLayerOpacity (layername) {\n    const layer = this.layer_map[layername];\n    if (!layer) { return null; }\n    return layer.getOpacity();\n  }\n\n  /**\n   * Sets the opacity of the given layer.  If the input name is not a layer,\n   * nothing happens. If opacity is not a value between 0.0 and 1.0, then\n   * nothing happens.\n   * @param {string} layername - Name of the layer on which to set the opacity\n   * @param {number} opacity - A float value in the range 0.0-1.0\n  */\n  setLayerOpacity (layername, opacity) {\n    if (typeof opacity !== 'number' || opacity < 0.0 || opacity > 1.0) {\n      return;\n    }\n    const layer = this.layer_map[layername];\n    if (layer) {\n      layer.setOpacity(opacity);\n    }\n  }\n\n  /**\n   * Create a clone of an element, updating its ID and its children's IDs when needed\n   * @param {Element} el - DOM element to clone\n   * @returns {Element}\n   */\n  copyElem (el) {\n    const self = this;\n    const getNextIdClosure = function () { return self.getNextId(); };\n    return utilCopyElem(el, getNextIdClosure);\n  }\n}\n\n/**\n * Called to ensure that drawings will or will not have randomized ids.\n * The currentDrawing will have its nonce set if it doesn't already.\n * @param {boolean} enableRandomization - flag indicating if documents should have randomized ids\n * @param {svgedit.draw.Drawing} currentDrawing\n */\nexport const randomizeIds = function (enableRandomization, currentDrawing) {\n  randIds = enableRandomization === false\n    ? RandomizeModes.NEVER_RANDOMIZE\n    : RandomizeModes.ALWAYS_RANDOMIZE;\n\n  if (randIds === RandomizeModes.ALWAYS_RANDOMIZE && !currentDrawing.getNonce()) {\n    currentDrawing.setNonce(Math.floor(Math.random() * 100001));\n  } else if (randIds === RandomizeModes.NEVER_RANDOMIZE && currentDrawing.getNonce()) {\n    currentDrawing.clearNonce();\n  }\n};\n\n// Layer API Functions\n\n/**\n* Group: Layers\n*/\n\nlet canvas_;\nexport const init = function (canvas) {\n  canvas_ = canvas;\n};\n\n// Updates layer system\nexport const identifyLayers = function () {\n  leaveContext();\n  canvas_.getCurrentDrawing().identifyLayers();\n};\n\n/**\n* Creates a new top-level layer in the drawing with the given name, sets the current layer\n* to it, and then clears the selection. This function then calls the 'changed' handler.\n* This is an undoable action.\n* @param name - The given name\n* @param hrService\n*/\nexport const createLayer = function (name, hrService) {\n  const newLayer = canvas_.getCurrentDrawing().createLayer(\n    name,\n    historyRecordingService(hrService)\n  );\n  canvas_.clearSelection();\n  canvas_.call('changed', [newLayer]);\n};\n\n/**\n * Creates a new top-level layer in the drawing with the given name, copies all the current layer's contents\n * to it, and then clears the selection. This function then calls the 'changed' handler.\n * This is an undoable action.\n * @param {string} name - The given name. If the layer name exists, a new name will be generated.\n * @param {svgedit.history.HistoryRecordingService} hrService - History recording service\n */\nexport const cloneLayer = function (name, hrService) {\n  // Clone the current layer and make the cloned layer the new current layer\n  const newLayer = canvas_.getCurrentDrawing().cloneLayer(name, historyRecordingService(hrService));\n\n  canvas_.clearSelection();\n  leaveContext();\n  canvas_.call('changed', [newLayer]);\n};\n\n/**\n* Deletes the current layer from the drawing and then clears the selection. This function\n* then calls the 'changed' handler. This is an undoable action.\n*/\nexport const deleteCurrentLayer = function () {\n  let currentLayer = canvas_.getCurrentDrawing().getCurrentLayer();\n  const {nextSibling} = currentLayer;\n  const parent = currentLayer.parentNode;\n  currentLayer = canvas_.getCurrentDrawing().deleteCurrentLayer();\n  if (currentLayer) {\n    const batchCmd = new BatchCommand('Delete Layer');\n    // store in our Undo History\n    batchCmd.addSubCommand(new RemoveElementCommand(currentLayer, nextSibling, parent));\n    canvas_.addCommandToHistory(batchCmd);\n    canvas_.clearSelection();\n    canvas_.call('changed', [parent]);\n    return true;\n  }\n  return false;\n};\n\n/**\n* Sets the current layer. If the name is not a valid layer name, then this function returns\n* false. Otherwise it returns true. This is not an undo-able action.\n* @param name - The name of the layer you want to switch to.\n*\n* @returns true if the current layer was switched, otherwise false\n*/\nexport const setCurrentLayer = function (name) {\n  const result = canvas_.getCurrentDrawing().setCurrentLayer(toXml(name));\n  if (result) {\n    canvas_.clearSelection();\n  }\n  return result;\n};\n\n/**\n* Renames the current layer. If the layer name is not valid (i.e. unique), then this function\n* does nothing and returns false, otherwise it returns true. This is an undo-able action.\n*\n* @param newname - the new name you want to give the current layer. This name must be unique\n* among all layer names.\n* @returns {Boolean} Whether the rename succeeded\n*/\nexport const renameCurrentLayer = function (newname) {\n  const drawing = canvas_.getCurrentDrawing();\n  const layer = drawing.getCurrentLayer();\n  if (layer) {\n    const result = drawing.setCurrentLayerName(newname, historyRecordingService());\n    if (result) {\n      canvas_.call('changed', [layer]);\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n* Changes the position of the current layer to the new value. If the new index is not valid,\n* this function does nothing and returns false, otherwise it returns true. This is an\n* undo-able action.\n* @param newpos - The zero-based index of the new position of the layer. This should be between\n* 0 and (number of layers - 1)\n*\n* @returns {Boolean} true if the current layer position was changed, false otherwise.\n*/\nexport const setCurrentLayerPosition = function (newpos) {\n  const drawing = canvas_.getCurrentDrawing();\n  const result = drawing.setCurrentLayerPosition(newpos);\n  if (result) {\n    canvas_.addCommandToHistory(new MoveElementCommand(result.currentGroup, result.oldNextSibling, canvas_.getSVGContent()));\n    return true;\n  }\n  return false;\n};\n\n/**\n* Sets the visibility of the layer. If the layer name is not valid, this function return\n* false, otherwise it returns true. This is an undo-able action.\n* @param layername - The name of the layer to change the visibility\n* @param {Boolean} bVisible - Whether the layer should be visible\n* @returns {Boolean} true if the layer's visibility was set, false otherwise\n*/\nexport const setLayerVisibility = function (layername, bVisible) {\n  const drawing = canvas_.getCurrentDrawing();\n  const prevVisibility = drawing.getLayerVisibility(layername);\n  const layer = drawing.setLayerVisibility(layername, bVisible);\n  if (layer) {\n    const oldDisplay = prevVisibility ? 'inline' : 'none';\n    canvas_.addCommandToHistory(new ChangeElementCommand(layer, {display: oldDisplay}, 'Layer Visibility'));\n  } else {\n    return false;\n  }\n\n  if (layer === drawing.getCurrentLayer()) {\n    canvas_.clearSelection();\n    canvas_.pathActions.clear();\n  }\n  // call('changed', [selected]);\n  return true;\n};\n\n/**\n* Moves the selected elements to layername. If the name is not a valid layer name, then false\n* is returned. Otherwise it returns true. This is an undo-able action.\n*\n* @param layername - The name of the layer you want to which you want to move the selected elements\n* @returns {Boolean} Whether the selected elements were moved to the layer.\n*/\nexport const moveSelectedToLayer = function (layername) {\n  // find the layer\n  const drawing = canvas_.getCurrentDrawing();\n  const layer = drawing.getLayerByName(layername);\n  if (!layer) { return false; }\n\n  const batchCmd = new BatchCommand('Move Elements to Layer');\n\n  // loop for each selected element and move it\n  const selElems = canvas_.getSelectedElements();\n  let i = selElems.length;\n  while (i--) {\n    const elem = selElems[i];\n    if (!elem) { continue; }\n    const oldNextSibling = elem.nextSibling;\n    // TODO: this is pretty brittle!\n    const oldLayer = elem.parentNode;\n    layer.append(elem);\n    batchCmd.addSubCommand(new MoveElementCommand(elem, oldNextSibling, oldLayer));\n  }\n\n  canvas_.addCommandToHistory(batchCmd);\n\n  return true;\n};\n\nexport const mergeLayer = function (hrService) {\n  canvas_.getCurrentDrawing().mergeLayer(historyRecordingService(hrService));\n  canvas_.clearSelection();\n  leaveContext();\n  canvas_.changeSvgcontent();\n};\n\nexport const mergeAllLayers = function (hrService) {\n  canvas_.getCurrentDrawing().mergeAllLayers(historyRecordingService(hrService));\n  canvas_.clearSelection();\n  leaveContext();\n  canvas_.changeSvgcontent();\n};\n\n// Return from a group context to the regular kind, make any previously\n// disabled elements enabled again\nexport const leaveContext = function () {\n  const len = disabledElems.length;\n  if (len) {\n    for (let i = 0; i < len; i++) {\n      const elem = disabledElems[i];\n      const orig = canvas_.elData(elem, 'orig_opac');\n      if (orig !== 1) {\n        elem.setAttribute('opacity', orig);\n      } else {\n        elem.removeAttribute('opacity');\n      }\n      elem.setAttribute('style', 'pointer-events: inherit');\n    }\n    disabledElems = [];\n    canvas_.clearSelection(true);\n    canvas_.call('contextset', null);\n  }\n  canvas_.setCurrentGroup(null);\n};\n\n// Set the current context (for in-group editing)\nexport const setContext = function (elem) {\n  leaveContext();\n  if (typeof elem === 'string') {\n    elem = getElem(elem);\n  }\n\n  // Edit inside this group\n  canvas_.setCurrentGroup(elem);\n\n  // Disable other elements\n  $(elem).parentsUntil('#svgcontent').andSelf().siblings().each(function () {\n    const opac = this.getAttribute('opacity') || 1;\n    // Store the original's opacity\n    canvas_.elData(this, 'orig_opac', opac);\n    this.setAttribute('opacity', opac * 0.33);\n    this.setAttribute('style', 'pointer-events: none');\n    disabledElems.push(this);\n  });\n\n  canvas_.clearSelection();\n  canvas_.call('contextset', canvas_.getCurrentGroup());\n};\n\nexport {Layer};\n","/**\n * Package: svgedit.sanitize\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Jeff Schiller\n */\n\nimport {getReverseNS, NS} from './svgedit.js';\nimport {isGecko} from './browser.js';\nimport {getHref, setHref, getUrlFromAttr} from './svgutils.js';\n\nconst REVERSE_NS = getReverseNS();\n\n// this defines which elements and attributes that we support\nconst svgWhiteList_ = {\n  // SVG Elements\n  a: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'mask', 'opacity', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'xlink:href', 'xlink:title'],\n  circle: ['class', 'clip-path', 'clip-rule', 'cx', 'cy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'mask', 'opacity', 'r', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  clipPath: ['class', 'clipPathUnits', 'id'],\n  defs: [],\n  style: ['type'],\n  desc: [],\n  ellipse: ['class', 'clip-path', 'clip-rule', 'cx', 'cy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  feGaussianBlur: ['class', 'color-interpolation-filters', 'id', 'requiredFeatures', 'stdDeviation'],\n  filter: ['class', 'color-interpolation-filters', 'filterRes', 'filterUnits', 'height', 'id', 'primitiveUnits', 'requiredFeatures', 'width', 'x', 'xlink:href', 'y'],\n  foreignObject: ['class', 'font-size', 'height', 'id', 'opacity', 'requiredFeatures', 'style', 'transform', 'width', 'x', 'y'],\n  g: ['class', 'clip-path', 'clip-rule', 'id', 'display', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'font-family', 'font-size', 'font-style', 'font-weight', 'text-anchor'],\n  image: ['class', 'clip-path', 'clip-rule', 'filter', 'height', 'id', 'mask', 'opacity', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:href', 'xlink:title', 'y'],\n  line: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'x1', 'x2', 'y1', 'y2'],\n  linearGradient: ['class', 'id', 'gradientTransform', 'gradientUnits', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'x1', 'x2', 'xlink:href', 'y1', 'y2'],\n  marker: ['id', 'class', 'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'systemLanguage', 'viewBox'],\n  mask: ['class', 'height', 'id', 'maskContentUnits', 'maskUnits', 'width', 'x', 'y'],\n  metadata: ['class', 'id'],\n  path: ['class', 'clip-path', 'clip-rule', 'd', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  pattern: ['class', 'height', 'id', 'patternContentUnits', 'patternTransform', 'patternUnits', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:href', 'y'],\n  polygon: ['class', 'clip-path', 'clip-rule', 'id', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'class', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  polyline: ['class', 'clip-path', 'clip-rule', 'id', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  radialGradient: ['class', 'cx', 'cy', 'fx', 'fy', 'gradientTransform', 'gradientUnits', 'id', 'r', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'xlink:href'],\n  rect: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height', 'id', 'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'width', 'x', 'y'],\n  stop: ['class', 'id', 'offset', 'requiredFeatures', 'stop-color', 'stop-opacity', 'style', 'systemLanguage'],\n  svg: ['class', 'clip-path', 'clip-rule', 'filter', 'id', 'height', 'mask', 'preserveAspectRatio', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xmlns', 'xmlns:se', 'xmlns:xlink', 'y'],\n  switch: ['class', 'id', 'requiredFeatures', 'systemLanguage'],\n  symbol: ['class', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight', 'id', 'opacity', 'preserveAspectRatio', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'viewBox'],\n  text: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight', 'id', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'text-anchor', 'transform', 'x', 'xml:space', 'y'],\n  textPath: ['class', 'id', 'method', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'transform', 'xlink:href'],\n  title: [],\n  tspan: ['class', 'clip-path', 'clip-rule', 'dx', 'dy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight', 'id', 'mask', 'opacity', 'requiredFeatures', 'rotate', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'text-anchor', 'textLength', 'transform', 'x', 'xml:space', 'y'],\n  use: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height', 'id', 'mask', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'transform', 'width', 'x', 'xlink:href', 'y'],\n\n  // MathML Elements\n  annotation: ['encoding'],\n  'annotation-xml': ['encoding'],\n  maction: ['actiontype', 'other', 'selection'],\n  math: ['class', 'id', 'display', 'xmlns'],\n  menclose: ['notation'],\n  merror: [],\n  mfrac: ['linethickness'],\n  mi: ['mathvariant'],\n  mmultiscripts: [],\n  mn: [],\n  mo: ['fence', 'lspace', 'maxsize', 'minsize', 'rspace', 'stretchy'],\n  mover: [],\n  mpadded: ['lspace', 'width', 'height', 'depth', 'voffset'],\n  mphantom: [],\n  mprescripts: [],\n  mroot: [],\n  mrow: ['xlink:href', 'xlink:type', 'xmlns:xlink'],\n  mspace: ['depth', 'height', 'width'],\n  msqrt: [],\n  mstyle: ['displaystyle', 'mathbackground', 'mathcolor', 'mathvariant', 'scriptlevel'],\n  msub: [],\n  msubsup: [],\n  msup: [],\n  mtable: ['align', 'columnalign', 'columnlines', 'columnspacing', 'displaystyle', 'equalcolumns', 'equalrows', 'frame', 'rowalign', 'rowlines', 'rowspacing', 'width'],\n  mtd: ['columnalign', 'columnspan', 'rowalign', 'rowspan'],\n  mtext: [],\n  mtr: ['columnalign', 'rowalign'],\n  munder: [],\n  munderover: [],\n  none: [],\n  semantics: []\n};\n\n// Produce a Namespace-aware version of svgWhitelist\nconst svgWhiteListNS_ = {};\nObject.entries(svgWhiteList_).forEach(function ([elt, atts]) {\n  const attNS = {};\n  Object.entries(atts).forEach(function ([i, att]) {\n    if (att.includes(':')) {\n      const v = att.split(':');\n      attNS[v[1]] = NS[(v[0]).toUpperCase()];\n    } else {\n      attNS[att] = att === 'xmlns' ? NS.XMLNS : null;\n    }\n  });\n  svgWhiteListNS_[elt] = attNS;\n});\n\n/**\n* Sanitizes the input node and its children\n* It only keeps what is allowed from our whitelist defined above\n* @param node - The DOM element to be checked (we'll also check its children)\n*/\nexport const sanitizeSvg = function (node) {\n  // Cleanup text nodes\n  if (node.nodeType === 3) { // 3 === TEXT_NODE\n    // Trim whitespace\n    node.nodeValue = node.nodeValue.replace(/^\\s+|\\s+$/g, '');\n    // Remove if empty\n    if (!node.nodeValue.length) {\n      node.remove();\n    }\n  }\n\n  // We only care about element nodes.\n  // Automatically return for all non-element nodes, such as comments, etc.\n  if (node.nodeType !== 1) { // 1 == ELEMENT_NODE\n    return;\n  }\n\n  const doc = node.ownerDocument;\n  const parent = node.parentNode;\n  // can parent ever be null here?  I think the root node's parent is the document...\n  if (!doc || !parent) {\n    return;\n  }\n\n  const allowedAttrs = svgWhiteList_[node.nodeName];\n  const allowedAttrsNS = svgWhiteListNS_[node.nodeName];\n  // if this element is supported, sanitize it\n  if (typeof allowedAttrs !== 'undefined') {\n    const seAttrs = [];\n    let i = node.attributes.length;\n    while (i--) {\n      // if the attribute is not in our whitelist, then remove it\n      // could use jQuery's inArray(), but I don't know if that's any better\n      const attr = node.attributes.item(i);\n      const attrName = attr.nodeName;\n      const attrLocalName = attr.localName;\n      const attrNsURI = attr.namespaceURI;\n      // Check that an attribute with the correct localName in the correct namespace is on\n      // our whitelist or is a namespace declaration for one of our allowed namespaces\n      if (!(allowedAttrsNS.hasOwnProperty(attrLocalName) && attrNsURI === allowedAttrsNS[attrLocalName] && attrNsURI !== NS.XMLNS) &&\n        !(attrNsURI === NS.XMLNS && REVERSE_NS[attr.value])) {\n        // TODO(codedread): Programmatically add the se: attributes to the NS-aware whitelist.\n        // Bypassing the whitelist to allow se: prefixes.\n        // Is there a more appropriate way to do this?\n        if (attrName.startsWith('se:') || attrName.startsWith('data-')) {\n          seAttrs.push([attrName, attr.value]);\n        }\n        node.removeAttributeNS(attrNsURI, attrLocalName);\n      }\n\n      // Add spaces before negative signs where necessary\n      if (isGecko()) {\n        switch (attrName) {\n        case 'transform':\n        case 'gradientTransform':\n        case 'patternTransform':\n          const val = attr.value.replace(/(\\d)-/g, '$1 -');\n          node.setAttribute(attrName, val);\n          break;\n        }\n      }\n\n      // For the style attribute, rewrite it in terms of XML presentational attributes\n      if (attrName === 'style') {\n        const props = attr.value.split(';');\n        let p = props.length;\n        while (p--) {\n          const [name, val] = props[p].split(':');\n          const styleAttrName = (name || '').trim();\n          const styleAttrVal = (val || '').trim();\n          // Now check that this attribute is supported\n          if (allowedAttrs.includes(styleAttrName)) {\n            node.setAttribute(styleAttrName, styleAttrVal);\n          }\n        }\n        node.removeAttribute('style');\n      }\n    }\n\n    Object.values(seAttrs).forEach(([att, val]) => {\n      node.setAttributeNS(NS.SE, att, val);\n    });\n\n    // for some elements that have a xlink:href, ensure the URI refers to a local element\n    // (but not for links)\n    const href = getHref(node);\n    if (href &&\n      ['filter', 'linearGradient', 'pattern',\n        'radialGradient', 'textPath', 'use'].includes(node.nodeName)) {\n      // TODO: we simply check if the first character is a #, is this bullet-proof?\n      if (href[0] !== '#') {\n        // remove the attribute (but keep the element)\n        setHref(node, '');\n        node.removeAttributeNS(NS.XLINK, 'href');\n      }\n    }\n\n    // Safari crashes on a <use> without a xlink:href, so we just remove the node here\n    if (node.nodeName === 'use' && !getHref(node)) {\n      node.remove();\n      return;\n    }\n    // if the element has attributes pointing to a non-local reference,\n    // need to remove the attribute\n    Object.values(['clip-path', 'fill', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'stroke'], function (attr) {\n      let val = node.getAttribute(attr);\n      if (val) {\n        val = getUrlFromAttr(val);\n        // simply check for first character being a '#'\n        if (val && val[0] !== '#') {\n          node.setAttribute(attr, '');\n          node.removeAttribute(attr);\n        }\n      }\n    });\n\n    // recurse to children\n    i = node.childNodes.length;\n    while (i--) { sanitizeSvg(node.childNodes.item(i)); }\n  // else (element not supported), remove it\n  } else {\n    // remove all children from this node and insert them before this node\n    // FIXME: in the case of animation elements this will hardly ever be correct\n    const children = [];\n    while (node.hasChildNodes()) {\n      children.push(parent.insertBefore(node.firstChild, node));\n    }\n\n    // remove this node from the document altogether\n    node.remove();\n\n    // call sanitizeSvg on each of those children\n    let i = children.length;\n    while (i--) { sanitizeSvg(children[i]); }\n  }\n};\n","/* globals jQuery */\n/**\n * Coords.\n *\n * Licensed under the MIT License\n *\n */\n\nimport './pathseg.js';\nimport {\n  snapToGrid, assignAttributes, getBBox, getRefElem, findDefs\n} from './svgutils.js';\nimport {\n  transformPoint, transformListToTransform, matrixMultiply, transformBox\n} from './math.js';\nimport {getTransformList} from './svgtransformlist.js';\n\nconst $ = jQuery;\n\n// this is how we map paths to our preferred relative segment types\nconst pathMap = [0, 'z', 'M', 'm', 'L', 'l', 'C', 'c', 'Q', 'q', 'A', 'a',\n  'H', 'h', 'V', 'v', 'S', 's', 'T', 't'];\n\n/**\n * @typedef editorContext\n * @type {?object}\n * @property {function} getGridSnapping\n * @property {function} getDrawing\n*/\nlet editorContext_ = null;\n\n/**\n* @param {editorContext} editorContext\n*/\nexport const init = function (editorContext) {\n  editorContext_ = editorContext;\n};\n\n/**\n * Applies coordinate changes to an element based on the given matrix\n * @param {Element} selected - DOM element to be changed\n * @param {Object} changes - Object with changes to be remapped\n * @param {SVGMatrix} m - Matrix object to use for remapping coordinates\n*/\nexport const remapElement = function (selected, changes, m) {\n  const remap = function (x, y) { return transformPoint(x, y, m); },\n    scalew = function (w) { return m.a * w; },\n    scaleh = function (h) { return m.d * h; },\n    doSnapping = editorContext_.getGridSnapping() && selected.parentNode.parentNode.localName === 'svg',\n    finishUp = function () {\n      if (doSnapping) {\n        for (const o in changes) {\n          changes[o] = snapToGrid(changes[o]);\n        }\n      }\n      assignAttributes(selected, changes, 1000, true);\n    },\n    box = getBBox(selected);\n\n  for (let i = 0; i < 2; i++) {\n    const type = i === 0 ? 'fill' : 'stroke';\n    const attrVal = selected.getAttribute(type);\n    if (attrVal && attrVal.startsWith('url(')) {\n      if (m.a < 0 || m.d < 0) {\n        const grad = getRefElem(attrVal);\n        const newgrad = grad.cloneNode(true);\n        if (m.a < 0) {\n          // flip x\n          const x1 = newgrad.getAttribute('x1');\n          const x2 = newgrad.getAttribute('x2');\n          newgrad.setAttribute('x1', -(x1 - 1));\n          newgrad.setAttribute('x2', -(x2 - 1));\n        }\n\n        if (m.d < 0) {\n          // flip y\n          const y1 = newgrad.getAttribute('y1');\n          const y2 = newgrad.getAttribute('y2');\n          newgrad.setAttribute('y1', -(y1 - 1));\n          newgrad.setAttribute('y2', -(y2 - 1));\n        }\n        newgrad.id = editorContext_.getDrawing().getNextId();\n        findDefs().append(newgrad);\n        selected.setAttribute(type, 'url(#' + newgrad.id + ')');\n      }\n\n      // Not really working :(\n      // if (selected.tagName === 'path') {\n      //   reorientGrads(selected, m);\n      // }\n    }\n  }\n\n  const elName = selected.tagName;\n  if (elName === 'g' || elName === 'text' || elName === 'tspan' || elName === 'use') {\n    // if it was a translate, then just update x,y\n    if (m.a === 1 && m.b === 0 && m.c === 0 && m.d === 1 && (m.e !== 0 || m.f !== 0)) {\n      // [T][M] = [M][T']\n      // therefore [T'] = [M_inv][T][M]\n      const existing = transformListToTransform(selected).matrix,\n        tNew = matrixMultiply(existing.inverse(), m, existing);\n      changes.x = parseFloat(changes.x) + tNew.e;\n      changes.y = parseFloat(changes.y) + tNew.f;\n    } else {\n      // we just absorb all matrices into the element and don't do any remapping\n      const chlist = getTransformList(selected);\n      const mt = editorContext_.getSVGRoot().createSVGTransform();\n      mt.setMatrix(matrixMultiply(transformListToTransform(chlist).matrix, m));\n      chlist.clear();\n      chlist.appendItem(mt);\n    }\n  }\n\n  // now we have a set of changes and an applied reduced transform list\n  // we apply the changes directly to the DOM\n  switch (elName) {\n  case 'foreignObject':\n  case 'rect':\n  case 'image': {\n    // Allow images to be inverted (give them matrix when flipped)\n    if (elName === 'image' && (m.a < 0 || m.d < 0)) {\n      // Convert to matrix\n      const chlist = getTransformList(selected);\n      const mt = editorContext_.getSVGRoot().createSVGTransform();\n      mt.setMatrix(matrixMultiply(transformListToTransform(chlist).matrix, m));\n      chlist.clear();\n      chlist.appendItem(mt);\n    } else {\n      const pt1 = remap(changes.x, changes.y);\n      changes.width = scalew(changes.width);\n      changes.height = scaleh(changes.height);\n      changes.x = pt1.x + Math.min(0, changes.width);\n      changes.y = pt1.y + Math.min(0, changes.height);\n      changes.width = Math.abs(changes.width);\n      changes.height = Math.abs(changes.height);\n    }\n    finishUp();\n    break;\n  } case 'ellipse': {\n    const c = remap(changes.cx, changes.cy);\n    changes.cx = c.x;\n    changes.cy = c.y;\n    changes.rx = scalew(changes.rx);\n    changes.ry = scaleh(changes.ry);\n    changes.rx = Math.abs(changes.rx);\n    changes.ry = Math.abs(changes.ry);\n    finishUp();\n    break;\n  } case 'circle': {\n    const c = remap(changes.cx, changes.cy);\n    changes.cx = c.x;\n    changes.cy = c.y;\n    // take the minimum of the new selected box's dimensions for the new circle radius\n    const tbox = transformBox(box.x, box.y, box.width, box.height, m);\n    const w = tbox.tr.x - tbox.tl.x, h = tbox.bl.y - tbox.tl.y;\n    changes.r = Math.min(w / 2, h / 2);\n\n    if (changes.r) { changes.r = Math.abs(changes.r); }\n    finishUp();\n    break;\n  } case 'line': {\n    const pt1 = remap(changes.x1, changes.y1);\n    const pt2 = remap(changes.x2, changes.y2);\n    changes.x1 = pt1.x;\n    changes.y1 = pt1.y;\n    changes.x2 = pt2.x;\n    changes.y2 = pt2.y;\n  } // Fallthrough\n  case 'text':\n  case 'tspan':\n  case 'use': {\n    finishUp();\n    break;\n  } case 'g': {\n    const gsvg = $(selected).data('gsvg');\n    if (gsvg) {\n      assignAttributes(gsvg, changes, 1000, true);\n    }\n    break;\n  } case 'polyline':\n  case 'polygon': {\n    const len = changes.points.length;\n    for (let i = 0; i < len; ++i) {\n      const pt = changes.points[i];\n      const {x, y} = remap(pt.x, pt.y);\n      changes.points[i].x = x;\n      changes.points[i].y = y;\n    }\n\n    // const len = changes.points.length;\n    let pstr = '';\n    for (let i = 0; i < len; ++i) {\n      const pt = changes.points[i];\n      pstr += pt.x + ',' + pt.y + ' ';\n    }\n    selected.setAttribute('points', pstr);\n    break;\n  } case 'path': {\n    const segList = selected.pathSegList;\n    let len = segList.numberOfItems;\n    changes.d = [];\n    for (let i = 0; i < len; ++i) {\n      const seg = segList.getItem(i);\n      changes.d[i] = {\n        type: seg.pathSegType,\n        x: seg.x,\n        y: seg.y,\n        x1: seg.x1,\n        y1: seg.y1,\n        x2: seg.x2,\n        y2: seg.y2,\n        r1: seg.r1,\n        r2: seg.r2,\n        angle: seg.angle,\n        largeArcFlag: seg.largeArcFlag,\n        sweepFlag: seg.sweepFlag\n      };\n    }\n\n    len = changes.d.length;\n    const firstseg = changes.d[0],\n      currentpt = remap(firstseg.x, firstseg.y);\n    changes.d[0].x = currentpt.x;\n    changes.d[0].y = currentpt.y;\n    for (let i = 1; i < len; ++i) {\n      const seg = changes.d[i];\n      const {type} = seg;\n      // if absolute or first segment, we want to remap x, y, x1, y1, x2, y2\n      // if relative, we want to scalew, scaleh\n      if (type % 2 === 0) { // absolute\n        const thisx = (seg.x !== undefined) ? seg.x : currentpt.x, // for V commands\n          thisy = (seg.y !== undefined) ? seg.y : currentpt.y; // for H commands\n        const pt = remap(thisx, thisy);\n        const pt1 = remap(seg.x1, seg.y1);\n        const pt2 = remap(seg.x2, seg.y2);\n        seg.x = pt.x;\n        seg.y = pt.y;\n        seg.x1 = pt1.x;\n        seg.y1 = pt1.y;\n        seg.x2 = pt2.x;\n        seg.y2 = pt2.y;\n        seg.r1 = scalew(seg.r1);\n        seg.r2 = scaleh(seg.r2);\n      } else { // relative\n        seg.x = scalew(seg.x);\n        seg.y = scaleh(seg.y);\n        seg.x1 = scalew(seg.x1);\n        seg.y1 = scaleh(seg.y1);\n        seg.x2 = scalew(seg.x2);\n        seg.y2 = scaleh(seg.y2);\n        seg.r1 = scalew(seg.r1);\n        seg.r2 = scaleh(seg.r2);\n      }\n    } // for each segment\n\n    let dstr = '';\n    len = changes.d.length;\n    for (let i = 0; i < len; ++i) {\n      const seg = changes.d[i];\n      const {type} = seg;\n      dstr += pathMap[type];\n      switch (type) {\n      case 13: // relative horizontal line (h)\n      case 12: // absolute horizontal line (H)\n        dstr += seg.x + ' ';\n        break;\n      case 15: // relative vertical line (v)\n      case 14: // absolute vertical line (V)\n        dstr += seg.y + ' ';\n        break;\n      case 3: // relative move (m)\n      case 5: // relative line (l)\n      case 19: // relative smooth quad (t)\n      case 2: // absolute move (M)\n      case 4: // absolute line (L)\n      case 18: // absolute smooth quad (T)\n        dstr += seg.x + ',' + seg.y + ' ';\n        break;\n      case 7: // relative cubic (c)\n      case 6: // absolute cubic (C)\n        dstr += seg.x1 + ',' + seg.y1 + ' ' + seg.x2 + ',' + seg.y2 + ' ' +\n          seg.x + ',' + seg.y + ' ';\n        break;\n      case 9: // relative quad (q)\n      case 8: // absolute quad (Q)\n        dstr += seg.x1 + ',' + seg.y1 + ' ' + seg.x + ',' + seg.y + ' ';\n        break;\n      case 11: // relative elliptical arc (a)\n      case 10: // absolute elliptical arc (A)\n        dstr += seg.r1 + ',' + seg.r2 + ' ' + seg.angle + ' ' + (+seg.largeArcFlag) +\n          ' ' + (+seg.sweepFlag) + ' ' + seg.x + ',' + seg.y + ' ';\n        break;\n      case 17: // relative smooth cubic (s)\n      case 16: // absolute smooth cubic (S)\n        dstr += seg.x2 + ',' + seg.y2 + ' ' + seg.x + ',' + seg.y + ' ';\n        break;\n      }\n    }\n\n    selected.setAttribute('d', dstr);\n    break;\n  }\n  }\n};\n","/* globals jQuery */\n/**\n * Recalculate.\n *\n * Licensed under the MIT License\n *\n */\n\n// Dependencies:\n// 1) jquery-svg.js\n\nimport jqPluginSVG from './jquery-svg.js'; // Needed for SVG attribute setting and array form with `attr`\nimport {NS} from './svgedit.js';\nimport {convertToNum} from './units.js';\nimport {isWebkit} from './browser.js';\nimport {getTransformList} from './svgtransformlist.js';\nimport {getRotationAngle, getHref, getBBox, getRefElem} from './svgutils.js';\nimport {BatchCommand, ChangeElementCommand} from './history.js';\nimport {remapElement} from './coords.js';\nimport {\n  isIdentity, matrixMultiply, transformPoint, transformListToTransform,\n  hasMatrixTransform\n} from './math.js';\n\nconst $ = jqPluginSVG(jQuery);\n\nlet context_;\n\n/**\n* @param editorContext\n*/\nexport const init = function (editorContext) {\n  context_ = editorContext;\n};\n\n/**\n* Updates a <clipPath>s values based on the given translation of an element\n* @param attr - The clip-path attribute value with the clipPath's ID\n* @param tx - The translation's x value\n* @param ty - The translation's y value\n*/\nexport const updateClipPath = function (attr, tx, ty) {\n  const path = getRefElem(attr).firstChild;\n  const cpXform = getTransformList(path);\n  const newxlate = context_.getSVGRoot().createSVGTransform();\n  newxlate.setTranslate(tx, ty);\n\n  cpXform.appendItem(newxlate);\n\n  // Update clipPath's dimensions\n  recalculateDimensions(path);\n};\n\n/**\n* Decides the course of action based on the element's transform list\n* @param selected - The DOM element to recalculate\n* @returns Undo command object with the resulting change\n*/\nexport const recalculateDimensions = function (selected) {\n  if (selected == null) { return null; }\n\n  // Firefox Issue - 1081\n  if (selected.nodeName === 'svg' && navigator.userAgent.includes('Firefox/20')) {\n    return null;\n  }\n\n  const svgroot = context_.getSVGRoot();\n  const tlist = getTransformList(selected);\n\n  // remove any unnecessary transforms\n  if (tlist && tlist.numberOfItems > 0) {\n    let k = tlist.numberOfItems;\n    const noi = k;\n    while (k--) {\n      const xform = tlist.getItem(k);\n      if (xform.type === 0) {\n        tlist.removeItem(k);\n      // remove identity matrices\n      } else if (xform.type === 1) {\n        if (isIdentity(xform.matrix)) {\n          if (noi === 1) {\n            // Overcome Chrome bug (though only when noi is 1) with\n            //    `removeItem` preventing `removeAttribute` from\n            //    subsequently working\n            // See https://bugs.chromium.org/p/chromium/issues/detail?id=843901\n            selected.removeAttribute('transform');\n            return null;\n          }\n          tlist.removeItem(k);\n        }\n      // remove zero-degree rotations\n      } else if (xform.type === 4) {\n        if (xform.angle === 0) {\n          tlist.removeItem(k);\n        }\n      }\n    }\n    // End here if all it has is a rotation\n    if (tlist.numberOfItems === 1 &&\n        getRotationAngle(selected)) { return null; }\n  }\n\n  // if this element had no transforms, we are done\n  if (!tlist || tlist.numberOfItems === 0) {\n    // Chrome apparently had a bug that requires clearing the attribute first.\n    selected.setAttribute('transform', '');\n    // However, this still next line currently doesn't work at all in Chrome\n    selected.removeAttribute('transform');\n    // selected.transform.baseVal.clear(); // Didn't help for Chrome bug\n    return null;\n  }\n\n  // TODO: Make this work for more than 2\n  if (tlist) {\n    let mxs = [];\n    let k = tlist.numberOfItems;\n    while (k--) {\n      const xform = tlist.getItem(k);\n      if (xform.type === 1) {\n        mxs.push([xform.matrix, k]);\n      } else if (mxs.length) {\n        mxs = [];\n      }\n    }\n    if (mxs.length === 2) {\n      const mNew = svgroot.createSVGTransformFromMatrix(matrixMultiply(mxs[1][0], mxs[0][0]));\n      tlist.removeItem(mxs[0][1]);\n      tlist.removeItem(mxs[1][1]);\n      tlist.insertItemBefore(mNew, mxs[1][1]);\n    }\n\n    // combine matrix + translate\n    k = tlist.numberOfItems;\n    if (k >= 2 && tlist.getItem(k - 2).type === 1 && tlist.getItem(k - 1).type === 2) {\n      const mt = svgroot.createSVGTransform();\n\n      const m = matrixMultiply(\n        tlist.getItem(k - 2).matrix,\n        tlist.getItem(k - 1).matrix);\n      mt.setMatrix(m);\n      tlist.removeItem(k - 2);\n      tlist.removeItem(k - 2);\n      tlist.appendItem(mt);\n    }\n  }\n\n  // If it still has a single [M] or [R][M], return null too (prevents BatchCommand from being returned).\n  switch (selected.tagName) {\n  // Ignore these elements, as they can absorb the [M]\n  case 'line':\n  case 'polyline':\n  case 'polygon':\n  case 'path':\n    break;\n  default:\n    if ((tlist.numberOfItems === 1 && tlist.getItem(0).type === 1) ||\n        (tlist.numberOfItems === 2 && tlist.getItem(0).type === 1 && tlist.getItem(0).type === 4)) {\n      return null;\n    }\n  }\n\n  // Grouped SVG element\n  const gsvg = $(selected).data('gsvg');\n\n  // we know we have some transforms, so set up return variable\n  const batchCmd = new BatchCommand('Transform');\n\n  // store initial values that will be affected by reducing the transform list\n  let changes = {};\n  let initial = null;\n  let attrs = [];\n  switch (selected.tagName) {\n  case 'line':\n    attrs = ['x1', 'y1', 'x2', 'y2'];\n    break;\n  case 'circle':\n    attrs = ['cx', 'cy', 'r'];\n    break;\n  case 'ellipse':\n    attrs = ['cx', 'cy', 'rx', 'ry'];\n    break;\n  case 'foreignObject':\n  case 'rect':\n  case 'image':\n    attrs = ['width', 'height', 'x', 'y'];\n    break;\n  case 'use':\n  case 'text':\n  case 'tspan':\n    attrs = ['x', 'y'];\n    break;\n  case 'polygon':\n  case 'polyline': {\n    initial = {};\n    initial.points = selected.getAttribute('points');\n    const list = selected.points;\n    const len = list.numberOfItems;\n    changes.points = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      const pt = list.getItem(i);\n      changes.points[i] = {x: pt.x, y: pt.y};\n    }\n    break;\n  } case 'path':\n    initial = {};\n    initial.d = selected.getAttribute('d');\n    changes.d = selected.getAttribute('d');\n    break;\n  } // switch on element type to get initial values\n\n  if (attrs.length) {\n    changes = $(selected).attr(attrs);\n    $.each(changes, function (attr, val) {\n      changes[attr] = convertToNum(attr, val);\n    });\n  } else if (gsvg) {\n    // GSVG exception\n    changes = {\n      x: $(gsvg).attr('x') || 0,\n      y: $(gsvg).attr('y') || 0\n    };\n  }\n\n  // if we haven't created an initial array in polygon/polyline/path, then\n  // make a copy of initial values and include the transform\n  if (initial == null) {\n    initial = $.extend(true, {}, changes);\n    $.each(initial, function (attr, val) {\n      initial[attr] = convertToNum(attr, val);\n    });\n  }\n  // save the start transform value too\n  initial.transform = context_.getStartTransform() || '';\n\n  let oldcenter, newcenter;\n\n  // if it's a regular group, we have special processing to flatten transforms\n  if ((selected.tagName === 'g' && !gsvg) || selected.tagName === 'a') {\n    const box = getBBox(selected);\n\n    oldcenter = {x: box.x + box.width / 2, y: box.y + box.height / 2};\n    newcenter = transformPoint(\n      box.x + box.width / 2,\n      box.y + box.height / 2,\n      transformListToTransform(tlist).matrix\n    );\n    let m = svgroot.createSVGMatrix();\n\n    // temporarily strip off the rotate and save the old center\n    const gangle = getRotationAngle(selected);\n    if (gangle) {\n      const a = gangle * Math.PI / 180;\n      let s;\n      if (Math.abs(a) > (1.0e-10)) {\n        s = Math.sin(a) / (1 - Math.cos(a));\n      } else {\n        // FIXME: This blows up if the angle is exactly 0!\n        s = 2 / a;\n      }\n      for (let i = 0; i < tlist.numberOfItems; ++i) {\n        const xform = tlist.getItem(i);\n        if (xform.type === 4) {\n          // extract old center through mystical arts\n          const rm = xform.matrix;\n          oldcenter.y = (s * rm.e + rm.f) / 2;\n          oldcenter.x = (rm.e - s * rm.f) / 2;\n          tlist.removeItem(i);\n          break;\n        }\n      }\n    }\n    const N = tlist.numberOfItems;\n    let tx = 0, ty = 0, operation = 0;\n\n    let firstM;\n    if (N) {\n      firstM = tlist.getItem(0).matrix;\n    }\n\n    let oldStartTransform;\n    // first, if it was a scale then the second-last transform will be it\n    if (N >= 3 && tlist.getItem(N - 2).type === 3 &&\n      tlist.getItem(N - 3).type === 2 && tlist.getItem(N - 1).type === 2) {\n      operation = 3; // scale\n\n      // if the children are unrotated, pass the scale down directly\n      // otherwise pass the equivalent matrix() down directly\n      const tm = tlist.getItem(N - 3).matrix,\n        sm = tlist.getItem(N - 2).matrix,\n        tmn = tlist.getItem(N - 1).matrix;\n\n      const children = selected.childNodes;\n      let c = children.length;\n      while (c--) {\n        const child = children.item(c);\n        tx = 0;\n        ty = 0;\n        if (child.nodeType === 1) {\n          const childTlist = getTransformList(child);\n\n          // some children might not have a transform (<metadata>, <defs>, etc)\n          if (!childTlist) { continue; }\n\n          const m = transformListToTransform(childTlist).matrix;\n\n          // Convert a matrix to a scale if applicable\n          // if (hasMatrixTransform(childTlist) && childTlist.numberOfItems == 1) {\n          //   if (m.b==0 && m.c==0 && m.e==0 && m.f==0) {\n          //     childTlist.removeItem(0);\n          //     const translateOrigin = svgroot.createSVGTransform(),\n          //       scale = svgroot.createSVGTransform(),\n          //       translateBack = svgroot.createSVGTransform();\n          //     translateOrigin.setTranslate(0, 0);\n          //     scale.setScale(m.a, m.d);\n          //     translateBack.setTranslate(0, 0);\n          //     childTlist.appendItem(translateBack);\n          //     childTlist.appendItem(scale);\n          //     childTlist.appendItem(translateOrigin);\n          //   }\n          // }\n\n          const angle = getRotationAngle(child);\n          oldStartTransform = context_.getStartTransform();\n          const childxforms = [];\n          context_.setStartTransform(child.getAttribute('transform'));\n          if (angle || hasMatrixTransform(childTlist)) {\n            const e2t = svgroot.createSVGTransform();\n            e2t.setMatrix(matrixMultiply(tm, sm, tmn, m));\n            childTlist.clear();\n            childTlist.appendItem(e2t);\n            childxforms.push(e2t);\n          // if not rotated or skewed, push the [T][S][-T] down to the child\n          } else {\n            // update the transform list with translate,scale,translate\n\n            // slide the [T][S][-T] from the front to the back\n            // [T][S][-T][M] = [M][T2][S2][-T2]\n\n            // (only bringing [-T] to the right of [M])\n            // [T][S][-T][M] = [T][S][M][-T2]\n            // [-T2] = [M_inv][-T][M]\n            const t2n = matrixMultiply(m.inverse(), tmn, m);\n            // [T2] is always negative translation of [-T2]\n            const t2 = svgroot.createSVGMatrix();\n            t2.e = -t2n.e;\n            t2.f = -t2n.f;\n\n            // [T][S][-T][M] = [M][T2][S2][-T2]\n            // [S2] = [T2_inv][M_inv][T][S][-T][M][-T2_inv]\n            const s2 = matrixMultiply(t2.inverse(), m.inverse(), tm, sm, tmn, m, t2n.inverse());\n\n            const translateOrigin = svgroot.createSVGTransform(),\n              scale = svgroot.createSVGTransform(),\n              translateBack = svgroot.createSVGTransform();\n            translateOrigin.setTranslate(t2n.e, t2n.f);\n            scale.setScale(s2.a, s2.d);\n            translateBack.setTranslate(t2.e, t2.f);\n            childTlist.appendItem(translateBack);\n            childTlist.appendItem(scale);\n            childTlist.appendItem(translateOrigin);\n            childxforms.push(translateBack);\n            childxforms.push(scale);\n            childxforms.push(translateOrigin);\n            // logMatrix(translateBack.matrix);\n            // logMatrix(scale.matrix);\n          } // not rotated\n          batchCmd.addSubCommand(recalculateDimensions(child));\n          // TODO: If any <use> have this group as a parent and are\n          // referencing this child, then we need to impose a reverse\n          // scale on it so that when it won't get double-translated\n          // const uses = selected.getElementsByTagNameNS(NS.SVG, 'use');\n          // const href = '#' + child.id;\n          // let u = uses.length;\n          // while (u--) {\n          //   const useElem = uses.item(u);\n          //   if (href == getHref(useElem)) {\n          //     const usexlate = svgroot.createSVGTransform();\n          //     usexlate.setTranslate(-tx,-ty);\n          //     getTransformList(useElem).insertItemBefore(usexlate,0);\n          //     batchCmd.addSubCommand( recalculateDimensions(useElem) );\n          //   }\n          // }\n          context_.setStartTransform(oldStartTransform);\n        } // element\n      } // for each child\n      // Remove these transforms from group\n      tlist.removeItem(N - 1);\n      tlist.removeItem(N - 2);\n      tlist.removeItem(N - 3);\n    } else if (N >= 3 && tlist.getItem(N - 1).type === 1) {\n      operation = 3; // scale\n      m = transformListToTransform(tlist).matrix;\n      const e2t = svgroot.createSVGTransform();\n      e2t.setMatrix(m);\n      tlist.clear();\n      tlist.appendItem(e2t);\n    // next, check if the first transform was a translate\n    // if we had [ T1 ] [ M ] we want to transform this into [ M ] [ T2 ]\n    // therefore [ T2 ] = [ M_inv ] [ T1 ] [ M ]\n    } else if ((N === 1 || (N > 1 && tlist.getItem(1).type !== 3)) &&\n      tlist.getItem(0).type === 2) {\n      operation = 2; // translate\n      const T_M = transformListToTransform(tlist).matrix;\n      tlist.removeItem(0);\n      const mInv = transformListToTransform(tlist).matrix.inverse();\n      const M2 = matrixMultiply(mInv, T_M);\n\n      tx = M2.e;\n      ty = M2.f;\n\n      if (tx !== 0 || ty !== 0) {\n        // we pass the translates down to the individual children\n        const children = selected.childNodes;\n        let c = children.length;\n\n        let clipPathsDone = [];\n\n        while (c--) {\n          const child = children.item(c);\n          if (child.nodeType === 1) {\n            // Check if child has clip-path\n            if (child.getAttribute('clip-path')) {\n              // tx, ty\n              const attr = child.getAttribute('clip-path');\n              if (!clipPathsDone.includes(attr)) {\n                updateClipPath(attr, tx, ty);\n                clipPathsDone.push(attr);\n              }\n            }\n\n            oldStartTransform = context_.getStartTransform();\n            context_.setStartTransform(child.getAttribute('transform'));\n\n            const childTlist = getTransformList(child);\n            // some children might not have a transform (<metadata>, <defs>, etc)\n            if (childTlist) {\n              const newxlate = svgroot.createSVGTransform();\n              newxlate.setTranslate(tx, ty);\n              if (childTlist.numberOfItems) {\n                childTlist.insertItemBefore(newxlate, 0);\n              } else {\n                childTlist.appendItem(newxlate);\n              }\n              batchCmd.addSubCommand(recalculateDimensions(child));\n              // If any <use> have this group as a parent and are\n              // referencing this child, then impose a reverse translate on it\n              // so that when it won't get double-translated\n              const uses = selected.getElementsByTagNameNS(NS.SVG, 'use');\n              const href = '#' + child.id;\n              let u = uses.length;\n              while (u--) {\n                const useElem = uses.item(u);\n                if (href === getHref(useElem)) {\n                  const usexlate = svgroot.createSVGTransform();\n                  usexlate.setTranslate(-tx, -ty);\n                  getTransformList(useElem).insertItemBefore(usexlate, 0);\n                  batchCmd.addSubCommand(recalculateDimensions(useElem));\n                }\n              }\n              context_.setStartTransform(oldStartTransform);\n            }\n          }\n        }\n\n        clipPathsDone = [];\n        context_.setStartTransform(oldStartTransform);\n      }\n    // else, a matrix imposition from a parent group\n    // keep pushing it down to the children\n    } else if (N === 1 && tlist.getItem(0).type === 1 && !gangle) {\n      operation = 1;\n      const m = tlist.getItem(0).matrix,\n        children = selected.childNodes;\n      let c = children.length;\n      while (c--) {\n        const child = children.item(c);\n        if (child.nodeType === 1) {\n          oldStartTransform = context_.getStartTransform();\n          context_.setStartTransform(child.getAttribute('transform'));\n          const childTlist = getTransformList(child);\n\n          if (!childTlist) { continue; }\n\n          const em = matrixMultiply(m, transformListToTransform(childTlist).matrix);\n          const e2m = svgroot.createSVGTransform();\n          e2m.setMatrix(em);\n          childTlist.clear();\n          childTlist.appendItem(e2m, 0);\n\n          batchCmd.addSubCommand(recalculateDimensions(child));\n          context_.setStartTransform(oldStartTransform);\n\n          // Convert stroke\n          // TODO: Find out if this should actually happen somewhere else\n          const sw = child.getAttribute('stroke-width');\n          if (child.getAttribute('stroke') !== 'none' && !isNaN(sw)) {\n            const avg = (Math.abs(em.a) + Math.abs(em.d)) / 2;\n            child.setAttribute('stroke-width', sw * avg);\n          }\n        }\n      }\n      tlist.clear();\n    // else it was just a rotate\n    } else {\n      if (gangle) {\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(gangle, newcenter.x, newcenter.y);\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n      if (tlist.numberOfItems === 0) {\n        selected.removeAttribute('transform');\n      }\n      return null;\n    }\n\n    // if it was a translate, put back the rotate at the new center\n    if (operation === 2) {\n      if (gangle) {\n        newcenter = {\n          x: oldcenter.x + firstM.e,\n          y: oldcenter.y + firstM.f\n        };\n\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(gangle, newcenter.x, newcenter.y);\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n    // if it was a resize\n    } else if (operation === 3) {\n      const m = transformListToTransform(tlist).matrix;\n      const roldt = svgroot.createSVGTransform();\n      roldt.setRotate(gangle, oldcenter.x, oldcenter.y);\n      const rold = roldt.matrix;\n      const rnew = svgroot.createSVGTransform();\n      rnew.setRotate(gangle, newcenter.x, newcenter.y);\n      const rnewInv = rnew.matrix.inverse(),\n        mInv = m.inverse(),\n        extrat = matrixMultiply(mInv, rnewInv, rold, m);\n\n      tx = extrat.e;\n      ty = extrat.f;\n\n      if (tx !== 0 || ty !== 0) {\n        // now push this transform down to the children\n        // we pass the translates down to the individual children\n        const children = selected.childNodes;\n        let c = children.length;\n        while (c--) {\n          const child = children.item(c);\n          if (child.nodeType === 1) {\n            oldStartTransform = context_.getStartTransform();\n            context_.setStartTransform(child.getAttribute('transform'));\n            const childTlist = getTransformList(child);\n            const newxlate = svgroot.createSVGTransform();\n            newxlate.setTranslate(tx, ty);\n            if (childTlist.numberOfItems) {\n              childTlist.insertItemBefore(newxlate, 0);\n            } else {\n              childTlist.appendItem(newxlate);\n            }\n\n            batchCmd.addSubCommand(recalculateDimensions(child));\n            context_.setStartTransform(oldStartTransform);\n          }\n        }\n      }\n\n      if (gangle) {\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(rnew, 0);\n        } else {\n          tlist.appendItem(rnew);\n        }\n      }\n    }\n  // else, it's a non-group\n  } else {\n    // FIXME: box might be null for some elements (<metadata> etc), need to handle this\n    const box = getBBox(selected);\n\n    // Paths (and possbly other shapes) will have no BBox while still in <defs>,\n    // but we still may need to recalculate them (see issue 595).\n    // TODO: Figure out how to get BBox from these elements in case they\n    // have a rotation transform\n\n    if (!box && selected.tagName !== 'path') return null;\n\n    let m = svgroot.createSVGMatrix();\n    // temporarily strip off the rotate and save the old center\n    const angle = getRotationAngle(selected);\n    if (angle) {\n      oldcenter = {x: box.x + box.width / 2, y: box.y + box.height / 2};\n      newcenter = transformPoint(\n        box.x + box.width / 2,\n        box.y + box.height / 2,\n        transformListToTransform(tlist).matrix\n      );\n\n      const a = angle * Math.PI / 180;\n      const s = (Math.abs(a) > (1.0e-10))\n        ? Math.sin(a) / (1 - Math.cos(a))\n        // FIXME: This blows up if the angle is exactly 0!\n        : 2 / a;\n\n      for (let i = 0; i < tlist.numberOfItems; ++i) {\n        const xform = tlist.getItem(i);\n        if (xform.type === 4) {\n          // extract old center through mystical arts\n          const rm = xform.matrix;\n          oldcenter.y = (s * rm.e + rm.f) / 2;\n          oldcenter.x = (rm.e - s * rm.f) / 2;\n          tlist.removeItem(i);\n          break;\n        }\n      }\n    }\n\n    // 2 = translate, 3 = scale, 4 = rotate, 1 = matrix imposition\n    let operation = 0;\n    const N = tlist.numberOfItems;\n\n    // Check if it has a gradient with userSpaceOnUse, in which case\n    // adjust it by recalculating the matrix transform.\n    // TODO: Make this work in Webkit using svgedit.transformlist.SVGTransformList\n    if (!isWebkit()) {\n      const fill = selected.getAttribute('fill');\n      if (fill && fill.startsWith('url(')) {\n        const paint = getRefElem(fill);\n        let type = 'pattern';\n        if (paint.tagName !== type) type = 'gradient';\n        const attrVal = paint.getAttribute(type + 'Units');\n        if (attrVal === 'userSpaceOnUse') {\n          // Update the userSpaceOnUse element\n          m = transformListToTransform(tlist).matrix;\n          const gtlist = getTransformList(paint);\n          const gmatrix = transformListToTransform(gtlist).matrix;\n          m = matrixMultiply(m, gmatrix);\n          const mStr = 'matrix(' + [m.a, m.b, m.c, m.d, m.e, m.f].join(',') + ')';\n          paint.setAttribute(type + 'Transform', mStr);\n        }\n      }\n    }\n\n    // first, if it was a scale of a non-skewed element, then the second-last\n    // transform will be the [S]\n    // if we had [M][T][S][T] we want to extract the matrix equivalent of\n    // [T][S][T] and push it down to the element\n    if (N >= 3 && tlist.getItem(N - 2).type === 3 &&\n      tlist.getItem(N - 3).type === 2 && tlist.getItem(N - 1).type === 2) {\n      // Removed this so a <use> with a given [T][S][T] would convert to a matrix.\n      // Is that bad?\n      //  && selected.nodeName != 'use'\n      operation = 3; // scale\n      m = transformListToTransform(tlist, N - 3, N - 1).matrix;\n      tlist.removeItem(N - 1);\n      tlist.removeItem(N - 2);\n      tlist.removeItem(N - 3);\n    // if we had [T][S][-T][M], then this was a skewed element being resized\n    // Thus, we simply combine it all into one matrix\n    } else if (N === 4 && tlist.getItem(N - 1).type === 1) {\n      operation = 3; // scale\n      m = transformListToTransform(tlist).matrix;\n      const e2t = svgroot.createSVGTransform();\n      e2t.setMatrix(m);\n      tlist.clear();\n      tlist.appendItem(e2t);\n      // reset the matrix so that the element is not re-mapped\n      m = svgroot.createSVGMatrix();\n    // if we had [R][T][S][-T][M], then this was a rotated matrix-element\n    // if we had [T1][M] we want to transform this into [M][T2]\n    // therefore [ T2 ] = [ M_inv ] [ T1 ] [ M ] and we can push [T2]\n    // down to the element\n    } else if ((N === 1 || (N > 1 && tlist.getItem(1).type !== 3)) &&\n      tlist.getItem(0).type === 2) {\n      operation = 2; // translate\n      const oldxlate = tlist.getItem(0).matrix,\n        meq = transformListToTransform(tlist, 1).matrix,\n        meqInv = meq.inverse();\n      m = matrixMultiply(meqInv, oldxlate, meq);\n      tlist.removeItem(0);\n    // else if this child now has a matrix imposition (from a parent group)\n    // we might be able to simplify\n    } else if (N === 1 && tlist.getItem(0).type === 1 && !angle) {\n      // Remap all point-based elements\n      m = transformListToTransform(tlist).matrix;\n      switch (selected.tagName) {\n      case 'line':\n        changes = $(selected).attr(['x1', 'y1', 'x2', 'y2']);\n        // Fallthrough\n      case 'polyline':\n      case 'polygon':\n        changes.points = selected.getAttribute('points');\n        if (changes.points) {\n          const list = selected.points;\n          const len = list.numberOfItems;\n          changes.points = new Array(len);\n          for (let i = 0; i < len; ++i) {\n            const pt = list.getItem(i);\n            changes.points[i] = {x: pt.x, y: pt.y};\n          }\n        }\n        // Fallthrough\n      case 'path':\n        changes.d = selected.getAttribute('d');\n        operation = 1;\n        tlist.clear();\n        break;\n      default:\n        break;\n      }\n    // if it was a rotation, put the rotate back and return without a command\n    // (this function has zero work to do for a rotate())\n    } else {\n      operation = 4; // rotation\n      if (angle) {\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(angle, newcenter.x, newcenter.y);\n\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n      if (tlist.numberOfItems === 0) {\n        selected.removeAttribute('transform');\n      }\n      return null;\n    }\n\n    // if it was a translate or resize, we need to remap the element and absorb the xform\n    if (operation === 1 || operation === 2 || operation === 3) {\n      remapElement(selected, changes, m);\n    } // if we are remapping\n\n    // if it was a translate, put back the rotate at the new center\n    if (operation === 2) {\n      if (angle) {\n        if (!hasMatrixTransform(tlist)) {\n          newcenter = {\n            x: oldcenter.x + m.e,\n            y: oldcenter.y + m.f\n          };\n        }\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(angle, newcenter.x, newcenter.y);\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n      // We have special processing for tspans:  Tspans are not transformable\n      // but they can have x,y coordinates (sigh).  Thus, if this was a translate,\n      // on a text element, also translate any tspan children.\n      if (selected.tagName === 'text') {\n        const children = selected.childNodes;\n        let c = children.length;\n        while (c--) {\n          const child = children.item(c);\n          if (child.tagName === 'tspan') {\n            const tspanChanges = {\n              x: $(child).attr('x') || 0,\n              y: $(child).attr('y') || 0\n            };\n            remapElement(child, tspanChanges, m);\n          }\n        }\n      }\n    // [Rold][M][T][S][-T] became [Rold][M]\n    // we want it to be [Rnew][M][Tr] where Tr is the\n    // translation required to re-center it\n    // Therefore, [Tr] = [M_inv][Rnew_inv][Rold][M]\n    } else if (operation === 3 && angle) {\n      const m = transformListToTransform(tlist).matrix;\n      const roldt = svgroot.createSVGTransform();\n      roldt.setRotate(angle, oldcenter.x, oldcenter.y);\n      const rold = roldt.matrix;\n      const rnew = svgroot.createSVGTransform();\n      rnew.setRotate(angle, newcenter.x, newcenter.y);\n      const rnewInv = rnew.matrix.inverse();\n      const mInv = m.inverse();\n      const extrat = matrixMultiply(mInv, rnewInv, rold, m);\n\n      remapElement(selected, changes, extrat);\n      if (angle) {\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(rnew, 0);\n        } else {\n          tlist.appendItem(rnew);\n        }\n      }\n    }\n  } // a non-group\n\n  // if the transform list has been emptied, remove it\n  if (tlist.numberOfItems === 0) {\n    selected.removeAttribute('transform');\n  }\n\n  batchCmd.addSubCommand(new ChangeElementCommand(selected, initial));\n\n  return batchCmd;\n};\n","/* globals jQuery */\n/**\n * Package: svedit.select\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Jeff Schiller\n */\n\nimport {isTouch, isWebkit} from './browser.js'; // , isOpera\nimport {getRotationAngle, getBBox, getStrokedBBox} from './svgutils.js';\nimport {transformListToTransform, transformBox, transformPoint} from './math.js';\nimport {getTransformList} from './svgtransformlist.js';\n\nconst $ = jQuery;\n\nlet svgFactory_;\nlet config_;\nlet selectorManager_; // A Singleton\nconst gripRadius = isTouch() ? 10 : 4;\n\n/**\n* Private class for DOM element selection boxes\n* @param id - integer to internally indentify the selector\n* @param elem - DOM element associated with this selector\n* @param bbox - Optional bbox to use for initialization (prevents duplicate getBBox call).\n*/\nexport class Selector {\n  constructor (id, elem, bbox) {\n    // this is the selector's unique number\n    this.id = id;\n\n    // this holds a reference to the element for which this selector is being used\n    this.selectedElement = elem;\n\n    // this is a flag used internally to track whether the selector is being used or not\n    this.locked = true;\n\n    // this holds a reference to the <g> element that holds all visual elements of the selector\n    this.selectorGroup = svgFactory_.createSVGElement({\n      element: 'g',\n      attr: {id: ('selectorGroup' + this.id)}\n    });\n\n    // this holds a reference to the path rect\n    this.selectorRect = this.selectorGroup.appendChild(\n      svgFactory_.createSVGElement({\n        element: 'path',\n        attr: {\n          id: ('selectedBox' + this.id),\n          fill: 'none',\n          stroke: '#22C',\n          'stroke-width': '1',\n          'stroke-dasharray': '5,5',\n          // need to specify this so that the rect is not selectable\n          style: 'pointer-events:none'\n        }\n      })\n    );\n\n    // this holds a reference to the grip coordinates for this selector\n    this.gripCoords = {\n      nw: null,\n      n: null,\n      ne: null,\n      e: null,\n      se: null,\n      s: null,\n      sw: null,\n      w: null\n    };\n\n    this.reset(this.selectedElement, bbox);\n  }\n\n  /**\n  * Used to reset the id and element that the selector is attached to\n  * @param e - DOM element associated with this selector\n  * @param bbox - Optional bbox to use for reset (prevents duplicate getBBox call).\n  */\n  reset (e, bbox) {\n    this.locked = true;\n    this.selectedElement = e;\n    this.resize(bbox);\n    this.selectorGroup.setAttribute('display', 'inline');\n  }\n\n  /**\n  * Updates cursors for corner grips on rotation so arrows point the right way\n  * @param {Number} angle - Float indicating current rotation angle in degrees\n  */\n  updateGripCursors (angle) {\n    let dir;\n    const dirArr = [];\n    let steps = Math.round(angle / 45);\n    if (steps < 0) { steps += 8; }\n    for (dir in selectorManager_.selectorGrips) {\n      dirArr.push(dir);\n    }\n    while (steps > 0) {\n      dirArr.push(dirArr.shift());\n      steps--;\n    }\n    let i = 0;\n    for (dir in selectorManager_.selectorGrips) {\n      selectorManager_.selectorGrips[dir].setAttribute('style', ('cursor:' + dirArr[i] + '-resize'));\n      i++;\n    }\n  }\n\n  /**\n  * Show the resize grips of this selector\n  *\n  * @param {Boolean} show - Indicates whether grips should be shown or not\n  */\n  showGrips (show) {\n    const bShow = show ? 'inline' : 'none';\n    selectorManager_.selectorGripsGroup.setAttribute('display', bShow);\n    const elem = this.selectedElement;\n    this.hasGrips = show;\n    if (elem && show) {\n      this.selectorGroup.append(selectorManager_.selectorGripsGroup);\n      this.updateGripCursors(getRotationAngle(elem));\n    }\n  }\n\n  /**\n  * Updates the selector to match the element's size\n  * @param bbox - Optional bbox to use for resize (prevents duplicate getBBox call).\n  */\n  resize (bbox) {\n    const selectedBox = this.selectorRect,\n      mgr = selectorManager_,\n      selectedGrips = mgr.selectorGrips,\n      selected = this.selectedElement,\n      sw = selected.getAttribute('stroke-width'),\n      currentZoom = svgFactory_.getCurrentZoom();\n    let offset = 1 / currentZoom;\n    if (selected.getAttribute('stroke') !== 'none' && !isNaN(sw)) {\n      offset += (sw / 2);\n    }\n\n    const {tagName} = selected;\n    if (tagName === 'text') {\n      offset += 2 / currentZoom;\n    }\n\n    // loop and transform our bounding box until we reach our first rotation\n    const tlist = getTransformList(selected);\n    const m = transformListToTransform(tlist).matrix;\n\n    // This should probably be handled somewhere else, but for now\n    // it keeps the selection box correctly positioned when zoomed\n    m.e *= currentZoom;\n    m.f *= currentZoom;\n\n    if (!bbox) {\n      bbox = getBBox(selected);\n    }\n    // TODO: getBBox (previous line) already knows to call getStrokedBBox when tagName === 'g'. Remove this?\n    // TODO: getBBox doesn't exclude 'gsvg' and calls getStrokedBBox for any 'g'. Should getBBox be updated?\n    if (tagName === 'g' && !$.data(selected, 'gsvg')) {\n      // The bbox for a group does not include stroke vals, so we\n      // get the bbox based on its children.\n      const strokedBbox = getStrokedBBox([selected.childNodes]);\n      if (strokedBbox) {\n        bbox = strokedBbox;\n      }\n    }\n\n    // apply the transforms\n    const l = bbox.x, t = bbox.y, w = bbox.width, h = bbox.height;\n    bbox = {x: l, y: t, width: w, height: h};\n\n    // we need to handle temporary transforms too\n    // if skewed, get its transformed box, then find its axis-aligned bbox\n\n    // *\n    offset *= currentZoom;\n\n    const nbox = transformBox(l * currentZoom, t * currentZoom, w * currentZoom, h * currentZoom, m),\n      {aabox} = nbox;\n    let nbax = aabox.x - offset,\n      nbay = aabox.y - offset,\n      nbaw = aabox.width + (offset * 2),\n      nbah = aabox.height + (offset * 2);\n\n    // now if the shape is rotated, un-rotate it\n    const cx = nbax + nbaw / 2,\n      cy = nbay + nbah / 2;\n\n    const angle = getRotationAngle(selected);\n    if (angle) {\n      const rot = svgFactory_.svgRoot().createSVGTransform();\n      rot.setRotate(-angle, cx, cy);\n      const rotm = rot.matrix;\n      nbox.tl = transformPoint(nbox.tl.x, nbox.tl.y, rotm);\n      nbox.tr = transformPoint(nbox.tr.x, nbox.tr.y, rotm);\n      nbox.bl = transformPoint(nbox.bl.x, nbox.bl.y, rotm);\n      nbox.br = transformPoint(nbox.br.x, nbox.br.y, rotm);\n\n      // calculate the axis-aligned bbox\n      const {tl} = nbox;\n      let minx = tl.x,\n        miny = tl.y,\n        maxx = tl.x,\n        maxy = tl.y;\n\n      const {min, max} = Math;\n\n      minx = min(minx, min(nbox.tr.x, min(nbox.bl.x, nbox.br.x))) - offset;\n      miny = min(miny, min(nbox.tr.y, min(nbox.bl.y, nbox.br.y))) - offset;\n      maxx = max(maxx, max(nbox.tr.x, max(nbox.bl.x, nbox.br.x))) + offset;\n      maxy = max(maxy, max(nbox.tr.y, max(nbox.bl.y, nbox.br.y))) + offset;\n\n      nbax = minx;\n      nbay = miny;\n      nbaw = (maxx - minx);\n      nbah = (maxy - miny);\n    }\n\n    const dstr = 'M' + nbax + ',' + nbay +\n      ' L' + (nbax + nbaw) + ',' + nbay +\n      ' ' + (nbax + nbaw) + ',' + (nbay + nbah) +\n      ' ' + nbax + ',' + (nbay + nbah) + 'z';\n    selectedBox.setAttribute('d', dstr);\n\n    const xform = angle ? 'rotate(' + [angle, cx, cy].join(',') + ')' : '';\n    this.selectorGroup.setAttribute('transform', xform);\n\n    // TODO(codedread): Is this needed?\n    //  if (selected === selectedElements[0]) {\n    this.gripCoords = {\n      nw: [nbax, nbay],\n      ne: [nbax + nbaw, nbay],\n      sw: [nbax, nbay + nbah],\n      se: [nbax + nbaw, nbay + nbah],\n      n: [nbax + (nbaw) / 2, nbay],\n      w: [nbax, nbay + (nbah) / 2],\n      e: [nbax + nbaw, nbay + (nbah) / 2],\n      s: [nbax + (nbaw) / 2, nbay + nbah]\n    };\n    for (const dir in this.gripCoords) {\n      const coords = this.gripCoords[dir];\n      selectedGrips[dir].setAttribute('cx', coords[0]);\n      selectedGrips[dir].setAttribute('cy', coords[1]);\n    }\n\n    // we want to go 20 pixels in the negative transformed y direction, ignoring scale\n    mgr.rotateGripConnector.setAttribute('x1', nbax + (nbaw) / 2);\n    mgr.rotateGripConnector.setAttribute('y1', nbay);\n    mgr.rotateGripConnector.setAttribute('x2', nbax + (nbaw) / 2);\n    mgr.rotateGripConnector.setAttribute('y2', nbay - (gripRadius * 5));\n\n    mgr.rotateGrip.setAttribute('cx', nbax + (nbaw) / 2);\n    mgr.rotateGrip.setAttribute('cy', nbay - (gripRadius * 5));\n    // }\n  }\n}\n\n/**\n*\n*/\nexport class SelectorManager {\n  constructor () {\n    // this will hold the <g> element that contains all selector rects/grips\n    this.selectorParentGroup = null;\n\n    // this is a special rect that is used for multi-select\n    this.rubberBandBox = null;\n\n    // this will hold objects of type Selector (see above)\n    this.selectors = [];\n\n    // this holds a map of SVG elements to their Selector object\n    this.selectorMap = {};\n\n    // this holds a reference to the grip elements\n    this.selectorGrips = {\n      nw: null,\n      n: null,\n      ne: null,\n      e: null,\n      se: null,\n      s: null,\n      sw: null,\n      w: null\n    };\n\n    this.selectorGripsGroup = null;\n    this.rotateGripConnector = null;\n    this.rotateGrip = null;\n\n    this.initGroup();\n  }\n\n  /**\n  * Resets the parent selector group element\n  */\n  initGroup () {\n    // remove old selector parent group if it existed\n    if (this.selectorParentGroup && this.selectorParentGroup.parentNode) {\n      this.selectorParentGroup.remove();\n    }\n\n    // create parent selector group and add it to svgroot\n    this.selectorParentGroup = svgFactory_.createSVGElement({\n      element: 'g',\n      attr: {id: 'selectorParentGroup'}\n    });\n    this.selectorGripsGroup = svgFactory_.createSVGElement({\n      element: 'g',\n      attr: {display: 'none'}\n    });\n    this.selectorParentGroup.append(this.selectorGripsGroup);\n    svgFactory_.svgRoot().append(this.selectorParentGroup);\n\n    this.selectorMap = {};\n    this.selectors = [];\n    this.rubberBandBox = null;\n\n    // add the corner grips\n    for (const dir in this.selectorGrips) {\n      const grip = svgFactory_.createSVGElement({\n        element: 'circle',\n        attr: {\n          id: ('selectorGrip_resize_' + dir),\n          fill: '#22C',\n          r: gripRadius,\n          style: ('cursor:' + dir + '-resize'),\n          // This expands the mouse-able area of the grips making them\n          // easier to grab with the mouse.\n          // This works in Opera and WebKit, but does not work in Firefox\n          // see https://bugzilla.mozilla.org/show_bug.cgi?id=500174\n          'stroke-width': 2,\n          'pointer-events': 'all'\n        }\n      });\n\n      $.data(grip, 'dir', dir);\n      $.data(grip, 'type', 'resize');\n      this.selectorGrips[dir] = this.selectorGripsGroup.appendChild(grip);\n    }\n\n    // add rotator elems\n    this.rotateGripConnector = this.selectorGripsGroup.appendChild(\n      svgFactory_.createSVGElement({\n        element: 'line',\n        attr: {\n          id: ('selectorGrip_rotateconnector'),\n          stroke: '#22C',\n          'stroke-width': '1'\n        }\n      })\n    );\n\n    this.rotateGrip = this.selectorGripsGroup.appendChild(\n      svgFactory_.createSVGElement({\n        element: 'circle',\n        attr: {\n          id: 'selectorGrip_rotate',\n          fill: 'lime',\n          r: gripRadius,\n          stroke: '#22C',\n          'stroke-width': 2,\n          style: 'cursor:url(' + config_.imgPath + 'rotate.png) 12 12, auto;'\n        }\n      })\n    );\n    $.data(this.rotateGrip, 'type', 'rotate');\n\n    if ($('#canvasBackground').length) { return; }\n\n    const dims = config_.dimensions;\n    const canvasbg = svgFactory_.createSVGElement({\n      element: 'svg',\n      attr: {\n        id: 'canvasBackground',\n        width: dims[0],\n        height: dims[1],\n        x: 0,\n        y: 0,\n        overflow: (isWebkit() ? 'none' : 'visible'), // Chrome 7 has a problem with this when zooming out\n        style: 'pointer-events:none'\n      }\n    });\n\n    const rect = svgFactory_.createSVGElement({\n      element: 'rect',\n      attr: {\n        width: '100%',\n        height: '100%',\n        x: 0,\n        y: 0,\n        'stroke-width': 1,\n        stroke: '#000',\n        fill: '#FFF',\n        style: 'pointer-events:none'\n      }\n    });\n\n    // Both Firefox and WebKit are too slow with this filter region (especially at higher\n    // zoom levels) and Opera has at least one bug\n    // if (!isOpera()) rect.setAttribute('filter', 'url(#canvashadow)');\n    canvasbg.append(rect);\n    svgFactory_.svgRoot().insertBefore(canvasbg, svgFactory_.svgContent());\n    // Ok to replace above with `svgFactory_.svgContent().before(canvasbg);`?\n  }\n\n  /**\n  *\n  * @param elem - DOM element to get the selector for\n  * @param [bbox] - Optional bbox to use for reset (prevents duplicate getBBox call).\n  * @returns The selector based on the given element\n  */\n  requestSelector (elem, bbox) {\n    if (elem == null) { return null; }\n\n    const N = this.selectors.length;\n    // If we've already acquired one for this element, return it.\n    if (typeof this.selectorMap[elem.id] === 'object') {\n      this.selectorMap[elem.id].locked = true;\n      return this.selectorMap[elem.id];\n    }\n    for (let i = 0; i < N; ++i) {\n      if (this.selectors[i] && !this.selectors[i].locked) {\n        this.selectors[i].locked = true;\n        this.selectors[i].reset(elem, bbox);\n        this.selectorMap[elem.id] = this.selectors[i];\n        return this.selectors[i];\n      }\n    }\n    // if we reached here, no available selectors were found, we create one\n    this.selectors[N] = new Selector(N, elem, bbox);\n    this.selectorParentGroup.append(this.selectors[N].selectorGroup);\n    this.selectorMap[elem.id] = this.selectors[N];\n    return this.selectors[N];\n  }\n\n  /**\n  * Removes the selector of the given element (hides selection box)\n  *\n  * @param elem - DOM element to remove the selector for\n  */\n  releaseSelector (elem) {\n    if (elem == null) { return; }\n    const N = this.selectors.length,\n      sel = this.selectorMap[elem.id];\n    if (!sel.locked) {\n      // TODO(codedread): Ensure this exists in this module.\n      console.log('WARNING! selector was released but was already unlocked');\n    }\n    for (let i = 0; i < N; ++i) {\n      if (this.selectors[i] && this.selectors[i] === sel) {\n        delete this.selectorMap[elem.id];\n        sel.locked = false;\n        sel.selectedElement = null;\n        sel.showGrips(false);\n\n        // remove from DOM and store reference in JS but only if it exists in the DOM\n        try {\n          sel.selectorGroup.setAttribute('display', 'none');\n        } catch (e) {}\n\n        break;\n      }\n    }\n  }\n\n  /**\n  * @returns The rubberBandBox DOM element. This is the rectangle drawn by\n  * the user for selecting/zooming\n  */\n  getRubberBandBox () {\n    if (!this.rubberBandBox) {\n      this.rubberBandBox = this.selectorParentGroup.appendChild(\n        svgFactory_.createSVGElement({\n          element: 'rect',\n          attr: {\n            id: 'selectorRubberBand',\n            fill: '#22C',\n            'fill-opacity': 0.15,\n            stroke: '#22C',\n            'stroke-width': 0.5,\n            display: 'none',\n            style: 'pointer-events:none'\n          }\n        })\n      );\n    }\n    return this.rubberBandBox;\n  }\n}\n\n/**\n * An object that creates SVG elements for the canvas.\n *\n * interface svgedit.select.SVGFactory {\n *   SVGElement createSVGElement(jsonMap);\n *   SVGSVGElement svgRoot();\n *   SVGSVGElement svgContent();\n *\n *   Number currentZoom();\n * }\n */\n\n/**\n * Initializes this module.\n *\n * @param config - An object containing configurable parameters (imgPath)\n * @param svgFactory - An object implementing the SVGFactory interface (see above).\n */\nexport const init = function (config, svgFactory) {\n  config_ = config;\n  svgFactory_ = svgFactory;\n  selectorManager_ = new SelectorManager();\n};\n\n/**\n *\n * @returns The SelectorManager instance.\n */\nexport const getSelectorManager = () => selectorManager_;\n","/* eslint-disable indent */\n/* globals jQuery, jsPDF */\n/*\n * svgcanvas.js\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Pavol Rusnak\n * Copyright(c) 2010 Jeff Schiller\n *\n */\n\n/* Dependencies:\n1. Also expects jQuery UI for `svgCanvasToString` and\n`convertToGroup` use of `:data()` selector\n*/\n\n// Todo: Obtain/adapt latest jsPDF to utilize ES Module for `jsPDF`/avoid global\n\nimport './pathseg.js';\nimport jqPluginSVG from './jquery-svg.js'; // Needed for SVG attribute setting and array form with `attr`\n\nimport * as draw from './draw.js';\nimport * as pathModule from './path.js';\nimport {sanitizeSvg} from './sanitize.js';\nimport {getReverseNS, NS} from './svgedit.js';\nimport {importSetGlobal, importScript} from './external/dynamic-import-polyfill/importModule.js';\nimport {\n  text2xml, assignAttributes, cleanupElement, getElem, getUrlFromAttr,\n  findDefs, getHref, setHref, getRefElem, getRotationAngle, getPathBBox,\n  preventClickDefault, snapToGrid, walkTree, walkTreePost,\n  getBBoxOfElementAsPath, convertToPath, toXml, encode64, decode64,\n  dataURLToObjectURL, createObjectURL,\n  getVisibleElements,\n  init as utilsInit, getBBox as utilsGetBBox, getStrokedBBoxDefaultVisible\n} from './svgutils.js';\nimport * as history from './history.js';\nimport {\n  transformPoint, matrixMultiply, hasMatrixTransform, transformListToTransform,\n  getMatrix, snapToAngle, isIdentity, rectsIntersect, transformBox\n} from './math.js';\nimport {\n  convertToNum, convertAttrs, convertUnit, shortFloat, getTypeMap,\n  init as unitsInit\n} from './units.js';\nimport {\n  isGecko, isChrome, isIE, isWebkit, supportsNonScalingStroke, supportsGoodTextCharPos\n} from './browser.js'; // , supportsEditableText\nimport {\n  getTransformList, resetListMap,\n  SVGTransformList as SVGEditTransformList\n} from './svgtransformlist.js';\nimport {\n  remapElement,\n  init as coordsInit\n} from './coords.js';\nimport {\n  recalculateDimensions,\n  init as recalculateInit\n} from './recalculate.js';\nimport {\n  getSelectorManager,\n  init as selectInit\n} from './select.js';\n\nconst $ = jqPluginSVG(jQuery);\nconst {\n  MoveElementCommand, InsertElementCommand, RemoveElementCommand,\n  ChangeElementCommand, BatchCommand, UndoManager, HistoryEventTypes\n} = history;\n\nif (!window.console) {\n  window.console = {};\n  window.console.log = function (str) {};\n  window.console.dir = function (str) {};\n}\n\nif (window.opera) {\n  window.console.log = function (str) { opera.postError(str); };\n  window.console.dir = function (str) {};\n}\n\n/**\n* The main SvgCanvas class that manages all SVG-related functions\n* @param container - The container HTML element that should hold the SVG root element\n* @param {Object} config - An object that contains configuration data\n*/\nclass SvgCanvas {\n  constructor (container, config) {\n// Alias Namespace constants\n\n// Default configuration options\nconst curConfig = {\n  show_outside_canvas: true,\n  selectNew: true,\n  dimensions: [640, 480]\n};\n\n// Update config with new one if given\nif (config) {\n  $.extend(curConfig, config);\n}\n\n// Array with width/height of canvas\nconst {dimensions} = curConfig;\n\nconst canvas = this;\n\n// \"document\" element associated with the container (same as window.document using default svg-editor.js)\n// NOTE: This is not actually a SVG document, but an HTML document.\nconst svgdoc = container.ownerDocument;\n\n// This is a container for the document being edited, not the document itself.\nconst svgroot = svgdoc.importNode(\n  text2xml(\n    '<svg id=\"svgroot\" xmlns=\"' + NS.SVG + '\" xlinkns=\"' + NS.XLINK + '\" ' +\n      'width=\"' + dimensions[0] + '\" height=\"' + dimensions[1] + '\" x=\"' + dimensions[0] + '\" y=\"' + dimensions[1] + '\" overflow=\"visible\">' +\n      '<defs>' +\n        '<filter id=\"canvashadow\" filterUnits=\"objectBoundingBox\">' +\n          '<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"4\" result=\"blur\"/>' +\n          '<feOffset in=\"blur\" dx=\"5\" dy=\"5\" result=\"offsetBlur\"/>' +\n          '<feMerge>' +\n            '<feMergeNode in=\"offsetBlur\"/>' +\n            '<feMergeNode in=\"SourceGraphic\"/>' +\n          '</feMerge>' +\n        '</filter>' +\n      '</defs>' +\n    '</svg>'\n  ).documentElement,\n  true\n);\ncontainer.append(svgroot);\n\n// The actual element that represents the final output SVG element\nlet svgcontent = svgdoc.createElementNS(NS.SVG, 'svg');\n\n// This function resets the svgcontent element while keeping it in the DOM.\nconst clearSvgContentElement = canvas.clearSvgContentElement = function () {\n  $(svgcontent).empty();\n\n  // TODO: Clear out all other attributes first?\n  $(svgcontent).attr({\n    id: 'svgcontent',\n    width: dimensions[0],\n    height: dimensions[1],\n    x: dimensions[0],\n    y: dimensions[1],\n    overflow: curConfig.show_outside_canvas ? 'visible' : 'hidden',\n    xmlns: NS.SVG,\n    'xmlns:se': NS.SE,\n    'xmlns:xlink': NS.XLINK\n  }).appendTo(svgroot);\n\n  // TODO: make this string optional and set by the client\n  const comment = svgdoc.createComment(' Created with SVG-edit - https://github.com/SVG-Edit/svgedit');\n  svgcontent.append(comment);\n};\nclearSvgContentElement();\n\n// Prefix string for element IDs\nlet idprefix = 'svg_';\n\n/**\n* Changes the ID prefix to the given value\n* @param {String} p - String with the new prefix\n*/\ncanvas.setIdPrefix = function (p) {\n  idprefix = p;\n};\n\n// Current svgedit.draw.Drawing object\n// @type {svgedit.draw.Drawing}\ncanvas.current_drawing_ = new draw.Drawing(svgcontent, idprefix);\n\n/**\n* Returns the current Drawing.\n* @returns {svgedit.draw.Drawing}\n*/\nconst getCurrentDrawing = canvas.getCurrentDrawing = function () {\n  return canvas.current_drawing_;\n};\n\n// Float displaying the current zoom level (1 = 100%, .5 = 50%, etc)\nlet currentZoom = 1;\n\n// pointer to current group (for in-group editing)\nlet currentGroup = null;\n\n// Object containing data for the currently selected styles\nconst allProperties = {\n  shape: {\n    fill: (curConfig.initFill.color === 'none' ? '' : '#') + curConfig.initFill.color,\n    fill_paint: null,\n    fill_opacity: curConfig.initFill.opacity,\n    stroke: '#' + curConfig.initStroke.color,\n    stroke_paint: null,\n    stroke_opacity: curConfig.initStroke.opacity,\n    stroke_width: curConfig.initStroke.width,\n    stroke_dasharray: 'none',\n    stroke_linejoin: 'miter',\n    stroke_linecap: 'butt',\n    opacity: curConfig.initOpacity\n  }\n};\n\nallProperties.text = $.extend(true, {}, allProperties.shape);\n$.extend(allProperties.text, {\n  fill: '#000000',\n  stroke_width: curConfig.text && curConfig.text.stroke_width,\n  font_size: curConfig.text && curConfig.text.font_size,\n  font_family: curConfig.text && curConfig.text.font_family\n});\n\n// Current shape style properties\nconst curShape = allProperties.shape;\n\n// Array with all the currently selected elements\n// default size of 1 until it needs to grow bigger\nlet selectedElements = [];\n\nconst getJsonFromSvgElement = this.getJsonFromSvgElement = function (data) {\n  // Text node\n  if (data.nodeType === 3) return data.nodeValue;\n\n  const retval = {\n    element: data.tagName,\n    // namespace: nsMap[data.namespaceURI],\n    attr: {},\n    children: []\n  };\n\n  // Iterate attributes\n  for (let i = 0, attr; (attr = data.attributes[i]); i++) {\n    retval.attr[attr.name] = attr.value;\n  }\n\n  // Iterate children\n  for (let i = 0, node; (node = data.childNodes[i]); i++) {\n    retval.children[i] = getJsonFromSvgElement(node);\n  }\n\n  return retval;\n};\n\n/**\n* Create a new SVG element based on the given object keys/values and add it to the current layer\n* The element will be ran through cleanupElement before being returned\n*\n* @param data - Object with the following keys/values:\n* @param {String} data.element - tag name of the SVG element to create\n* @param {Object} data.attr - Has key-value attributes to assign to the new element\n* @param {Boolean} [data.curStyles] - Indicates whether current style attributes should be applied first\n* @param {Array} [data.children] - Data objects to be added recursively as children\n* @param {String} [data.namespace=\"http://www.w3.org/2000/svg\"] - Indicate a (non-SVG) namespace\n*\n* @returns The new element\n*/\nconst addSvgElementFromJson = this.addSvgElementFromJson = function (data) {\n  if (typeof data === 'string') return svgdoc.createTextNode(data);\n\n  let shape = getElem(data.attr.id);\n  // if shape is a path but we need to create a rect/ellipse, then remove the path\n  const currentLayer = getCurrentDrawing().getCurrentLayer();\n  if (shape && data.element !== shape.tagName) {\n    shape.remove();\n    shape = null;\n  }\n  if (!shape) {\n    const ns = data.namespace || NS.SVG;\n    shape = svgdoc.createElementNS(ns, data.element);\n    if (currentLayer) {\n      (currentGroup || currentLayer).append(shape);\n    }\n  }\n  if (data.curStyles) {\n    assignAttributes(shape, {\n      fill: curShape.fill,\n      stroke: curShape.stroke,\n      'stroke-width': curShape.stroke_width,\n      'stroke-dasharray': curShape.stroke_dasharray,\n      'stroke-linejoin': curShape.stroke_linejoin,\n      'stroke-linecap': curShape.stroke_linecap,\n      'stroke-opacity': curShape.stroke_opacity,\n      'fill-opacity': curShape.fill_opacity,\n      opacity: curShape.opacity / 2,\n      style: 'pointer-events:inherit'\n    }, 100);\n  }\n  assignAttributes(shape, data.attr, 100);\n  cleanupElement(shape);\n\n  // Children\n  if (data.children) {\n    data.children.forEach((child) => {\n      shape.append(addSvgElementFromJson(child));\n    });\n  }\n\n  return shape;\n};\n\ncanvas.getTransformList = getTransformList;\n\ncanvas.matrixMultiply = matrixMultiply;\ncanvas.hasMatrixTransform = hasMatrixTransform;\ncanvas.transformListToTransform = transformListToTransform;\n\n// initialize from units.js\n// send in an object implementing the ElementContainer interface (see units.js)\nunitsInit({\n  getBaseUnit () { return curConfig.baseUnit; },\n  getElement: getElem,\n  getHeight () { return svgcontent.getAttribute('height') / currentZoom; },\n  getWidth () { return svgcontent.getAttribute('width') / currentZoom; },\n  getRoundDigits () { return saveOptions.round_digits; }\n});\n\ncanvas.convertToNum = convertToNum;\n\nconst getSVGContent = () => { return svgcontent; };\n\n/**\n* @returns {Array} the array with selected DOM elements\n*/\nconst getSelectedElements = this.getSelectedElems = function () {\n  return selectedElements;\n};\n\nconst pathActions = pathModule.pathActions;\n\nutilsInit({\n  pathActions, // Ok since not modifying\n  getSVGContent,\n  addSvgElementFromJson,\n  getSelectedElements,\n  getDOMDocument () { return svgdoc; },\n  getDOMContainer () { return container; },\n  getSVGRoot () { return svgroot; },\n  // TODO: replace this mostly with a way to get the current drawing.\n  getBaseUnit () { return curConfig.baseUnit; },\n  getSnappingStep () { return curConfig.snappingStep; }\n});\n\ncanvas.findDefs = findDefs;\ncanvas.getUrlFromAttr = getUrlFromAttr;\ncanvas.getHref = getHref;\ncanvas.setHref = setHref;\n/* const getBBox = */ canvas.getBBox = utilsGetBBox;\ncanvas.getRotationAngle = getRotationAngle;\ncanvas.getElem = getElem;\ncanvas.getRefElem = getRefElem;\ncanvas.assignAttributes = assignAttributes;\nthis.cleanupElement = cleanupElement;\n\nconst getGridSnapping = () => { return curConfig.gridSnapping; };\ncoordsInit({\n  getDrawing () { return getCurrentDrawing(); },\n  getSVGRoot () { return svgroot; },\n  getGridSnapping\n});\nthis.remapElement = remapElement;\n\nrecalculateInit({\n  getSVGRoot () { return svgroot; },\n  getStartTransform () { return startTransform; },\n  setStartTransform (transform) { startTransform = transform; }\n});\nthis.recalculateDimensions = recalculateDimensions;\n\n// import from sanitize.js\nconst nsMap = getReverseNS();\ncanvas.sanitizeSvg = sanitizeSvg;\n\n// Implement the svgedit.history.HistoryEventHandler interface.\nconst undoMgr = canvas.undoMgr = new UndoManager({\n  handleHistoryEvent (eventType, cmd) {\n    const EventTypes = HistoryEventTypes;\n    // TODO: handle setBlurOffsets.\n    if (eventType === EventTypes.BEFORE_UNAPPLY || eventType === EventTypes.BEFORE_APPLY) {\n      canvas.clearSelection();\n    } else if (eventType === EventTypes.AFTER_APPLY || eventType === EventTypes.AFTER_UNAPPLY) {\n      const elems = cmd.elements();\n      canvas.pathActions.clear();\n      call('changed', elems);\n      const cmdType = cmd.type();\n      const isApply = (eventType === EventTypes.AFTER_APPLY);\n      if (cmdType === MoveElementCommand.type()) {\n        const parent = isApply ? cmd.newParent : cmd.oldParent;\n        if (parent === svgcontent) {\n          draw.identifyLayers();\n        }\n      } else if (cmdType === InsertElementCommand.type() ||\n          cmdType === RemoveElementCommand.type()) {\n        if (cmd.parent === svgcontent) {\n          draw.identifyLayers();\n        }\n        if (cmdType === InsertElementCommand.type()) {\n          if (isApply) { restoreRefElems(cmd.elem); }\n        } else {\n          if (!isApply) { restoreRefElems(cmd.elem); }\n        }\n        if (cmd.elem.tagName === 'use') {\n          setUseData(cmd.elem);\n        }\n      } else if (cmdType === ChangeElementCommand.type()) {\n        // if we are changing layer names, re-identify all layers\n        if (cmd.elem.tagName === 'title' &&\n          cmd.elem.parentNode.parentNode === svgcontent\n        ) {\n          draw.identifyLayers();\n        }\n        const values = isApply ? cmd.newValues : cmd.oldValues;\n        // If stdDeviation was changed, update the blur.\n        if (values.stdDeviation) {\n          canvas.setBlurOffsets(cmd.elem.parentNode, values.stdDeviation);\n        }\n        // This is resolved in later versions of webkit, perhaps we should\n        // have a featured detection for correct 'use' behavior?\n        // ——————————\n        // Remove & Re-add hack for Webkit (issue 775)\n        // if (cmd.elem.tagName === 'use' && isWebkit()) {\n        //  const {elem} = cmd;\n        //  if (!elem.getAttribute('x') && !elem.getAttribute('y')) {\n        //    const parent = elem.parentNode;\n        //    const sib = elem.nextSibling;\n        //    elem.remove();\n        //    parent.insertBefore(elem, sib);\n        //    // Ok to replace above with this? `sib.before(elem);`\n        //  }\n        // }\n      }\n    }\n  }\n});\nconst addCommandToHistory = function (cmd) {\n  canvas.undoMgr.addCommandToHistory(cmd);\n};\n\n/**\n* @returns The current zoom level\n*/\nconst getCurrentZoom = this.getZoom = function () { return currentZoom; };\n\n/**\n* This method rounds the incoming value to the nearest value based on the `currentZoom`\n* @param {Number} val\n* @returns Rounded value to nearest value based on `currentZoom`\n*/\nconst round = this.round = function (val) {\n  return parseInt(val * currentZoom, 10) / currentZoom;\n};\n\n// import from select.js\nselectInit(curConfig, {\n  createSVGElement (jsonMap) { return canvas.addSvgElementFromJson(jsonMap); },\n  svgRoot () { return svgroot; },\n  svgContent () { return svgcontent; },\n  getCurrentZoom\n});\n// this object manages selectors for us\nconst selectorManager = this.selectorManager = getSelectorManager();\n\nconst getNextId = canvas.getNextId = function () { return getCurrentDrawing().getNextId(); };\nconst getId = canvas.getId = function () { return getCurrentDrawing().getId(); };\n\n/**\n* Run the callback function associated with the given event\n* @param ev - String with the event name\n* @param arg - Argument to pass through to the callback function\n*/\nconst call = function (ev, arg) {\n  if (events[ev]) {\n    return events[ev](window, arg);\n  }\n};\n\n/**\n* Clears the selection. The 'selected' handler is then called.\n* @param {Boolean} [noCall] - When true does not call the \"selected\" handler\n*/\nconst clearSelection = function (noCall) {\n  selectedElements.map(function (elem) {\n    if (elem == null) return;\n\n    selectorManager.releaseSelector(elem);\n  });\n  selectedElements = [];\n\n  if (!noCall) { call('selected', selectedElements); }\n};\n\n/**\n* Adds a list of elements to the selection. The 'selected' handler is then called.\n* @param {Array} elemsToAdd - An array of DOM elements to add to the selection\n* @param {Boolean} showGrips - Indicates whether the resize grips should be shown\n*/\nconst addToSelection = function (elemsToAdd, showGrips) {\n  if (!elemsToAdd.length) { return; }\n  // find the first null in our selectedElements array\n\n  let j = 0;\n  while (j < selectedElements.length) {\n    if (selectedElements[j] == null) {\n      break;\n    }\n    ++j;\n  }\n\n  // now add each element consecutively\n  let i = elemsToAdd.length;\n  while (i--) {\n    let elem = elemsToAdd[i];\n    if (!elem) { continue; }\n    const bbox = utilsGetBBox(elem);\n    if (!bbox) { continue; }\n\n    if (elem.tagName === 'a' && elem.childNodes.length === 1) {\n      // Make \"a\" element's child be the selected element\n      elem = elem.firstChild;\n    }\n\n    // if it's not already there, add it\n    if (!selectedElements.includes(elem)) {\n      selectedElements[j] = elem;\n\n      // only the first selectedBBoxes element is ever used in the codebase these days\n      // if (j === 0) selectedBBoxes[0] = utilsGetBBox(elem);\n      j++;\n      const sel = selectorManager.requestSelector(elem, bbox);\n\n      if (selectedElements.length > 1) {\n        sel.showGrips(false);\n      }\n    }\n  }\n  call('selected', selectedElements);\n\n  if (showGrips || selectedElements.length === 1) {\n    selectorManager.requestSelector(selectedElements[0]).showGrips(true);\n  } else {\n    selectorManager.requestSelector(selectedElements[0]).showGrips(false);\n  }\n\n  // make sure the elements are in the correct order\n  // See: https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-compareDocumentPosition\n\n  selectedElements.sort(function (a, b) {\n    if (a && b && a.compareDocumentPosition) {\n      return 3 - (b.compareDocumentPosition(a) & 6);\n    }\n    if (a == null) {\n      return 1;\n    }\n  });\n\n  // Make sure first elements are not null\n  while (selectedElements[0] == null) {\n    selectedElements.shift(0);\n  }\n};\n\nconst getOpacity = function () {\n  return curShape.opacity;\n};\n\n/**\n* Gets the desired element from a mouse event\n* @param evt - Event object from the mouse event\n* @returns DOM element we want\n*/\nconst getMouseTarget = this.getMouseTarget = function (evt) {\n  if (evt == null) {\n    return null;\n  }\n  let mouseTarget = evt.target;\n\n  // if it was a <use>, Opera and WebKit return the SVGElementInstance\n  if (mouseTarget.correspondingUseElement) { mouseTarget = mouseTarget.correspondingUseElement; }\n\n  // for foreign content, go up until we find the foreignObject\n  // WebKit browsers set the mouse target to the svgcanvas div\n  if ([NS.MATH, NS.HTML].includes(mouseTarget.namespaceURI) &&\n    mouseTarget.id !== 'svgcanvas'\n  ) {\n    while (mouseTarget.nodeName !== 'foreignObject') {\n      mouseTarget = mouseTarget.parentNode;\n      if (!mouseTarget) { return svgroot; }\n    }\n  }\n\n  // Get the desired mouseTarget with jQuery selector-fu\n  // If it's root-like, select the root\n  const currentLayer = getCurrentDrawing().getCurrentLayer();\n  if ([svgroot, container, svgcontent, currentLayer].includes(mouseTarget)) {\n    return svgroot;\n  }\n\n  const $target = $(mouseTarget);\n\n  // If it's a selection grip, return the grip parent\n  if ($target.closest('#selectorParentGroup').length) {\n    // While we could instead have just returned mouseTarget,\n    // this makes it easier to indentify as being a selector grip\n    return selectorManager.selectorParentGroup;\n  }\n\n  while (mouseTarget.parentNode !== (currentGroup || currentLayer)) {\n    mouseTarget = mouseTarget.parentNode;\n  }\n\n  //\n  // // go up until we hit a child of a layer\n  // while (mouseTarget.parentNode.parentNode.tagName == 'g') {\n  //   mouseTarget = mouseTarget.parentNode;\n  // }\n  // Webkit bubbles the mouse event all the way up to the div, so we\n  // set the mouseTarget to the svgroot like the other browsers\n  // if (mouseTarget.nodeName.toLowerCase() == 'div') {\n  //   mouseTarget = svgroot;\n  // }\n\n  return mouseTarget;\n};\n\ncanvas.pathActions = pathActions;\nfunction resetD (p) {\n  p.setAttribute('d', pathActions.convertPath(p));\n}\npathModule.init({\n  selectorManager, // Ok since not changing\n  canvas, // Ok since not changing\n  call,\n  resetD,\n  round,\n  clearSelection,\n  addToSelection,\n  addCommandToHistory,\n  remapElement,\n  addSvgElementFromJson,\n  getGridSnapping,\n  getOpacity,\n  getSelectedElements,\n  getContainer () {\n    return container;\n  },\n  setStarted (s) {\n    started = s;\n  },\n  getRubberBox () {\n    return rubberBox;\n  },\n  setRubberBox (rb) {\n    rubberBox = rb;\n    return rubberBox;\n  },\n  addPtsToSelection ({closedSubpath, grips}) {\n    // TODO: Correct this:\n    pathActions.canDeleteNodes = true;\n    pathActions.closed_subpath = closedSubpath;\n    call('pointsAdded', {closedSubpath, grips});\n    call('selected', grips);\n  },\n  endChanges ({cmd, elem}) {\n    addCommandToHistory(cmd);\n    call('changed', [elem]);\n  },\n  getCurrentZoom,\n  getId,\n  getNextId,\n  getMouseTarget,\n  getCurrentMode () {\n    return currentMode;\n  },\n  setCurrentMode (cm) {\n    currentMode = cm;\n    return currentMode;\n  },\n  getDrawnPath () {\n    return drawnPath;\n  },\n  setDrawnPath (dp) {\n    drawnPath = dp;\n    return drawnPath;\n  },\n  getSVGRoot () { return svgroot; }\n});\n\n// Interface strings, usually for title elements\nconst uiStrings = {};\n\nconst visElems = 'a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use';\nconst refAttrs = ['clip-path', 'fill', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'stroke'];\n\nconst elData = $.data;\n\n// Animation element to change the opacity of any newly created element\nconst opacAni = document.createElementNS(NS.SVG, 'animate');\n$(opacAni).attr({\n  attributeName: 'opacity',\n  begin: 'indefinite',\n  dur: 1,\n  fill: 'freeze'\n}).appendTo(svgroot);\n\nconst restoreRefElems = function (elem) {\n  // Look for missing reference elements, restore any found\n  const attrs = $(elem).attr(refAttrs);\n  for (const o in attrs) {\n    const val = attrs[o];\n    if (val && val.startsWith('url(')) {\n      const id = getUrlFromAttr(val).substr(1);\n      const ref = getElem(id);\n      if (!ref) {\n        findDefs().append(removedElements[id]);\n        delete removedElements[id];\n      }\n    }\n  }\n\n  const childs = elem.getElementsByTagName('*');\n\n  if (childs.length) {\n    for (let i = 0, l = childs.length; i < l; i++) {\n      restoreRefElems(childs[i]);\n    }\n  }\n};\n\n// (function () {\n// TODO For Issue 208: this is a start on a thumbnail\n//  const svgthumb = svgdoc.createElementNS(NS.SVG, 'use');\n//  svgthumb.setAttribute('width', '100');\n//  svgthumb.setAttribute('height', '100');\n//  setHref(svgthumb, '#svgcontent');\n//  svgroot.append(svgthumb);\n// }());\n\n// Object to contain image data for raster images that were found encodable\nconst encodableImages = {},\n\n  // Object with save options\n  saveOptions = {round_digits: 5},\n\n  // Object with IDs for imported files, to see if one was already added\n  importIds = {},\n\n  // Current text style properties\n  curText = allProperties.text,\n\n  // Object to contain all included extensions\n  extensions = {},\n\n  // Map of deleted reference elements\n  removedElements = {};\n\nlet\n  // String with image URL of last loadable image\n  lastGoodImgUrl = curConfig.imgPath + 'logo.png',\n\n  // Boolean indicating whether or not a draw action has been started\n  started = false,\n\n  // String with an element's initial transform attribute value\n  startTransform = null,\n\n  // String indicating the current editor mode\n  currentMode = 'select',\n\n  // String with the current direction in which an element is being resized\n  currentResizeMode = 'none',\n\n  // Current general properties\n  curProperties = curShape,\n\n  // Array with selected elements' Bounding box object\n  // selectedBBoxes = new Array(1),\n\n  // The DOM element that was just selected\n  justSelected = null,\n\n  // DOM element for selection rectangle drawn by the user\n  rubberBox = null,\n\n  // Array of current BBoxes, used in getIntersectionList().\n  curBBoxes = [],\n\n  // Canvas point for the most recent right click\n  lastClickPoint = null;\n\n// Should this return an array by default, so extension results aren't overwritten?\nconst runExtensions = this.runExtensions = function (action, vars, returnArray) {\n  let result = returnArray ? [] : false;\n  $.each(extensions, function (name, opts) {\n    if (opts && action in opts) {\n      if (returnArray) {\n        result.push(opts[action](vars));\n      } else {\n        result = opts[action](vars);\n      }\n    }\n  });\n  return result;\n};\n\n/**\n* Add an extension to the editor\n* @param {String} name - String with the ID of the extension\n* @param {Function} extFunc - Function supplied by the extension with its data\n*/\nthis.addExtension = function (name, extFunc) {\n  let ext;\n  if (!(name in extensions)) {\n    // Provide private vars/funcs here. Is there a better way to do this?\n    const argObj = $.extend(canvas.getPrivateMethods(), {\n      svgroot,\n      svgcontent,\n      nonce: getCurrentDrawing().getNonce(),\n      selectorManager\n    });\n    if (typeof extFunc === 'function') {\n      ext = extFunc(argObj);\n    } else {\n      ext = extFunc;\n      if (ext.callback) {\n        ext.callback = ext.callback.bind(ext, argObj);\n      }\n    }\n    extensions[name] = ext;\n    call('extension_added', ext);\n  } else {\n    console.log('Cannot add extension \"' + name + '\", an extension by that name already exists.');\n  }\n};\n\n/**\n* This method sends back an array or a NodeList full of elements that\n* intersect the multi-select rubber-band-box on the currentLayer only.\n*\n* We brute-force getIntersectionList for browsers that do not support it (Firefox).\n*\n* Reference:\n* Firefox does not implement getIntersectionList(), see https://bugzilla.mozilla.org/show_bug.cgi?id=501421\n* @param rect\n* @returns {Array|NodeList} Bbox elements\n*/\nconst getIntersectionList = this.getIntersectionList = function (rect) {\n  if (rubberBox == null) { return null; }\n\n  const parent = currentGroup || getCurrentDrawing().getCurrentLayer();\n\n  let rubberBBox;\n  if (!rect) {\n    rubberBBox = rubberBox.getBBox();\n    const bb = svgcontent.createSVGRect();\n\n    for (const o in rubberBBox) {\n      bb[o] = rubberBBox[o] / currentZoom;\n    }\n    rubberBBox = bb;\n  } else {\n    rubberBBox = svgcontent.createSVGRect();\n    rubberBBox.x = rect.x;\n    rubberBBox.y = rect.y;\n    rubberBBox.width = rect.width;\n    rubberBBox.height = rect.height;\n  }\n\n  let resultList = null;\n  if (!isIE) {\n    if (typeof svgroot.getIntersectionList === 'function') {\n      // Offset the bbox of the rubber box by the offset of the svgcontent element.\n      rubberBBox.x += parseInt(svgcontent.getAttribute('x'), 10);\n      rubberBBox.y += parseInt(svgcontent.getAttribute('y'), 10);\n\n      resultList = svgroot.getIntersectionList(rubberBBox, parent);\n    }\n  }\n\n  if (resultList == null || typeof resultList.item !== 'function') {\n    resultList = [];\n\n    if (!curBBoxes.length) {\n      // Cache all bboxes\n      curBBoxes = getVisibleElementsAndBBoxes(parent);\n    }\n    let i = curBBoxes.length;\n    while (i--) {\n      if (!rubberBBox.width) { continue; }\n      if (rectsIntersect(rubberBBox, curBBoxes[i].bbox)) {\n        resultList.push(curBBoxes[i].elem);\n      }\n    }\n  }\n\n  // addToSelection expects an array, but it's ok to pass a NodeList\n  // because using square-bracket notation is allowed:\n  // https://www.w3.org/TR/DOM-Level-2-Core/ecma-script-binding.html\n  return resultList;\n};\n\nthis.getStrokedBBox = getStrokedBBoxDefaultVisible;\n\nthis.getVisibleElements = getVisibleElements;\n\n/**\n* Get all elements that have a BBox (excludes &lt;defs>, &lt;title>, etc).\n* Note that 0-opacity, off-screen etc elements are still considered \"visible\"\n* for this function\n* @param parent - The parent DOM element to search within\n* @returns {Array} An array with objects that include:\n* - elem - The element\n* - bbox - The element's BBox as retrieved from `getStrokedBBoxDefaultVisible`\n*/\nconst getVisibleElementsAndBBoxes = this.getVisibleElementsAndBBoxes = function (parent) {\n  if (!parent) {\n    parent = $(svgcontent).children(); // Prevent layers from being included\n  }\n  const contentElems = [];\n  $(parent).children().each(function (i, elem) {\n    if (elem.getBBox) {\n      contentElems.push({elem, bbox: getStrokedBBoxDefaultVisible([elem])});\n    }\n  });\n  return contentElems.reverse();\n};\n\n/**\n* Wrap an SVG element into a group element, mark the group as 'gsvg'\n* @param elem - SVG element to wrap\n*/\nconst groupSvgElem = this.groupSvgElem = function (elem) {\n  const g = document.createElementNS(NS.SVG, 'g');\n  elem.replaceWith(g);\n  $(g).append(elem).data('gsvg', elem)[0].id = getNextId();\n};\n\n// Set scope for these functions\n\n// Object to contain editor event names and callback functions\nconst events = {};\n\ncanvas.call = call;\n\n/**\n* Attaches a callback function to an event\n* @param {String} ev - String indicating the name of the event\n* @param {Function} f - The callback function to bind to the event\n* @returns The previous event\n*/\ncanvas.bind = function (ev, f) {\n  const old = events[ev];\n  events[ev] = f;\n  return old;\n};\n\n/**\n* Runs the SVG Document through the sanitizer and then updates its paths.\n* @param newDoc - The SVG DOM document\n*/\nthis.prepareSvg = function (newDoc) {\n  this.sanitizeSvg(newDoc.documentElement);\n\n  // convert paths into absolute commands\n  const paths = newDoc.getElementsByTagNameNS(NS.SVG, 'path');\n  for (let i = 0, len = paths.length; i < len; ++i) {\n    const path = paths[i];\n    path.setAttribute('d', pathActions.convertPath(path));\n    pathActions.fixEnd(path);\n  }\n};\n\n/**\n* Hack for Firefox bugs where text element features aren't updated or get\n* messed up. See issue 136 and issue 137.\n* This function clones the element and re-selects it\n* @todo Test for this bug on load and add it to \"support\" object instead of\n* browser sniffing\n* @param elem - The (text) DOM element to clone\n* @returns Cloned element\n*/\nconst ffClone = function (elem) {\n  if (!isGecko()) { return elem; }\n  const clone = elem.cloneNode(true);\n  elem.before(clone);\n  elem.remove();\n  selectorManager.releaseSelector(elem);\n  selectedElements[0] = clone;\n  selectorManager.requestSelector(clone).showGrips(true);\n  return clone;\n};\n\n// this.each is deprecated, if any extension used this it can be recreated by doing this:\n// $(canvas.getRootElem()).children().each(...)\n\n// this.each = function (cb) {\n//  $(svgroot).children().each(cb);\n// };\n\n/**\n* Removes any old rotations if present, prepends a new rotation at the\n* transformed center\n* @param val - The new rotation angle in degrees\n* @param {Boolean} preventUndo - Indicates whether the action should be undoable or not\n*/\nthis.setRotationAngle = function (val, preventUndo) {\n  // ensure val is the proper type\n  val = parseFloat(val);\n  const elem = selectedElements[0];\n  const oldTransform = elem.getAttribute('transform');\n  const bbox = utilsGetBBox(elem);\n  const cx = bbox.x + bbox.width / 2, cy = bbox.y + bbox.height / 2;\n  const tlist = getTransformList(elem);\n\n  // only remove the real rotational transform if present (i.e. at index=0)\n  if (tlist.numberOfItems > 0) {\n    const xform = tlist.getItem(0);\n    if (xform.type === 4) {\n      tlist.removeItem(0);\n    }\n  }\n  // find Rnc and insert it\n  if (val !== 0) {\n    const center = transformPoint(cx, cy, transformListToTransform(tlist).matrix);\n    const Rnc = svgroot.createSVGTransform();\n    Rnc.setRotate(val, center.x, center.y);\n    if (tlist.numberOfItems) {\n      tlist.insertItemBefore(Rnc, 0);\n    } else {\n      tlist.appendItem(Rnc);\n    }\n  } else if (tlist.numberOfItems === 0) {\n    elem.removeAttribute('transform');\n  }\n\n  if (!preventUndo) {\n    // we need to undo it, then redo it so it can be undo-able! :)\n    // TODO: figure out how to make changes to transform list undo-able cross-browser?\n    const newTransform = elem.getAttribute('transform');\n    elem.setAttribute('transform', oldTransform);\n    changeSelectedAttribute('transform', newTransform, selectedElements);\n    call('changed', selectedElements);\n  }\n  // const pointGripContainer = getElem('pathpointgrip_container');\n  // if (elem.nodeName === 'path' && pointGripContainer) {\n  //   pathActions.setPointContainerTransform(elem.getAttribute('transform'));\n  // }\n  const selector = selectorManager.requestSelector(selectedElements[0]);\n  selector.resize();\n  selector.updateGripCursors(val);\n};\n\n// Runs recalculateDimensions on the selected elements,\n// adding the changes to a single batch command\nconst recalculateAllSelectedDimensions = this.recalculateAllSelectedDimensions = function () {\n  const text = (currentResizeMode === 'none' ? 'position' : 'size');\n  const batchCmd = new BatchCommand(text);\n\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    // if (getRotationAngle(elem) && !hasMatrixTransform(getTransformList(elem))) { continue; }\n    const cmd = recalculateDimensions(elem);\n    if (cmd) {\n      batchCmd.addSubCommand(cmd);\n    }\n  }\n\n  if (!batchCmd.isEmpty()) {\n    addCommandToHistory(batchCmd);\n    call('changed', selectedElements);\n  }\n};\n\n// Debug tool to easily see the current matrix in the browser's console\nconst logMatrix = function (m) {\n  console.log([m.a, m.b, m.c, m.d, m.e, m.f]);\n};\n\n// Root Current Transformation Matrix in user units\nlet rootSctm = null;\n\n/**\n* Group: Selection\n*/\n\nthis.clearSelection = clearSelection;\n\n// TODO: do we need to worry about selectedBBoxes here?\n\nthis.addToSelection = addToSelection;\n\n/**\n* Selects only the given elements, shortcut for clearSelection(); addToSelection()\n* @param {Array} elems - an array of DOM elements to be selected\n*/\nconst selectOnly = this.selectOnly = function (elems, showGrips) {\n  clearSelection(true);\n  addToSelection(elems, showGrips);\n};\n\n// TODO: could use slice here to make this faster?\n// TODO: should the 'selected' handler\n\n/**\n* Removes elements from the selection.\n* @param {Array} elemsToRemove - an array of elements to remove from selection\n*/\n/* const removeFromSelection = */ this.removeFromSelection = function (elemsToRemove) {\n  if (selectedElements[0] == null) { return; }\n  if (!elemsToRemove.length) { return; }\n\n  // find every element and remove it from our array copy\n  const newSelectedItems = [],\n    len = selectedElements.length;\n  for (let i = 0; i < len; ++i) {\n    const elem = selectedElements[i];\n    if (elem) {\n      // keep the item\n      if (!elemsToRemove.includes(elem)) {\n        newSelectedItems.push(elem);\n      } else { // remove the item and its selector\n        selectorManager.releaseSelector(elem);\n      }\n    }\n  }\n  // the copy becomes the master now\n  selectedElements = newSelectedItems;\n};\n\n// Clears the selection, then adds all elements in the current layer to the selection.\nthis.selectAllInCurrentLayer = function () {\n  const currentLayer = getCurrentDrawing().getCurrentLayer();\n  if (currentLayer) {\n    currentMode = 'select';\n    selectOnly($(currentGroup || currentLayer).children());\n  }\n};\n\nlet drawnPath = null;\n\n// Mouse events\n(function () {\nconst freehand = {\n  minx: null,\n  miny: null,\n  maxx: null,\n  maxy: null\n};\nconst THRESHOLD_DIST = 0.8,\n  STEP_COUNT = 10;\nlet dAttr = null,\n  startX = null,\n  startY = null,\n  rStartX = null,\n  rStartY = null,\n  initBbox = {},\n  sumDistance = 0,\n  controllPoint2 = {x: 0, y: 0},\n  controllPoint1 = {x: 0, y: 0},\n  start = {x: 0, y: 0},\n  end = {x: 0, y: 0},\n  bSpline = {x: 0, y: 0},\n  nextPos = {x: 0, y: 0},\n  parameter,\n  nextParameter;\n\nconst getBsplinePoint = function (t) {\n  const spline = {x: 0, y: 0},\n    p0 = controllPoint2,\n    p1 = controllPoint1,\n    p2 = start,\n    p3 = end,\n    S = 1.0 / 6.0,\n    t2 = t * t,\n    t3 = t2 * t;\n\n  const m = [\n    [-1, 3, -3, 1],\n    [3, -6, 3, 0],\n    [-3, 0, 3, 0],\n    [1, 4, 1, 0]\n  ];\n\n  spline.x = S * (\n    (p0.x * m[0][0] + p1.x * m[0][1] + p2.x * m[0][2] + p3.x * m[0][3]) * t3 +\n      (p0.x * m[1][0] + p1.x * m[1][1] + p2.x * m[1][2] + p3.x * m[1][3]) * t2 +\n      (p0.x * m[2][0] + p1.x * m[2][1] + p2.x * m[2][2] + p3.x * m[2][3]) * t +\n      (p0.x * m[3][0] + p1.x * m[3][1] + p2.x * m[3][2] + p3.x * m[3][3])\n  );\n  spline.y = S * (\n    (p0.y * m[0][0] + p1.y * m[0][1] + p2.y * m[0][2] + p3.y * m[0][3]) * t3 +\n      (p0.y * m[1][0] + p1.y * m[1][1] + p2.y * m[1][2] + p3.y * m[1][3]) * t2 +\n      (p0.y * m[2][0] + p1.y * m[2][1] + p2.y * m[2][2] + p3.y * m[2][3]) * t +\n      (p0.y * m[3][0] + p1.y * m[3][1] + p2.y * m[3][2] + p3.y * m[3][3])\n  );\n\n  return {\n    x: spline.x,\n    y: spline.y\n  };\n};\n// - when we are in a create mode, the element is added to the canvas\n// but the action is not recorded until mousing up\n// - when we are in select mode, select the element, remember the position\n// and do nothing else\nconst mouseDown = function (evt) {\n  if (canvas.spaceKey || evt.button === 1) { return; }\n\n  const rightClick = evt.button === 2;\n\n  if (evt.altKey) { // duplicate when dragging\n    canvas.cloneSelectedElements(0, 0);\n  }\n\n  rootSctm = $('#svgcontent g')[0].getScreenCTM().inverse();\n\n  const pt = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = pt.x * currentZoom,\n    mouseY = pt.y * currentZoom;\n\n  evt.preventDefault();\n\n  if (rightClick) {\n    currentMode = 'select';\n    lastClickPoint = pt;\n  }\n\n  // This would seem to be unnecessary...\n  // if (!['select', 'resize'].includes(currentMode)) {\n  //   setGradient();\n  // }\n\n  let x = mouseX / currentZoom,\n    y = mouseY / currentZoom;\n  let mouseTarget = getMouseTarget(evt);\n\n  if (mouseTarget.tagName === 'a' && mouseTarget.childNodes.length === 1) {\n    mouseTarget = mouseTarget.firstChild;\n  }\n\n  // realX/y ignores grid-snap value\n  const realX = x;\n  rStartX = startX = x;\n  const realY = y;\n  rStartY = startY = y;\n\n  if (curConfig.gridSnapping) {\n    x = snapToGrid(x);\n    y = snapToGrid(y);\n    startX = snapToGrid(startX);\n    startY = snapToGrid(startY);\n  }\n\n  // if it is a selector grip, then it must be a single element selected,\n  // set the mouseTarget to that and update the mode to rotate/resize\n\n  if (mouseTarget === selectorManager.selectorParentGroup && selectedElements[0] != null) {\n    const grip = evt.target;\n    const griptype = elData(grip, 'type');\n    // rotating\n    if (griptype === 'rotate') {\n      currentMode = 'rotate';\n    // resizing\n    } else if (griptype === 'resize') {\n      currentMode = 'resize';\n      currentResizeMode = elData(grip, 'dir');\n    }\n    mouseTarget = selectedElements[0];\n  }\n\n  startTransform = mouseTarget.getAttribute('transform');\n  let i, strokeW;\n  const tlist = getTransformList(mouseTarget);\n  switch (currentMode) {\n  case 'select':\n    started = true;\n    currentResizeMode = 'none';\n    if (rightClick) { started = false; }\n\n    if (mouseTarget !== svgroot) {\n      // if this element is not yet selected, clear selection and select it\n      if (!selectedElements.includes(mouseTarget)) {\n        // only clear selection if shift is not pressed (otherwise, add\n        // element to selection)\n        if (!evt.shiftKey) {\n          // No need to do the call here as it will be done on addToSelection\n          clearSelection(true);\n        }\n        addToSelection([mouseTarget]);\n        justSelected = mouseTarget;\n        pathActions.clear();\n      }\n      // else if it's a path, go into pathedit mode in mouseup\n\n      if (!rightClick) {\n        // insert a dummy transform so if the element(s) are moved it will have\n        // a transform to use for its translate\n        for (i = 0; i < selectedElements.length; ++i) {\n          if (selectedElements[i] == null) { continue; }\n          const slist = getTransformList(selectedElements[i]);\n          if (slist.numberOfItems) {\n            slist.insertItemBefore(svgroot.createSVGTransform(), 0);\n          } else {\n            slist.appendItem(svgroot.createSVGTransform());\n          }\n        }\n      }\n    } else if (!rightClick) {\n      clearSelection();\n      currentMode = 'multiselect';\n      if (rubberBox == null) {\n        rubberBox = selectorManager.getRubberBandBox();\n      }\n      rStartX *= currentZoom;\n      rStartY *= currentZoom;\n      // console.log('p',[evt.pageX, evt.pageY]);\n      // console.log('c',[evt.clientX, evt.clientY]);\n      // console.log('o',[evt.offsetX, evt.offsetY]);\n      // console.log('s',[startX, startY]);\n\n      assignAttributes(rubberBox, {\n        x: rStartX,\n        y: rStartY,\n        width: 0,\n        height: 0,\n        display: 'inline'\n      }, 100);\n    }\n    break;\n  case 'zoom':\n    started = true;\n    if (rubberBox == null) {\n      rubberBox = selectorManager.getRubberBandBox();\n    }\n    assignAttributes(rubberBox, {\n      x: realX * currentZoom,\n      y: realX * currentZoom,\n      width: 0,\n      height: 0,\n      display: 'inline'\n    }, 100);\n    break;\n  case 'resize':\n    started = true;\n    startX = x;\n    startY = y;\n\n    // Getting the BBox from the selection box, since we know we\n    // want to orient around it\n    initBbox = utilsGetBBox($('#selectedBox0')[0]);\n    const bb = {};\n    $.each(initBbox, function (key, val) {\n      bb[key] = val / currentZoom;\n    });\n    initBbox = bb;\n\n    // append three dummy transforms to the tlist so that\n    // we can translate,scale,translate in mousemove\n    const pos = getRotationAngle(mouseTarget) ? 1 : 0;\n\n    if (hasMatrixTransform(tlist)) {\n      tlist.insertItemBefore(svgroot.createSVGTransform(), pos);\n      tlist.insertItemBefore(svgroot.createSVGTransform(), pos);\n      tlist.insertItemBefore(svgroot.createSVGTransform(), pos);\n    } else {\n      tlist.appendItem(svgroot.createSVGTransform());\n      tlist.appendItem(svgroot.createSVGTransform());\n      tlist.appendItem(svgroot.createSVGTransform());\n\n      if (supportsNonScalingStroke()) {\n        // Handle crash for newer Chrome and Safari 6 (Mobile and Desktop):\n        // https://code.google.com/p/svg-edit/issues/detail?id=904\n        // Chromium issue: https://code.google.com/p/chromium/issues/detail?id=114625\n        // TODO: Remove this workaround once vendor fixes the issue\n        const iswebkit = isWebkit();\n\n        let delayedStroke;\n        if (iswebkit) {\n          delayedStroke = function (ele) {\n            const _stroke = ele.getAttributeNS(null, 'stroke');\n            ele.removeAttributeNS(null, 'stroke');\n            // Re-apply stroke after delay. Anything higher than 1 seems to cause flicker\n            if (_stroke !== null) setTimeout(function () { ele.setAttributeNS(null, 'stroke', _stroke); }, 0);\n          };\n        }\n        mouseTarget.style.vectorEffect = 'non-scaling-stroke';\n        if (iswebkit) { delayedStroke(mouseTarget); }\n\n        const all = mouseTarget.getElementsByTagName('*'),\n          len = all.length;\n        for (i = 0; i < len; i++) {\n          if (!all[i].style) { // mathML\n            continue;\n          }\n          all[i].style.vectorEffect = 'non-scaling-stroke';\n          if (iswebkit) { delayedStroke(all[i]); }\n        }\n      }\n    }\n    break;\n  case 'fhellipse':\n  case 'fhrect':\n  case 'fhpath':\n    start.x = realX;\n    start.y = realY;\n    started = true;\n    dAttr = realX + ',' + realY + ' ';\n    strokeW = parseFloat(curShape.stroke_width) === 0 ? 1 : curShape.stroke_width;\n    addSvgElementFromJson({\n      element: 'polyline',\n      curStyles: true,\n      attr: {\n        points: dAttr,\n        id: getNextId(),\n        fill: 'none',\n        opacity: curShape.opacity / 2,\n        'stroke-linecap': 'round',\n        style: 'pointer-events:none'\n      }\n    });\n    freehand.minx = realX;\n    freehand.maxx = realX;\n    freehand.miny = realY;\n    freehand.maxy = realY;\n    break;\n  case 'image':\n    started = true;\n    const newImage = addSvgElementFromJson({\n      element: 'image',\n      attr: {\n        x,\n        y,\n        width: 0,\n        height: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2,\n        style: 'pointer-events:inherit'\n      }\n    });\n    setHref(newImage, lastGoodImgUrl);\n    preventClickDefault(newImage);\n    break;\n  case 'square':\n    // FIXME: once we create the rect, we lose information that this was a square\n    // (for resizing purposes this could be important)\n    // Fallthrough\n  case 'rect':\n    started = true;\n    startX = x;\n    startY = y;\n    addSvgElementFromJson({\n      element: 'rect',\n      curStyles: true,\n      attr: {\n        x,\n        y,\n        width: 0,\n        height: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2\n      }\n    });\n    break;\n  case 'line':\n    started = true;\n    strokeW = Number(curShape.stroke_width) === 0 ? 1 : curShape.stroke_width;\n    addSvgElementFromJson({\n      element: 'line',\n      curStyles: true,\n      attr: {\n        x1: x,\n        y1: y,\n        x2: x,\n        y2: y,\n        id: getNextId(),\n        stroke: curShape.stroke,\n        'stroke-width': strokeW,\n        'stroke-dasharray': curShape.stroke_dasharray,\n        'stroke-linejoin': curShape.stroke_linejoin,\n        'stroke-linecap': curShape.stroke_linecap,\n        'stroke-opacity': curShape.stroke_opacity,\n        fill: 'none',\n        opacity: curShape.opacity / 2,\n        style: 'pointer-events:none'\n      }\n    });\n    break;\n  case 'circle':\n    started = true;\n    addSvgElementFromJson({\n      element: 'circle',\n      curStyles: true,\n      attr: {\n        cx: x,\n        cy: y,\n        r: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2\n      }\n    });\n    break;\n  case 'ellipse':\n    started = true;\n    addSvgElementFromJson({\n      element: 'ellipse',\n      curStyles: true,\n      attr: {\n        cx: x,\n        cy: y,\n        rx: 0,\n        ry: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2\n      }\n    });\n    break;\n  case 'text':\n    started = true;\n    /* const newText = */ addSvgElementFromJson({\n      element: 'text',\n      curStyles: true,\n      attr: {\n        x,\n        y,\n        id: getNextId(),\n        fill: curText.fill,\n        'stroke-width': curText.stroke_width,\n        'font-size': curText.font_size,\n        'font-family': curText.font_family,\n        'text-anchor': 'middle',\n        'xml:space': 'preserve',\n        opacity: curShape.opacity\n      }\n    });\n    // newText.textContent = 'text';\n    break;\n  case 'path':\n    // Fall through\n  case 'pathedit':\n    startX *= currentZoom;\n    startY *= currentZoom;\n    pathActions.mouseDown(evt, mouseTarget, startX, startY);\n    started = true;\n    break;\n  case 'textedit':\n    startX *= currentZoom;\n    startY *= currentZoom;\n    textActions.mouseDown(evt, mouseTarget, startX, startY);\n    started = true;\n    break;\n  case 'rotate':\n    started = true;\n    // we are starting an undoable change (a drag-rotation)\n    canvas.undoMgr.beginUndoableChange('transform', selectedElements);\n    break;\n  default:\n    // This could occur in an extension\n    break;\n  }\n\n  const extResult = runExtensions('mouseDown', {\n    event: evt,\n    start_x: startX,\n    start_y: startY,\n    selectedElements\n  }, true);\n\n  $.each(extResult, function (i, r) {\n    if (r && r.started) {\n      started = true;\n    }\n  });\n};\n\n// in this function we do not record any state changes yet (but we do update\n// any elements that are still being created, moved or resized on the canvas)\nconst mouseMove = function (evt) {\n  if (!started) { return; }\n  if (evt.button === 1 || canvas.spaceKey) { return; }\n\n  let i, xya, c, cx, cy, dx, dy, len, angle, box,\n    selected = selectedElements[0];\n  const\n    pt = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = pt.x * currentZoom,\n    mouseY = pt.y * currentZoom,\n    shape = getElem(getId());\n\n  let realX = mouseX / currentZoom;\n  let x = realX;\n  let realY = mouseY / currentZoom;\n  let y = realY;\n\n  if (curConfig.gridSnapping) {\n    x = snapToGrid(x);\n    y = snapToGrid(y);\n  }\n\n  evt.preventDefault();\n  let tlist;\n  switch (currentMode) {\n  case 'select': {\n    // we temporarily use a translate on the element(s) being dragged\n    // this transform is removed upon mousing up and the element is\n    // relocated to the new location\n    if (selectedElements[0] !== null) {\n      dx = x - startX;\n      dy = y - startY;\n\n      if (curConfig.gridSnapping) {\n        dx = snapToGrid(dx);\n        dy = snapToGrid(dy);\n      }\n\n      if (evt.shiftKey) {\n        xya = snapToAngle(startX, startY, x, y);\n        ({x, y} = xya);\n      }\n\n      if (dx !== 0 || dy !== 0) {\n        len = selectedElements.length;\n        for (i = 0; i < len; ++i) {\n          selected = selectedElements[i];\n          if (selected == null) { break; }\n          // if (i === 0) {\n          //   const box = utilsGetBBox(selected);\n          //     selectedBBoxes[i].x = box.x + dx;\n          //     selectedBBoxes[i].y = box.y + dy;\n          // }\n\n          // update the dummy transform in our transform list\n          // to be a translate\n          const xform = svgroot.createSVGTransform();\n          tlist = getTransformList(selected);\n          // Note that if Webkit and there's no ID for this\n          // element, the dummy transform may have gotten lost.\n          // This results in unexpected behaviour\n\n          xform.setTranslate(dx, dy);\n          if (tlist.numberOfItems) {\n            tlist.replaceItem(xform, 0);\n          } else {\n            tlist.appendItem(xform);\n          }\n\n          // update our internal bbox that we're tracking while dragging\n          selectorManager.requestSelector(selected).resize();\n        }\n\n        call('transition', selectedElements);\n      }\n    }\n    break;\n  } case 'multiselect': {\n    realX *= currentZoom;\n    realY *= currentZoom;\n    assignAttributes(rubberBox, {\n      x: Math.min(rStartX, realX),\n      y: Math.min(rStartY, realY),\n      width: Math.abs(realX - rStartX),\n      height: Math.abs(realY - rStartY)\n    }, 100);\n\n    // for each selected:\n    // - if newList contains selected, do nothing\n    // - if newList doesn't contain selected, remove it from selected\n    // - for any newList that was not in selectedElements, add it to selected\n    const elemsToRemove = selectedElements.slice(), elemsToAdd = [],\n      newList = getIntersectionList();\n\n    // For every element in the intersection, add if not present in selectedElements.\n    len = newList.length;\n    for (i = 0; i < len; ++i) {\n      const intElem = newList[i];\n      // Found an element that was not selected before, so we should add it.\n      if (!selectedElements.includes(intElem)) {\n        elemsToAdd.push(intElem);\n      }\n      // Found an element that was already selected, so we shouldn't remove it.\n      const foundInd = elemsToRemove.indexOf(intElem);\n      if (foundInd !== -1) {\n        elemsToRemove.splice(foundInd, 1);\n      }\n    }\n\n    if (elemsToRemove.length > 0) {\n      canvas.removeFromSelection(elemsToRemove);\n    }\n\n    if (elemsToAdd.length > 0) {\n      canvas.addToSelection(elemsToAdd);\n    }\n\n    break;\n  } case 'resize': {\n    // we track the resize bounding box and translate/scale the selected element\n    // while the mouse is down, when mouse goes up, we use this to recalculate\n    // the shape's coordinates\n    tlist = getTransformList(selected);\n    const hasMatrix = hasMatrixTransform(tlist);\n    box = hasMatrix ? initBbox : utilsGetBBox(selected);\n    let left = box.x,\n      top = box.y,\n      {width, height} = box;\n    dx = (x - startX);\n    dy = (y - startY);\n\n    if (curConfig.gridSnapping) {\n      dx = snapToGrid(dx);\n      dy = snapToGrid(dy);\n      height = snapToGrid(height);\n      width = snapToGrid(width);\n    }\n\n    // if rotated, adjust the dx,dy values\n    angle = getRotationAngle(selected);\n    if (angle) {\n      const r = Math.sqrt(dx * dx + dy * dy),\n        theta = Math.atan2(dy, dx) - angle * Math.PI / 180.0;\n      dx = r * Math.cos(theta);\n      dy = r * Math.sin(theta);\n    }\n\n    // if not stretching in y direction, set dy to 0\n    // if not stretching in x direction, set dx to 0\n    if (!currentResizeMode.includes('n') && !currentResizeMode.includes('s')) {\n      dy = 0;\n    }\n    if (!currentResizeMode.includes('e') && !currentResizeMode.includes('w')) {\n      dx = 0;\n    }\n\n    let // ts = null,\n      tx = 0, ty = 0,\n      sy = height ? (height + dy) / height : 1,\n      sx = width ? (width + dx) / width : 1;\n    // if we are dragging on the north side, then adjust the scale factor and ty\n    if (currentResizeMode.includes('n')) {\n      sy = height ? (height - dy) / height : 1;\n      ty = height;\n    }\n\n    // if we dragging on the east side, then adjust the scale factor and tx\n    if (currentResizeMode.includes('w')) {\n      sx = width ? (width - dx) / width : 1;\n      tx = width;\n    }\n\n    // update the transform list with translate,scale,translate\n    const translateOrigin = svgroot.createSVGTransform(),\n      scale = svgroot.createSVGTransform(),\n      translateBack = svgroot.createSVGTransform();\n\n    if (curConfig.gridSnapping) {\n      left = snapToGrid(left);\n      tx = snapToGrid(tx);\n      top = snapToGrid(top);\n      ty = snapToGrid(ty);\n    }\n\n    translateOrigin.setTranslate(-(left + tx), -(top + ty));\n    if (evt.shiftKey) {\n      if (sx === 1) {\n        sx = sy;\n      } else { sy = sx; }\n    }\n    scale.setScale(sx, sy);\n\n    translateBack.setTranslate(left + tx, top + ty);\n    if (hasMatrix) {\n      const diff = angle ? 1 : 0;\n      tlist.replaceItem(translateOrigin, 2 + diff);\n      tlist.replaceItem(scale, 1 + diff);\n      tlist.replaceItem(translateBack, Number(diff));\n    } else {\n      const N = tlist.numberOfItems;\n      tlist.replaceItem(translateBack, N - 3);\n      tlist.replaceItem(scale, N - 2);\n      tlist.replaceItem(translateOrigin, N - 1);\n    }\n\n    selectorManager.requestSelector(selected).resize();\n\n    call('transition', selectedElements);\n\n    break;\n  } case 'zoom': {\n    realX *= currentZoom;\n    realY *= currentZoom;\n    assignAttributes(rubberBox, {\n      x: Math.min(rStartX * currentZoom, realX),\n      y: Math.min(rStartY * currentZoom, realY),\n      width: Math.abs(realX - rStartX * currentZoom),\n      height: Math.abs(realY - rStartY * currentZoom)\n    }, 100);\n    break;\n  } case 'text': {\n    assignAttributes(shape, {\n      x,\n      y\n    }, 1000);\n    break;\n  } case 'line': {\n    if (curConfig.gridSnapping) {\n      x = snapToGrid(x);\n      y = snapToGrid(y);\n    }\n\n    let x2 = x;\n    let y2 = y;\n\n    if (evt.shiftKey) {\n      xya = snapToAngle(startX, startY, x2, y2);\n      x2 = xya.x;\n      y2 = xya.y;\n    }\n\n    shape.setAttributeNS(null, 'x2', x2);\n    shape.setAttributeNS(null, 'y2', y2);\n    break;\n  } case 'foreignObject':\n    // fall through\n  case 'square':\n    // fall through\n  case 'rect':\n    // fall through\n  case 'image': {\n    const square = (currentMode === 'square') || evt.shiftKey;\n    let\n      w = Math.abs(x - startX),\n      h = Math.abs(y - startY);\n    let newX, newY;\n    if (square) {\n      w = h = Math.max(w, h);\n      newX = startX < x ? startX : startX - w;\n      newY = startY < y ? startY : startY - h;\n    } else {\n      newX = Math.min(startX, x);\n      newY = Math.min(startY, y);\n    }\n\n    if (curConfig.gridSnapping) {\n      w = snapToGrid(w);\n      h = snapToGrid(h);\n      newX = snapToGrid(newX);\n      newY = snapToGrid(newY);\n    }\n\n    assignAttributes(shape, {\n      width: w,\n      height: h,\n      x: newX,\n      y: newY\n    }, 1000);\n\n    break;\n  } case 'circle': {\n    c = $(shape).attr(['cx', 'cy']);\n    ({cx, cy} = c);\n    let rad = Math.sqrt((x - cx) * (x - cx) + (y - cy) * (y - cy));\n    if (curConfig.gridSnapping) {\n      rad = snapToGrid(rad);\n    }\n    shape.setAttributeNS(null, 'r', rad);\n    break;\n  } case 'ellipse': {\n    c = $(shape).attr(['cx', 'cy']);\n    ({cx, cy} = c);\n    if (curConfig.gridSnapping) {\n      x = snapToGrid(x);\n      cx = snapToGrid(cx);\n      y = snapToGrid(y);\n      cy = snapToGrid(cy);\n    }\n    shape.setAttributeNS(null, 'rx', Math.abs(x - cx));\n    const ry = Math.abs(evt.shiftKey ? (x - cx) : (y - cy));\n    shape.setAttributeNS(null, 'ry', ry);\n    break;\n  }\n  case 'fhellipse':\n  case 'fhrect': {\n    freehand.minx = Math.min(realX, freehand.minx);\n    freehand.maxx = Math.max(realX, freehand.maxx);\n    freehand.miny = Math.min(realY, freehand.miny);\n    freehand.maxy = Math.max(realY, freehand.maxy);\n  }\n  // Fallthrough\n  case 'fhpath': {\n    // dAttr += + realX + ',' + realY + ' ';\n    // shape.setAttributeNS(null, 'points', dAttr);\n    end.x = realX; end.y = realY;\n    if (controllPoint2.x && controllPoint2.y) {\n      for (i = 0; i < STEP_COUNT - 1; i++) {\n        parameter = i / STEP_COUNT;\n        nextParameter = (i + 1) / STEP_COUNT;\n        bSpline = getBsplinePoint(nextParameter);\n        nextPos = bSpline;\n        bSpline = getBsplinePoint(parameter);\n        sumDistance += Math.sqrt((nextPos.x - bSpline.x) * (nextPos.x - bSpline.x) + (nextPos.y - bSpline.y) * (nextPos.y - bSpline.y));\n        if (sumDistance > THRESHOLD_DIST) {\n          dAttr += +bSpline.x + ',' + bSpline.y + ' ';\n          shape.setAttributeNS(null, 'points', dAttr);\n          sumDistance -= THRESHOLD_DIST;\n        }\n      }\n    }\n    controllPoint2 = {x: controllPoint1.x, y: controllPoint1.y};\n    controllPoint1 = {x: start.x, y: start.y};\n    start = {x: end.x, y: end.y};\n    break;\n  // update path stretch line coordinates\n  } case 'path': {\n  }\n  // fall through\n  case 'pathedit': {\n    x *= currentZoom;\n    y *= currentZoom;\n\n    if (curConfig.gridSnapping) {\n      x = snapToGrid(x);\n      y = snapToGrid(y);\n      startX = snapToGrid(startX);\n      startY = snapToGrid(startY);\n    }\n    if (evt.shiftKey) {\n      const {path} = pathModule;\n      let x1, y1;\n      if (path) {\n        x1 = path.dragging ? path.dragging[0] : startX;\n        y1 = path.dragging ? path.dragging[1] : startY;\n      } else {\n        x1 = startX;\n        y1 = startY;\n      }\n      xya = snapToAngle(x1, y1, x, y);\n      ({x, y} = xya);\n    }\n\n    if (rubberBox && rubberBox.getAttribute('display') !== 'none') {\n      realX *= currentZoom;\n      realY *= currentZoom;\n      assignAttributes(rubberBox, {\n        x: Math.min(rStartX * currentZoom, realX),\n        y: Math.min(rStartY * currentZoom, realY),\n        width: Math.abs(realX - rStartX * currentZoom),\n        height: Math.abs(realY - rStartY * currentZoom)\n      }, 100);\n    }\n    pathActions.mouseMove(x, y);\n\n    break;\n  } case 'textedit': {\n    x *= currentZoom;\n    y *= currentZoom;\n    // if (rubberBox && rubberBox.getAttribute('display') !== 'none') {\n    //   assignAttributes(rubberBox, {\n    //     x: Math.min(startX, x),\n    //     y: Math.min(startY, y),\n    //     width: Math.abs(x - startX),\n    //     height: Math.abs(y - startY)\n    //   }, 100);\n    // }\n\n    textActions.mouseMove(mouseX, mouseY);\n\n    break;\n  } case 'rotate': {\n    box = utilsGetBBox(selected);\n    cx = box.x + box.width / 2;\n    cy = box.y + box.height / 2;\n    const m = getMatrix(selected),\n      center = transformPoint(cx, cy, m);\n    cx = center.x;\n    cy = center.y;\n    angle = ((Math.atan2(cy - y, cx - x) * (180 / Math.PI)) - 90) % 360;\n    if (curConfig.gridSnapping) {\n      angle = snapToGrid(angle);\n    }\n    if (evt.shiftKey) { // restrict rotations to nice angles (WRS)\n      const snap = 45;\n      angle = Math.round(angle / snap) * snap;\n    }\n\n    canvas.setRotationAngle(angle < -180 ? (360 + angle) : angle, true);\n    call('transition', selectedElements);\n    break;\n  } default:\n    break;\n  }\n\n  runExtensions('mouseMove', {\n    event: evt,\n    mouse_x: mouseX,\n    mouse_y: mouseY,\n    selected\n  });\n}; // mouseMove()\n\n// - in create mode, the element's opacity is set properly, we create an InsertElementCommand\n// and store it on the Undo stack\n// - in move/resize mode, the element's attributes which were affected by the move/resize are\n// identified, a ChangeElementCommand is created and stored on the stack for those attrs\n// this is done in when we recalculate the selected dimensions()\nconst mouseUp = function (evt) {\n  if (evt.button === 2) { return; }\n  const tempJustSelected = justSelected;\n  justSelected = null;\n  if (!started) { return; }\n  const pt = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = pt.x * currentZoom,\n    mouseY = pt.y * currentZoom,\n    x = mouseX / currentZoom,\n    y = mouseY / currentZoom;\n\n  let element = getElem(getId());\n  let keep = false;\n\n  const realX = x;\n  const realY = y;\n\n  // TODO: Make true when in multi-unit mode\n  const useUnit = false; // (curConfig.baseUnit !== 'px');\n  started = false;\n  let attrs, t;\n  switch (currentMode) {\n  // intentionally fall-through to select here\n  case 'resize':\n  case 'multiselect':\n    if (rubberBox != null) {\n      rubberBox.setAttribute('display', 'none');\n      curBBoxes = [];\n    }\n    currentMode = 'select';\n    // Fallthrough\n  case 'select':\n    if (selectedElements[0] != null) {\n      // if we only have one selected element\n      if (selectedElements[1] == null) {\n        // set our current stroke/fill properties to the element's\n        const selected = selectedElements[0];\n        switch (selected.tagName) {\n        case 'g':\n        case 'use':\n        case 'image':\n        case 'foreignObject':\n          break;\n        default:\n          curProperties.fill = selected.getAttribute('fill');\n          curProperties.fill_opacity = selected.getAttribute('fill-opacity');\n          curProperties.stroke = selected.getAttribute('stroke');\n          curProperties.stroke_opacity = selected.getAttribute('stroke-opacity');\n          curProperties.stroke_width = selected.getAttribute('stroke-width');\n          curProperties.stroke_dasharray = selected.getAttribute('stroke-dasharray');\n          curProperties.stroke_linejoin = selected.getAttribute('stroke-linejoin');\n          curProperties.stroke_linecap = selected.getAttribute('stroke-linecap');\n        }\n\n        if (selected.tagName === 'text') {\n          curText.font_size = selected.getAttribute('font-size');\n          curText.font_family = selected.getAttribute('font-family');\n        }\n        selectorManager.requestSelector(selected).showGrips(true);\n\n        // This shouldn't be necessary as it was done on mouseDown...\n        // call('selected', [selected]);\n      }\n      // always recalculate dimensions to strip off stray identity transforms\n      recalculateAllSelectedDimensions();\n      // if it was being dragged/resized\n      if (realX !== rStartX || realY !== rStartY) {\n        const len = selectedElements.length;\n        for (let i = 0; i < len; ++i) {\n          if (selectedElements[i] == null) { break; }\n          if (!selectedElements[i].firstChild) {\n            // Not needed for groups (incorrectly resizes elems), possibly not needed at all?\n            selectorManager.requestSelector(selectedElements[i]).resize();\n          }\n        }\n      // no change in position/size, so maybe we should move to pathedit\n      } else {\n        t = evt.target;\n        if (selectedElements[0].nodeName === 'path' && selectedElements[1] == null) {\n          pathActions.select(selectedElements[0]);\n        // if it was a path\n        // else, if it was selected and this is a shift-click, remove it from selection\n        } else if (evt.shiftKey) {\n          if (tempJustSelected !== t) {\n            canvas.removeFromSelection([t]);\n          }\n        }\n      } // no change in mouse position\n\n      // Remove non-scaling stroke\n      if (supportsNonScalingStroke()) {\n        const elem = selectedElements[0];\n        if (elem) {\n          elem.removeAttribute('style');\n          walkTree(elem, function (elem) {\n            elem.removeAttribute('style');\n          });\n        }\n      }\n    }\n    return;\n  case 'zoom':\n    if (rubberBox != null) {\n      rubberBox.setAttribute('display', 'none');\n    }\n    const factor = evt.shiftKey ? 0.5 : 2;\n    call('zoomed', {\n      x: Math.min(rStartX, realX),\n      y: Math.min(rStartY, realY),\n      width: Math.abs(realX - rStartX),\n      height: Math.abs(realY - rStartY),\n      factor\n    });\n    return;\n  case 'fhpath':\n    // Check that the path contains at least 2 points; a degenerate one-point path\n    // causes problems.\n    // Webkit ignores how we set the points attribute with commas and uses space\n    // to separate all coordinates, see https://bugs.webkit.org/show_bug.cgi?id=29870\n    sumDistance = 0;\n    controllPoint2 = {x: 0, y: 0};\n    controllPoint1 = {x: 0, y: 0};\n    start = {x: 0, y: 0};\n    end = {x: 0, y: 0};\n    const coords = element.getAttribute('points');\n    const commaIndex = coords.indexOf(',');\n    if (commaIndex >= 0) {\n      keep = coords.indexOf(',', commaIndex + 1) >= 0;\n    } else {\n      keep = coords.indexOf(' ', coords.indexOf(' ') + 1) >= 0;\n    }\n    if (keep) {\n      element = pathActions.smoothPolylineIntoPath(element);\n    }\n    break;\n  case 'line':\n    attrs = $(element).attr(['x1', 'x2', 'y1', 'y2']);\n    keep = (attrs.x1 !== attrs.x2 || attrs.y1 !== attrs.y2);\n    break;\n  case 'foreignObject':\n  case 'square':\n  case 'rect':\n  case 'image':\n    attrs = $(element).attr(['width', 'height']);\n    // Image should be kept regardless of size (use inherit dimensions later)\n    keep = (attrs.width || attrs.height) || currentMode === 'image';\n    break;\n  case 'circle':\n    keep = (element.getAttribute('r') !== '0');\n    break;\n  case 'ellipse':\n    attrs = $(element).attr(['rx', 'ry']);\n    keep = (attrs.rx || attrs.ry);\n    break;\n  case 'fhellipse':\n    if ((freehand.maxx - freehand.minx) > 0 &&\n      (freehand.maxy - freehand.miny) > 0) {\n      element = addSvgElementFromJson({\n        element: 'ellipse',\n        curStyles: true,\n        attr: {\n          cx: (freehand.minx + freehand.maxx) / 2,\n          cy: (freehand.miny + freehand.maxy) / 2,\n          rx: (freehand.maxx - freehand.minx) / 2,\n          ry: (freehand.maxy - freehand.miny) / 2,\n          id: getId()\n        }\n      });\n      call('changed', [element]);\n      keep = true;\n    }\n    break;\n  case 'fhrect':\n    if ((freehand.maxx - freehand.minx) > 0 &&\n      (freehand.maxy - freehand.miny) > 0) {\n      element = addSvgElementFromJson({\n        element: 'rect',\n        curStyles: true,\n        attr: {\n          x: freehand.minx,\n          y: freehand.miny,\n          width: (freehand.maxx - freehand.minx),\n          height: (freehand.maxy - freehand.miny),\n          id: getId()\n        }\n      });\n      call('changed', [element]);\n      keep = true;\n    }\n    break;\n  case 'text':\n    keep = true;\n    selectOnly([element]);\n    textActions.start(element);\n    break;\n  case 'path':\n    // set element to null here so that it is not removed nor finalized\n    element = null;\n    // continue to be set to true so that mouseMove happens\n    started = true;\n\n    const res = pathActions.mouseUp(evt, element, mouseX, mouseY);\n    ({element} = res);\n    ({keep} = res);\n    break;\n  case 'pathedit':\n    keep = true;\n    element = null;\n    pathActions.mouseUp(evt);\n    break;\n  case 'textedit':\n    keep = false;\n    element = null;\n    textActions.mouseUp(evt, mouseX, mouseY);\n    break;\n  case 'rotate':\n    keep = true;\n    element = null;\n    currentMode = 'select';\n    const batchCmd = canvas.undoMgr.finishUndoableChange();\n    if (!batchCmd.isEmpty()) {\n      addCommandToHistory(batchCmd);\n    }\n    // perform recalculation to weed out any stray identity transforms that might get stuck\n    recalculateAllSelectedDimensions();\n    call('changed', selectedElements);\n    break;\n  default:\n    // This could occur in an extension\n    break;\n  }\n\n  const extResult = runExtensions('mouseUp', {\n    event: evt,\n    mouse_x: mouseX,\n    mouse_y: mouseY\n  }, true);\n\n  $.each(extResult, function (i, r) {\n    if (r) {\n      keep = r.keep || keep;\n      ({element} = r);\n      started = r.started || started;\n    }\n  });\n\n  if (!keep && element != null) {\n    getCurrentDrawing().releaseId(getId());\n    element.remove();\n    element = null;\n\n    t = evt.target;\n\n    // if this element is in a group, go up until we reach the top-level group\n    // just below the layer groups\n    // TODO: once we implement links, we also would have to check for <a> elements\n    while (t && t.parentNode && t.parentNode.parentNode && t.parentNode.parentNode.tagName === 'g') {\n      t = t.parentNode;\n    }\n    // if we are not in the middle of creating a path, and we've clicked on some shape,\n    // then go to Select mode.\n    // WebKit returns <div> when the canvas is clicked, Firefox/Opera return <svg>\n    if ((currentMode !== 'path' || !drawnPath) &&\n      t && t.parentNode &&\n      t.parentNode.id !== 'selectorParentGroup' &&\n      t.id !== 'svgcanvas' && t.id !== 'svgroot'\n    ) {\n      // switch into \"select\" mode if we've clicked on an element\n      canvas.setMode('select');\n      selectOnly([t], true);\n    }\n  } else if (element != null) {\n    canvas.addedNew = true;\n\n    if (useUnit) { convertAttrs(element); }\n\n    let aniDur = 0.2;\n    let cAni;\n    if (opacAni.beginElement && parseFloat(element.getAttribute('opacity')) !== curShape.opacity) {\n      cAni = $(opacAni).clone().attr({\n        to: curShape.opacity,\n        dur: aniDur\n      }).appendTo(element);\n      try {\n        // Fails in FF4 on foreignObject\n        cAni[0].beginElement();\n      } catch (e) {}\n    } else {\n      aniDur = 0;\n    }\n\n    // Ideally this would be done on the endEvent of the animation,\n    // but that doesn't seem to be supported in Webkit\n    setTimeout(function () {\n      if (cAni) { cAni.remove(); }\n      element.setAttribute('opacity', curShape.opacity);\n      element.setAttribute('style', 'pointer-events:inherit');\n      cleanupElement(element);\n      if (currentMode === 'path') {\n        pathActions.toEditMode(element);\n      } else if (curConfig.selectNew) {\n        selectOnly([element], true);\n      }\n      // we create the insert command that is stored on the stack\n      // undo means to call cmd.unapply(), redo means to call cmd.apply()\n      addCommandToHistory(new InsertElementCommand(element));\n\n      call('changed', [element]);\n    }, aniDur * 1000);\n  }\n\n  startTransform = null;\n};\n\nconst dblClick = function (evt) {\n  const evtTarget = evt.target;\n  const parent = evtTarget.parentNode;\n\n  // Do nothing if already in current group\n  if (parent === currentGroup) { return; }\n\n  let mouseTarget = getMouseTarget(evt);\n  const {tagName} = mouseTarget;\n\n  if (tagName === 'text' && currentMode !== 'textedit') {\n    const pt = transformPoint(evt.pageX, evt.pageY, rootSctm);\n    textActions.select(mouseTarget, pt.x, pt.y);\n  }\n\n  if ((tagName === 'g' || tagName === 'a') &&\n    getRotationAngle(mouseTarget)\n  ) {\n    // TODO: Allow method of in-group editing without having to do\n    // this (similar to editing rotated paths)\n\n    // Ungroup and regroup\n    pushGroupProperties(mouseTarget);\n    mouseTarget = selectedElements[0];\n    clearSelection(true);\n  }\n  // Reset context\n  if (currentGroup) {\n    draw.leaveContext();\n  }\n\n  if ((parent.tagName !== 'g' && parent.tagName !== 'a') ||\n    parent === getCurrentDrawing().getCurrentLayer() ||\n    mouseTarget === selectorManager.selectorParentGroup\n  ) {\n    // Escape from in-group edit\n    return;\n  }\n  draw.setContext(mouseTarget);\n};\n\n// prevent links from being followed in the canvas\nconst handleLinkInCanvas = function (e) {\n  e.preventDefault();\n  return false;\n};\n\n// Added mouseup to the container here.\n// TODO(codedread): Figure out why after the Closure compiler, the window mouseup is ignored.\n$(container).mousedown(mouseDown).mousemove(mouseMove).click(handleLinkInCanvas).dblclick(dblClick).mouseup(mouseUp);\n// $(window).mouseup(mouseUp);\n\n// TODO(rafaelcastrocouto): User preference for shift key and zoom factor\n$(container).bind('mousewheel DOMMouseScroll', function (e) {\n  if (!e.shiftKey) { return; }\n\n  e.preventDefault();\n  const evt = e.originalEvent;\n\n  rootSctm = $('#svgcontent g')[0].getScreenCTM().inverse();\n\n  const workarea = $('#workarea');\n\tconst scrbar = 15;\n\tconst rulerwidth = curConfig.showRulers ? 16 : 0;\n\n\t// mouse relative to content area in content pixels\n\tconst pt = transformPoint(evt.pageX, evt.pageY, rootSctm);\n\n\t// full work area width in screen pixels\n\tconst editorFullW = workarea.width();\n\tconst editorFullH = workarea.height();\n\n\t// work area width minus scroll and ruler in screen pixels\n\tconst editorW = editorFullW - scrbar - rulerwidth;\n\tconst editorH = editorFullH - scrbar - rulerwidth;\n\n\t// work area width in content pixels\n\tconst workareaViewW = editorW * rootSctm.a;\n\tconst workareaViewH = editorH * rootSctm.d;\n\n\t// content offset from canvas in screen pixels\n\tconst wOffset = workarea.offset();\n\tconst wOffsetLeft = wOffset['left'] + rulerwidth;\n\tconst wOffsetTop = wOffset['top'] + rulerwidth;\n\n  const delta = (evt.wheelDelta) ? evt.wheelDelta : (evt.detail) ? -evt.detail : 0;\n  if (!delta) { return; }\n\n  let factor = Math.max(3 / 4, Math.min(4 / 3, (delta)));\n\n  let wZoom, hZoom;\n\tif (factor > 1) {\n\t\twZoom = Math.ceil(editorW / workareaViewW * factor * 100) / 100;\n\t\thZoom = Math.ceil(editorH / workareaViewH * factor * 100) / 100;\n\t} else {\n\t\twZoom = Math.floor(editorW / workareaViewW * factor * 100) / 100;\n\t\thZoom = Math.floor(editorH / workareaViewH * factor * 100) / 100;\n\t}\n\tlet zoomlevel = Math.min(wZoom, hZoom);\n\tzoomlevel = Math.min(10, Math.max(0.01, zoomlevel));\n\tif (zoomlevel === currentZoom) {\n\t\treturn;\n\t}\n\tfactor = zoomlevel / currentZoom;\n\n\t// top left of workarea in content pixels before zoom\n\tconst topLeftOld = transformPoint(wOffsetLeft, wOffsetTop, rootSctm);\n\n\t// top left of workarea in content pixels after zoom\n\tconst topLeftNew = {\n\t\tx: pt.x - (pt.x - topLeftOld.x) / factor,\n\t\ty: pt.y - (pt.y - topLeftOld.y) / factor\n\t};\n\n\t// top left of workarea in canvas pixels relative to content after zoom\n\tconst topLeftNewCanvas = {\n\t\tx: topLeftNew.x * zoomlevel,\n\t\ty: topLeftNew.y * zoomlevel\n\t};\n\n\t// new center in canvas pixels\n\tconst newCtr = {\n\t\tx: topLeftNewCanvas.x - rulerwidth + editorFullW / 2,\n\t\ty: topLeftNewCanvas.y - rulerwidth + editorFullH / 2\n\t};\n\n\tcanvas.setZoom(zoomlevel);\n\t$('#zoom').val((zoomlevel * 100).toFixed(1));\n\n\tcall('updateCanvas', {center: false, newCtr});\n\tcall('zoomDone');\n});\n}());\n\n/**\n* Group: Text edit functions\n* Functions relating to editing text elements\n*/\nconst textActions = canvas.textActions = (function () {\nlet curtext;\nlet textinput;\nlet cursor;\nlet selblock;\nlet blinker;\nlet chardata = [];\nlet textbb; // , transbb;\nlet matrix;\nlet lastX, lastY;\nlet allowDbl;\n\nfunction setCursor (index) {\n  const empty = (textinput.value === '');\n  $(textinput).focus();\n\n  if (!arguments.length) {\n    if (empty) {\n      index = 0;\n    } else {\n      if (textinput.selectionEnd !== textinput.selectionStart) { return; }\n      index = textinput.selectionEnd;\n    }\n  }\n\n  const charbb = chardata[index];\n  if (!empty) {\n    textinput.setSelectionRange(index, index);\n  }\n  cursor = getElem('text_cursor');\n  if (!cursor) {\n    cursor = document.createElementNS(NS.SVG, 'line');\n    assignAttributes(cursor, {\n      id: 'text_cursor',\n      stroke: '#333',\n      'stroke-width': 1\n    });\n    cursor = getElem('selectorParentGroup').appendChild(cursor);\n  }\n\n  if (!blinker) {\n    blinker = setInterval(function () {\n      const show = (cursor.getAttribute('display') === 'none');\n      cursor.setAttribute('display', show ? 'inline' : 'none');\n    }, 600);\n  }\n\n  const startPt = ptToScreen(charbb.x, textbb.y);\n  const endPt = ptToScreen(charbb.x, (textbb.y + textbb.height));\n\n  assignAttributes(cursor, {\n    x1: startPt.x,\n    y1: startPt.y,\n    x2: endPt.x,\n    y2: endPt.y,\n    visibility: 'visible',\n    display: 'inline'\n  });\n\n  if (selblock) { selblock.setAttribute('d', ''); }\n}\n\nfunction setSelection (start, end, skipInput) {\n  if (start === end) {\n    setCursor(end);\n    return;\n  }\n\n  if (!skipInput) {\n    textinput.setSelectionRange(start, end);\n  }\n\n  selblock = getElem('text_selectblock');\n  if (!selblock) {\n    selblock = document.createElementNS(NS.SVG, 'path');\n    assignAttributes(selblock, {\n      id: 'text_selectblock',\n      fill: 'green',\n      opacity: 0.5,\n      style: 'pointer-events:none'\n    });\n    getElem('selectorParentGroup').append(selblock);\n  }\n\n  const startbb = chardata[start];\n  const endbb = chardata[end];\n\n  cursor.setAttribute('visibility', 'hidden');\n\n  const tl = ptToScreen(startbb.x, textbb.y),\n    tr = ptToScreen(startbb.x + (endbb.x - startbb.x), textbb.y),\n    bl = ptToScreen(startbb.x, textbb.y + textbb.height),\n    br = ptToScreen(startbb.x + (endbb.x - startbb.x), textbb.y + textbb.height);\n\n  const dstr = 'M' + tl.x + ',' + tl.y +\n    ' L' + tr.x + ',' + tr.y +\n    ' ' + br.x + ',' + br.y +\n    ' ' + bl.x + ',' + bl.y + 'z';\n\n  assignAttributes(selblock, {\n    d: dstr,\n    display: 'inline'\n  });\n}\n\nfunction getIndexFromPoint (mouseX, mouseY) {\n  // Position cursor here\n  const pt = svgroot.createSVGPoint();\n  pt.x = mouseX;\n  pt.y = mouseY;\n\n  // No content, so return 0\n  if (chardata.length === 1) { return 0; }\n  // Determine if cursor should be on left or right of character\n  let charpos = curtext.getCharNumAtPosition(pt);\n  if (charpos < 0) {\n    // Out of text range, look at mouse coords\n    charpos = chardata.length - 2;\n    if (mouseX <= chardata[0].x) {\n      charpos = 0;\n    }\n  } else if (charpos >= chardata.length - 2) {\n    charpos = chardata.length - 2;\n  }\n  const charbb = chardata[charpos];\n  const mid = charbb.x + (charbb.width / 2);\n  if (mouseX > mid) {\n    charpos++;\n  }\n  return charpos;\n}\n\nfunction setCursorFromPoint (mouseX, mouseY) {\n  setCursor(getIndexFromPoint(mouseX, mouseY));\n}\n\nfunction setEndSelectionFromPoint (x, y, apply) {\n  const i1 = textinput.selectionStart;\n  const i2 = getIndexFromPoint(x, y);\n\n  const start = Math.min(i1, i2);\n  const end = Math.max(i1, i2);\n  setSelection(start, end, !apply);\n}\n\nfunction screenToPt (xIn, yIn) {\n  const out = {\n    x: xIn,\n    y: yIn\n  };\n\n  out.x /= currentZoom;\n  out.y /= currentZoom;\n\n  if (matrix) {\n    const pt = transformPoint(out.x, out.y, matrix.inverse());\n    out.x = pt.x;\n    out.y = pt.y;\n  }\n\n  return out;\n}\n\nfunction ptToScreen (xIn, yIn) {\n  const out = {\n    x: xIn,\n    y: yIn\n  };\n\n  if (matrix) {\n    const pt = transformPoint(out.x, out.y, matrix);\n    out.x = pt.x;\n    out.y = pt.y;\n  }\n\n  out.x *= currentZoom;\n  out.y *= currentZoom;\n\n  return out;\n}\n\n/*\n// Not currently in use\nfunction hideCursor () {\n  if (cursor) {\n    cursor.setAttribute('visibility', 'hidden');\n  }\n}\n*/\n\nfunction selectAll (evt) {\n  setSelection(0, curtext.textContent.length);\n  $(this).unbind(evt);\n}\n\nfunction selectWord (evt) {\n  if (!allowDbl || !curtext) { return; }\n\n  const ept = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = ept.x * currentZoom,\n    mouseY = ept.y * currentZoom;\n  const pt = screenToPt(mouseX, mouseY);\n\n  const index = getIndexFromPoint(pt.x, pt.y);\n  const str = curtext.textContent;\n  const first = str.substr(0, index).replace(/[a-z0-9]+$/i, '').length;\n  const m = str.substr(index).match(/^[a-z0-9]+/i);\n  const last = (m ? m[0].length : 0) + index;\n  setSelection(first, last);\n\n  // Set tripleclick\n  $(evt.target).click(selectAll);\n  setTimeout(function () {\n    $(evt.target).unbind('click', selectAll);\n  }, 300);\n}\n\nreturn {\n  select (target, x, y) {\n    curtext = target;\n    textActions.toEditMode(x, y);\n  },\n  start (elem) {\n    curtext = elem;\n    textActions.toEditMode();\n  },\n  mouseDown (evt, mouseTarget, startX, startY) {\n    const pt = screenToPt(startX, startY);\n\n    textinput.focus();\n    setCursorFromPoint(pt.x, pt.y);\n    lastX = startX;\n    lastY = startY;\n\n    // TODO: Find way to block native selection\n  },\n  mouseMove (mouseX, mouseY) {\n    const pt = screenToPt(mouseX, mouseY);\n    setEndSelectionFromPoint(pt.x, pt.y);\n  },\n  mouseUp (evt, mouseX, mouseY) {\n    const pt = screenToPt(mouseX, mouseY);\n\n    setEndSelectionFromPoint(pt.x, pt.y, true);\n\n    // TODO: Find a way to make this work: Use transformed BBox instead of evt.target\n    // if (lastX === mouseX && lastY === mouseY\n    //   && !rectsIntersect(transbb, {x: pt.x, y: pt.y, width: 0, height: 0})) {\n    //   textActions.toSelectMode(true);\n    // }\n\n    if (\n      evt.target !== curtext &&\n      mouseX < lastX + 2 &&\n      mouseX > lastX - 2 &&\n      mouseY < lastY + 2 &&\n      mouseY > lastY - 2\n    ) {\n      textActions.toSelectMode(true);\n    }\n  },\n  setCursor,\n  toEditMode (x, y) {\n    allowDbl = false;\n    currentMode = 'textedit';\n    selectorManager.requestSelector(curtext).showGrips(false);\n    // Make selector group accept clicks\n    /* const selector = */ selectorManager.requestSelector(curtext); // Do we need this? Has side effect of setting lock, so keeping for now, but next line wasn't being used\n    // const sel = selector.selectorRect;\n\n    textActions.init();\n\n    $(curtext).css('cursor', 'text');\n\n    // if (supportsEditableText()) {\n    //   curtext.setAttribute('editable', 'simple');\n    //   return;\n    // }\n\n    if (!arguments.length) {\n      setCursor();\n    } else {\n      const pt = screenToPt(x, y);\n      setCursorFromPoint(pt.x, pt.y);\n    }\n\n    setTimeout(function () {\n      allowDbl = true;\n    }, 300);\n  },\n  toSelectMode (selectElem) {\n    currentMode = 'select';\n    clearInterval(blinker);\n    blinker = null;\n    if (selblock) { $(selblock).attr('display', 'none'); }\n    if (cursor) { $(cursor).attr('visibility', 'hidden'); }\n    $(curtext).css('cursor', 'move');\n\n    if (selectElem) {\n      clearSelection();\n      $(curtext).css('cursor', 'move');\n\n      call('selected', [curtext]);\n      addToSelection([curtext], true);\n    }\n    if (curtext && !curtext.textContent.length) {\n      // No content, so delete\n      canvas.deleteSelectedElements();\n    }\n\n    $(textinput).blur();\n\n    curtext = false;\n\n    // if (supportsEditableText()) {\n    //   curtext.removeAttribute('editable');\n    // }\n  },\n  setInputElem (elem) {\n    textinput = elem;\n    // $(textinput).blur(hideCursor);\n  },\n  clear () {\n    if (currentMode === 'textedit') {\n      textActions.toSelectMode();\n    }\n  },\n  init (inputElem) {\n    if (!curtext) { return; }\n    let i, end;\n    // if (supportsEditableText()) {\n    //   curtext.select();\n    //   return;\n    // }\n\n    if (!curtext.parentNode) {\n      // Result of the ffClone, need to get correct element\n      curtext = selectedElements[0];\n      selectorManager.requestSelector(curtext).showGrips(false);\n    }\n\n    const str = curtext.textContent;\n    const len = str.length;\n\n    const xform = curtext.getAttribute('transform');\n\n    textbb = utilsGetBBox(curtext);\n\n    matrix = xform ? getMatrix(curtext) : null;\n\n    chardata = [];\n    chardata.length = len;\n    textinput.focus();\n\n    $(curtext).unbind('dblclick', selectWord).dblclick(selectWord);\n\n    if (!len) {\n      end = {x: textbb.x + (textbb.width / 2), width: 0};\n    }\n\n    for (i = 0; i < len; i++) {\n      const start = curtext.getStartPositionOfChar(i);\n      end = curtext.getEndPositionOfChar(i);\n\n      if (!supportsGoodTextCharPos()) {\n        const offset = canvas.contentW * currentZoom;\n        start.x -= offset;\n        end.x -= offset;\n\n        start.x /= currentZoom;\n        end.x /= currentZoom;\n      }\n\n      // Get a \"bbox\" equivalent for each character. Uses the\n      // bbox data of the actual text for y, height purposes\n\n      // TODO: Decide if y, width and height are actually necessary\n      chardata[i] = {\n        x: start.x,\n        y: textbb.y, // start.y?\n        width: end.x - start.x,\n        height: textbb.height\n      };\n    }\n\n    // Add a last bbox for cursor at end of text\n    chardata.push({\n      x: end.x,\n      width: 0\n    });\n    setSelection(textinput.selectionStart, textinput.selectionEnd, true);\n  }\n};\n}());\n\n/**\n* Group: Serialization\n*/\n\n/**\n* Looks at DOM elements inside the <defs> to see if they are referred to,\n* removes them from the DOM if they are not.\n* @returns The amount of elements that were removed\n*/\nconst removeUnusedDefElems = this.removeUnusedDefElems = function () {\n  const defs = svgcontent.getElementsByTagNameNS(NS.SVG, 'defs');\n  if (!defs || !defs.length) { return 0; }\n\n  // if (!defs.firstChild) { return; }\n\n  const defelemUses = [];\n  let numRemoved = 0;\n  const attrs = ['fill', 'stroke', 'filter', 'marker-start', 'marker-mid', 'marker-end'];\n  const alen = attrs.length;\n\n  const allEls = svgcontent.getElementsByTagNameNS(NS.SVG, '*');\n  const allLen = allEls.length;\n\n  let i, j;\n  for (i = 0; i < allLen; i++) {\n    const el = allEls[i];\n    for (j = 0; j < alen; j++) {\n      const ref = getUrlFromAttr(el.getAttribute(attrs[j]));\n      if (ref) {\n        defelemUses.push(ref.substr(1));\n      }\n    }\n\n    // gradients can refer to other gradients\n    const href = getHref(el);\n    if (href && href.startsWith('#')) {\n      defelemUses.push(href.substr(1));\n    }\n  }\n\n  const defelems = $(defs).find('linearGradient, radialGradient, filter, marker, svg, symbol');\n  i = defelems.length;\n  while (i--) {\n    const defelem = defelems[i];\n    const {id} = defelem;\n    if (!defelemUses.includes(id)) {\n      // Not found, so remove (but remember)\n      removedElements[id] = defelem;\n      defelem.remove();\n      numRemoved++;\n    }\n  }\n\n  return numRemoved;\n};\n\n/**\n* Main function to set up the SVG content for output\n* @returns {String} The SVG image for output\n*/\nthis.svgCanvasToString = function () {\n  // keep calling it until there are none to remove\n  while (removeUnusedDefElems() > 0) {}\n\n  pathActions.clear(true);\n\n  // Keep SVG-Edit comment on top\n  $.each(svgcontent.childNodes, function (i, node) {\n    if (i && node.nodeType === 8 && node.data.includes('Created with')) {\n      svgcontent.firstChild.before(node);\n    }\n  });\n\n  // Move out of in-group editing mode\n  if (currentGroup) {\n    draw.leaveContext();\n    selectOnly([currentGroup]);\n  }\n\n  const nakedSvgs = [];\n\n  // Unwrap gsvg if it has no special attributes (only id and style)\n  $(svgcontent).find('g:data(gsvg)').each(function () {\n    const attrs = this.attributes;\n    let len = attrs.length;\n    for (let i = 0; i < len; i++) {\n      if (attrs[i].nodeName === 'id' || attrs[i].nodeName === 'style') {\n        len--;\n      }\n    }\n    // No significant attributes, so ungroup\n    if (len <= 0) {\n      const svg = this.firstChild;\n      nakedSvgs.push(svg);\n      $(this).replaceWith(svg);\n    }\n  });\n  const output = this.svgToString(svgcontent, 0);\n\n  // Rewrap gsvg\n  if (nakedSvgs.length) {\n    $(nakedSvgs).each(function () {\n      groupSvgElem(this);\n    });\n  }\n\n  return output;\n};\n\n/**\n* Sub function ran on each SVG element to convert it to a string as desired\n* @param elem - The SVG element to convert\n* @param {Number} indent - Integer with the amount of spaces to indent this tag\n* @returns {String} The given element as an SVG tag\n*/\nthis.svgToString = function (elem, indent) {\n  const out = [];\n  const unit = curConfig.baseUnit;\n  const unitRe = new RegExp('^-?[\\\\d\\\\.]+' + unit + '$');\n\n  if (elem) {\n    cleanupElement(elem);\n    const attrs = Array.from(elem.attributes);\n    let i;\n    const childs = elem.childNodes;\n    attrs.sort((a, b) => a.name > b.name ? -1 : 1);\n\n    for (i = 0; i < indent; i++) { out.push(' '); }\n    out.push('<'); out.push(elem.nodeName);\n    if (elem.id === 'svgcontent') {\n      // Process root element separately\n      const res = getResolution();\n\n      const vb = '';\n      // TODO: Allow this by dividing all values by current baseVal\n      // Note that this also means we should properly deal with this on import\n      // if (curConfig.baseUnit !== 'px') {\n      //   const unit = curConfig.baseUnit;\n      //   const unitM = getTypeMap()[unit];\n      //   res.w = shortFloat(res.w / unitM);\n      //   res.h = shortFloat(res.h / unitM);\n      //   vb = ' viewBox=\"' + [0, 0, res.w, res.h].join(' ') + '\"';\n      //   res.w += unit;\n      //   res.h += unit;\n      // }\n\n      if (unit !== 'px') {\n        res.w = convertUnit(res.w, unit) + unit;\n        res.h = convertUnit(res.h, unit) + unit;\n      }\n\n      out.push(' width=\"' + res.w + '\" height=\"' + res.h + '\"' + vb + ' xmlns=\"' + NS.SVG + '\"');\n\n      const nsuris = {};\n\n      // Check elements for namespaces, add if found\n      $(elem).find('*').andSelf().each(function () {\n        // const el = this;\n        // for some elements have no attribute\n        const uri = this.namespaceURI;\n        if (uri && !nsuris[uri] && nsMap[uri] && nsMap[uri] !== 'xmlns' && nsMap[uri] !== 'xml') {\n          nsuris[uri] = true;\n          out.push(' xmlns:' + nsMap[uri] + '=\"' + uri + '\"');\n        }\n\n        $.each(this.attributes, function (i, attr) {\n          const uri = attr.namespaceURI;\n          if (uri && !nsuris[uri] && nsMap[uri] !== 'xmlns' && nsMap[uri] !== 'xml') {\n            nsuris[uri] = true;\n            out.push(' xmlns:' + nsMap[uri] + '=\"' + uri + '\"');\n          }\n        });\n      });\n\n      i = attrs.length;\n      const attrNames = ['width', 'height', 'xmlns', 'x', 'y', 'viewBox', 'id', 'overflow'];\n      while (i--) {\n        const attr = attrs[i];\n        const attrVal = toXml(attr.value);\n\n        // Namespaces have already been dealt with, so skip\n        if (attr.nodeName.startsWith('xmlns:')) { continue; }\n\n        // only serialize attributes we don't use internally\n        if (attrVal !== '' && !attrNames.includes(attr.localName)) {\n          if (!attr.namespaceURI || nsMap[attr.namespaceURI]) {\n            out.push(' ');\n            out.push(attr.nodeName); out.push('=\"');\n            out.push(attrVal); out.push('\"');\n          }\n        }\n      }\n    } else {\n      // Skip empty defs\n      if (elem.nodeName === 'defs' && !elem.firstChild) { return; }\n\n      const mozAttrs = ['-moz-math-font-style', '_moz-math-font-style'];\n      for (i = attrs.length - 1; i >= 0; i--) {\n        const attr = attrs[i];\n        let attrVal = toXml(attr.value);\n        // remove bogus attributes added by Gecko\n        if (mozAttrs.includes(attr.localName)) { continue; }\n        if (attrVal !== '') {\n          if (attrVal.startsWith('pointer-events')) { continue; }\n          if (attr.localName === 'class' && attrVal.startsWith('se_')) { continue; }\n          out.push(' ');\n          if (attr.localName === 'd') { attrVal = pathActions.convertPath(elem, true); }\n          if (!isNaN(attrVal)) {\n            attrVal = shortFloat(attrVal);\n          } else if (unitRe.test(attrVal)) {\n            attrVal = shortFloat(attrVal) + unit;\n          }\n\n          // Embed images when saving\n          if (saveOptions.apply &&\n            elem.nodeName === 'image' &&\n            attr.localName === 'href' &&\n            saveOptions.images &&\n            saveOptions.images === 'embed'\n          ) {\n            const img = encodableImages[attrVal];\n            if (img) { attrVal = img; }\n          }\n\n          // map various namespaces to our fixed namespace prefixes\n          // (the default xmlns attribute itself does not get a prefix)\n          if (!attr.namespaceURI || attr.namespaceURI === NS.SVG || nsMap[attr.namespaceURI]) {\n            out.push(attr.nodeName); out.push('=\"');\n            out.push(attrVal); out.push('\"');\n          }\n        }\n      }\n    }\n\n    if (elem.hasChildNodes()) {\n      out.push('>');\n      indent++;\n      let bOneLine = false;\n\n      for (i = 0; i < childs.length; i++) {\n        const child = childs.item(i);\n        switch (child.nodeType) {\n        case 1: // element node\n          out.push('\\n');\n          out.push(this.svgToString(childs.item(i), indent));\n          break;\n        case 3: // text node\n          const str = child.nodeValue.replace(/^\\s+|\\s+$/g, '');\n          if (str !== '') {\n            bOneLine = true;\n            out.push(String(toXml(str)));\n          }\n          break;\n        case 4: // cdata node\n          out.push('\\n');\n          out.push(new Array(indent + 1).join(' '));\n          out.push('<![CDATA[');\n          out.push(child.nodeValue);\n          out.push(']]>');\n          break;\n        case 8: // comment\n          out.push('\\n');\n          out.push(new Array(indent + 1).join(' '));\n          out.push('<!--');\n          out.push(child.data);\n          out.push('-->');\n          break;\n        } // switch on node type\n      }\n      indent--;\n      if (!bOneLine) {\n        out.push('\\n');\n        for (i = 0; i < indent; i++) { out.push(' '); }\n      }\n      out.push('</'); out.push(elem.nodeName); out.push('>');\n    } else {\n      out.push('/>');\n    }\n  }\n  return out.join('');\n}; // end svgToString()\n\n/**\n* Converts a given image file to a data URL when possible, then runs a given callback\n* @param {String} val - String with the path/URL of the image\n* @param {Function} callback - Optional function to run when image data is found, supplies the\n* result (data URL or false) as first parameter.\n*/\nthis.embedImage = function (val, callback) {\n  // load in the image and once it's loaded, get the dimensions\n  $(new Image()).load(function () {\n    // create a canvas the same size as the raster image\n    const canvas = document.createElement('canvas');\n    canvas.width = this.width;\n    canvas.height = this.height;\n    // load the raster image into the canvas\n    canvas.getContext('2d').drawImage(this, 0, 0);\n    // retrieve the data: URL\n    try {\n      let urldata = ';svgedit_url=' + encodeURIComponent(val);\n      urldata = canvas.toDataURL().replace(';base64', urldata + ';base64');\n      encodableImages[val] = urldata;\n    } catch (e) {\n      encodableImages[val] = false;\n    }\n    lastGoodImgUrl = val;\n    if (callback) { callback(encodableImages[val]); }\n  }).attr('src', val);\n};\n\n/**\n* Sets a given URL to be a \"last good image\" URL\n*/\nthis.setGoodImage = function (val) {\n  lastGoodImgUrl = val;\n};\n\n/**\n*\n*/\nthis.open = function () {\n  // Nothing by default, handled by optional widget/extension\n};\n\n/**\n* Serializes the current drawing into SVG XML text and returns it to the 'saved' handler.\n* This function also includes the XML prolog. Clients of the SvgCanvas bind their save\n* function to the 'saved' event.\n*/\nthis.save = function (opts) {\n  // remove the selected outline before serializing\n  clearSelection();\n  // Update save options if provided\n  if (opts) { $.extend(saveOptions, opts); }\n  saveOptions.apply = true;\n\n  // no need for doctype, see https://jwatt.org/svg/authoring/#doctype-declaration\n  const str = this.svgCanvasToString();\n  call('saved', str);\n};\n\n/**\n* Codes only is useful for locale-independent detection\n*/\nfunction getIssues () {\n  // remove the selected outline before serializing\n  clearSelection();\n\n  // Check for known CanVG issues\n  const issues = [];\n  const issueCodes = [];\n\n  // Selector and notice\n  const issueList = {\n    feGaussianBlur: uiStrings.exportNoBlur,\n    foreignObject: uiStrings.exportNoforeignObject,\n    '[stroke-dasharray]': uiStrings.exportNoDashArray\n  };\n  const content = $(svgcontent);\n\n  // Add font/text check if Canvas Text API is not implemented\n  if (!('font' in $('<canvas>')[0].getContext('2d'))) {\n    issueList.text = uiStrings.exportNoText;\n  }\n\n  $.each(issueList, function (sel, descr) {\n    if (content.find(sel).length) {\n      issueCodes.push(sel);\n      issues.push(descr);\n    }\n  });\n  return {issues, issueCodes};\n}\n\nlet canvg;\n/**\n* Generates a Data URL based on the current image, then calls \"exported\"\n* with an object including the string, image information, and any issues found\n* @param {String} [imgType=\"PNG\"]\n* @param {Number} [quality] Between 0 and 1\n* @param {String} [exportWindowName]\n* @param {Function} [cb]\n* @returns {Promise}\n*/\nthis.rasterExport = function (imgType, quality, exportWindowName, cb) {\n  const mimeType = 'image/' + imgType.toLowerCase();\n  const {issues, issueCodes} = getIssues();\n  const svg = this.svgCanvasToString();\n\n  return new Promise(async (resolve, reject) => {\n    if (!canvg) {\n      ({canvg} = await importSetGlobal(curConfig.canvgPath + 'canvg.js', {\n        global: 'canvg'\n      }));\n    }\n    const type = imgType || 'PNG';\n    if (!$('#export_canvas').length) {\n      $('<canvas>', {id: 'export_canvas'}).hide().appendTo('body');\n    }\n    const c = $('#export_canvas')[0];\n    c.width = canvas.contentW;\n    c.height = canvas.contentH;\n\n    await canvg(c, svg);\n    const dataURLType = (type === 'ICO' ? 'BMP' : type).toLowerCase();\n    const datauri = quality\n      ? c.toDataURL('image/' + dataURLType, quality)\n      : c.toDataURL('image/' + dataURLType);\n    let bloburl;\n    function done () {\n      const obj = {\n        datauri, bloburl, svg, issues, issueCodes, type: imgType,\n        mimeType, quality, exportWindowName\n      };\n      call('exported', obj);\n      if (cb) {\n        cb(obj);\n      }\n      resolve(obj);\n    }\n    if (c.toBlob) {\n      c.toBlob((blob) => {\n        bloburl = createObjectURL(blob);\n        done();\n      }, mimeType, quality);\n      return;\n    }\n    bloburl = dataURLToObjectURL(datauri);\n    done();\n  });\n};\n\n/**\n* @param {String} exportWindowName\n* @param outputType Needed?\n* @param {Function} cb\n* @returns {Promise}\n*/\nthis.exportPDF = function (exportWindowName, outputType, cb) {\n  const that = this;\n  return new Promise(async (resolve, reject) => {\n    if (!window.jsPDF) {\n      // Todo: Switch to `import()` when widely supported and available (also allow customization of path)\n      await importScript([\n        // We do not currently have these paths configurable as they are\n        //   currently global-only, so not Rolled-up\n        'jspdf/underscore-min.js',\n        'jspdf/jspdf.min.js'\n      ]);\n\n      const modularVersion = !('svgEditor' in window) ||\n        !window.svgEditor ||\n        window.svgEditor.modules !== false;\n      // Todo: Switch to `import()` when widely supported and available (also allow customization of path)\n      await importScript(curConfig.jspdfPath + 'jspdf.plugin.svgToPdf.js', {\n        type: modularVersion\n          ? 'module'\n          : 'text/javascript'\n      });\n      // await importModule('jspdf/jspdf.plugin.svgToPdf.js');\n    }\n\n    const res = getResolution();\n    const orientation = res.w > res.h ? 'landscape' : 'portrait';\n    const unit = 'pt'; // curConfig.baseUnit; // We could use baseUnit, but that is presumably not intended for export purposes\n    const doc = jsPDF({\n      orientation,\n      unit,\n      format: [res.w, res.h]\n      // , compressPdf: true\n    }); // Todo: Give options to use predefined jsPDF formats like \"a4\", etc. from pull-down (with option to keep customizable)\n    const docTitle = getDocumentTitle();\n    doc.setProperties({\n      title: docTitle /* ,\n      subject: '',\n      author: '',\n      keywords: '',\n      creator: '' */\n    });\n    const {issues, issueCodes} = getIssues();\n    const svg = that.svgCanvasToString();\n    doc.addSVG(svg, 0, 0);\n\n    // doc.output('save'); // Works to open in a new\n    //  window; todo: configure this and other export\n    //  options to optionally work in this manner as\n    //  opposed to opening a new tab\n    const obj = {svg, issues, issueCodes, exportWindowName};\n    const method = outputType || 'dataurlstring';\n    obj[method] = doc.output(method);\n    if (cb) {\n      cb(obj);\n    }\n    resolve(obj);\n    call('exportedPDF', obj);\n  });\n};\n\n/**\n* Returns the current drawing as raw SVG XML text.\n* @returns The current drawing as raw SVG XML text.\n*/\nthis.getSvgString = function () {\n  saveOptions.apply = false;\n  return this.svgCanvasToString();\n};\n\n/**\n* This function determines whether to use a nonce in the prefix, when\n* generating IDs for future documents in SVG-Edit.\n* @param {Boolean} [enableRandomization] If true, adds a nonce to the prefix. Thus\n* svgCanvas.randomizeIds() <==> svgCanvas.randomizeIds(true)\n*\n* if you're controlling SVG-Edit externally, and want randomized IDs, call\n* this BEFORE calling svgCanvas.setSvgString\n*/\nthis.randomizeIds = function (enableRandomization) {\n  if (arguments.length > 0 && enableRandomization === false) {\n    draw.randomizeIds(false, getCurrentDrawing());\n  } else {\n    draw.randomizeIds(true, getCurrentDrawing());\n  }\n};\n\n/**\n* Ensure each element has a unique ID\n* @param g - The parent element of the tree to give unique IDs\n*/\nconst uniquifyElems = this.uniquifyElems = function (g) {\n  const ids = {};\n  // TODO: Handle markers and connectors. These are not yet re-identified properly\n  // as their referring elements do not get remapped.\n  //\n  // <marker id='se_marker_end_svg_7'/>\n  // <polyline id='svg_7' se:connector='svg_1 svg_6' marker-end='url(#se_marker_end_svg_7)'/>\n  //\n  // Problem #1: if svg_1 gets renamed, we do not update the polyline's se:connector attribute\n  // Problem #2: if the polyline svg_7 gets renamed, we do not update the marker id nor the polyline's marker-end attribute\n  const refElems = ['filter', 'linearGradient', 'pattern', 'radialGradient', 'symbol', 'textPath', 'use'];\n\n  walkTree(g, function (n) {\n    // if it's an element node\n    if (n.nodeType === 1) {\n      // and the element has an ID\n      if (n.id) {\n        // and we haven't tracked this ID yet\n        if (!(n.id in ids)) {\n          // add this id to our map\n          ids[n.id] = {elem: null, attrs: [], hrefs: []};\n        }\n        ids[n.id].elem = n;\n      }\n\n      // now search for all attributes on this element that might refer\n      // to other elements\n      $.each(refAttrs, function (i, attr) {\n        const attrnode = n.getAttributeNode(attr);\n        if (attrnode) {\n          // the incoming file has been sanitized, so we should be able to safely just strip off the leading #\n          const url = getUrlFromAttr(attrnode.value),\n            refid = url ? url.substr(1) : null;\n          if (refid) {\n            if (!(refid in ids)) {\n              // add this id to our map\n              ids[refid] = {elem: null, attrs: [], hrefs: []};\n            }\n            ids[refid].attrs.push(attrnode);\n          }\n        }\n      });\n\n      // check xlink:href now\n      const href = getHref(n);\n      // TODO: what if an <image> or <a> element refers to an element internally?\n      if (href && refElems.includes(n.nodeName)) {\n        const refid = href.substr(1);\n        if (refid) {\n          if (!(refid in ids)) {\n            // add this id to our map\n            ids[refid] = {elem: null, attrs: [], hrefs: []};\n          }\n          ids[refid].hrefs.push(n);\n        }\n      }\n    }\n  });\n\n  // in ids, we now have a map of ids, elements and attributes, let's re-identify\n  for (const oldid in ids) {\n    if (!oldid) { continue; }\n    const {elem} = ids[oldid];\n    if (elem) {\n      const newid = getNextId();\n\n      // assign element its new id\n      elem.id = newid;\n\n      // remap all url() attributes\n      const {attrs} = ids[oldid];\n      let j = attrs.length;\n      while (j--) {\n        const attr = attrs[j];\n        attr.ownerElement.setAttribute(attr.name, 'url(#' + newid + ')');\n      }\n\n      // remap all href attributes\n      const hreffers = ids[oldid].hrefs;\n      let k = hreffers.length;\n      while (k--) {\n        const hreffer = hreffers[k];\n        setHref(hreffer, '#' + newid);\n      }\n    }\n  }\n};\n\n/**\n* Assigns reference data for each use element\n*/\nconst setUseData = this.setUseData = function (parent) {\n  let elems = $(parent);\n\n  if (parent.tagName !== 'use') {\n    elems = elems.find('use');\n  }\n\n  elems.each(function () {\n    const id = getHref(this).substr(1);\n    const refElem = getElem(id);\n    if (!refElem) { return; }\n    $(this).data('ref', refElem);\n    if (refElem.tagName === 'symbol' || refElem.tagName === 'svg') {\n      $(this).data('symbol', refElem).data('ref', refElem);\n    }\n  });\n};\n\n/**\n* Converts gradients from userSpaceOnUse to objectBoundingBox\n* @param elem\n*/\nconst convertGradients = this.convertGradients = function (elem) {\n  let elems = $(elem).find('linearGradient, radialGradient');\n  if (!elems.length && isWebkit()) {\n    // Bug in webkit prevents regular *Gradient selector search\n    elems = $(elem).find('*').filter(function () {\n      return (this.tagName.includes('Gradient'));\n    });\n  }\n\n  elems.each(function () {\n    const grad = this;\n    if ($(grad).attr('gradientUnits') === 'userSpaceOnUse') {\n      // TODO: Support more than one element with this ref by duplicating parent grad\n      const elems = $(svgcontent).find('[fill=\"url(#' + grad.id + ')\"],[stroke=\"url(#' + grad.id + ')\"]');\n      if (!elems.length) { return; }\n\n      // get object's bounding box\n      const bb = utilsGetBBox(elems[0]);\n\n      // This will occur if the element is inside a <defs> or a <symbol>,\n      // in which we shouldn't need to convert anyway.\n      if (!bb) { return; }\n\n      if (grad.tagName === 'linearGradient') {\n        const gCoords = $(grad).attr(['x1', 'y1', 'x2', 'y2']);\n\n        // If has transform, convert\n        const tlist = grad.gradientTransform.baseVal;\n        if (tlist && tlist.numberOfItems > 0) {\n          const m = transformListToTransform(tlist).matrix;\n          const pt1 = transformPoint(gCoords.x1, gCoords.y1, m);\n          const pt2 = transformPoint(gCoords.x2, gCoords.y2, m);\n\n          gCoords.x1 = pt1.x;\n          gCoords.y1 = pt1.y;\n          gCoords.x2 = pt2.x;\n          gCoords.y2 = pt2.y;\n          grad.removeAttribute('gradientTransform');\n        }\n\n        $(grad).attr({\n          x1: (gCoords.x1 - bb.x) / bb.width,\n          y1: (gCoords.y1 - bb.y) / bb.height,\n          x2: (gCoords.x2 - bb.x) / bb.width,\n          y2: (gCoords.y2 - bb.y) / bb.height\n        });\n        grad.removeAttribute('gradientUnits');\n      }\n      // else {\n      //   Note: radialGradient elements cannot be easily converted\n      //   because userSpaceOnUse will keep circular gradients, while\n      //   objectBoundingBox will x/y scale the gradient according to\n      //   its bbox.\n      //\n      //   For now we'll do nothing, though we should probably have\n      //   the gradient be updated as the element is moved, as\n      //   inkscape/illustrator do.\n      //\n      //   const gCoords = $(grad).attr(['cx', 'cy', 'r']);\n      //\n      //   $(grad).attr({\n      //     cx: (gCoords.cx - bb.x) / bb.width,\n      //     cy: (gCoords.cy - bb.y) / bb.height,\n      //     r: gCoords.r\n      //   });\n      //\n      //   grad.removeAttribute('gradientUnits');\n      // }\n    }\n  });\n};\n\n/**\n* Converts selected/given <use> or child SVG element to a group\n* @param elem\n*/\nconst convertToGroup = this.convertToGroup = function (elem) {\n  if (!elem) {\n    elem = selectedElements[0];\n  }\n  const $elem = $(elem);\n  const batchCmd = new BatchCommand();\n  let ts;\n\n  if ($elem.data('gsvg')) {\n    // Use the gsvg as the new group\n    const svg = elem.firstChild;\n    const pt = $(svg).attr(['x', 'y']);\n\n    $(elem.firstChild.firstChild).unwrap();\n    $(elem).removeData('gsvg');\n\n    const tlist = getTransformList(elem);\n    const xform = svgroot.createSVGTransform();\n    xform.setTranslate(pt.x, pt.y);\n    tlist.appendItem(xform);\n    recalculateDimensions(elem);\n    call('selected', [elem]);\n  } else if ($elem.data('symbol')) {\n    elem = $elem.data('symbol');\n\n    ts = $elem.attr('transform');\n    const pos = $elem.attr(['x', 'y']);\n\n    const vb = elem.getAttribute('viewBox');\n\n    if (vb) {\n      const nums = vb.split(' ');\n      pos.x -= +nums[0];\n      pos.y -= +nums[1];\n    }\n\n    // Not ideal, but works\n    ts += ' translate(' + (pos.x || 0) + ',' + (pos.y || 0) + ')';\n\n    const prev = $elem.prev();\n\n    // Remove <use> element\n    batchCmd.addSubCommand(new RemoveElementCommand($elem[0], $elem[0].nextSibling, $elem[0].parentNode));\n    $elem.remove();\n\n    // See if other elements reference this symbol\n    const hasMore = $(svgcontent).find('use:data(symbol)').length;\n\n    const g = svgdoc.createElementNS(NS.SVG, 'g');\n    const childs = elem.childNodes;\n\n    let i;\n    for (i = 0; i < childs.length; i++) {\n      g.append(childs[i].cloneNode(true));\n    }\n\n    // Duplicate the gradients for Gecko, since they weren't included in the <symbol>\n    if (isGecko()) {\n      const dupeGrads = $(findDefs()).children('linearGradient,radialGradient,pattern').clone();\n      $(g).append(dupeGrads);\n    }\n\n    if (ts) {\n      g.setAttribute('transform', ts);\n    }\n\n    const parent = elem.parentNode;\n\n    uniquifyElems(g);\n\n    // Put the dupe gradients back into <defs> (after uniquifying them)\n    if (isGecko()) {\n      $(findDefs()).append($(g).find('linearGradient,radialGradient,pattern'));\n    }\n\n    // now give the g itself a new id\n    g.id = getNextId();\n\n    prev.after(g);\n\n    if (parent) {\n      if (!hasMore) {\n        // remove symbol/svg element\n        const {nextSibling} = elem;\n        elem.remove();\n        batchCmd.addSubCommand(new RemoveElementCommand(elem, nextSibling, parent));\n      }\n      batchCmd.addSubCommand(new InsertElementCommand(g));\n    }\n\n    setUseData(g);\n\n    if (isGecko()) {\n      convertGradients(findDefs());\n    } else {\n      convertGradients(g);\n    }\n\n    // recalculate dimensions on the top-level children so that unnecessary transforms\n    // are removed\n    walkTreePost(g, function (n) {\n      try {\n        recalculateDimensions(n);\n      } catch (e) {\n        console.log(e);\n      }\n    });\n\n    // Give ID for any visible element missing one\n    $(g).find(visElems).each(function () {\n      if (!this.id) { this.id = getNextId(); }\n    });\n\n    selectOnly([g]);\n\n    const cm = pushGroupProperties(g, true);\n    if (cm) {\n      batchCmd.addSubCommand(cm);\n    }\n\n    addCommandToHistory(batchCmd);\n  } else {\n    console.log('Unexpected element to ungroup:', elem);\n  }\n};\n\n/**\n* This function sets the current drawing as the input SVG XML.\n* @param {String} xmlString - The SVG as XML text.\n* @param {Boolean} [preventUndo=false] - Indicates if we want to do the\n* changes without adding them to the undo stack - e.g. for initializing a\n* drawing on page load.\n* @returns {Boolean} This function returns false if the set was\n*     unsuccessful, true otherwise.\n*/\nthis.setSvgString = function (xmlString, preventUndo) {\n  try {\n    // convert string into XML document\n    const newDoc = text2xml(xmlString);\n    if (newDoc.firstElementChild &&\n      newDoc.firstElementChild.namespaceURI !== NS.SVG) {\n      return false;\n    }\n\n    this.prepareSvg(newDoc);\n\n    const batchCmd = new BatchCommand('Change Source');\n\n    // remove old svg document\n    const {nextSibling} = svgcontent;\n    const oldzoom = svgroot.removeChild(svgcontent);\n    batchCmd.addSubCommand(new RemoveElementCommand(oldzoom, nextSibling, svgroot));\n\n    // set new svg document\n    // If DOM3 adoptNode() available, use it. Otherwise fall back to DOM2 importNode()\n    if (svgdoc.adoptNode) {\n      svgcontent = svgdoc.adoptNode(newDoc.documentElement);\n    } else {\n      svgcontent = svgdoc.importNode(newDoc.documentElement, true);\n    }\n\n    svgroot.append(svgcontent);\n    const content = $(svgcontent);\n\n    canvas.current_drawing_ = new draw.Drawing(svgcontent, idprefix);\n\n    // retrieve or set the nonce\n    const nonce = getCurrentDrawing().getNonce();\n    if (nonce) {\n      call('setnonce', nonce);\n    } else {\n      call('unsetnonce');\n    }\n\n    // change image href vals if possible\n    content.find('image').each(function () {\n      const image = this;\n      preventClickDefault(image);\n      const val = getHref(this);\n      if (val) {\n        if (val.startsWith('data:')) {\n          // Check if an SVG-edit data URI\n          const m = val.match(/svgedit_url=(.*?);/);\n          if (m) {\n            const url = decodeURIComponent(m[1]);\n            $(new Image()).load(function () {\n              image.setAttributeNS(NS.XLINK, 'xlink:href', url);\n            }).attr('src', url);\n          }\n        }\n        // Add to encodableImages if it loads\n        canvas.embedImage(val);\n      }\n    });\n\n    // Wrap child SVGs in group elements\n    content.find('svg').each(function () {\n      // Skip if it's in a <defs>\n      if ($(this).closest('defs').length) { return; }\n\n      uniquifyElems(this);\n\n      // Check if it already has a gsvg group\n      const pa = this.parentNode;\n      if (pa.childNodes.length === 1 && pa.nodeName === 'g') {\n        $(pa).data('gsvg', this);\n        pa.id = pa.id || getNextId();\n      } else {\n        groupSvgElem(this);\n      }\n    });\n\n    // For Firefox: Put all paint elems in defs\n    if (isGecko()) {\n      content.find('linearGradient, radialGradient, pattern').appendTo(findDefs());\n    }\n\n    // Set ref element for <use> elements\n\n    // TODO: This should also be done if the object is re-added through \"redo\"\n    setUseData(content);\n\n    convertGradients(content[0]);\n\n    const attrs = {\n      id: 'svgcontent',\n      overflow: curConfig.show_outside_canvas ? 'visible' : 'hidden'\n    };\n\n    let percs = false;\n\n    // determine proper size\n    if (content.attr('viewBox')) {\n      const vb = content.attr('viewBox').split(' ');\n      attrs.width = vb[2];\n      attrs.height = vb[3];\n    // handle content that doesn't have a viewBox\n    } else {\n      $.each(['width', 'height'], function (i, dim) {\n        // Set to 100 if not given\n        const val = content.attr(dim) || '100%';\n\n        if (String(val).substr(-1) === '%') {\n          // Use user units if percentage given\n          percs = true;\n        } else {\n          attrs[dim] = convertToNum(dim, val);\n        }\n      });\n    }\n\n    // identify layers\n    draw.identifyLayers();\n\n    // Give ID for any visible layer children missing one\n    content.children().find(visElems).each(function () {\n      if (!this.id) { this.id = getNextId(); }\n    });\n\n    // Percentage width/height, so let's base it on visible elements\n    if (percs) {\n      const bb = getStrokedBBoxDefaultVisible();\n      attrs.width = bb.width + bb.x;\n      attrs.height = bb.height + bb.y;\n    }\n\n    // Just in case negative numbers are given or\n    // result from the percs calculation\n    if (attrs.width <= 0) { attrs.width = 100; }\n    if (attrs.height <= 0) { attrs.height = 100; }\n\n    content.attr(attrs);\n    this.contentW = attrs.width;\n    this.contentH = attrs.height;\n\n    batchCmd.addSubCommand(new InsertElementCommand(svgcontent));\n    // update root to the correct size\n    const changes = content.attr(['width', 'height']);\n    batchCmd.addSubCommand(new ChangeElementCommand(svgroot, changes));\n\n    // reset zoom\n    currentZoom = 1;\n\n    // reset transform lists\n    resetListMap();\n    clearSelection();\n    pathModule.clearData();\n    svgroot.append(selectorManager.selectorParentGroup);\n\n    if (!preventUndo) addCommandToHistory(batchCmd);\n    call('changed', [svgcontent]);\n  } catch (e) {\n    console.log(e);\n    return false;\n  }\n\n  return true;\n};\n\n/**\n* This function imports the input SVG XML as a &lt;symbol> in the &lt;defs>, then adds a\n* &lt;use> to the current layer.\n* @param {String} xmlString - The SVG as XML text.\n* @returns This function returns null if the import was unsuccessful, or the element otherwise.\n* @todo\n* - properly handle if namespace is introduced by imported content (must add to svgcontent\n* and update all prefixes in the imported node)\n* - properly handle recalculating dimensions, recalculateDimensions() doesn't handle\n* arbitrary transform lists, but makes some assumptions about how the transform list\n* was obtained\n* - import should happen in top-left of current zoomed viewport\n*/\nthis.importSvgString = function (xmlString) {\n  let j, ts, useEl;\n  try {\n    // Get unique ID\n    const uid = encode64(xmlString.length + xmlString).substr(0, 32);\n\n    let useExisting = false;\n    // Look for symbol and make sure symbol exists in image\n    if (importIds[uid]) {\n      if ($(importIds[uid].symbol).parents('#svgroot').length) {\n        useExisting = true;\n      }\n    }\n\n    const batchCmd = new BatchCommand('Import Image');\n    let symbol;\n    if (useExisting) {\n      ({symbol} = importIds[uid]);\n      ts = importIds[uid].xform;\n    } else {\n      // convert string into XML document\n      const newDoc = text2xml(xmlString);\n\n      this.prepareSvg(newDoc);\n\n      // import new svg document into our document\n      let svg;\n      // If DOM3 adoptNode() available, use it. Otherwise fall back to DOM2 importNode()\n      if (svgdoc.adoptNode) {\n        svg = svgdoc.adoptNode(newDoc.documentElement);\n      } else {\n        svg = svgdoc.importNode(newDoc.documentElement, true);\n      }\n\n      uniquifyElems(svg);\n\n      const innerw = convertToNum('width', svg.getAttribute('width')),\n        innerh = convertToNum('height', svg.getAttribute('height')),\n        innervb = svg.getAttribute('viewBox'),\n        // if no explicit viewbox, create one out of the width and height\n        vb = innervb ? innervb.split(' ') : [0, 0, innerw, innerh];\n      for (j = 0; j < 4; ++j) {\n        vb[j] = +(vb[j]);\n      }\n\n      // TODO: properly handle preserveAspectRatio\n      const // canvasw = +svgcontent.getAttribute('width'),\n        canvash = +svgcontent.getAttribute('height');\n      // imported content should be 1/3 of the canvas on its largest dimension\n\n      if (innerh > innerw) {\n        ts = 'scale(' + (canvash / 3) / vb[3] + ')';\n      } else {\n        ts = 'scale(' + (canvash / 3) / vb[2] + ')';\n      }\n\n      // Hack to make recalculateDimensions understand how to scale\n      ts = 'translate(0) ' + ts + ' translate(0)';\n\n      symbol = svgdoc.createElementNS(NS.SVG, 'symbol');\n      const defs = findDefs();\n\n      if (isGecko()) {\n        // Move all gradients into root for Firefox, workaround for this bug:\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=353575\n        // TODO: Make this properly undo-able.\n        $(svg).find('linearGradient, radialGradient, pattern').appendTo(defs);\n      }\n\n      while (svg.firstChild) {\n        const first = svg.firstChild;\n        symbol.append(first);\n      }\n      const attrs = svg.attributes;\n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        symbol.setAttribute(attr.nodeName, attr.value);\n      }\n      symbol.id = getNextId();\n\n      // Store data\n      importIds[uid] = {\n        symbol,\n        xform: ts\n      };\n\n      findDefs().append(symbol);\n      batchCmd.addSubCommand(new InsertElementCommand(symbol));\n    }\n\n    useEl = svgdoc.createElementNS(NS.SVG, 'use');\n    useEl.id = getNextId();\n    setHref(useEl, '#' + symbol.id);\n\n    (currentGroup || getCurrentDrawing().getCurrentLayer()).append(useEl);\n    batchCmd.addSubCommand(new InsertElementCommand(useEl));\n    clearSelection();\n\n    useEl.setAttribute('transform', ts);\n    recalculateDimensions(useEl);\n    $(useEl).data('symbol', symbol).data('ref', symbol);\n    addToSelection([useEl]);\n\n    // TODO: Find way to add this in a recalculateDimensions-parsable way\n    // if (vb[0] !== 0 || vb[1] !== 0) {\n    //   ts = 'translate(' + (-vb[0]) + ',' + (-vb[1]) + ') ' + ts;\n    // }\n    addCommandToHistory(batchCmd);\n    call('changed', [svgcontent]);\n  } catch (e) {\n    console.log(e);\n    return null;\n  }\n\n  // we want to return the element so we can automatically select it\n  return useEl;\n};\n\n// Could deprecate, but besides external uses, their usage makes clear that\n//  canvas is a dependency for all of these\n[\n  'identifyLayers', 'createLayer', 'cloneLayer', 'deleteCurrentLayer',\n  'setCurrentLayer', 'renameCurrentLayer', 'setCurrentLayerPosition',\n  'setLayerVisibility', 'moveSelectedToLayer', 'mergeLayer', 'mergeAllLayers',\n  'leaveContext', 'setContext'\n].forEach((prop) => {\n  canvas[prop] = draw[prop];\n});\ndraw.init({\n  pathActions,\n  getCurrentGroup () {\n    return currentGroup;\n  },\n  setCurrentGroup (cg) {\n    currentGroup = cg;\n  },\n  getSelectedElements,\n  getSVGContent,\n  undoMgr,\n  elData,\n  getCurrentDrawing,\n  clearSelection,\n  call,\n  addCommandToHistory,\n  changeSvgcontent () {\n    call('changed', [svgcontent]);\n  }\n});\n\n/**\n* Group: Document functions\n*/\n\n/**\n* Clears the current document. This is not an undoable action.\n*/\nthis.clear = function () {\n  pathActions.clear();\n\n  clearSelection();\n\n  // clear the svgcontent node\n  canvas.clearSvgContentElement();\n\n  // create new document\n  canvas.current_drawing_ = new draw.Drawing(svgcontent);\n\n  // create empty first layer\n  canvas.createLayer('Layer 1');\n\n  // clear the undo stack\n  canvas.undoMgr.resetUndoStack();\n\n  // reset the selector manager\n  selectorManager.initGroup();\n\n  // reset the rubber band box\n  rubberBox = selectorManager.getRubberBandBox();\n\n  call('cleared');\n};\n\n/**\n* Alias function\n*/\nthis.linkControlPoints = pathActions.linkControlPoints;\n\n/**\n* @returns The content DOM element\n*/\nthis.getContentElem = function () { return svgcontent; };\n\n/**\n* @returns The root DOM element\n*/\nthis.getRootElem = function () { return svgroot; };\n\n/**\n* @returns {Object} The current dimensions and zoom level in an object\n*/\nconst getResolution = this.getResolution = function () {\n//    const vb = svgcontent.getAttribute('viewBox').split(' ');\n//    return {w:vb[2], h:vb[3], zoom: currentZoom};\n\n  const w = svgcontent.getAttribute('width') / currentZoom;\n  const h = svgcontent.getAttribute('height') / currentZoom;\n\n  return {\n    w,\n    h,\n    zoom: currentZoom\n  };\n};\n\n/**\n* @returns The current snap to grid setting\n*/\nthis.getSnapToGrid = function () { return curConfig.gridSnapping; };\n\n/**\n* @returns {String} A string which describes the revision number of SvgCanvas.\n*/\nthis.getVersion = function () {\n  return 'svgcanvas.js ($Rev$)';\n};\n\n/**\n* Update interface strings with given values\n* @param strs - Object with strings (see locales file)\n*/\nthis.setUiStrings = function (strs) {\n  Object.assign(uiStrings, strs.notification);\n  pathModule.setUiStrings(strs);\n};\n\n/**\n* Update configuration options with given values\n* @param {Object} opts - Object with options (see curConfig for examples)\n*/\nthis.setConfig = function (opts) {\n  Object.assign(curConfig, opts);\n};\n\n/**\n* @param elem\n* @returns {String|undefined} the current group/SVG's title contents\n*/\nthis.getTitle = function (elem) {\n  elem = elem || selectedElements[0];\n  if (!elem) { return; }\n  elem = $(elem).data('gsvg') || $(elem).data('symbol') || elem;\n  const childs = elem.childNodes;\n  for (let i = 0; i < childs.length; i++) {\n    if (childs[i].nodeName === 'title') {\n      return childs[i].textContent;\n    }\n  }\n  return '';\n};\n\n/**\n* Sets the group/SVG's title content\n* @param val\n* @todo Combine this with `setDocumentTitle`\n*/\nthis.setGroupTitle = function (val) {\n  let elem = selectedElements[0];\n  elem = $(elem).data('gsvg') || elem;\n\n  const ts = $(elem).children('title');\n\n  const batchCmd = new BatchCommand('Set Label');\n\n  let title;\n  if (!val.length) {\n    // Remove title element\n    const tsNextSibling = ts.nextSibling;\n    batchCmd.addSubCommand(new RemoveElementCommand(ts[0], tsNextSibling, elem));\n    ts.remove();\n  } else if (ts.length) {\n    // Change title contents\n    title = ts[0];\n    batchCmd.addSubCommand(new ChangeElementCommand(title, {'#text': title.textContent}));\n    title.textContent = val;\n  } else {\n    // Add title element\n    title = svgdoc.createElementNS(NS.SVG, 'title');\n    title.textContent = val;\n    $(elem).prepend(title);\n    batchCmd.addSubCommand(new InsertElementCommand(title));\n  }\n\n  addCommandToHistory(batchCmd);\n};\n\n/**\n* @returns {String|undefined} The current document title or an empty string if not found\n*/\nconst getDocumentTitle = this.getDocumentTitle = function () {\n  return canvas.getTitle(svgcontent);\n};\n\n/**\n* Adds/updates a title element for the document with the given name.\n* This is an undoable action\n* @param {String} newtitle - String with the new title\n*/\nthis.setDocumentTitle = function (newtitle) {\n  const childs = svgcontent.childNodes;\n  let docTitle = false, oldTitle = '';\n\n  const batchCmd = new BatchCommand('Change Image Title');\n\n  for (let i = 0; i < childs.length; i++) {\n    if (childs[i].nodeName === 'title') {\n      docTitle = childs[i];\n      oldTitle = docTitle.textContent;\n      break;\n    }\n  }\n  if (!docTitle) {\n    docTitle = svgdoc.createElementNS(NS.SVG, 'title');\n    svgcontent.insertBefore(docTitle, svgcontent.firstChild);\n    // svgcontent.firstChild.before(docTitle); // Ok to replace above with this?\n  }\n\n  if (newtitle.length) {\n    docTitle.textContent = newtitle;\n  } else {\n    // No title given, so element is not necessary\n    docTitle.remove();\n  }\n  batchCmd.addSubCommand(new ChangeElementCommand(docTitle, {'#text': oldTitle}));\n  addCommandToHistory(batchCmd);\n};\n\n/**\n* Returns the editor's namespace URL, optionally adds it to root element\n* @param {Boolean} add - Indicates whether or not to add the namespace value\n* @returns {String} The editor's namespace URL\n*/\nthis.getEditorNS = function (add) {\n  if (add) {\n    svgcontent.setAttribute('xmlns:se', NS.SE);\n  }\n  return NS.SE;\n};\n\n/**\n* Changes the document's dimensions to the given size\n* @param x - Number with the width of the new dimensions in user units.\n* Can also be the string \"fit\" to indicate \"fit to content\"\n* @param y - Number with the height of the new dimensions in user units.\n* @returns {Boolean} Indicates if resolution change was succesful.\n* It will fail on \"fit to content\" option with no content to fit to.\n*/\nthis.setResolution = function (x, y) {\n  const res = getResolution();\n  const {w, h} = res;\n  let batchCmd;\n\n  if (x === 'fit') {\n    // Get bounding box\n    const bbox = getStrokedBBoxDefaultVisible();\n\n    if (bbox) {\n      batchCmd = new BatchCommand('Fit Canvas to Content');\n      const visEls = getVisibleElements();\n      addToSelection(visEls);\n      const dx = [], dy = [];\n      $.each(visEls, function (i, item) {\n        dx.push(bbox.x * -1);\n        dy.push(bbox.y * -1);\n      });\n\n      const cmd = canvas.moveSelectedElements(dx, dy, true);\n      batchCmd.addSubCommand(cmd);\n      clearSelection();\n\n      x = Math.round(bbox.width);\n      y = Math.round(bbox.height);\n    } else {\n      return false;\n    }\n  }\n  if (x !== w || y !== h) {\n    if (!batchCmd) {\n      batchCmd = new BatchCommand('Change Image Dimensions');\n    }\n\n    x = convertToNum('width', x);\n    y = convertToNum('height', y);\n\n    svgcontent.setAttribute('width', x);\n    svgcontent.setAttribute('height', y);\n\n    this.contentW = x;\n    this.contentH = y;\n    batchCmd.addSubCommand(new ChangeElementCommand(svgcontent, {width: w, height: h}));\n\n    svgcontent.setAttribute('viewBox', [0, 0, x / currentZoom, y / currentZoom].join(' '));\n    batchCmd.addSubCommand(new ChangeElementCommand(svgcontent, {viewBox: ['0 0', w, h].join(' ')}));\n\n    addCommandToHistory(batchCmd);\n    call('changed', [svgcontent]);\n  }\n  return true;\n};\n\n/**\n* @returns An object with x, y values indicating the svgcontent element's\n* position in the editor's canvas.\n*/\nthis.getOffset = function () {\n  return $(svgcontent).attr(['x', 'y']);\n};\n\n/**\n* Sets the zoom level on the canvas-side based on the given value\n* @param val - Bounding box object to zoom to or string indicating zoom option\n* @param {Number} editorW - Integer with the editor's workarea box's width\n* @param {Number} editorH - Integer with the editor's workarea box's height\n* @returns {Object|undefined}\n*/\nthis.setBBoxZoom = function (val, editorW, editorH) {\n  let spacer = 0.85;\n  let bb;\n  const calcZoom = function (bb) {\n    if (!bb) { return false; }\n    const wZoom = Math.round((editorW / bb.width) * 100 * spacer) / 100;\n    const hZoom = Math.round((editorH / bb.height) * 100 * spacer) / 100;\n    const zoom = Math.min(wZoom, hZoom);\n    canvas.setZoom(zoom);\n    return {zoom, bbox: bb};\n  };\n\n  if (typeof val === 'object') {\n    bb = val;\n    if (bb.width === 0 || bb.height === 0) {\n      const newzoom = bb.zoom ? bb.zoom : currentZoom * bb.factor;\n      canvas.setZoom(newzoom);\n      return {zoom: currentZoom, bbox: bb};\n    }\n    return calcZoom(bb);\n  }\n\n  switch (val) {\n  case 'selection':\n    if (!selectedElements[0]) { return; }\n    const selectedElems = $.map(selectedElements, function (n) { if (n) { return n; } });\n    bb = getStrokedBBoxDefaultVisible(selectedElems);\n    break;\n  case 'canvas':\n    const res = getResolution();\n    spacer = 0.95;\n    bb = {width: res.w, height: res.h, x: 0, y: 0};\n    break;\n  case 'content':\n    bb = getStrokedBBoxDefaultVisible();\n    break;\n  case 'layer':\n    bb = getStrokedBBoxDefaultVisible(getVisibleElements(getCurrentDrawing().getCurrentLayer()));\n    break;\n  default:\n    return;\n  }\n  return calcZoom(bb);\n};\n\n/**\n* Sets the zoom to the given level\n* @param {Number} zoomlevel - Float indicating the zoom level to change to\n*/\nthis.setZoom = function (zoomlevel) {\n  const res = getResolution();\n  svgcontent.setAttribute('viewBox', '0 0 ' + res.w / zoomlevel + ' ' + res.h / zoomlevel);\n  currentZoom = zoomlevel;\n  $.each(selectedElements, function (i, elem) {\n    if (!elem) { return; }\n    selectorManager.requestSelector(elem).resize();\n  });\n  pathActions.zoomChange();\n  runExtensions('zoomChanged', zoomlevel);\n};\n\n/**\n* @returns {String} The current editor mode string\n*/\nthis.getMode = function () {\n  return currentMode;\n};\n\n/**\n* Sets the editor's mode to the given string\n* @param {String} name - String with the new mode to change to\n*/\nthis.setMode = function (name) {\n  pathActions.clear(true);\n  textActions.clear();\n  curProperties = (selectedElements[0] && selectedElements[0].nodeName === 'text') ? curText : curShape;\n  currentMode = name;\n};\n\n/**\n* Group: Element Styling\n*/\n\n/**\n* @returns The current fill/stroke option\n*/\nthis.getColor = function (type) {\n  return curProperties[type];\n};\n\n/**\n* Change the current stroke/fill color/gradient value\n* @param {String} type - String indicating fill or stroke\n* @param val - The value to set the stroke attribute to\n* @param {Boolean} preventUndo - Boolean indicating whether or not this should be and undoable option\n*/\nthis.setColor = function (type, val, preventUndo) {\n  curShape[type] = val;\n  curProperties[type + '_paint'] = {type: 'solidColor'};\n  const elems = [];\n  function addNonG (e) {\n    if (e.nodeName !== 'g') {\n      elems.push(e);\n    }\n  }\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    if (elem) {\n      if (elem.tagName === 'g') {\n        walkTree(elem, addNonG);\n      } else {\n        if (type === 'fill') {\n          if (elem.tagName !== 'polyline' && elem.tagName !== 'line') {\n            elems.push(elem);\n          }\n        } else {\n          elems.push(elem);\n        }\n      }\n    }\n  }\n  if (elems.length > 0) {\n    if (!preventUndo) {\n      changeSelectedAttribute(type, val, elems);\n      call('changed', elems);\n    } else {\n      changeSelectedAttributeNoUndo(type, val, elems);\n    }\n  }\n};\n\n// Apply the current gradient to selected element's fill or stroke\n//\n// Parameters\n// type - String indicating \"fill\" or \"stroke\" to apply to an element\nconst setGradient = this.setGradient = function (type) {\n  if (!curProperties[type + '_paint'] || curProperties[type + '_paint'].type === 'solidColor') { return; }\n  let grad = canvas[type + 'Grad'];\n  // find out if there is a duplicate gradient already in the defs\n  const duplicateGrad = findDuplicateGradient(grad);\n  const defs = findDefs();\n  // no duplicate found, so import gradient into defs\n  if (!duplicateGrad) {\n    // const origGrad = grad;\n    grad = defs.appendChild(svgdoc.importNode(grad, true));\n    // get next id and set it on the grad\n    grad.id = getNextId();\n  } else { // use existing gradient\n    grad = duplicateGrad;\n  }\n  canvas.setColor(type, 'url(#' + grad.id + ')');\n};\n\n/**\n* Check if exact gradient already exists\n* @param grad - The gradient DOM element to compare to others\n* @returns The existing gradient if found, null if not\n*/\nconst findDuplicateGradient = function (grad) {\n  const defs = findDefs();\n  const existingGrads = $(defs).find('linearGradient, radialGradient');\n  let i = existingGrads.length;\n  const radAttrs = ['r', 'cx', 'cy', 'fx', 'fy'];\n  while (i--) {\n    const og = existingGrads[i];\n    if (grad.tagName === 'linearGradient') {\n      if (grad.getAttribute('x1') !== og.getAttribute('x1') ||\n        grad.getAttribute('y1') !== og.getAttribute('y1') ||\n        grad.getAttribute('x2') !== og.getAttribute('x2') ||\n        grad.getAttribute('y2') !== og.getAttribute('y2')\n      ) {\n        continue;\n      }\n    } else {\n      const gradAttrs = $(grad).attr(radAttrs);\n      const ogAttrs = $(og).attr(radAttrs);\n\n      let diff = false;\n      $.each(radAttrs, function (i, attr) {\n        if (gradAttrs[attr] !== ogAttrs[attr]) { diff = true; }\n      });\n\n      if (diff) { continue; }\n    }\n\n    // else could be a duplicate, iterate through stops\n    const stops = grad.getElementsByTagNameNS(NS.SVG, 'stop');\n    const ostops = og.getElementsByTagNameNS(NS.SVG, 'stop');\n\n    if (stops.length !== ostops.length) {\n      continue;\n    }\n\n    let j = stops.length;\n    while (j--) {\n      const stop = stops[j];\n      const ostop = ostops[j];\n\n      if (stop.getAttribute('offset') !== ostop.getAttribute('offset') ||\n        stop.getAttribute('stop-opacity') !== ostop.getAttribute('stop-opacity') ||\n        stop.getAttribute('stop-color') !== ostop.getAttribute('stop-color')) {\n        break;\n      }\n    }\n\n    if (j === -1) {\n      return og;\n    }\n  } // for each gradient in defs\n\n  return null;\n};\n\n/**\n* Set a color/gradient to a fill/stroke\n* @param {\"fill\"|\"stroke\"} type - String with \"fill\" or \"stroke\"\n* @param paint - The jGraduate paint object to apply\n*/\nthis.setPaint = function (type, paint) {\n  // make a copy\n  const p = new $.jGraduate.Paint(paint);\n  this.setPaintOpacity(type, p.alpha / 100, true);\n\n  // now set the current paint object\n  curProperties[type + '_paint'] = p;\n  switch (p.type) {\n  case 'solidColor':\n    this.setColor(type, p.solidColor !== 'none' ? '#' + p.solidColor : 'none');\n    break;\n  case 'linearGradient':\n  case 'radialGradient':\n    canvas[type + 'Grad'] = p[p.type];\n    setGradient(type);\n    break;\n  }\n};\n\n// alias\nthis.setStrokePaint = function (paint) {\n  this.setPaint('stroke', paint);\n};\n\nthis.setFillPaint = function (paint) {\n  this.setPaint('fill', paint);\n};\n\n/**\n* @returns The current stroke-width value\n*/\nthis.getStrokeWidth = function () {\n  return curProperties.stroke_width;\n};\n\n/**\n* Sets the stroke width for the current selected elements\n* When attempting to set a line's width to 0, this changes it to 1 instead\n* @param {Number} val - A Float indicating the new stroke width value\n*/\nthis.setStrokeWidth = function (val) {\n  if (val === 0 && ['line', 'path'].includes(currentMode)) {\n    canvas.setStrokeWidth(1);\n    return;\n  }\n  curProperties.stroke_width = val;\n\n  const elems = [];\n  function addNonG (e) {\n    if (e.nodeName !== 'g') {\n      elems.push(e);\n    }\n  }\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    if (elem) {\n      if (elem.tagName === 'g') {\n        walkTree(elem, addNonG);\n      } else {\n        elems.push(elem);\n      }\n    }\n  }\n  if (elems.length > 0) {\n    changeSelectedAttribute('stroke-width', val, elems);\n    call('changed', selectedElements);\n  }\n};\n\n/**\n* Set the given stroke-related attribute the given value for selected elements\n* @param {String} attr - String with the attribute name\n* @param {String|Number} val - String or number with the attribute value\n*/\nthis.setStrokeAttr = function (attr, val) {\n  curShape[attr.replace('-', '_')] = val;\n  const elems = [];\n\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    if (elem) {\n      if (elem.tagName === 'g') {\n        walkTree(elem, function (e) { if (e.nodeName !== 'g') { elems.push(e); } });\n      } else {\n        elems.push(elem);\n      }\n    }\n  }\n  if (elems.length > 0) {\n    changeSelectedAttribute(attr, val, elems);\n    call('changed', selectedElements);\n  }\n};\n\n/**\n* @returns current style options\n*/\nthis.getStyle = function () {\n  return curShape;\n};\n\n/**\n* @returns the current opacity\n*/\nthis.getOpacity = getOpacity;\n\n/**\n* Sets the given opacity to the current selected elements\n* @param val\n*/\nthis.setOpacity = function (val) {\n  curShape.opacity = val;\n  changeSelectedAttribute('opacity', val);\n};\n\n/**\n* @returns the current fill opacity\n*/\nthis.getFillOpacity = function () {\n  return curShape.fill_opacity;\n};\n\n/**\n* @returns the current stroke opacity\n*/\nthis.getStrokeOpacity = function () {\n  return curShape.stroke_opacity;\n};\n\n/**\n* Sets the current fill/stroke opacity\n* @param {String} type - String with \"fill\" or \"stroke\"\n* @param {Number} val - Float with the new opacity value\n* @param {Boolean} preventUndo - Indicates whether or not this should be an undoable action\n*/\nthis.setPaintOpacity = function (type, val, preventUndo) {\n  curShape[type + '_opacity'] = val;\n  if (!preventUndo) {\n    changeSelectedAttribute(type + '-opacity', val);\n  } else {\n    changeSelectedAttributeNoUndo(type + '-opacity', val);\n  }\n};\n\n/**\n* Gets the current fill/stroke opacity\n* @param {\"fill\"|\"stroke\"} type - String with \"fill\" or \"stroke\"\n* @returns Fill/stroke opacity\n*/\nthis.getPaintOpacity = function (type) {\n  return type === 'fill' ? this.getFillOpacity() : this.getStrokeOpacity();\n};\n\n/**\n* Gets the stdDeviation blur value of the given element\n* @param elem - The element to check the blur value for\n* @returns stdDeviation blur attribute value\n*/\nthis.getBlur = function (elem) {\n  let val = 0;\n  // const elem = selectedElements[0];\n\n  if (elem) {\n    const filterUrl = elem.getAttribute('filter');\n    if (filterUrl) {\n      const blur = getElem(elem.id + '_blur');\n      if (blur) {\n        val = blur.firstChild.getAttribute('stdDeviation');\n      }\n    }\n  }\n  return val;\n};\n\n(function () {\nlet curCommand = null;\nlet filter = null;\nlet filterHidden = false;\n\n/**\n* Sets the stdDeviation blur value on the selected element without being undoable\n* @param val - The new stdDeviation value\n*/\ncanvas.setBlurNoUndo = function (val) {\n  if (!filter) {\n    canvas.setBlur(val);\n    return;\n  }\n  if (val === 0) {\n    // Don't change the StdDev, as that will hide the element.\n    // Instead, just remove the value for \"filter\"\n    changeSelectedAttributeNoUndo('filter', '');\n    filterHidden = true;\n  } else {\n    const elem = selectedElements[0];\n    if (filterHidden) {\n      changeSelectedAttributeNoUndo('filter', 'url(#' + elem.id + '_blur)');\n    }\n    if (isWebkit()) {\n      console.log('e', elem);\n      elem.removeAttribute('filter');\n      elem.setAttribute('filter', 'url(#' + elem.id + '_blur)');\n    }\n    changeSelectedAttributeNoUndo('stdDeviation', val, [filter.firstChild]);\n    canvas.setBlurOffsets(filter, val);\n  }\n};\n\nfunction finishChange () {\n  const bCmd = canvas.undoMgr.finishUndoableChange();\n  curCommand.addSubCommand(bCmd);\n  addCommandToHistory(curCommand);\n  curCommand = null;\n  filter = null;\n}\n\n/**\n* Sets the x, y, with, height values of the filter element in order to\n* make the blur not be clipped. Removes them if not neeeded\n* @param filter - The filter DOM element to update\n* @param stdDev - The standard deviation value on which to base the offset size\n*/\ncanvas.setBlurOffsets = function (filter, stdDev) {\n  if (stdDev > 3) {\n    // TODO: Create algorithm here where size is based on expected blur\n    assignAttributes(filter, {\n      x: '-50%',\n      y: '-50%',\n      width: '200%',\n      height: '200%'\n    }, 100);\n  } else {\n    // Removing these attributes hides text in Chrome (see Issue 579)\n    if (!isWebkit()) {\n      filter.removeAttribute('x');\n      filter.removeAttribute('y');\n      filter.removeAttribute('width');\n      filter.removeAttribute('height');\n    }\n  }\n};\n\n/**\n* Adds/updates the blur filter to the selected element\n* @param {Number} val - Float with the new stdDeviation blur value\n* @param {Boolean} complete - Boolean indicating whether or not the action should be completed (to add to the undo manager)\n*/\ncanvas.setBlur = function (val, complete) {\n  if (curCommand) {\n    finishChange();\n    return;\n  }\n\n  // Looks for associated blur, creates one if not found\n  const elem = selectedElements[0];\n  const elemId = elem.id;\n  filter = getElem(elemId + '_blur');\n\n  val -= 0;\n\n  const batchCmd = new BatchCommand();\n\n  // Blur found!\n  if (filter) {\n    if (val === 0) {\n      filter = null;\n    }\n  } else {\n    // Not found, so create\n    const newblur = addSvgElementFromJson({ element: 'feGaussianBlur',\n      attr: {\n        in: 'SourceGraphic',\n        stdDeviation: val\n      }\n    });\n\n    filter = addSvgElementFromJson({ element: 'filter',\n      attr: {\n        id: elemId + '_blur'\n      }\n    });\n\n    filter.append(newblur);\n    findDefs().append(filter);\n\n    batchCmd.addSubCommand(new InsertElementCommand(filter));\n  }\n\n  const changes = {filter: elem.getAttribute('filter')};\n\n  if (val === 0) {\n    elem.removeAttribute('filter');\n    batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n    return;\n  }\n\n  changeSelectedAttribute('filter', 'url(#' + elemId + '_blur)');\n  batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n  canvas.setBlurOffsets(filter, val);\n\n  curCommand = batchCmd;\n  canvas.undoMgr.beginUndoableChange('stdDeviation', [filter ? filter.firstChild : null]);\n  if (complete) {\n    canvas.setBlurNoUndo(val);\n    finishChange();\n  }\n};\n}());\n\n/**\n* Check whether selected element is bold or not\n* @returns {Boolean} Indicates whether or not element is bold\n*/\nthis.getBold = function () {\n  // should only have one element selected\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    return (selected.getAttribute('font-weight') === 'bold');\n  }\n  return false;\n};\n\n/**\n* Make the selected element bold or normal\n* @param {Boolean} b - Indicates bold (true) or normal (false)\n*/\nthis.setBold = function (b) {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    changeSelectedAttribute('font-weight', b ? 'bold' : 'normal');\n  }\n  if (!selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* Check whether selected element is italic or not\n* @returns {Boolean} Indicates whether or not element is italic\n*/\nthis.getItalic = function () {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    return (selected.getAttribute('font-style') === 'italic');\n  }\n  return false;\n};\n\n/**\n* Make the selected element italic or normal\n* @param {Boolean} b - Indicates italic (true) or normal (false)\n*/\nthis.setItalic = function (i) {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    changeSelectedAttribute('font-style', i ? 'italic' : 'normal');\n  }\n  if (!selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* @returns The current font family\n*/\nthis.getFontFamily = function () {\n  return curText.font_family;\n};\n\n/**\n* Set the new font family\n* @param {String} val - String with the new font family\n*/\nthis.setFontFamily = function (val) {\n  curText.font_family = val;\n  changeSelectedAttribute('font-family', val);\n  if (selectedElements[0] && !selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* Set the new font color\n* @param {String} val - String with the new font color\n*/\nthis.setFontColor = function (val) {\n  curText.fill = val;\n  changeSelectedAttribute('fill', val);\n};\n\n/**\n* @returns The current font color\n*/\nthis.getFontColor = function () {\n  return curText.fill;\n};\n\n/**\n* Returns the current font size\n*/\nthis.getFontSize = function () {\n  return curText.font_size;\n};\n\n/**\n* Applies the given font size to the selected element\n* @param {Number} val - Float with the new font size\n*/\nthis.setFontSize = function (val) {\n  curText.font_size = val;\n  changeSelectedAttribute('font-size', val);\n  if (!selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* @returns The current text (textContent) of the selected element\n*/\nthis.getText = function () {\n  const selected = selectedElements[0];\n  if (selected == null) { return ''; }\n  return selected.textContent;\n};\n\n/**\n* Updates the text element with the given string\n* @param {String} val - String with the new text\n*/\nthis.setTextContent = function (val) {\n  changeSelectedAttribute('#text', val);\n  textActions.init(val);\n  textActions.setCursor();\n};\n\n/**\n* Sets the new image URL for the selected image element. Updates its size if\n* a new URL is given\n* @param {String} val - String with the image URL/path\n*/\nthis.setImageURL = function (val) {\n  const elem = selectedElements[0];\n  if (!elem) { return; }\n\n  const attrs = $(elem).attr(['width', 'height']);\n  let setsize = (!attrs.width || !attrs.height);\n\n  const curHref = getHref(elem);\n\n  // Do nothing if no URL change or size change\n  if (curHref !== val) {\n    setsize = true;\n  } else if (!setsize) { return; }\n\n  const batchCmd = new BatchCommand('Change Image URL');\n\n  setHref(elem, val);\n  batchCmd.addSubCommand(new ChangeElementCommand(elem, {\n    '#href': curHref\n  }));\n\n  if (setsize) {\n    $(new Image()).load(function () {\n      const changes = $(elem).attr(['width', 'height']);\n\n      $(elem).attr({\n        width: this.width,\n        height: this.height\n      });\n\n      selectorManager.requestSelector(elem).resize();\n\n      batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n      addCommandToHistory(batchCmd);\n      call('changed', [elem]);\n    }).attr('src', val);\n  } else {\n    addCommandToHistory(batchCmd);\n  }\n};\n\n/**\n* Sets the new link URL for the selected anchor element.\n* @param {String} val - String with the link URL/path\n*/\nthis.setLinkURL = function (val) {\n  let elem = selectedElements[0];\n  if (!elem) { return; }\n  if (elem.tagName !== 'a') {\n    // See if parent is an anchor\n    const parentsA = $(elem).parents('a');\n    if (parentsA.length) {\n      elem = parentsA[0];\n    } else {\n      return;\n    }\n  }\n\n  const curHref = getHref(elem);\n\n  if (curHref === val) { return; }\n\n  const batchCmd = new BatchCommand('Change Link URL');\n\n  setHref(elem, val);\n  batchCmd.addSubCommand(new ChangeElementCommand(elem, {\n    '#href': curHref\n  }));\n\n  addCommandToHistory(batchCmd);\n};\n\n/**\n* Sets the rx & ry values to the selected rect element to change its corner radius\n* @param val - The new radius\n*/\nthis.setRectRadius = function (val) {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'rect') {\n    const r = selected.getAttribute('rx');\n    if (r !== String(val)) {\n      selected.setAttribute('rx', val);\n      selected.setAttribute('ry', val);\n      addCommandToHistory(new ChangeElementCommand(selected, {rx: r, ry: r}, 'Radius'));\n      call('changed', [selected]);\n    }\n  }\n};\n\n/**\n* Wraps the selected element(s) in an anchor element or converts group to one\n* @param url\n*/\nthis.makeHyperlink = function (url) {\n  canvas.groupSelectedElements('a', url);\n\n  // TODO: If element is a single \"g\", convert to \"a\"\n  //  if (selectedElements.length > 1 && selectedElements[1]) {\n};\n\n/**\n*\n*/\nthis.removeHyperlink = function () {\n  canvas.ungroupSelectedElement();\n};\n\n/**\n* Group: Element manipulation\n*/\n\n/**\n* Sets the new segment type to the selected segment(s).\n* @param {Number} newType - Integer with the new segment type\n* See https://www.w3.org/TR/SVG/paths.html#InterfaceSVGPathSeg for list\n*/\nthis.setSegType = function (newType) {\n  pathActions.setSegType(newType);\n};\n\n/**\n* @todo (codedread): Remove the getBBox argument and split this function into two.\n* Convert selected element to a path, or get the BBox of an element-as-path\n* @param elem - The DOM element to be converted\n* @param getBBox - Boolean on whether or not to only return the path's BBox\n* @returns If the getBBox flag is true, the resulting path's bounding box object.\n* Otherwise the resulting path element is returned.\n*/\nthis.convertToPath = function (elem, getBBox) {\n  if (elem == null) {\n    const elems = selectedElements;\n    $.each(elems, function (i, elem) {\n      if (elem) { canvas.convertToPath(elem); }\n    });\n    return;\n  }\n  if (getBBox) {\n    return getBBoxOfElementAsPath(elem, addSvgElementFromJson, pathActions);\n  } else {\n    // TODO: Why is this applying attributes from curShape, then inside utilities.convertToPath it's pulling addition attributes from elem?\n    // TODO: If convertToPath is called with one elem, curShape and elem are probably the same; but calling with multiple is a bug or cool feature.\n    const attrs = {\n      fill: curShape.fill,\n      'fill-opacity': curShape.fill_opacity,\n      stroke: curShape.stroke,\n      'stroke-width': curShape.stroke_width,\n      'stroke-dasharray': curShape.stroke_dasharray,\n      'stroke-linejoin': curShape.stroke_linejoin,\n      'stroke-linecap': curShape.stroke_linecap,\n      'stroke-opacity': curShape.stroke_opacity,\n      opacity: curShape.opacity,\n      visibility: 'hidden'\n    };\n    return convertToPath(elem, attrs, addSvgElementFromJson, pathActions, clearSelection, addToSelection, history, addCommandToHistory);\n  }\n};\n\n/**\n* This function makes the changes to the elements. It does not add the change\n* to the history stack.\n* @param {String} attr - Attribute name\n* @param {String|Number} newValue - String or number with the new attribute value\n* @param elems - The DOM elements to apply the change to\n*/\nconst changeSelectedAttributeNoUndo = function (attr, newValue, elems) {\n  if (currentMode === 'pathedit') {\n    // Editing node\n    pathActions.moveNode(attr, newValue);\n  }\n  elems = elems || selectedElements;\n  let i = elems.length;\n  const noXYElems = ['g', 'polyline', 'path'];\n  const goodGAttrs = ['transform', 'opacity', 'filter'];\n\n  while (i--) {\n    let elem = elems[i];\n    if (elem == null) { continue; }\n\n    // Set x,y vals on elements that don't have them\n    if ((attr === 'x' || attr === 'y') && noXYElems.includes(elem.tagName)) {\n      const bbox = getStrokedBBoxDefaultVisible([elem]);\n      const diffX = attr === 'x' ? newValue - bbox.x : 0;\n      const diffY = attr === 'y' ? newValue - bbox.y : 0;\n      canvas.moveSelectedElements(diffX * currentZoom, diffY * currentZoom, true);\n      continue;\n    }\n\n    // only allow the transform/opacity/filter attribute to change on <g> elements, slightly hacky\n    // TODO: FIXME: This doesn't seem right. Where's the body of this if statement?\n    if (elem.tagName === 'g' && goodGAttrs.includes(attr)) {}\n    let oldval = attr === '#text' ? elem.textContent : elem.getAttribute(attr);\n    if (oldval == null) { oldval = ''; }\n    if (oldval !== String(newValue)) {\n      if (attr === '#text') {\n        // const oldW = utilsGetBBox(elem).width;\n        elem.textContent = newValue;\n\n        // FF bug occurs on on rotated elements\n        if ((/rotate/).test(elem.getAttribute('transform'))) {\n          elem = ffClone(elem);\n        }\n        // Hoped to solve the issue of moving text with text-anchor=\"start\",\n        // but this doesn't actually fix it. Hopefully on the right track, though. -Fyrd\n        // const box = getBBox(elem), left = box.x, top = box.y, {width, height} = box,\n        //   dx = width - oldW, dy = 0;\n        // const angle = getRotationAngle(elem, true);\n        // if (angle) {\n        //   const r = Math.sqrt(dx * dx + dy * dy);\n        //   const theta = Math.atan2(dy, dx) - angle;\n        //   dx = r * Math.cos(theta);\n        //   dy = r * Math.sin(theta);\n        //\n        //   elem.setAttribute('x', elem.getAttribute('x') - dx);\n        //   elem.setAttribute('y', elem.getAttribute('y') - dy);\n        // }\n      } else if (attr === '#href') {\n        setHref(elem, newValue);\n      } else { elem.setAttribute(attr, newValue); }\n\n      // Go into \"select\" mode for text changes\n      // NOTE: Important that this happens AFTER elem.setAttribute() or else attributes like\n      // font-size can get reset to their old value, ultimately by svgEditor.updateContextPanel(),\n      // after calling textActions.toSelectMode() below\n      if (currentMode === 'textedit' && attr !== '#text' && elem.textContent.length) {\n        textActions.toSelectMode(elem);\n      }\n\n      // if (i === 0) {\n      //   selectedBBoxes[0] = utilsGetBBox(elem);\n      // }\n\n      // Use the Firefox ffClone hack for text elements with gradients or\n      // where other text attributes are changed.\n      if (isGecko() && elem.nodeName === 'text' && (/rotate/).test(elem.getAttribute('transform'))) {\n        if (String(newValue).startsWith('url') || (['font-size', 'font-family', 'x', 'y'].includes(attr) && elem.textContent)) {\n          elem = ffClone(elem);\n        }\n      }\n      // Timeout needed for Opera & Firefox\n      // codedread: it is now possible for this function to be called with elements\n      // that are not in the selectedElements array, we need to only request a\n      // selector if the element is in that array\n      if (selectedElements.includes(elem)) {\n        setTimeout(function () {\n          // Due to element replacement, this element may no longer\n          // be part of the DOM\n          if (!elem.parentNode) { return; }\n          selectorManager.requestSelector(elem).resize();\n        }, 0);\n      }\n      // if this element was rotated, and we changed the position of this element\n      // we need to update the rotational transform attribute\n      const angle = getRotationAngle(elem);\n      if (angle !== 0 && attr !== 'transform') {\n        const tlist = getTransformList(elem);\n        let n = tlist.numberOfItems;\n        while (n--) {\n          const xform = tlist.getItem(n);\n          if (xform.type === 4) {\n            // remove old rotate\n            tlist.removeItem(n);\n\n            const box = utilsGetBBox(elem);\n            const center = transformPoint(box.x + box.width / 2, box.y + box.height / 2, transformListToTransform(tlist).matrix);\n            const cx = center.x,\n              cy = center.y;\n            const newrot = svgroot.createSVGTransform();\n            newrot.setRotate(angle, cx, cy);\n            tlist.insertItemBefore(newrot, n);\n            break;\n          }\n        }\n      }\n    } // if oldValue != newValue\n  } // for each elem\n};\n\n/**\n* Change the given/selected element and add the original value to the history stack\n* If you want to change all selectedElements, ignore the elems argument.\n* If you want to change only a subset of selectedElements, then send the\n* subset to this function in the elems argument.\n* @param {String} attr - String with the attribute name\n* @param {String|Number} newValue - String or number with the new attribute value\n* @param elems - The DOM elements to apply the change to\n*/\nconst changeSelectedAttribute = this.changeSelectedAttribute = function (attr, val, elems) {\n  elems = elems || selectedElements;\n  canvas.undoMgr.beginUndoableChange(attr, elems);\n  // const i = elems.length;\n\n  changeSelectedAttributeNoUndo(attr, val, elems);\n\n  const batchCmd = canvas.undoMgr.finishUndoableChange();\n  if (!batchCmd.isEmpty()) {\n    addCommandToHistory(batchCmd);\n  }\n};\n\n// Removes all selected elements from the DOM and adds the change to the\n// history stack\nthis.deleteSelectedElements = function () {\n  const batchCmd = new BatchCommand('Delete Elements');\n  const len = selectedElements.length;\n  const selectedCopy = []; // selectedElements is being deleted\n\n  for (let i = 0; i < len; ++i) {\n    const selected = selectedElements[i];\n    if (selected == null) { break; }\n\n    let parent = selected.parentNode;\n    let t = selected;\n\n    // this will unselect the element and remove the selectedOutline\n    selectorManager.releaseSelector(t);\n\n    // Remove the path if present.\n    pathModule.removePath_(t.id);\n\n    // Get the parent if it's a single-child anchor\n    if (parent.tagName === 'a' && parent.childNodes.length === 1) {\n      t = parent;\n      parent = parent.parentNode;\n    }\n\n    const {nextSibling} = t;\n    const elem = parent.removeChild(t);\n    selectedCopy.push(selected); // for the copy\n    batchCmd.addSubCommand(new RemoveElementCommand(elem, nextSibling, parent));\n  }\n  selectedElements = [];\n\n  if (!batchCmd.isEmpty()) { addCommandToHistory(batchCmd); }\n  call('changed', selectedCopy);\n  clearSelection();\n};\n\n/**\n* Removes all selected elements from the DOM and adds the change to the\n* history stack. Remembers removed elements on the clipboard\n*/\nthis.cutSelectedElements = function () {\n  canvas.copySelectedElements();\n  canvas.deleteSelectedElements();\n};\n\n/**\n* Remembers the current selected elements on the clipboard\n*/\nthis.copySelectedElements = function () {\n  localStorage.setItem('svgedit_clipboard', JSON.stringify(\n    selectedElements.map(function (x) { return getJsonFromSvgElement(x); })\n  ));\n\n  $('#cmenu_canvas').enableContextMenuItems('#paste,#paste_in_place');\n};\n\n/**\n* @param {\"in_place\"|\"point\"|undefined} type\n* @param {Number|undefined} x Expected if type is \"point\"\n* @param {Number|undefined} y Expected if type is \"point\"\n*/\nthis.pasteElements = function (type, x, y) {\n  let cb = JSON.parse(localStorage.getItem('svgedit_clipboard'));\n  let len = cb.length;\n  if (!len) { return; }\n\n  const pasted = [];\n  const batchCmd = new BatchCommand('Paste elements');\n  // const drawing = getCurrentDrawing();\n  const changedIDs = {};\n\n  // Recursively replace IDs and record the changes\n  function checkIDs (elem) {\n    if (elem.attr && elem.attr.id) {\n      changedIDs[elem.attr.id] = getNextId();\n      elem.attr.id = changedIDs[elem.attr.id];\n    }\n    if (elem.children) elem.children.forEach(checkIDs);\n  }\n  cb.forEach(checkIDs);\n\n  // Give extensions like the connector extension a chance to reflect new IDs and remove invalid elements\n  runExtensions('IDsUpdated', {elems: cb, changes: changedIDs}, true).forEach(function (extChanges) {\n    if (!extChanges || !('remove' in extChanges)) return;\n\n    extChanges.remove.forEach(function (removeID) {\n      cb = cb.filter(function (cbItem) {\n        return cbItem.attr.id !== removeID;\n      });\n    });\n  });\n\n  // Move elements to lastClickPoint\n  while (len--) {\n    const elem = cb[len];\n    if (!elem) { continue; }\n\n    const copy = addSvgElementFromJson(elem);\n    pasted.push(copy);\n    batchCmd.addSubCommand(new InsertElementCommand(copy));\n\n    restoreRefElems(copy);\n  }\n\n  selectOnly(pasted);\n\n  if (type !== 'in_place') {\n    let ctrX, ctrY;\n\n    if (!type) {\n      ctrX = lastClickPoint.x;\n      ctrY = lastClickPoint.y;\n    } else if (type === 'point') {\n      ctrX = x;\n      ctrY = y;\n    }\n\n    const bbox = getStrokedBBoxDefaultVisible(pasted);\n    const cx = ctrX - (bbox.x + bbox.width / 2),\n      cy = ctrY - (bbox.y + bbox.height / 2),\n      dx = [],\n      dy = [];\n\n    $.each(pasted, function (i, item) {\n      dx.push(cx);\n      dy.push(cy);\n    });\n\n    const cmd = canvas.moveSelectedElements(dx, dy, false);\n    if (cmd) batchCmd.addSubCommand(cmd);\n  }\n\n  addCommandToHistory(batchCmd);\n  call('changed', pasted);\n};\n\n/**\n* Wraps all the selected elements in a group (g) element\n* @param type - type of element to group into, defaults to &lt;g>\n*/\nthis.groupSelectedElements = function (type, urlArg) {\n  if (!type) { type = 'g'; }\n  let cmdStr = '';\n  let url;\n\n  switch (type) {\n  case 'a': {\n    cmdStr = 'Make hyperlink';\n    url = '';\n    if (arguments.length > 1) {\n      url = urlArg;\n    }\n    break;\n  } default: {\n    type = 'g';\n    cmdStr = 'Group Elements';\n    break;\n  }\n  }\n\n  const batchCmd = new BatchCommand(cmdStr);\n\n  // create and insert the group element\n  const g = addSvgElementFromJson({\n    element: type,\n    attr: {\n      id: getNextId()\n    }\n  });\n  if (type === 'a') {\n    setHref(g, url);\n  }\n  batchCmd.addSubCommand(new InsertElementCommand(g));\n\n  // now move all children into the group\n  let i = selectedElements.length;\n  while (i--) {\n    let elem = selectedElements[i];\n    if (elem == null) { continue; }\n\n    if (elem.parentNode.tagName === 'a' && elem.parentNode.childNodes.length === 1) {\n      elem = elem.parentNode;\n    }\n\n    const oldNextSibling = elem.nextSibling;\n    const oldParent = elem.parentNode;\n    g.append(elem);\n    batchCmd.addSubCommand(new MoveElementCommand(elem, oldNextSibling, oldParent));\n  }\n  if (!batchCmd.isEmpty()) { addCommandToHistory(batchCmd); }\n\n  // update selection\n  selectOnly([g], true);\n};\n\n// Pushes all appropriate parent group properties down to its children, then\n// removes them from the group\nconst pushGroupProperties = this.pushGroupProperties = function (g, undoable) {\n  const children = g.childNodes;\n  const len = children.length;\n  const xform = g.getAttribute('transform');\n\n  const glist = getTransformList(g);\n  const m = transformListToTransform(glist).matrix;\n\n  const batchCmd = new BatchCommand('Push group properties');\n\n  // TODO: get all fill/stroke properties from the group that we are about to destroy\n  // \"fill\", \"fill-opacity\", \"fill-rule\", \"stroke\", \"stroke-dasharray\", \"stroke-dashoffset\",\n  // \"stroke-linecap\", \"stroke-linejoin\", \"stroke-miterlimit\", \"stroke-opacity\",\n  // \"stroke-width\"\n  // and then for each child, if they do not have the attribute (or the value is 'inherit')\n  // then set the child's attribute\n\n  const gangle = getRotationAngle(g);\n\n  const gattrs = $(g).attr(['filter', 'opacity']);\n  let gfilter, gblur, changes;\n  const drawing = getCurrentDrawing();\n\n  for (let i = 0; i < len; i++) {\n    const elem = children[i];\n\n    if (elem.nodeType !== 1) { continue; }\n\n    if (gattrs.opacity !== null && gattrs.opacity !== 1) {\n      // const c_opac = elem.getAttribute('opacity') || 1;\n      const newOpac = Math.round((elem.getAttribute('opacity') || 1) * gattrs.opacity * 100) / 100;\n      changeSelectedAttribute('opacity', newOpac, [elem]);\n    }\n\n    if (gattrs.filter) {\n      let cblur = this.getBlur(elem);\n      const origCblur = cblur;\n      if (!gblur) { gblur = this.getBlur(g); }\n      if (cblur) {\n        // Is this formula correct?\n        cblur = Number(gblur) + Number(cblur);\n      } else if (cblur === 0) {\n        cblur = gblur;\n      }\n\n      // If child has no current filter, get group's filter or clone it.\n      if (!origCblur) {\n        // Set group's filter to use first child's ID\n        if (!gfilter) {\n          gfilter = getRefElem(gattrs.filter);\n        } else {\n          // Clone the group's filter\n          gfilter = drawing.copyElem(gfilter);\n          findDefs().append(gfilter);\n        }\n      } else {\n        gfilter = getRefElem(elem.getAttribute('filter'));\n      }\n\n      // Change this in future for different filters\n      const suffix = (gfilter.firstChild.tagName === 'feGaussianBlur') ? 'blur' : 'filter';\n      gfilter.id = elem.id + '_' + suffix;\n      changeSelectedAttribute('filter', 'url(#' + gfilter.id + ')', [elem]);\n\n      // Update blur value\n      if (cblur) {\n        changeSelectedAttribute('stdDeviation', cblur, [gfilter.firstChild]);\n        canvas.setBlurOffsets(gfilter, cblur);\n      }\n    }\n\n    let chtlist = getTransformList(elem);\n\n    // Don't process gradient transforms\n    if (elem.tagName.includes('Gradient')) { chtlist = null; }\n\n    // Hopefully not a problem to add this. Necessary for elements like <desc/>\n    if (!chtlist) { continue; }\n\n    // Apparently <defs> can get get a transformlist, but we don't want it to have one!\n    if (elem.tagName === 'defs') { continue; }\n\n    if (glist.numberOfItems) {\n      // TODO: if the group's transform is just a rotate, we can always transfer the\n      // rotate() down to the children (collapsing consecutive rotates and factoring\n      // out any translates)\n      if (gangle && glist.numberOfItems === 1) {\n        // [Rg] [Rc] [Mc]\n        // we want [Tr] [Rc2] [Mc] where:\n        //  - [Rc2] is at the child's current center but has the\n        // sum of the group and child's rotation angles\n        //  - [Tr] is the equivalent translation that this child\n        // undergoes if the group wasn't there\n\n        // [Tr] = [Rg] [Rc] [Rc2_inv]\n\n        // get group's rotation matrix (Rg)\n        const rgm = glist.getItem(0).matrix;\n\n        // get child's rotation matrix (Rc)\n        let rcm = svgroot.createSVGMatrix();\n        const cangle = getRotationAngle(elem);\n        if (cangle) {\n          rcm = chtlist.getItem(0).matrix;\n        }\n\n        // get child's old center of rotation\n        const cbox = utilsGetBBox(elem);\n        const ceqm = transformListToTransform(chtlist).matrix;\n        const coldc = transformPoint(cbox.x + cbox.width / 2, cbox.y + cbox.height / 2, ceqm);\n\n        // sum group and child's angles\n        const sangle = gangle + cangle;\n\n        // get child's rotation at the old center (Rc2_inv)\n        const r2 = svgroot.createSVGTransform();\n        r2.setRotate(sangle, coldc.x, coldc.y);\n\n        // calculate equivalent translate\n        const trm = matrixMultiply(rgm, rcm, r2.matrix.inverse());\n\n        // set up tlist\n        if (cangle) {\n          chtlist.removeItem(0);\n        }\n\n        if (sangle) {\n          if (chtlist.numberOfItems) {\n            chtlist.insertItemBefore(r2, 0);\n          } else {\n            chtlist.appendItem(r2);\n          }\n        }\n\n        if (trm.e || trm.f) {\n          const tr = svgroot.createSVGTransform();\n          tr.setTranslate(trm.e, trm.f);\n          if (chtlist.numberOfItems) {\n            chtlist.insertItemBefore(tr, 0);\n          } else {\n            chtlist.appendItem(tr);\n          }\n        }\n      } else { // more complicated than just a rotate\n        // transfer the group's transform down to each child and then\n        // call recalculateDimensions()\n        const oldxform = elem.getAttribute('transform');\n        changes = {};\n        changes.transform = oldxform || '';\n\n        const newxform = svgroot.createSVGTransform();\n\n        // [ gm ] [ chm ] = [ chm ] [ gm' ]\n        // [ gm' ] = [ chmInv ] [ gm ] [ chm ]\n        const chm = transformListToTransform(chtlist).matrix,\n          chmInv = chm.inverse();\n        const gm = matrixMultiply(chmInv, m, chm);\n        newxform.setMatrix(gm);\n        chtlist.appendItem(newxform);\n      }\n      const cmd = recalculateDimensions(elem);\n      if (cmd) { batchCmd.addSubCommand(cmd); }\n    }\n  }\n\n  // remove transform and make it undo-able\n  if (xform) {\n    changes = {};\n    changes.transform = xform;\n    g.setAttribute('transform', '');\n    g.removeAttribute('transform');\n    batchCmd.addSubCommand(new ChangeElementCommand(g, changes));\n  }\n\n  if (undoable && !batchCmd.isEmpty()) {\n    return batchCmd;\n  }\n};\n\n/**\n* Unwraps all the elements in a selected group (g) element. This requires\n* significant recalculations to apply group's transforms, etc to its children\n*/\nthis.ungroupSelectedElement = function () {\n  let g = selectedElements[0];\n  if (!g) {\n    return;\n  }\n  if ($(g).data('gsvg') || $(g).data('symbol')) {\n    // Is svg, so actually convert to group\n    convertToGroup(g);\n    return;\n  }\n  if (g.tagName === 'use') {\n    // Somehow doesn't have data set, so retrieve\n    const symbol = getElem(getHref(g).substr(1));\n    $(g).data('symbol', symbol).data('ref', symbol);\n    convertToGroup(g);\n    return;\n  }\n  const parentsA = $(g).parents('a');\n  if (parentsA.length) {\n    g = parentsA[0];\n  }\n\n  // Look for parent \"a\"\n  if (g.tagName === 'g' || g.tagName === 'a') {\n    const batchCmd = new BatchCommand('Ungroup Elements');\n    const cmd = pushGroupProperties(g, true);\n    if (cmd) { batchCmd.addSubCommand(cmd); }\n\n    const parent = g.parentNode;\n    const anchor = g.nextSibling;\n    const children = new Array(g.childNodes.length);\n\n    let i = 0;\n    while (g.firstChild) {\n      let elem = g.firstChild;\n      const oldNextSibling = elem.nextSibling;\n      const oldParent = elem.parentNode;\n\n      // Remove child title elements\n      if (elem.tagName === 'title') {\n        const {nextSibling} = elem;\n        batchCmd.addSubCommand(new RemoveElementCommand(elem, nextSibling, oldParent));\n        elem.remove();\n        continue;\n      }\n\n      children[i++] = elem = parent.insertBefore(elem, anchor);\n      batchCmd.addSubCommand(new MoveElementCommand(elem, oldNextSibling, oldParent));\n    }\n\n    // remove the group from the selection\n    clearSelection();\n\n    // delete the group element (but make undo-able)\n    const gNextSibling = g.nextSibling;\n    g = parent.removeChild(g);\n    batchCmd.addSubCommand(new RemoveElementCommand(g, gNextSibling, parent));\n\n    if (!batchCmd.isEmpty()) { addCommandToHistory(batchCmd); }\n\n    // update selection\n    addToSelection(children);\n  }\n};\n\n/**\n* Repositions the selected element to the bottom in the DOM to appear on top of\n* other elements\n*/\nthis.moveToTopSelectedElement = function () {\n  const selected = selectedElements[0];\n  if (selected != null) {\n    let t = selected;\n    const oldParent = t.parentNode;\n    const oldNextSibling = t.nextSibling;\n    t = t.parentNode.appendChild(t);\n    // If the element actually moved position, add the command and fire the changed\n    // event handler.\n    if (oldNextSibling !== t.nextSibling) {\n      addCommandToHistory(new MoveElementCommand(t, oldNextSibling, oldParent, 'top'));\n      call('changed', [t]);\n    }\n  }\n};\n\n/**\n* Repositions the selected element to the top in the DOM to appear under\n* other elements\n*/\nthis.moveToBottomSelectedElement = function () {\n  const selected = selectedElements[0];\n  if (selected != null) {\n    let t = selected;\n    const oldParent = t.parentNode;\n    const oldNextSibling = t.nextSibling;\n    let {firstChild} = t.parentNode;\n    if (firstChild.tagName === 'title') {\n      firstChild = firstChild.nextSibling;\n    }\n    // This can probably be removed, as the defs should not ever apppear\n    // inside a layer group\n    if (firstChild.tagName === 'defs') {\n      firstChild = firstChild.nextSibling;\n    }\n    t = t.parentNode.insertBefore(t, firstChild);\n    // If the element actually moved position, add the command and fire the changed\n    // event handler.\n    if (oldNextSibling !== t.nextSibling) {\n      addCommandToHistory(new MoveElementCommand(t, oldNextSibling, oldParent, 'bottom'));\n      call('changed', [t]);\n    }\n  }\n};\n\n/**\n* Moves the select element up or down the stack, based on the visibly\n* intersecting elements\n* @param {\"Up\"|\"Down\"} dir - String that's either 'Up' or 'Down'\n*/\nthis.moveUpDownSelected = function (dir) {\n  const selected = selectedElements[0];\n  if (!selected) { return; }\n\n  curBBoxes = [];\n  let closest, foundCur;\n  // jQuery sorts this list\n  const list = $(getIntersectionList(getStrokedBBoxDefaultVisible([selected]))).toArray();\n  if (dir === 'Down') { list.reverse(); }\n\n  $.each(list, function () {\n    if (!foundCur) {\n      if (this === selected) {\n        foundCur = true;\n      }\n      return;\n    }\n    closest = this;\n    return false;\n  });\n  if (!closest) { return; }\n\n  const t = selected;\n  const oldParent = t.parentNode;\n  const oldNextSibling = t.nextSibling;\n  $(closest)[dir === 'Down' ? 'before' : 'after'](t);\n  // If the element actually moved position, add the command and fire the changed\n  // event handler.\n  if (oldNextSibling !== t.nextSibling) {\n    addCommandToHistory(new MoveElementCommand(t, oldNextSibling, oldParent, 'Move ' + dir));\n    call('changed', [t]);\n  }\n};\n\n/**\n* Moves selected elements on the X/Y axis\n* @param {Number} dx - Float with the distance to move on the x-axis\n* @param {Number} dy - Float with the distance to move on the y-axis\n* @param {Boolean} undoable - Boolean indicating whether or not the action should be undoable\n* @returns Batch command for the move\n*/\nthis.moveSelectedElements = function (dx, dy, undoable) {\n  // if undoable is not sent, default to true\n  // if single values, scale them to the zoom\n  if (dx.constructor !== Array) {\n    dx /= currentZoom;\n    dy /= currentZoom;\n  }\n  undoable = undoable || true;\n  const batchCmd = new BatchCommand('position');\n  let i = selectedElements.length;\n  while (i--) {\n    const selected = selectedElements[i];\n    if (selected != null) {\n      // if (i === 0) {\n      //   selectedBBoxes[0] = utilsGetBBox(selected);\n      // }\n      // const b = {};\n      // for (const j in selectedBBoxes[i]) b[j] = selectedBBoxes[i][j];\n      // selectedBBoxes[i] = b;\n\n      const xform = svgroot.createSVGTransform();\n      const tlist = getTransformList(selected);\n\n      // dx and dy could be arrays\n      if (dx.constructor === Array) {\n        // if (i === 0) {\n        //   selectedBBoxes[0].x += dx[0];\n        //   selectedBBoxes[0].y += dy[0];\n        // }\n        xform.setTranslate(dx[i], dy[i]);\n      } else {\n        // if (i === 0) {\n        //   selectedBBoxes[0].x += dx;\n        //   selectedBBoxes[0].y += dy;\n        // }\n        xform.setTranslate(dx, dy);\n      }\n\n      if (tlist.numberOfItems) {\n        tlist.insertItemBefore(xform, 0);\n      } else {\n        tlist.appendItem(xform);\n      }\n\n      const cmd = recalculateDimensions(selected);\n      if (cmd) {\n        batchCmd.addSubCommand(cmd);\n      }\n\n      selectorManager.requestSelector(selected).resize();\n    }\n  }\n  if (!batchCmd.isEmpty()) {\n    if (undoable) {\n      addCommandToHistory(batchCmd);\n    }\n    call('changed', selectedElements);\n    return batchCmd;\n  }\n};\n\n/**\n* Create deep DOM copies (clones) of all selected elements and move them slightly\n* from their originals\n*/\nthis.cloneSelectedElements = function (x, y) {\n  let i, elem;\n  const batchCmd = new BatchCommand('Clone Elements');\n  // find all the elements selected (stop at first null)\n  const len = selectedElements.length;\n  function sortfunction (a, b) {\n    return ($(b).index() - $(a).index()); // causes an array to be sorted numerically and ascending\n  }\n  selectedElements.sort(sortfunction);\n  for (i = 0; i < len; ++i) {\n    elem = selectedElements[i];\n    if (elem == null) { break; }\n  }\n  // use slice to quickly get the subset of elements we need\n  const copiedElements = selectedElements.slice(0, i);\n  this.clearSelection(true);\n  // note that we loop in the reverse way because of the way elements are added\n  // to the selectedElements array (top-first)\n  const drawing = getCurrentDrawing();\n  i = copiedElements.length;\n  while (i--) {\n    // clone each element and replace it within copiedElements\n    elem = copiedElements[i] = drawing.copyElem(copiedElements[i]);\n    (currentGroup || drawing.getCurrentLayer()).append(elem);\n    batchCmd.addSubCommand(new InsertElementCommand(elem));\n  }\n\n  if (!batchCmd.isEmpty()) {\n    addToSelection(copiedElements.reverse()); // Need to reverse for correct selection-adding\n    this.moveSelectedElements(x, y, false);\n    addCommandToHistory(batchCmd);\n  }\n};\n\n/**\n* Aligns selected elements\n* @param {String} type - String with single character indicating the alignment type\n* @param {\"selected\"|\"largest\"|\"smallest\"|\"page\"} relativeTo\n*/\nthis.alignSelectedElements = function (type, relativeTo) {\n  const bboxes = []; // angles = [];\n  const len = selectedElements.length;\n  if (!len) { return; }\n  let minx = Number.MAX_VALUE, maxx = Number.MIN_VALUE,\n    miny = Number.MAX_VALUE, maxy = Number.MIN_VALUE;\n  let curwidth = Number.MIN_VALUE, curheight = Number.MIN_VALUE;\n  for (let i = 0; i < len; ++i) {\n    if (selectedElements[i] == null) { break; }\n    const elem = selectedElements[i];\n    bboxes[i] = getStrokedBBoxDefaultVisible([elem]);\n\n    // now bbox is axis-aligned and handles rotation\n    switch (relativeTo) {\n    case 'smallest':\n      if (((type === 'l' || type === 'c' || type === 'r') &&\n        (curwidth === Number.MIN_VALUE || curwidth > bboxes[i].width)) ||\n        ((type === 't' || type === 'm' || type === 'b') &&\n        (curheight === Number.MIN_VALUE || curheight > bboxes[i].height))\n      ) {\n        minx = bboxes[i].x;\n        miny = bboxes[i].y;\n        maxx = bboxes[i].x + bboxes[i].width;\n        maxy = bboxes[i].y + bboxes[i].height;\n        curwidth = bboxes[i].width;\n        curheight = bboxes[i].height;\n      }\n      break;\n    case 'largest':\n      if (((type === 'l' || type === 'c' || type === 'r') &&\n        (curwidth === Number.MIN_VALUE || curwidth < bboxes[i].width)) ||\n        ((type === 't' || type === 'm' || type === 'b') &&\n        (curheight === Number.MIN_VALUE || curheight < bboxes[i].height))\n      ) {\n        minx = bboxes[i].x;\n        miny = bboxes[i].y;\n        maxx = bboxes[i].x + bboxes[i].width;\n        maxy = bboxes[i].y + bboxes[i].height;\n        curwidth = bboxes[i].width;\n        curheight = bboxes[i].height;\n      }\n      break;\n    default: // 'selected'\n      if (bboxes[i].x < minx) { minx = bboxes[i].x; }\n      if (bboxes[i].y < miny) { miny = bboxes[i].y; }\n      if (bboxes[i].x + bboxes[i].width > maxx) { maxx = bboxes[i].x + bboxes[i].width; }\n      if (bboxes[i].y + bboxes[i].height > maxy) { maxy = bboxes[i].y + bboxes[i].height; }\n      break;\n    }\n  } // loop for each element to find the bbox and adjust min/max\n\n  if (relativeTo === 'page') {\n    minx = 0;\n    miny = 0;\n    maxx = canvas.contentW;\n    maxy = canvas.contentH;\n  }\n\n  const dx = new Array(len);\n  const dy = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    if (selectedElements[i] == null) { break; }\n    // const elem = selectedElements[i];\n    const bbox = bboxes[i];\n    dx[i] = 0;\n    dy[i] = 0;\n    switch (type) {\n    case 'l': // left (horizontal)\n      dx[i] = minx - bbox.x;\n      break;\n    case 'c': // center (horizontal)\n      dx[i] = (minx + maxx) / 2 - (bbox.x + bbox.width / 2);\n      break;\n    case 'r': // right (horizontal)\n      dx[i] = maxx - (bbox.x + bbox.width);\n      break;\n    case 't': // top (vertical)\n      dy[i] = miny - bbox.y;\n      break;\n    case 'm': // middle (vertical)\n      dy[i] = (miny + maxy) / 2 - (bbox.y + bbox.height / 2);\n      break;\n    case 'b': // bottom (vertical)\n      dy[i] = maxy - (bbox.y + bbox.height);\n      break;\n    }\n  }\n  this.moveSelectedElements(dx, dy);\n};\n\n/**\n* Group: Additional editor tools\n*/\n\nthis.contentW = getResolution().w;\nthis.contentH = getResolution().h;\n\n/**\n* Updates the editor canvas width/height/position after a zoom has occurred\n* @param {Number} w - Float with the new width\n* @param {Number} h - Float with the new height\n* @returns Object with the following values:\n* - x - The canvas' new x coordinate\n* - y - The canvas' new y coordinate\n* - oldX - The canvas' old x coordinate\n* - oldY - The canvas' old y coordinate\n* - d_x - The x position difference\n* - d_y - The y position difference\n*/\nthis.updateCanvas = function (w, h) {\n  svgroot.setAttribute('width', w);\n  svgroot.setAttribute('height', h);\n  const bg = $('#canvasBackground')[0];\n  const oldX = svgcontent.getAttribute('x');\n  const oldY = svgcontent.getAttribute('y');\n  const x = (w / 2 - this.contentW * currentZoom / 2);\n  const y = (h / 2 - this.contentH * currentZoom / 2);\n\n  assignAttributes(svgcontent, {\n    width: this.contentW * currentZoom,\n    height: this.contentH * currentZoom,\n    x,\n    y,\n    viewBox: '0 0 ' + this.contentW + ' ' + this.contentH\n  });\n\n  assignAttributes(bg, {\n    width: svgcontent.getAttribute('width'),\n    height: svgcontent.getAttribute('height'),\n    x,\n    y\n  });\n\n  const bgImg = getElem('background_image');\n  if (bgImg) {\n    assignAttributes(bgImg, {\n      width: '100%',\n      height: '100%'\n    });\n  }\n\n  selectorManager.selectorParentGroup.setAttribute('transform', 'translate(' + x + ',' + y + ')');\n  runExtensions('canvasUpdated', {new_x: x, new_y: y, old_x: oldX, old_y: oldY, d_x: x - oldX, d_y: y - oldY});\n  return {x, y, old_x: oldX, old_y: oldY, d_x: x - oldX, d_y: y - oldY};\n};\n\n/**\n* Set the background of the editor (NOT the actual document)\n* @param {String} color - String with fill color to apply\n* @param url - URL or path to image to use\n*/\nthis.setBackground = function (color, url) {\n  const bg = getElem('canvasBackground');\n  const border = $(bg).find('rect')[0];\n  let bgImg = getElem('background_image');\n  border.setAttribute('fill', color);\n  if (url) {\n    if (!bgImg) {\n      bgImg = svgdoc.createElementNS(NS.SVG, 'image');\n      assignAttributes(bgImg, {\n        id: 'background_image',\n        width: '100%',\n        height: '100%',\n        preserveAspectRatio: 'xMinYMin',\n        style: 'pointer-events:none'\n      });\n    }\n    setHref(bgImg, url);\n    bg.append(bgImg);\n  } else if (bgImg) {\n    bgImg.remove();\n  }\n};\n\n/**\n* Select the next/previous element within the current layer\n* @param {Boolean} next - true = next and false = previous element\n*/\nthis.cycleElement = function (next) {\n  let num;\n  const curElem = selectedElements[0];\n  let elem = false;\n  const allElems = getVisibleElements(currentGroup || getCurrentDrawing().getCurrentLayer());\n  if (!allElems.length) { return; }\n  if (curElem == null) {\n    num = next ? allElems.length - 1 : 0;\n    elem = allElems[num];\n  } else {\n    let i = allElems.length;\n    while (i--) {\n      if (allElems[i] === curElem) {\n        num = next ? i - 1 : i + 1;\n        if (num >= allElems.length) {\n          num = 0;\n        } else if (num < 0) {\n          num = allElems.length - 1;\n        }\n        elem = allElems[num];\n        break;\n      }\n    }\n  }\n  selectOnly([elem], true);\n  call('selected', selectedElements);\n};\n\nthis.clear();\n\n/**\n* @deprecated getPrivateMethods\n* Since all methods are/should be public somehow, this function should be removed;\n*  we might require `import` in place of this in the future once ES6 Modules\n*  widespread\n\n* Being able to access private methods publicly seems wrong somehow,\n* but currently appears to be the best way to allow testing and provide\n* access to them to plugins.\n*/\nthis.getPrivateMethods = function () {\n  const obj = {\n    addCommandToHistory,\n    setGradient,\n    addSvgElementFromJson,\n    assignAttributes,\n    BatchCommand,\n    call,\n    ChangeElementCommand,\n    copyElem (elem) { return getCurrentDrawing().copyElem(elem); },\n    decode64,\n    encode64,\n    ffClone,\n    findDefs,\n    findDuplicateGradient,\n    getElem,\n    getId,\n    getIntersectionList,\n    getMouseTarget,\n    getNextId,\n    getPathBBox,\n    getTypeMap,\n    getUrlFromAttr,\n    hasMatrixTransform,\n    identifyLayers: draw.identifyLayers,\n    InsertElementCommand,\n    isChrome,\n    isIdentity,\n    isIE,\n    logMatrix,\n    matrixMultiply,\n    MoveElementCommand,\n    NS,\n    preventClickDefault,\n    recalculateAllSelectedDimensions,\n    recalculateDimensions,\n    remapElement,\n    RemoveElementCommand,\n    removeUnusedDefElems,\n    round,\n    runExtensions,\n    sanitizeSvg,\n    SVGEditTransformList,\n    text2xml,\n    toString,\n    transformBox,\n    transformListToTransform,\n    transformPoint,\n    walkTree\n  };\n  return obj;\n};\n  } // End constructor\n} // End class\n\nexport default SvgCanvas;\n","/**\n * jGraduate 0.4\n *\n * jQuery Plugin for a gradient picker\n *\n * Copyright (c) 2010 Jeff Schiller\n * http://blog.codedread.com/\n * Copyright (c) 2010 Alexis Deveria\n * http://a.deveria.com/\n *\n * Apache 2 License\n\njGraduate(options, okCallback, cancelCallback)\n\nwhere options is an object literal:\n  {\n    window: { title: 'Pick the start color and opacity for the gradient' },\n    images: { clientPath: 'images/' },\n    paint: a Paint object,\n    newstop: String of value \"same\", \"inverse\", \"black\" or \"white\"\n         OR object with one or both values {color: #Hex color, opac: number 0-1}\n  }\n\n- the Paint object is:\n  Paint {\n    type: String, // one of \"none\", \"solidColor\", \"linearGradient\", \"radialGradient\"\n    alpha: Number representing opacity (0-100),\n    solidColor: String representing #RRGGBB hex of color,\n    linearGradient: object of interface SVGLinearGradientElement,\n    radialGradient: object of interface SVGRadialGradientElement,\n  }\n\n$.jGraduate.Paint() -> constructs a 'none' color\n$.jGraduate.Paint({copy: o}) -> creates a copy of the paint o\n$.jGraduate.Paint({hex: '#rrggbb'}) -> creates a solid color paint with hex = \"#rrggbb\"\n$.jGraduate.Paint({linearGradient: o, a: 50}) -> creates a linear gradient paint with opacity=0.5\n$.jGraduate.Paint({radialGradient: o, a: 7}) -> creates a radial gradient paint with opacity=0.07\n$.jGraduate.Paint({hex: '#rrggbb', linearGradient: o}) -> throws an exception?\n\n- picker accepts the following object as input:\n  {\n    okCallback: function to call when Ok is pressed\n    cancelCallback: function to call when Cancel is pressed\n    paint: object describing the paint to display initially, if not set, then default to opaque white\n  }\n\n- okCallback receives a Paint object\n\n *\n*/\nconst ns = {\n  svg: 'http://www.w3.org/2000/svg',\n  xlink: 'http://www.w3.org/1999/xlink'\n};\n\nif (!window.console) {\n  window.console = {\n    log (str) {},\n    dir (str) {}\n  };\n}\n\nexport default function ($) {\n  if (!$.loadingStylesheets) {\n    $.loadingStylesheets = [];\n  }\n  const stylesheet = 'jgraduate/css/jgraduate.css';\n  if (!$.loadingStylesheets.includes(stylesheet)) {\n    $.loadingStylesheets.push(stylesheet);\n  }\n  $.jGraduate = {\n    Paint: function (opt) {\n      const options = opt || {};\n      this.alpha = isNaN(options.alpha) ? 100 : options.alpha;\n      // copy paint object\n      if (options.copy) {\n        this.type = options.copy.type;\n        this.alpha = options.copy.alpha;\n        this.solidColor = null;\n        this.linearGradient = null;\n        this.radialGradient = null;\n\n        switch (this.type) {\n        case 'none':\n          break;\n        case 'solidColor':\n          this.solidColor = options.copy.solidColor;\n          break;\n        case 'linearGradient':\n          this.linearGradient = options.copy.linearGradient.cloneNode(true);\n          break;\n        case 'radialGradient':\n          this.radialGradient = options.copy.radialGradient.cloneNode(true);\n          break;\n        }\n      // create linear gradient paint\n      } else if (options.linearGradient) {\n        this.type = 'linearGradient';\n        this.solidColor = null;\n        this.radialGradient = null;\n        this.linearGradient = options.linearGradient.cloneNode(true);\n      // create linear gradient paint\n      } else if (options.radialGradient) {\n        this.type = 'radialGradient';\n        this.solidColor = null;\n        this.linearGradient = null;\n        this.radialGradient = options.radialGradient.cloneNode(true);\n      // create solid color paint\n      } else if (options.solidColor) {\n        this.type = 'solidColor';\n        this.solidColor = options.solidColor;\n      // create empty paint\n      } else {\n        this.type = 'none';\n        this.solidColor = null;\n        this.linearGradient = null;\n        this.radialGradient = null;\n      }\n    }\n  };\n\n  $.fn.jGraduateDefaults = {\n    paint: new $.jGraduate.Paint(),\n    window: {\n      pickerTitle: 'Drag markers to pick a paint'\n    },\n    images: {\n      clientPath: 'images/'\n    },\n    newstop: 'inverse' // same, inverse, black, white\n  };\n\n  const isGecko = navigator.userAgent.includes('Gecko/');\n\n  function setAttrs (elem, attrs) {\n    if (isGecko) {\n      for (const aname in attrs) elem.setAttribute(aname, attrs[aname]);\n    } else {\n      for (const aname in attrs) {\n        const val = attrs[aname], prop = elem[aname];\n        if (prop && prop.constructor === 'SVGLength') {\n          prop.baseVal.value = val;\n        } else {\n          elem.setAttribute(aname, val);\n        }\n      }\n    }\n  }\n\n  function mkElem (name, attrs, newparent) {\n    const elem = document.createElementNS(ns.svg, name);\n    setAttrs(elem, attrs);\n    if (newparent) {\n      newparent.append(elem);\n    }\n    return elem;\n  }\n\n  $.fn.jGraduate = function (options) {\n    const $arguments = arguments;\n    return this.each(function () {\n      const $this = $(this),\n        $settings = $.extend(true, {}, $.fn.jGraduateDefaults, options),\n        id = $this.attr('id'),\n        idref = '#' + $this.attr('id') + ' ';\n\n      if (!idref) {\n        alert('Container element must have an id attribute to maintain unique id strings for sub-elements.');\n        return;\n      }\n\n      const okClicked = function () {\n        switch ($this.paint.type) {\n        case 'radialGradient':\n          $this.paint.linearGradient = null;\n          break;\n        case 'linearGradient':\n          $this.paint.radialGradient = null;\n          break;\n        case 'solidColor':\n          $this.paint.radialGradient = $this.paint.linearGradient = null;\n          break;\n        }\n        typeof $this.okCallback === 'function' && $this.okCallback($this.paint);\n        $this.hide();\n      };\n      const cancelClicked = function () {\n        typeof $this.cancelCallback === 'function' && $this.cancelCallback();\n        $this.hide();\n      };\n\n      $.extend(true, $this, { // public properties, methods, and callbacks\n        // make a copy of the incoming paint\n        paint: new $.jGraduate.Paint({copy: $settings.paint}),\n        okCallback: (typeof $arguments[1] === 'function' && $arguments[1]) || null,\n        cancelCallback: (typeof $arguments[2] === 'function' && $arguments[2]) || null\n      });\n\n      let // pos = $this.position(),\n        color = null;\n      const $win = $(window);\n\n      if ($this.paint.type === 'none') {\n        $this.paint = $.jGraduate.Paint({solidColor: 'ffffff'});\n      }\n\n      $this.addClass('jGraduate_Picker');\n      $this.html(\n        '<ul class=\"jGraduate_tabs\">' +\n          '<li class=\"jGraduate_tab_color jGraduate_tab_current\" data-type=\"col\">Solid Color</li>' +\n          '<li class=\"jGraduate_tab_lingrad\" data-type=\"lg\">Linear Gradient</li>' +\n          '<li class=\"jGraduate_tab_radgrad\" data-type=\"rg\">Radial Gradient</li>' +\n        '</ul>' +\n        '<div class=\"jGraduate_colPick\"></div>' +\n        '<div class=\"jGraduate_gradPick\"></div>' +\n        '<div class=\"jGraduate_LightBox\"></div>' +\n        '<div id=\"' + id + '_jGraduate_stopPicker\" class=\"jGraduate_stopPicker\"></div>'\n      );\n      const colPicker = $(idref + '> .jGraduate_colPick');\n      const gradPicker = $(idref + '> .jGraduate_gradPick');\n\n      gradPicker.html(\n        '<div id=\"' + id + '_jGraduate_Swatch\" class=\"jGraduate_Swatch\">' +\n          '<h2 class=\"jGraduate_Title\">' + $settings.window.pickerTitle + '</h2>' +\n          '<div id=\"' + id + '_jGraduate_GradContainer\" class=\"jGraduate_GradContainer\"></div>' +\n          '<div id=\"' + id + '_jGraduate_StopSlider\" class=\"jGraduate_StopSlider\"></div>' +\n        '</div>' +\n        '<div class=\"jGraduate_Form jGraduate_Points jGraduate_lg_field\">' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">Begin Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_x1\" size=\"3\" title=\"Enter starting x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_y1\" size=\"3\" title=\"Enter starting y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">End Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_x2\" size=\"3\" title=\"Enter ending x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_y2\" size=\"3\" title=\"Enter ending y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_Form jGraduate_Points jGraduate_rg_field\">' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">Center Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_cx\" size=\"3\" title=\"Enter x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_cy\" size=\"3\" title=\"Enter y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">Focal Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>Match center: <input type=\"checkbox\" checked=\"checked\" id=\"' + id + '_jGraduate_match_ctr\"/></label><br/>' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_fx\" size=\"3\" title=\"Enter x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_fy\" size=\"3\" title=\"Enter y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_StopSection jGraduate_SpreadMethod\">' +\n          '<label class=\"jGraduate_Form_Heading\">Spread method</label>' +\n          '<div class=\"jGraduate_Form_Section\">' +\n            '<select class=\"jGraduate_spreadMethod\">' +\n              '<option value=pad selected>Pad</option>' +\n              '<option value=reflect>Reflect</option>' +\n              '<option value=repeat>Repeat</option>' +\n            '</select>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_Form\">' +\n          '<div class=\"jGraduate_Slider jGraduate_RadiusField jGraduate_rg_field\">' +\n            '<label class=\"prelabel\">Radius:</label>' +\n            '<div id=\"' + id + '_jGraduate_Radius\" class=\"jGraduate_SliderBar jGraduate_Radius\" title=\"Click to set radius\">' +\n              '<img id=\"' + id + '_jGraduate_RadiusArrows\" class=\"jGraduate_RadiusArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_RadiusInput\" size=\"3\" value=\"100\"/>%</label>' +\n          '</div>' +\n          '<div class=\"jGraduate_Slider jGraduate_EllipField jGraduate_rg_field\">' +\n            '<label class=\"prelabel\">Ellip:</label>' +\n            '<div id=\"' + id + '_jGraduate_Ellip\" class=\"jGraduate_SliderBar jGraduate_Ellip\" title=\"Click to set Ellip\">' +\n              '<img id=\"' + id + '_jGraduate_EllipArrows\" class=\"jGraduate_EllipArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_EllipInput\" size=\"3\" value=\"0\"/>%</label>' +\n          '</div>' +\n          '<div class=\"jGraduate_Slider jGraduate_AngleField jGraduate_rg_field\">' +\n            '<label class=\"prelabel\">Angle:</label>' +\n            '<div id=\"' + id + '_jGraduate_Angle\" class=\"jGraduate_SliderBar jGraduate_Angle\" title=\"Click to set Angle\">' +\n              '<img id=\"' + id + '_jGraduate_AngleArrows\" class=\"jGraduate_AngleArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_AngleInput\" size=\"3\" value=\"0\"/>deg</label>' +\n          '</div>' +\n          '<div class=\"jGraduate_Slider jGraduate_OpacField\">' +\n            '<label class=\"prelabel\">Opac:</label>' +\n            '<div id=\"' + id + '_jGraduate_Opac\" class=\"jGraduate_SliderBar jGraduate_Opac\" title=\"Click to set Opac\">' +\n              '<img id=\"' + id + '_jGraduate_OpacArrows\" class=\"jGraduate_OpacArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_OpacInput\" size=\"3\" value=\"100\"/>%</label>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_OkCancel\">' +\n          '<input type=\"button\" id=\"' + id + '_jGraduate_Ok\" class=\"jGraduate_Ok\" value=\"OK\"/>' +\n          '<input type=\"button\" id=\"' + id + '_jGraduate_Cancel\" class=\"jGraduate_Cancel\" value=\"Cancel\"/>' +\n        '</div>');\n\n      // --------------\n      // Set up all the SVG elements (the gradient, stops and rectangle)\n      const MAX = 256,\n        MARGINX = 0,\n        MARGINY = 0,\n        // STOP_RADIUS = 15 / 2,\n        SIZEX = MAX - 2 * MARGINX,\n        SIZEY = MAX - 2 * MARGINY;\n\n      const attrInput = {};\n\n      const SLIDERW = 145;\n      $('.jGraduate_SliderBar').width(SLIDERW);\n\n      const container = $('#' + id + '_jGraduate_GradContainer')[0];\n\n      const svg = mkElem('svg', {\n        id: id + '_jgraduate_svg',\n        width: MAX,\n        height: MAX,\n        xmlns: ns.svg\n      }, container);\n\n      // This wasn't working as designed\n      // let curType;\n      // curType = curType || $this.paint.type;\n\n      // if we are sent a gradient, import it\n      let curType = $this.paint.type;\n\n      let grad = $this.paint[curType];\n      let curGradient = grad;\n\n      const gradalpha = $this.paint.alpha;\n\n      const isSolid = curType === 'solidColor';\n\n      // Make any missing gradients\n      switch (curType) {\n      case 'solidColor':\n        // fall through\n      case 'linearGradient':\n        if (!isSolid) {\n          curGradient.id = id + '_lg_jgraduate_grad';\n          grad = curGradient = svg.appendChild(curGradient); // .cloneNode(true));\n        }\n        mkElem('radialGradient', {\n          id: id + '_rg_jgraduate_grad'\n        }, svg);\n        if (curType === 'linearGradient') { break; }\n        // fall through\n      case 'radialGradient':\n        if (!isSolid) {\n          curGradient.id = id + '_rg_jgraduate_grad';\n          grad = curGradient = svg.appendChild(curGradient); // .cloneNode(true));\n        }\n        mkElem('linearGradient', {\n          id: id + '_lg_jgraduate_grad'\n        }, svg);\n      }\n\n      let stopGroup; // eslint-disable-line prefer-const\n      if (isSolid) {\n        grad = curGradient = $('#' + id + '_lg_jgraduate_grad')[0];\n        color = $this.paint[curType];\n        mkStop(0, '#' + color, 1);\n\n        const type = typeof $settings.newstop;\n\n        if (type === 'string') {\n          switch ($settings.newstop) {\n          case 'same':\n            mkStop(1, '#' + color, 1);\n            break;\n\n          case 'inverse':\n            // Invert current color for second stop\n            let inverted = '';\n            for (let i = 0; i < 6; i += 2) {\n              // const ch = color.substr(i, 2);\n              let inv = (255 - parseInt(color.substr(i, 2), 16)).toString(16);\n              if (inv.length < 2) inv = 0 + inv;\n              inverted += inv;\n            }\n            mkStop(1, '#' + inverted, 1);\n            break;\n\n          case 'white':\n            mkStop(1, '#ffffff', 1);\n            break;\n\n          case 'black':\n            mkStop(1, '#000000', 1);\n            break;\n          }\n        } else if (type === 'object') {\n          const opac = ('opac' in $settings.newstop) ? $settings.newstop.opac : 1;\n          mkStop(1, ($settings.newstop.color || '#' + color), opac);\n        }\n      }\n\n      const x1 = parseFloat(grad.getAttribute('x1') || 0.0),\n        y1 = parseFloat(grad.getAttribute('y1') || 0.0),\n        x2 = parseFloat(grad.getAttribute('x2') || 1.0),\n        y2 = parseFloat(grad.getAttribute('y2') || 0.0);\n\n      const cx = parseFloat(grad.getAttribute('cx') || 0.5),\n        cy = parseFloat(grad.getAttribute('cy') || 0.5),\n        fx = parseFloat(grad.getAttribute('fx') || cx),\n        fy = parseFloat(grad.getAttribute('fy') || cy);\n\n      const previewRect = mkElem('rect', {\n        id: id + '_jgraduate_rect',\n        x: MARGINX,\n        y: MARGINY,\n        width: SIZEX,\n        height: SIZEY,\n        fill: 'url(#' + id + '_jgraduate_grad)',\n        'fill-opacity': gradalpha / 100\n      }, svg);\n\n      // stop visuals created here\n      const beginCoord = $('<div/>').attr({\n        class: 'grad_coord jGraduate_lg_field',\n        title: 'Begin Stop'\n      }).text(1).css({\n        top: y1 * MAX,\n        left: x1 * MAX\n      }).data('coord', 'start').appendTo(container);\n\n      const endCoord = beginCoord.clone().text(2).css({\n        top: y2 * MAX,\n        left: x2 * MAX\n      }).attr('title', 'End stop').data('coord', 'end').appendTo(container);\n\n      const centerCoord = $('<div/>').attr({\n        class: 'grad_coord jGraduate_rg_field',\n        title: 'Center stop'\n      }).text('C').css({\n        top: cy * MAX,\n        left: cx * MAX\n      }).data('coord', 'center').appendTo(container);\n\n      const focusCoord = centerCoord.clone().text('F').css({\n        top: fy * MAX,\n        left: fx * MAX,\n        display: 'none'\n      }).attr('title', 'Focus point').data('coord', 'focus').appendTo(container);\n\n      focusCoord[0].id = id + '_jGraduate_focusCoord';\n\n      // const coords = $(idref + ' .grad_coord');\n\n      // $(container).hover(function () {\n      //   coords.animate({\n      //     opacity: 1\n      //   }, 500);\n      // }, function () {\n      //   coords.animate({\n      //     opacity: .2\n      //   }, 500);\n      // });\n\n      let showFocus;\n      $.each(['x1', 'y1', 'x2', 'y2', 'cx', 'cy', 'fx', 'fy'], function (i, attr) {\n        const isRadial = isNaN(attr[1]);\n\n        let attrval = curGradient.getAttribute(attr);\n        if (!attrval) {\n          // Set defaults\n          if (isRadial) {\n            // For radial points\n            attrval = '0.5';\n          } else {\n            // Only x2 is 1\n            attrval = attr === 'x2' ? '1.0' : '0.0';\n          }\n        }\n\n        attrInput[attr] = $('#' + id + '_jGraduate_' + attr)\n          .val(attrval)\n          .change(function () {\n            // TODO: Support values < 0 and > 1 (zoomable preview?)\n            if (isNaN(parseFloat(this.value)) || this.value < 0) {\n              this.value = 0.0;\n            } else if (this.value > 1) {\n              this.value = 1.0;\n            }\n\n            if (!(attr[0] === 'f' && !showFocus)) {\n              if ((isRadial && curType === 'radialGradient') || (!isRadial && curType === 'linearGradient')) {\n                curGradient.setAttribute(attr, this.value);\n              }\n            }\n\n            const $elem = isRadial\n              ? attr[0] === 'c' ? centerCoord : focusCoord\n              : attr[1] === '1' ? beginCoord : endCoord;\n\n            const cssName = attr.includes('x') ? 'left' : 'top';\n\n            $elem.css(cssName, this.value * MAX);\n          }).change();\n      });\n\n      function mkStop (n, color, opac, sel, stopElem) {\n        const stop = stopElem || mkElem('stop', {'stop-color': color, 'stop-opacity': opac, offset: n}, curGradient);\n        if (stopElem) {\n          color = stopElem.getAttribute('stop-color');\n          opac = stopElem.getAttribute('stop-opacity');\n          n = stopElem.getAttribute('offset');\n        } else {\n          curGradient.append(stop);\n        }\n        if (opac === null) opac = 1;\n\n        const pickerD = 'M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z';\n\n        const pathbg = mkElem('path', {\n          d: pickerD,\n          fill: 'url(#jGraduate_trans)',\n          transform: 'translate(' + (10 + n * MAX) + ', 26)'\n        }, stopGroup);\n\n        const path = mkElem('path', {\n          d: pickerD,\n          fill: color,\n          'fill-opacity': opac,\n          transform: 'translate(' + (10 + n * MAX) + ', 26)',\n          stroke: '#000',\n          'stroke-width': 1.5\n        }, stopGroup);\n\n        $(path).mousedown(function (e) {\n          selectStop(this);\n          drag = curStop;\n          $win.mousemove(dragColor).mouseup(remDrags);\n          stopOffset = stopMakerDiv.offset();\n          e.preventDefault();\n          return false;\n        }).data('stop', stop).data('bg', pathbg).dblclick(function () {\n          $('div.jGraduate_LightBox').show();\n          const colorhandle = this;\n          let stopOpacity = +stop.getAttribute('stop-opacity') || 1;\n          let stopColor = stop.getAttribute('stop-color') || 1;\n          let thisAlpha = (parseFloat(stopOpacity) * 255).toString(16);\n          while (thisAlpha.length < 2) { thisAlpha = '0' + thisAlpha; }\n          color = stopColor.substr(1) + thisAlpha;\n          $('#' + id + '_jGraduate_stopPicker').css({left: 100, bottom: 15}).jPicker({\n            window: { title: 'Pick the start color and opacity for the gradient' },\n            images: { clientPath: $settings.images.clientPath },\n            color: { active: color, alphaSupport: true }\n          }, function (color, arg2) {\n            stopColor = color.val('hex') ? ('#' + color.val('hex')) : 'none';\n            stopOpacity = color.val('a') !== null ? color.val('a') / 256 : 1;\n            colorhandle.setAttribute('fill', stopColor);\n            colorhandle.setAttribute('fill-opacity', stopOpacity);\n            stop.setAttribute('stop-color', stopColor);\n            stop.setAttribute('stop-opacity', stopOpacity);\n            $('div.jGraduate_LightBox').hide();\n            $('#' + id + '_jGraduate_stopPicker').hide();\n          }, null, function () {\n            $('div.jGraduate_LightBox').hide();\n            $('#' + id + '_jGraduate_stopPicker').hide();\n          });\n        });\n\n        $(curGradient).find('stop').each(function () {\n          const curS = $(this);\n          if (+this.getAttribute('offset') > n) {\n            if (!color) {\n              const newcolor = this.getAttribute('stop-color');\n              const newopac = this.getAttribute('stop-opacity');\n              stop.setAttribute('stop-color', newcolor);\n              path.setAttribute('fill', newcolor);\n              stop.setAttribute('stop-opacity', newopac === null ? 1 : newopac);\n              path.setAttribute('fill-opacity', newopac === null ? 1 : newopac);\n            }\n            curS.before(stop);\n            return false;\n          }\n        });\n        if (sel) selectStop(path);\n        return stop;\n      }\n\n      function remStop () {\n        delStop.setAttribute('display', 'none');\n        const path = $(curStop);\n        const stop = path.data('stop');\n        const bg = path.data('bg');\n        $([curStop, stop, bg]).remove();\n      }\n\n      const stopMakerDiv = $('#' + id + '_jGraduate_StopSlider');\n\n      let stops, curStop, drag;\n\n      const delStop = mkElem('path', {\n        d: 'm9.75,-6l-19.5,19.5m0,-19.5l19.5,19.5',\n        fill: 'none',\n        stroke: '#D00',\n        'stroke-width': 5,\n        display: 'none'\n      }, undefined); // stopMakerSVG);\n\n      function selectStop (item) {\n        if (curStop) curStop.setAttribute('stroke', '#000');\n        item.setAttribute('stroke', 'blue');\n        curStop = item;\n        curStop.parentNode.append(curStop);\n        //   stops = $('stop');\n        //   opac_select.val(curStop.attr('fill-opacity') || 1);\n        //   root.append(delStop);\n      }\n\n      let stopOffset;\n\n      function remDrags () {\n        $win.unbind('mousemove', dragColor);\n        if (delStop.getAttribute('display') !== 'none') {\n          remStop();\n        }\n        drag = null;\n      }\n\n      let scaleX = 1, scaleY = 1, angle = 0;\n\n      let cX = cx;\n      let cY = cy;\n      function xform () {\n        const rot = angle ? 'rotate(' + angle + ',' + cX + ',' + cY + ') ' : '';\n        if (scaleX === 1 && scaleY === 1) {\n          curGradient.removeAttribute('gradientTransform');\n          // $('#ang').addClass('dis');\n        } else {\n          const x = -cX * (scaleX - 1);\n          const y = -cY * (scaleY - 1);\n          curGradient.setAttribute('gradientTransform', rot + 'translate(' + x + ',' + y + ') scale(' + scaleX + ',' + scaleY + ')');\n          // $('#ang').removeClass('dis');\n        }\n      }\n\n      function dragColor (evt) {\n        let x = evt.pageX - stopOffset.left;\n        const y = evt.pageY - stopOffset.top;\n        x = x < 10\n          ? 10\n          : x > MAX + 10\n            ? MAX + 10\n            : x;\n\n        const xfStr = 'translate(' + x + ', 26)';\n        if (y < -60 || y > 130) {\n          delStop.setAttribute('display', 'block');\n          delStop.setAttribute('transform', xfStr);\n        } else {\n          delStop.setAttribute('display', 'none');\n        }\n\n        drag.setAttribute('transform', xfStr);\n        $.data(drag, 'bg').setAttribute('transform', xfStr);\n        const stop = $.data(drag, 'stop');\n        const sX = (x - 10) / MAX;\n\n        stop.setAttribute('offset', sX);\n\n        let last = 0;\n        $(curGradient).find('stop').each(function (i) {\n          const cur = this.getAttribute('offset');\n          const t = $(this);\n          if (cur < last) {\n            t.prev().before(t);\n            stops = $(curGradient).find('stop');\n          }\n          last = cur;\n        });\n      }\n\n      const stopMakerSVG = mkElem('svg', {\n        width: '100%',\n        height: 45\n      }, stopMakerDiv[0]);\n\n      const transPattern = mkElem('pattern', {\n        width: 16,\n        height: 16,\n        patternUnits: 'userSpaceOnUse',\n        id: 'jGraduate_trans'\n      }, stopMakerSVG);\n\n      const transImg = mkElem('image', {\n        width: 16,\n        height: 16\n      }, transPattern);\n\n      const bgImage = $settings.images.clientPath + 'map-opacity.png';\n\n      transImg.setAttributeNS(ns.xlink, 'xlink:href', bgImage);\n\n      $(stopMakerSVG).click(function (evt) {\n        stopOffset = stopMakerDiv.offset();\n        const {target} = evt;\n        if (target.tagName === 'path') return;\n        let x = evt.pageX - stopOffset.left - 8;\n        x = x < 10 ? 10 : x > MAX + 10 ? MAX + 10 : x;\n        mkStop(x / MAX, 0, 0, true);\n        evt.stopPropagation();\n      });\n\n      $(stopMakerSVG).mouseover(function () {\n        stopMakerSVG.append(delStop);\n      });\n\n      stopGroup = mkElem('g', {}, stopMakerSVG);\n\n      mkElem('line', {\n        x1: 10,\n        y1: 15,\n        x2: MAX + 10,\n        y2: 15,\n        'stroke-width': 2,\n        stroke: '#000'\n      }, stopMakerSVG);\n\n      const spreadMethodOpt = gradPicker.find('.jGraduate_spreadMethod').change(function () {\n        curGradient.setAttribute('spreadMethod', $(this).val());\n      });\n\n      // handle dragging the stop around the swatch\n      let draggingCoord = null;\n\n      const onCoordDrag = function (evt) {\n        let x = evt.pageX - offset.left;\n        let y = evt.pageY - offset.top;\n\n        // clamp stop to the swatch\n        x = x < 0 ? 0 : x > MAX ? MAX : x;\n        y = y < 0 ? 0 : y > MAX ? MAX : y;\n\n        draggingCoord.css('left', x).css('top', y);\n\n        // calculate stop offset\n        const fracx = x / SIZEX;\n        const fracy = y / SIZEY;\n\n        const type = draggingCoord.data('coord');\n        const grad = curGradient;\n\n        switch (type) {\n        case 'start':\n          attrInput.x1.val(fracx);\n          attrInput.y1.val(fracy);\n          grad.setAttribute('x1', fracx);\n          grad.setAttribute('y1', fracy);\n          break;\n        case 'end':\n          attrInput.x2.val(fracx);\n          attrInput.y2.val(fracy);\n          grad.setAttribute('x2', fracx);\n          grad.setAttribute('y2', fracy);\n          break;\n        case 'center':\n          attrInput.cx.val(fracx);\n          attrInput.cy.val(fracy);\n          grad.setAttribute('cx', fracx);\n          grad.setAttribute('cy', fracy);\n          cX = fracx;\n          cY = fracy;\n          xform();\n          break;\n        case 'focus':\n          attrInput.fx.val(fracx);\n          attrInput.fy.val(fracy);\n          grad.setAttribute('fx', fracx);\n          grad.setAttribute('fy', fracy);\n          xform();\n        }\n\n        evt.preventDefault();\n      };\n\n      const onCoordUp = function () {\n        draggingCoord = null;\n        $win.unbind('mousemove', onCoordDrag).unbind('mouseup', onCoordUp);\n      };\n\n      // Linear gradient\n      // (function () {\n\n      stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n\n      let numstops = stops.length;\n      // if there are not at least two stops, then\n      if (numstops < 2) {\n        while (numstops < 2) {\n          curGradient.append(document.createElementNS(ns.svg, 'stop'));\n          ++numstops;\n        }\n        stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n      }\n\n      for (let i = 0; i < numstops; i++) {\n        mkStop(0, 0, 0, 0, stops[i]);\n      }\n\n      spreadMethodOpt.val(curGradient.getAttribute('spreadMethod') || 'pad');\n\n      let offset;\n\n      // No match, so show focus point\n      showFocus = false;\n\n      previewRect.setAttribute('fill-opacity', gradalpha / 100);\n\n      $('#' + id + ' div.grad_coord').mousedown(function (evt) {\n        evt.preventDefault();\n        draggingCoord = $(this);\n        // const sPos = draggingCoord.offset();\n        offset = draggingCoord.parent().offset();\n        $win.mousemove(onCoordDrag).mouseup(onCoordUp);\n      });\n\n      // bind GUI elements\n      $('#' + id + '_jGraduate_Ok').bind('click', function () {\n        $this.paint.type = curType;\n        $this.paint[curType] = curGradient.cloneNode(true);\n        $this.paint.solidColor = null;\n        okClicked();\n      });\n      $('#' + id + '_jGraduate_Cancel').bind('click', function (paint) {\n        cancelClicked();\n      });\n\n      if (curType === 'radialGradient') {\n        if (showFocus) {\n          focusCoord.show();\n        } else {\n          focusCoord.hide();\n          attrInput.fx.val('');\n          attrInput.fy.val('');\n        }\n      }\n\n      $('#' + id + '_jGraduate_match_ctr')[0].checked = !showFocus;\n\n      let lastfx, lastfy;\n\n      $('#' + id + '_jGraduate_match_ctr').change(function () {\n        showFocus = !this.checked;\n        focusCoord.toggle(showFocus);\n        attrInput.fx.val('');\n        attrInput.fy.val('');\n        const grad = curGradient;\n        if (!showFocus) {\n          lastfx = grad.getAttribute('fx');\n          lastfy = grad.getAttribute('fy');\n          grad.removeAttribute('fx');\n          grad.removeAttribute('fy');\n        } else {\n          const fx = lastfx || 0.5;\n          const fy = lastfy || 0.5;\n          grad.setAttribute('fx', fx);\n          grad.setAttribute('fy', fy);\n          attrInput.fx.val(fx);\n          attrInput.fy.val(fy);\n        }\n      });\n\n      stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n      numstops = stops.length;\n      // if there are not at least two stops, then\n      if (numstops < 2) {\n        while (numstops < 2) {\n          curGradient.append(document.createElementNS(ns.svg, 'stop'));\n          ++numstops;\n        }\n        stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n      }\n\n      let slider;\n\n      const setSlider = function (e) {\n        const {offset} = slider;\n        const div = slider.parent;\n        let x = (e.pageX - offset.left - parseInt(div.css('border-left-width')));\n        if (x > SLIDERW) x = SLIDERW;\n        if (x <= 0) x = 0;\n        const posx = x - 5;\n        x /= SLIDERW;\n\n        switch (slider.type) {\n        case 'radius':\n          x = Math.pow(x * 2, 2.5);\n          if (x > 0.98 && x < 1.02) x = 1;\n          if (x <= 0.01) x = 0.01;\n          curGradient.setAttribute('r', x);\n          break;\n        case 'opacity':\n          $this.paint.alpha = parseInt(x * 100);\n          previewRect.setAttribute('fill-opacity', x);\n          break;\n        case 'ellip':\n          scaleX = 1;\n          scaleY = 1;\n          if (x < 0.5) {\n            x /= 0.5; // 0.001\n            scaleX = x <= 0 ? 0.01 : x;\n          } else if (x > 0.5) {\n            x /= 0.5; // 2\n            x = 2 - x;\n            scaleY = x <= 0 ? 0.01 : x;\n          }\n          xform();\n          x -= 1;\n          if (scaleY === x + 1) {\n            x = Math.abs(x);\n          }\n          break;\n        case 'angle':\n          x = x - 0.5;\n          angle = x *= 180;\n          xform();\n          x /= 100;\n          break;\n        }\n        slider.elem.css({'margin-left': posx});\n        x = Math.round(x * 100);\n        slider.input.val(x);\n      };\n\n      let ellipVal = 0, angleVal = 0;\n\n      if (curType === 'radialGradient') {\n        const tlist = curGradient.gradientTransform.baseVal;\n        if (tlist.numberOfItems === 2) {\n          const t = tlist.getItem(0);\n          const s = tlist.getItem(1);\n          if (t.type === 2 && s.type === 3) {\n            const m = s.matrix;\n            if (m.a !== 1) {\n              ellipVal = Math.round(-(1 - m.a) * 100);\n            } else if (m.d !== 1) {\n              ellipVal = Math.round((1 - m.d) * 100);\n            }\n          }\n        } else if (tlist.numberOfItems === 3) {\n          // Assume [R][T][S]\n          const r = tlist.getItem(0);\n          const t = tlist.getItem(1);\n          const s = tlist.getItem(2);\n\n          if (r.type === 4 &&\n            t.type === 2 &&\n            s.type === 3\n          ) {\n            angleVal = Math.round(r.angle);\n            const m = s.matrix;\n            if (m.a !== 1) {\n              ellipVal = Math.round(-(1 - m.a) * 100);\n            } else if (m.d !== 1) {\n              ellipVal = Math.round((1 - m.d) * 100);\n            }\n          }\n        }\n      }\n\n      const sliders = {\n        radius: {\n          handle: '#' + id + '_jGraduate_RadiusArrows',\n          input: '#' + id + '_jGraduate_RadiusInput',\n          val: (curGradient.getAttribute('r') || 0.5) * 100\n        },\n        opacity: {\n          handle: '#' + id + '_jGraduate_OpacArrows',\n          input: '#' + id + '_jGraduate_OpacInput',\n          val: $this.paint.alpha || 100\n        },\n        ellip: {\n          handle: '#' + id + '_jGraduate_EllipArrows',\n          input: '#' + id + '_jGraduate_EllipInput',\n          val: ellipVal\n        },\n        angle: {\n          handle: '#' + id + '_jGraduate_AngleArrows',\n          input: '#' + id + '_jGraduate_AngleInput',\n          val: angleVal\n        }\n      };\n\n      $.each(sliders, function (type, data) {\n        const handle = $(data.handle);\n        handle.mousedown(function (evt) {\n          const parent = handle.parent();\n          slider = {\n            type,\n            elem: handle,\n            input: $(data.input),\n            parent,\n            offset: parent.offset()\n          };\n          $win.mousemove(dragSlider).mouseup(stopSlider);\n          evt.preventDefault();\n        });\n\n        $(data.input).val(data.val).change(function () {\n          const isRad = curType === 'radialGradient';\n          let val = +this.value;\n          let xpos = 0;\n          switch (type) {\n          case 'radius':\n            if (isRad) curGradient.setAttribute('r', val / 100);\n            xpos = (Math.pow(val / 100, 1 / 2.5) / 2) * SLIDERW;\n            break;\n\n          case 'opacity':\n            $this.paint.alpha = val;\n            previewRect.setAttribute('fill-opacity', val / 100);\n            xpos = val * (SLIDERW / 100);\n            break;\n\n          case 'ellip':\n            scaleX = scaleY = 1;\n            if (val === 0) {\n              xpos = SLIDERW * 0.5;\n              break;\n            }\n            if (val > 99.5) val = 99.5;\n            if (val > 0) {\n              scaleY = 1 - (val / 100);\n            } else {\n              scaleX = -(val / 100) - 1;\n            }\n\n            xpos = SLIDERW * ((val + 100) / 2) / 100;\n            if (isRad) xform();\n            break;\n\n          case 'angle':\n            angle = val;\n            xpos = angle / 180;\n            xpos += 0.5;\n            xpos *= SLIDERW;\n            if (isRad) xform();\n          }\n          if (xpos > SLIDERW) {\n            xpos = SLIDERW;\n          } else if (xpos < 0) {\n            xpos = 0;\n          }\n          handle.css({'margin-left': xpos - 5});\n        }).change();\n      });\n\n      const dragSlider = function (evt) {\n        setSlider(evt);\n        evt.preventDefault();\n      };\n\n      const stopSlider = function (evt) {\n        $win.unbind('mousemove', dragSlider).unbind('mouseup', stopSlider);\n        slider = null;\n      };\n\n      // --------------\n      let thisAlpha = ($this.paint.alpha * 255 / 100).toString(16);\n      while (thisAlpha.length < 2) { thisAlpha = '0' + thisAlpha; }\n      thisAlpha = thisAlpha.split('.')[0];\n      color = $this.paint.solidColor === 'none' ? '' : $this.paint.solidColor + thisAlpha;\n\n      if (!isSolid) {\n        color = stops[0].getAttribute('stop-color');\n      }\n\n      // This should be done somewhere else, probably\n      $.extend($.fn.jPicker.defaults.window, {\n        alphaSupport: true, effects: {type: 'show', speed: 0}\n      });\n\n      colPicker.jPicker(\n        {\n          window: { title: $settings.window.pickerTitle },\n          images: { clientPath: $settings.images.clientPath },\n          color: { active: color, alphaSupport: true }\n        },\n        function (color) {\n          $this.paint.type = 'solidColor';\n          $this.paint.alpha = color.val('ahex') ? Math.round((color.val('a') / 255) * 100) : 100;\n          $this.paint.solidColor = color.val('hex') ? color.val('hex') : 'none';\n          $this.paint.radialGradient = null;\n          okClicked();\n        },\n        null,\n        function () { cancelClicked(); }\n      );\n\n      const tabs = $(idref + ' .jGraduate_tabs li');\n      tabs.click(function () {\n        tabs.removeClass('jGraduate_tab_current');\n        $(this).addClass('jGraduate_tab_current');\n        $(idref + ' > div').hide();\n        const type = $(this).attr('data-type');\n        /* const container = */ $(idref + ' .jGraduate_gradPick').show();\n        if (type === 'rg' || type === 'lg') {\n          // Show/hide appropriate fields\n          $('.jGraduate_' + type + '_field').show();\n          $('.jGraduate_' + (type === 'lg' ? 'rg' : 'lg') + '_field').hide();\n\n          $('#' + id + '_jgraduate_rect')[0].setAttribute('fill', 'url(#' + id + '_' + type + '_jgraduate_grad)');\n\n          // Copy stops\n\n          curType = type === 'lg' ? 'linearGradient' : 'radialGradient';\n\n          $('#' + id + '_jGraduate_OpacInput').val($this.paint.alpha).change();\n\n          const newGrad = $('#' + id + '_' + type + '_jgraduate_grad')[0];\n\n          if (curGradient !== newGrad) {\n            const curStops = $(curGradient).find('stop');\n            $(newGrad).empty().append(curStops);\n            curGradient = newGrad;\n            const sm = spreadMethodOpt.val();\n            curGradient.setAttribute('spreadMethod', sm);\n          }\n          showFocus = type === 'rg' && curGradient.getAttribute('fx') != null && !(cx === fx && cy === fy);\n          $('#' + id + '_jGraduate_focusCoord').toggle(showFocus);\n          if (showFocus) {\n            $('#' + id + '_jGraduate_match_ctr')[0].checked = false;\n          }\n        } else {\n          $(idref + ' .jGraduate_gradPick').hide();\n          $(idref + ' .jGraduate_colPick').show();\n        }\n      });\n      $(idref + ' > div').hide();\n      tabs.removeClass('jGraduate_tab_current');\n      let tab;\n      switch ($this.paint.type) {\n      case 'linearGradient':\n        tab = $(idref + ' .jGraduate_tab_lingrad');\n        break;\n      case 'radialGradient':\n        tab = $(idref + ' .jGraduate_tab_radgrad');\n        break;\n      default:\n        tab = $(idref + ' .jGraduate_tab_color');\n        break;\n      }\n      $this.show();\n\n      // jPicker will try to show after a 0ms timeout, so need to fire this after that\n      setTimeout(() => {\n        tab.addClass('jGraduate_tab_current').click();\n      }, 10);\n    });\n  };\n  return $;\n}\n","/*\n * jPicker (Adapted from version 1.1.6)\n *\n * jQuery Plugin for Photoshop style color picker\n *\n * Copyright (c) 2010 Christopher T. Tillman\n * Digital Magic Productions, Inc. (http://www.digitalmagicpro.com/)\n * MIT style license, FREE to use, alter, copy, sell, and especially ENHANCE\n *\n * Painstakingly ported from John Dyers' excellent work on his own color picker based on the Prototype framework.\n *\n * John Dyers' website: (http://johndyer.name)\n * Color Picker page:   (http://johndyer.name/post/2007/09/PhotoShop-like-JavaScript-Color-Picker.aspx)\n *\n */\n\nMath.precision = function (value, precision) {\n  if (precision === undefined) precision = 0;\n  return Math.round(value * Math.pow(10, precision)) / Math.pow(10, precision);\n};\n\nconst jPicker = function ($) {\n  if (!$.loadingStylesheets) {\n    $.loadingStylesheets = [];\n  }\n  const stylesheet = 'jgraduate/css/jPicker.css';\n  if (!$.loadingStylesheets.includes(stylesheet)) {\n    $.loadingStylesheets.push(stylesheet);\n  }\n  /**\n  * Encapsulate slider functionality for the ColorMap and ColorBar -\n  * could be useful to use a jQuery UI draggable for this with certain extensions\n  */\n  function Slider (bar, options) {\n    const $this = this;\n    function fireChangeEvents (context) {\n      for (let i = 0; i < changeEvents.length; i++) {\n        changeEvents[i].call($this, $this, context);\n      }\n    }\n    // bind the mousedown to the bar not the arrow for quick snapping to the clicked location\n    function mouseDown (e) {\n      const off = bar.offset();\n      offset = {l: off.left | 0, t: off.top | 0};\n      clearTimeout(timeout);\n      // using setTimeout for visual updates - once the style is updated the browser will re-render internally allowing the next Javascript to run\n      timeout = setTimeout(function () {\n        setValuesFromMousePosition.call($this, e);\n      }, 0);\n      // Bind mousemove and mouseup event to the document so it responds when dragged of of the bar - we will unbind these when on mouseup to save processing\n      $(document).bind('mousemove', mouseMove).bind('mouseup', mouseUp);\n      e.preventDefault(); // don't try to select anything or drag the image to the desktop\n    }\n    // set the values as the mouse moves\n    function mouseMove (e) {\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        setValuesFromMousePosition.call($this, e);\n      }, 0);\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    }\n    // unbind the document events - they aren't needed when not dragging\n    function mouseUp (e) {\n      $(document).unbind('mouseup', mouseUp).unbind('mousemove', mouseMove);\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    }\n    // calculate mouse position and set value within the current range\n    function setValuesFromMousePosition (e) {\n      const barW = bar.w, // local copies for YUI compressor\n        barH = bar.h;\n      let locX = e.pageX - offset.l,\n        locY = e.pageY - offset.t;\n      // keep the arrow within the bounds of the bar\n      if (locX < 0) locX = 0;\n      else if (locX > barW) locX = barW;\n      if (locY < 0) locY = 0;\n      else if (locY > barH) locY = barH;\n      val.call($this, 'xy', { x: ((locX / barW) * rangeX) + minX, y: ((locY / barH) * rangeY) + minY });\n    }\n    function draw () {\n      const\n        barW = bar.w,\n        barH = bar.h,\n        arrowW = arrow.w,\n        arrowH = arrow.h;\n      let arrowOffsetX = 0,\n        arrowOffsetY = 0;\n      setTimeout(function () {\n        if (rangeX > 0) { // range is greater than zero\n          // constrain to bounds\n          if (x === maxX) arrowOffsetX = barW;\n          else arrowOffsetX = ((x / rangeX) * barW) | 0;\n        }\n        if (rangeY > 0) { // range is greater than zero\n          // constrain to bounds\n          if (y === maxY) arrowOffsetY = barH;\n          else arrowOffsetY = ((y / rangeY) * barH) | 0;\n        }\n        // if arrow width is greater than bar width, center arrow and prevent horizontal dragging\n        if (arrowW >= barW) arrowOffsetX = (barW >> 1) - (arrowW >> 1); // number >> 1 - superfast bitwise divide by two and truncate (move bits over one bit discarding lowest)\n        else arrowOffsetX -= arrowW >> 1;\n        // if arrow height is greater than bar height, center arrow and prevent vertical dragging\n        if (arrowH >= barH) arrowOffsetY = (barH >> 1) - (arrowH >> 1);\n        else arrowOffsetY -= arrowH >> 1;\n        // set the arrow position based on these offsets\n        arrow.css({ left: arrowOffsetX + 'px', top: arrowOffsetY + 'px' });\n      }, 0);\n    }\n    function val (name, value, context) {\n      const set = value !== undefined;\n      if (!set) {\n        if (name === undefined || name == null) name = 'xy';\n        switch (name.toLowerCase()) {\n        case 'x': return x;\n        case 'y': return y;\n        case 'xy':\n        default: return { x, y };\n        }\n      }\n      if (context != null && context === $this) return;\n      let changed = false;\n\n      let newX, newY;\n      if (name == null) name = 'xy';\n      switch (name.toLowerCase()) {\n      case 'x':\n        newX = (value && ((value.x && value.x | 0) || value | 0)) || 0;\n        break;\n      case 'y':\n        newY = (value && ((value.y && value.y | 0) || value | 0)) || 0;\n        break;\n      case 'xy':\n      default:\n        newX = (value && value.x && value.x | 0) || 0;\n        newY = (value && value.y && value.y | 0) || 0;\n        break;\n      }\n      if (newX != null) {\n        if (newX < minX) newX = minX;\n        else if (newX > maxX) newX = maxX;\n        if (x !== newX) {\n          x = newX;\n          changed = true;\n        }\n      }\n      if (newY != null) {\n        if (newY < minY) newY = minY;\n        else if (newY > maxY) newY = maxY;\n        if (y !== newY) {\n          y = newY;\n          changed = true;\n        }\n      }\n      changed && fireChangeEvents.call($this, context || $this);\n    }\n    function range (name, value) {\n      const set = value !== undefined;\n      if (!set) {\n        if (name === undefined || name == null) name = 'all';\n        switch (name.toLowerCase()) {\n        case 'minx': return minX;\n        case 'maxx': return maxX;\n        case 'rangex': return { minX, maxX, rangeX };\n        case 'miny': return minY;\n        case 'maxy': return maxY;\n        case 'rangey': return { minY, maxY, rangeY };\n        case 'all':\n        default: return { minX, maxX, rangeX, minY, maxY, rangeY };\n        }\n      }\n      let // changed = false,\n        newMinX,\n        newMaxX,\n        newMinY,\n        newMaxY;\n      if (name == null) name = 'all';\n      switch (name.toLowerCase()) {\n      case 'minx':\n        newMinX = (value && ((value.minX && value.minX | 0) || value | 0)) || 0;\n        break;\n      case 'maxx':\n        newMaxX = (value && ((value.maxX && value.maxX | 0) || value | 0)) || 0;\n        break;\n      case 'rangex':\n        newMinX = (value && value.minX && value.minX | 0) || 0;\n        newMaxX = (value && value.maxX && value.maxX | 0) || 0;\n        break;\n      case 'miny':\n        newMinY = (value && ((value.minY && value.minY | 0) || value | 0)) || 0;\n        break;\n      case 'maxy':\n        newMaxY = (value && ((value.maxY && value.maxY | 0) || value | 0)) || 0;\n        break;\n      case 'rangey':\n        newMinY = (value && value.minY && value.minY | 0) || 0;\n        newMaxY = (value && value.maxY && value.maxY | 0) || 0;\n        break;\n      case 'all':\n      default:\n        newMinX = (value && value.minX && value.minX | 0) || 0;\n        newMaxX = (value && value.maxX && value.maxX | 0) || 0;\n        newMinY = (value && value.minY && value.minY | 0) || 0;\n        newMaxY = (value && value.maxY && value.maxY | 0) || 0;\n        break;\n      }\n      if (newMinX != null && minX !== newMinX) {\n        minX = newMinX;\n        rangeX = maxX - minX;\n      }\n      if (newMaxX != null && maxX !== newMaxX) {\n        maxX = newMaxX;\n        rangeX = maxX - minX;\n      }\n      if (newMinY != null && minY !== newMinY) {\n        minY = newMinY;\n        rangeY = maxY - minY;\n      }\n      if (newMaxY != null && maxY !== newMaxY) {\n        maxY = newMaxY;\n        rangeY = maxY - minY;\n      }\n    }\n    function bind (callback) {\n      if (typeof callback === 'function') changeEvents.push(callback);\n    }\n    function unbind (callback) {\n      if (typeof callback !== 'function') return;\n      let i;\n      while ((i = changeEvents.includes(callback))) changeEvents.splice(i, 1);\n    }\n    function destroy () {\n      // unbind all possible events and null objects\n      $(document).unbind('mouseup', mouseUp).unbind('mousemove', mouseMove);\n      bar.unbind('mousedown', mouseDown);\n      bar = null;\n      arrow = null;\n      changeEvents = null;\n    }\n    let offset,\n      timeout,\n      x = 0,\n      y = 0,\n      minX = 0,\n      maxX = 100,\n      rangeX = 100,\n      minY = 0,\n      maxY = 100,\n      rangeY = 100,\n      arrow = bar.find('img:first'), // the arrow image to drag\n      changeEvents = [];\n\n    $.extend(true, $this, // public properties, methods, and event bindings - these we need to access from other controls\n      {\n        val,\n        range,\n        bind,\n        unbind,\n        destroy\n      }\n    );\n    // initialize this control\n    arrow.src = options.arrow && options.arrow.image;\n    arrow.w = (options.arrow && options.arrow.width) || arrow.width();\n    arrow.h = (options.arrow && options.arrow.height) || arrow.height();\n    bar.w = (options.map && options.map.width) || bar.width();\n    bar.h = (options.map && options.map.height) || bar.height();\n    // bind mousedown event\n    bar.bind('mousedown', mouseDown);\n    bind.call($this, draw);\n  }\n  // controls for all the input elements for the typing in color values\n  function ColorValuePicker (picker, color, bindedHex, alphaPrecision) {\n    const $this = this; // private properties and methods\n    const inputs = picker.find('td.Text input');\n    // input box key down - use arrows to alter color\n    function keyDown (e) {\n      if (e.target.value === '' && e.target !== hex.get(0) && ((bindedHex != null && e.target !== bindedHex.get(0)) || bindedHex == null)) return;\n      if (!validateKey(e)) return e;\n      switch (e.target) {\n      case red.get(0):\n        switch (e.keyCode) {\n        case 38:\n          red.val(setValueInRange.call($this, (red.val() << 0) + 1, 0, 255));\n          color.val('r', red.val(), e.target);\n          return false;\n        case 40:\n          red.val(setValueInRange.call($this, (red.val() << 0) - 1, 0, 255));\n          color.val('r', red.val(), e.target);\n          return false;\n        }\n        break;\n      case green.get(0):\n        switch (e.keyCode) {\n        case 38:\n          green.val(setValueInRange.call($this, (green.val() << 0) + 1, 0, 255));\n          color.val('g', green.val(), e.target);\n          return false;\n        case 40:\n          green.val(setValueInRange.call($this, (green.val() << 0) - 1, 0, 255));\n          color.val('g', green.val(), e.target);\n          return false;\n        }\n        break;\n      case blue.get(0):\n        switch (e.keyCode) {\n        case 38:\n          blue.val(setValueInRange.call($this, (blue.val() << 0) + 1, 0, 255));\n          color.val('b', blue.val(), e.target);\n          return false;\n        case 40:\n          blue.val(setValueInRange.call($this, (blue.val() << 0) - 1, 0, 255));\n          color.val('b', blue.val(), e.target);\n          return false;\n        }\n        break;\n      case alpha && alpha.get(0):\n        switch (e.keyCode) {\n        case 38:\n          alpha.val(setValueInRange.call($this, parseFloat(alpha.val()) + 1, 0, 100));\n          color.val('a', Math.precision((alpha.val() * 255) / 100, alphaPrecision), e.target);\n          return false;\n        case 40:\n          alpha.val(setValueInRange.call($this, parseFloat(alpha.val()) - 1, 0, 100));\n          color.val('a', Math.precision((alpha.val() * 255) / 100, alphaPrecision), e.target);\n          return false;\n        }\n        break;\n      case hue.get(0):\n        switch (e.keyCode) {\n        case 38:\n          hue.val(setValueInRange.call($this, (hue.val() << 0) + 1, 0, 360));\n          color.val('h', hue.val(), e.target);\n          return false;\n        case 40:\n          hue.val(setValueInRange.call($this, (hue.val() << 0) - 1, 0, 360));\n          color.val('h', hue.val(), e.target);\n          return false;\n        }\n        break;\n      case saturation.get(0):\n        switch (e.keyCode) {\n        case 38:\n          saturation.val(setValueInRange.call($this, (saturation.val() << 0) + 1, 0, 100));\n          color.val('s', saturation.val(), e.target);\n          return false;\n        case 40:\n          saturation.val(setValueInRange.call($this, (saturation.val() << 0) - 1, 0, 100));\n          color.val('s', saturation.val(), e.target);\n          return false;\n        }\n        break;\n      case value.get(0):\n        switch (e.keyCode) {\n        case 38:\n          value.val(setValueInRange.call($this, (value.val() << 0) + 1, 0, 100));\n          color.val('v', value.val(), e.target);\n          return false;\n        case 40:\n          value.val(setValueInRange.call($this, (value.val() << 0) - 1, 0, 100));\n          color.val('v', value.val(), e.target);\n          return false;\n        }\n        break;\n      }\n    }\n    // input box key up - validate value and set color\n    function keyUp (e) {\n      if (e.target.value === '' && e.target !== hex.get(0) &&\n        ((bindedHex != null && e.target !== bindedHex.get(0)) ||\n        bindedHex == null)) return;\n      if (!validateKey(e)) return e;\n      switch (e.target) {\n      case red.get(0):\n        red.val(setValueInRange.call($this, red.val(), 0, 255));\n        color.val('r', red.val(), e.target);\n        break;\n      case green.get(0):\n        green.val(setValueInRange.call($this, green.val(), 0, 255));\n        color.val('g', green.val(), e.target);\n        break;\n      case blue.get(0):\n        blue.val(setValueInRange.call($this, blue.val(), 0, 255));\n        color.val('b', blue.val(), e.target);\n        break;\n      case alpha && alpha.get(0):\n        alpha.val(setValueInRange.call($this, alpha.val(), 0, 100));\n        color.val('a', Math.precision((alpha.val() * 255) / 100, alphaPrecision), e.target);\n        break;\n      case hue.get(0):\n        hue.val(setValueInRange.call($this, hue.val(), 0, 360));\n        color.val('h', hue.val(), e.target);\n        break;\n      case saturation.get(0):\n        saturation.val(setValueInRange.call($this, saturation.val(), 0, 100));\n        color.val('s', saturation.val(), e.target);\n        break;\n      case value.get(0):\n        value.val(setValueInRange.call($this, value.val(), 0, 100));\n        color.val('v', value.val(), e.target);\n        break;\n      case hex.get(0):\n        hex.val(hex.val().replace(/[^a-fA-F0-9]/g, '').toLowerCase().substring(0, 6));\n        bindedHex && bindedHex.val(hex.val());\n        color.val('hex', hex.val() !== '' ? hex.val() : null, e.target);\n        break;\n      case bindedHex && bindedHex.get(0):\n        bindedHex.val(bindedHex.val().replace(/[^a-fA-F0-9]/g, '').toLowerCase().substring(0, 6));\n        hex.val(bindedHex.val());\n        color.val('hex', bindedHex.val() !== '' ? bindedHex.val() : null, e.target);\n        break;\n      case ahex && ahex.get(0):\n        ahex.val(ahex.val().replace(/[^a-fA-F0-9]/g, '').toLowerCase().substring(0, 2));\n        color.val('a', ahex.val() != null ? parseInt(ahex.val(), 16) : null, e.target);\n        break;\n      }\n    }\n    // input box blur - reset to original if value empty\n    function blur (e) {\n      if (color.val() != null) {\n        switch (e.target) {\n        case red.get(0): red.val(color.val('r')); break;\n        case green.get(0): green.val(color.val('g')); break;\n        case blue.get(0): blue.val(color.val('b')); break;\n        case alpha && alpha.get(0): alpha.val(Math.precision((color.val('a') * 100) / 255, alphaPrecision)); break;\n        case hue.get(0): hue.val(color.val('h')); break;\n        case saturation.get(0): saturation.val(color.val('s')); break;\n        case value.get(0): value.val(color.val('v')); break;\n        case hex.get(0):\n        case bindedHex && bindedHex.get(0):\n          hex.val(color.val('hex'));\n          bindedHex && bindedHex.val(color.val('hex'));\n          break;\n        case ahex && ahex.get(0): ahex.val(color.val('ahex').substring(6)); break;\n        }\n      }\n    }\n    function validateKey (e) {\n      switch (e.keyCode) {\n      case 9:\n      case 16:\n      case 29:\n      case 37:\n      case 39:\n        return false;\n      case 'c'.charCodeAt():\n      case 'v'.charCodeAt():\n        if (e.ctrlKey) return false;\n      }\n      return true;\n    }\n    // constrain value within range\n    function setValueInRange (value, min, max) {\n      if (value === '' || isNaN(value)) return min;\n      if (value > max) return max;\n      if (value < min) return min;\n      return value;\n    }\n    function colorChanged (ui, context) {\n      const all = ui.val('all');\n      if (context !== red.get(0)) red.val(all != null ? all.r : '');\n      if (context !== green.get(0)) green.val(all != null ? all.g : '');\n      if (context !== blue.get(0)) blue.val(all != null ? all.b : '');\n      if (alpha && context !== alpha.get(0)) alpha.val(all != null ? Math.precision((all.a * 100) / 255, alphaPrecision) : '');\n      if (context !== hue.get(0)) hue.val(all != null ? all.h : '');\n      if (context !== saturation.get(0)) saturation.val(all != null ? all.s : '');\n      if (context !== value.get(0)) value.val(all != null ? all.v : '');\n      if (context !== hex.get(0) && ((bindedHex && context !== bindedHex.get(0)) || !bindedHex)) hex.val(all != null ? all.hex : '');\n      if (bindedHex && context !== bindedHex.get(0) && context !== hex.get(0)) bindedHex.val(all != null ? all.hex : '');\n      if (ahex && context !== ahex.get(0)) ahex.val(all != null ? all.ahex.substring(6) : '');\n    }\n    function destroy () {\n      // unbind all events and null objects\n      red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).add(hex).add(bindedHex).add(ahex).unbind('keyup', keyUp).unbind('blur', blur);\n      red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).unbind('keydown', keyDown);\n      color.unbind(colorChanged);\n      red = null;\n      green = null;\n      blue = null;\n      alpha = null;\n      hue = null;\n      saturation = null;\n      value = null;\n      hex = null;\n      ahex = null;\n    }\n    let\n      red = inputs.eq(3),\n      green = inputs.eq(4),\n      blue = inputs.eq(5),\n      alpha = inputs.length > 7 ? inputs.eq(6) : null,\n      hue = inputs.eq(0),\n      saturation = inputs.eq(1),\n      value = inputs.eq(2),\n      hex = inputs.eq(inputs.length > 7 ? 7 : 6),\n      ahex = inputs.length > 7 ? inputs.eq(8) : null;\n    $.extend(true, $this, {\n      // public properties and methods\n      destroy\n    });\n    red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).add(hex).add(bindedHex).add(ahex).bind('keyup', keyUp).bind('blur', blur);\n    red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).bind('keydown', keyDown);\n    color.bind(colorChanged);\n  }\n\n  $.jPicker = {\n    List: [], // array holding references to each active instance of the control\n    // color object - we will be able to assign by any color space type or retrieve any color space info\n    // we want this public so we can optionally assign new color objects to initial values using inputs other than a string hex value (also supported)\n    Color: class {\n      constructor (init) {\n        const $this = this;\n        function fireChangeEvents (context) {\n          for (let i = 0; i < changeEvents.length; i++) changeEvents[i].call($this, $this, context);\n        }\n        function val (name, value, context) {\n          // Kind of ugly\n          const set = Boolean(value);\n          if (set && value.ahex === '') value.ahex = '00000000';\n          if (!set) {\n            if (name === undefined || name == null || name === '') name = 'all';\n            if (r == null) return null;\n            switch (name.toLowerCase()) {\n            case 'ahex': return ColorMethods.rgbaToHex({ r, g, b, a });\n            case 'hex': return val('ahex').substring(0, 6);\n            case 'all': return { r, g, b, a, h, s, v, hex: val.call($this, 'hex'), ahex: val.call($this, 'ahex') };\n            default:\n              let ret = {};\n              for (let i = 0; i < name.length; i++) {\n                switch (name.charAt(i)) {\n                case 'r':\n                  if (name.length === 1) ret = r;\n                  else ret.r = r;\n                  break;\n                case 'g':\n                  if (name.length === 1) ret = g;\n                  else ret.g = g;\n                  break;\n                case 'b':\n                  if (name.length === 1) ret = b;\n                  else ret.b = b;\n                  break;\n                case 'a':\n                  if (name.length === 1) ret = a;\n                  else ret.a = a;\n                  break;\n                case 'h':\n                  if (name.length === 1) ret = h;\n                  else ret.h = h;\n                  break;\n                case 's':\n                  if (name.length === 1) ret = s;\n                  else ret.s = s;\n                  break;\n                case 'v':\n                  if (name.length === 1) ret = v;\n                  else ret.v = v;\n                  break;\n                }\n              }\n              return !name.length ? val.call($this, 'all') : ret;\n            }\n          }\n          if (context != null && context === $this) return;\n          if (name == null) name = '';\n\n          let changed = false;\n          if (value == null) {\n            if (r != null) {\n              r = null;\n              changed = true;\n            }\n            if (g != null) {\n              g = null;\n              changed = true;\n            }\n            if (b != null) {\n              b = null;\n              changed = true;\n            }\n            if (a != null) {\n              a = null;\n              changed = true;\n            }\n            if (h != null) {\n              h = null;\n              changed = true;\n            }\n            if (s != null) {\n              s = null;\n              changed = true;\n            }\n            if (v != null) {\n              v = null;\n              changed = true;\n            }\n            changed && fireChangeEvents.call($this, context || $this);\n            return;\n          }\n          switch (name.toLowerCase()) {\n          case 'ahex':\n          case 'hex':\n            const ret = ColorMethods.hexToRgba((value && (value.ahex || value.hex)) || value || 'none');\n            val.call($this, 'rgba', { r: ret.r, g: ret.g, b: ret.b, a: name === 'ahex' ? ret.a : a != null ? a : 255 }, context);\n            break;\n          default:\n            if (value && (value.ahex != null || value.hex != null)) {\n              val.call($this, 'ahex', value.ahex || value.hex || '00000000', context);\n              return;\n            }\n            const newV = {};\n            let rgb = false, hsv = false;\n            if (value.r !== undefined && !name.includes('r')) name += 'r';\n            if (value.g !== undefined && !name.includes('g')) name += 'g';\n            if (value.b !== undefined && !name.includes('b')) name += 'b';\n            if (value.a !== undefined && !name.includes('a')) name += 'a';\n            if (value.h !== undefined && !name.includes('h')) name += 'h';\n            if (value.s !== undefined && !name.includes('s')) name += 's';\n            if (value.v !== undefined && !name.includes('v')) name += 'v';\n            for (let i = 0; i < name.length; i++) {\n              switch (name.charAt(i)) {\n              case 'r':\n                if (hsv) continue;\n                rgb = true;\n                newV.r = (value && value.r && value.r | 0) || (value && value | 0) || 0;\n                if (newV.r < 0) newV.r = 0;\n                else if (newV.r > 255) newV.r = 255;\n                if (r !== newV.r) {\n                  ({r} = newV);\n                  changed = true;\n                }\n                break;\n              case 'g':\n                if (hsv) continue;\n                rgb = true;\n                newV.g = (value && value.g && value.g | 0) || (value && value | 0) || 0;\n                if (newV.g < 0) newV.g = 0;\n                else if (newV.g > 255) newV.g = 255;\n                if (g !== newV.g) {\n                  ({g} = newV);\n                  changed = true;\n                }\n                break;\n              case 'b':\n                if (hsv) continue;\n                rgb = true;\n                newV.b = (value && value.b && value.b | 0) || (value && value | 0) || 0;\n                if (newV.b < 0) newV.b = 0;\n                else if (newV.b > 255) newV.b = 255;\n                if (b !== newV.b) {\n                  ({b} = newV);\n                  changed = true;\n                }\n                break;\n              case 'a':\n                newV.a = value && value.a != null ? value.a | 0 : value != null ? value | 0 : 255;\n                if (newV.a < 0) newV.a = 0;\n                else if (newV.a > 255) newV.a = 255;\n                if (a !== newV.a) {\n                  ({a} = newV);\n                  changed = true;\n                }\n                break;\n              case 'h':\n                if (rgb) continue;\n                hsv = true;\n                newV.h = (value && value.h && value.h | 0) || (value && value | 0) || 0;\n                if (newV.h < 0) newV.h = 0;\n                else if (newV.h > 360) newV.h = 360;\n                if (h !== newV.h) {\n                  ({h} = newV);\n                  changed = true;\n                }\n                break;\n              case 's':\n                if (rgb) continue;\n                hsv = true;\n                newV.s = value && value.s != null ? value.s | 0 : value != null ? value | 0 : 100;\n                if (newV.s < 0) newV.s = 0;\n                else if (newV.s > 100) newV.s = 100;\n                if (s !== newV.s) {\n                  ({s} = newV);\n                  changed = true;\n                }\n                break;\n              case 'v':\n                if (rgb) continue;\n                hsv = true;\n                newV.v = value && value.v != null ? value.v | 0 : value != null ? value | 0 : 100;\n                if (newV.v < 0) newV.v = 0;\n                else if (newV.v > 100) newV.v = 100;\n                if (v !== newV.v) {\n                  ({v} = newV);\n                  changed = true;\n                }\n                break;\n              }\n            }\n            if (changed) {\n              if (rgb) {\n                r = r || 0;\n                g = g || 0;\n                b = b || 0;\n                const ret = ColorMethods.rgbToHsv({ r, g, b });\n                ({h, s, v} = ret);\n              } else if (hsv) {\n                h = h || 0;\n                s = s != null ? s : 100;\n                v = v != null ? v : 100;\n                const ret = ColorMethods.hsvToRgb({ h, s, v });\n                ({r, g, b} = ret);\n              }\n              a = a != null ? a : 255;\n              fireChangeEvents.call($this, context || $this);\n            }\n            break;\n          }\n        }\n        function bind (callback) {\n          if (typeof callback === 'function') changeEvents.push(callback);\n        }\n        function unbind (callback) {\n          if (typeof callback !== 'function') return;\n          let i;\n          while ((i = changeEvents.includes(callback))) {\n            changeEvents.splice(i, 1);\n          }\n        }\n        function destroy () {\n          changeEvents = null;\n        }\n        let r, g, b, a, h, s, v, changeEvents = [];\n\n        $.extend(true, $this, {\n          // public properties and methods\n          val,\n          bind,\n          unbind,\n          destroy\n        });\n        if (init) {\n          if (init.ahex != null) {\n            val('ahex', init);\n          } else if (init.hex != null) {\n            val(\n              (init.a != null ? 'a' : '') + 'hex',\n              init.a != null\n                ? {ahex: init.hex + ColorMethods.intToHex(init.a)}\n                : init\n            );\n          } else if (init.r != null && init.g != null && init.b != null) {\n            val('rgb' + (init.a != null ? 'a' : ''), init);\n          } else if (init.h != null && init.s != null && init.v != null) {\n            val('hsv' + (init.a != null ? 'a' : ''), init);\n          }\n        }\n      }\n    },\n    // color conversion methods  - make public to give use to external scripts\n    ColorMethods: {\n      hexToRgba (hex) {\n        if (hex === '' || hex === 'none') return { r: null, g: null, b: null, a: null };\n        hex = this.validateHex(hex);\n        let r = '00', g = '00', b = '00', a = '255';\n        if (hex.length === 6) hex += 'ff';\n        if (hex.length > 6) {\n          r = hex.substring(0, 2);\n          g = hex.substring(2, 4);\n          b = hex.substring(4, 6);\n          a = hex.substring(6, hex.length);\n        } else {\n          if (hex.length > 4) {\n            r = hex.substring(4, hex.length);\n            hex = hex.substring(0, 4);\n          }\n          if (hex.length > 2) {\n            g = hex.substring(2, hex.length);\n            hex = hex.substring(0, 2);\n          }\n          if (hex.length > 0) b = hex.substring(0, hex.length);\n        }\n        return { r: this.hexToInt(r), g: this.hexToInt(g), b: this.hexToInt(b), a: this.hexToInt(a) };\n      },\n      validateHex (hex) {\n        // if (typeof hex === 'object') return '';\n        hex = hex.toLowerCase().replace(/[^a-f0-9]/g, '');\n        if (hex.length > 8) hex = hex.substring(0, 8);\n        return hex;\n      },\n      rgbaToHex (rgba) {\n        return this.intToHex(rgba.r) + this.intToHex(rgba.g) + this.intToHex(rgba.b) + this.intToHex(rgba.a);\n      },\n      intToHex (dec) {\n        let result = (dec | 0).toString(16);\n        if (result.length === 1) result = ('0' + result);\n        return result.toLowerCase();\n      },\n      hexToInt (hex) {\n        return parseInt(hex, 16);\n      },\n      rgbToHsv (rgb) {\n        const r = rgb.r / 255, g = rgb.g / 255, b = rgb.b / 255, hsv = { h: 0, s: 0, v: 0 };\n        let min = 0, max = 0;\n        if (r >= g && r >= b) {\n          max = r;\n          min = g > b ? b : g;\n        } else if (g >= b && g >= r) {\n          max = g;\n          min = r > b ? b : r;\n        } else {\n          max = b;\n          min = g > r ? r : g;\n        }\n        hsv.v = max;\n        hsv.s = max ? (max - min) / max : 0;\n        let delta;\n        if (!hsv.s) hsv.h = 0;\n        else {\n          delta = max - min;\n          if (r === max) hsv.h = (g - b) / delta;\n          else if (g === max) hsv.h = 2 + (b - r) / delta;\n          else hsv.h = 4 + (r - g) / delta;\n          hsv.h = parseInt(hsv.h * 60);\n          if (hsv.h < 0) hsv.h += 360;\n        }\n        hsv.s = (hsv.s * 100) | 0;\n        hsv.v = (hsv.v * 100) | 0;\n        return hsv;\n      },\n      hsvToRgb (hsv) {\n        const rgb = {r: 0, g: 0, b: 0, a: 100};\n        let {h, s, v} = hsv;\n        if (s === 0) {\n          if (v === 0) rgb.r = rgb.g = rgb.b = 0;\n          else rgb.r = rgb.g = rgb.b = (v * 255 / 100) | 0;\n        } else {\n          if (h === 360) h = 0;\n          h /= 60;\n          s = s / 100;\n          v = v / 100;\n          const i = h | 0,\n            f = h - i,\n            p = v * (1 - s),\n            q = v * (1 - (s * f)),\n            t = v * (1 - (s * (1 - f)));\n          switch (i) {\n          case 0:\n            rgb.r = v;\n            rgb.g = t;\n            rgb.b = p;\n            break;\n          case 1:\n            rgb.r = q;\n            rgb.g = v;\n            rgb.b = p;\n            break;\n          case 2:\n            rgb.r = p;\n            rgb.g = v;\n            rgb.b = t;\n            break;\n          case 3:\n            rgb.r = p;\n            rgb.g = q;\n            rgb.b = v;\n            break;\n          case 4:\n            rgb.r = t;\n            rgb.g = p;\n            rgb.b = v;\n            break;\n          case 5:\n            rgb.r = v;\n            rgb.g = p;\n            rgb.b = q;\n            break;\n          }\n          rgb.r = (rgb.r * 255) | 0;\n          rgb.g = (rgb.g * 255) | 0;\n          rgb.b = (rgb.b * 255) | 0;\n        }\n        return rgb;\n      }\n    }\n  };\n  const {Color, List, ColorMethods} = $.jPicker; // local copies for YUI compressor\n  $.fn.jPicker = function (options) {\n    const $arguments = arguments;\n    return this.each(function () {\n      const $this = this, settings = $.extend(true, {}, $.fn.jPicker.defaults, options); // local copies for YUI compressor\n      if ($($this).get(0).nodeName.toLowerCase() === 'input') { // Add color picker icon if binding to an input element and bind the events to the input\n        $.extend(true, settings, {\n          window: {\n            bindToInput: true,\n            expandable: true,\n            input: $($this)\n          }\n        });\n        if ($($this).val() === '') {\n          settings.color.active = new Color({ hex: null });\n          settings.color.current = new Color({ hex: null });\n        } else if (ColorMethods.validateHex($($this).val())) {\n          settings.color.active = new Color({ hex: $($this).val(), a: settings.color.active.val('a') });\n          settings.color.current = new Color({ hex: $($this).val(), a: settings.color.active.val('a') });\n        }\n      }\n      if (settings.window.expandable) {\n        $($this).after('<span class=\"jPicker\"><span class=\"Icon\"><span class=\"Color\">&nbsp;</span><span class=\"Alpha\">&nbsp;</span><span class=\"Image\" title=\"Click To Open Color Picker\">&nbsp;</span><span class=\"Container\">&nbsp;</span></span></span>');\n      } else {\n        settings.window.liveUpdate = false; // Basic control binding for inline use - You will need to override the liveCallback or commitCallback function to retrieve results\n      }\n      const isLessThanIE7 = parseFloat(navigator.appVersion.split('MSIE')[1]) < 7 && document.body.filters; // needed to run the AlphaImageLoader function for IE6\n      // set color mode and update visuals for the new color mode\n      function setColorMode (colorMode) {\n        const {active} = color, // local copies for YUI compressor\n          // {clientPath} = images,\n          hex = active.val('hex');\n        let rgbMap, rgbBar;\n        settings.color.mode = colorMode;\n        switch (colorMode) {\n        case 'h':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setImgLoc.call($this, colorMapL1, 0);\n            setAlpha.call($this, colorMapL1, 100);\n            setImgLoc.call($this, colorMapL2, 260);\n            setAlpha.call($this, colorMapL2, 100);\n            setBG.call($this, colorBarDiv, 'transparent');\n            setImgLoc.call($this, colorBarL1, 0);\n            setAlpha.call($this, colorBarL1, 100);\n            setImgLoc.call($this, colorBarL2, 260);\n            setAlpha.call($this, colorBarL2, 100);\n            setImgLoc.call($this, colorBarL3, 260);\n            setAlpha.call($this, colorBarL3, 100);\n            setImgLoc.call($this, colorBarL4, 260);\n            setAlpha.call($this, colorBarL4, 100);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 100, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 360 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('s'), y: 100 - active.val('v') }, colorMap);\n          colorBar.val('y', 360 - active.val('h'), colorBar);\n          break;\n        case 's':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setImgLoc.call($this, colorMapL1, -260);\n            setImgLoc.call($this, colorMapL2, -520);\n            setImgLoc.call($this, colorBarL1, -260);\n            setImgLoc.call($this, colorBarL2, -520);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 360, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 100 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('h'), y: 100 - active.val('v') }, colorMap);\n          colorBar.val('y', 100 - active.val('s'), colorBar);\n          break;\n        case 'v':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, '000000');\n            setImgLoc.call($this, colorMapL1, -780);\n            setImgLoc.call($this, colorMapL2, 260);\n            setBG.call($this, colorBarDiv, hex);\n            setImgLoc.call($this, colorBarL1, -520);\n            setImgLoc.call($this, colorBarL2, 260);\n            setAlpha.call($this, colorBarL2, 100);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 360, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 100 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('h'), y: 100 - active.val('s') }, colorMap);\n          colorBar.val('y', 100 - active.val('v'), colorBar);\n          break;\n        case 'r':\n          rgbMap = -1040;\n          rgbBar = -780;\n          colorMap.range('all', { minX: 0, maxX: 255, minY: 0, maxY: 255 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('b'), y: 255 - active.val('g') }, colorMap);\n          colorBar.val('y', 255 - active.val('r'), colorBar);\n          break;\n        case 'g':\n          rgbMap = -1560;\n          rgbBar = -1820;\n          colorMap.range('all', { minX: 0, maxX: 255, minY: 0, maxY: 255 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('b'), y: 255 - active.val('r') }, colorMap);\n          colorBar.val('y', 255 - active.val('g'), colorBar);\n          break;\n        case 'b':\n          rgbMap = -2080;\n          rgbBar = -2860;\n          colorMap.range('all', { minX: 0, maxX: 255, minY: 0, maxY: 255 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('r'), y: 255 - active.val('g') }, colorMap);\n          colorBar.val('y', 255 - active.val('b'), colorBar);\n          break;\n        case 'a':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setImgLoc.call($this, colorMapL1, -260);\n            setImgLoc.call($this, colorMapL2, -520);\n            setImgLoc.call($this, colorBarL1, 260);\n            setImgLoc.call($this, colorBarL2, 260);\n            setAlpha.call($this, colorBarL2, 100);\n            setImgLoc.call($this, colorBarL6, 0);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 360, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('h'), y: 100 - active.val('v') }, colorMap);\n          colorBar.val('y', 255 - active.val('a'), colorBar);\n          break;\n        default:\n          throw new Error('Invalid Mode');\n        }\n        switch (colorMode) {\n        case 'h':\n          break;\n        case 's':\n        case 'v':\n        case 'a':\n          setTimeout(function () {\n            setAlpha.call($this, colorMapL1, 100);\n            setAlpha.call($this, colorBarL1, 100);\n            setImgLoc.call($this, colorBarL3, 260);\n            setAlpha.call($this, colorBarL3, 100);\n            setImgLoc.call($this, colorBarL4, 260);\n            setAlpha.call($this, colorBarL4, 100);\n          }, 0);\n          break;\n        case 'r':\n        case 'g':\n        case 'b':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setBG.call($this, colorBarDiv, 'transparent');\n            setAlpha.call($this, colorBarL1, 100);\n            setAlpha.call($this, colorMapL1, 100);\n            setImgLoc.call($this, colorMapL1, rgbMap);\n            setImgLoc.call($this, colorMapL2, rgbMap - 260);\n            setImgLoc.call($this, colorBarL1, rgbBar - 780);\n            setImgLoc.call($this, colorBarL2, rgbBar - 520);\n            setImgLoc.call($this, colorBarL3, rgbBar);\n            setImgLoc.call($this, colorBarL4, rgbBar - 260);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          break;\n        }\n        if (active.val('ahex') == null) return;\n        activeColorChanged.call($this, active);\n      }\n      // Update color when user changes text values\n      function activeColorChanged (ui, context) {\n        if (context == null || (context !== colorBar && context !== colorMap)) positionMapAndBarArrows.call($this, ui, context);\n        setTimeout(function () {\n          updatePreview.call($this, ui);\n          updateMapVisuals.call($this, ui);\n          updateBarVisuals.call($this, ui);\n        }, 0);\n      }\n      // user has dragged the ColorMap pointer\n      function mapValueChanged (ui, context) {\n        const {active} = color;\n        if (context !== colorMap && active.val() == null) return;\n        const xy = ui.val('all');\n        switch (settings.color.mode) {\n        case 'h':\n          active.val('sv', { s: xy.x, v: 100 - xy.y }, context);\n          break;\n        case 's':\n        case 'a':\n          active.val('hv', { h: xy.x, v: 100 - xy.y }, context);\n          break;\n        case 'v':\n          active.val('hs', { h: xy.x, s: 100 - xy.y }, context);\n          break;\n        case 'r':\n          active.val('gb', { g: 255 - xy.y, b: xy.x }, context);\n          break;\n        case 'g':\n          active.val('rb', { r: 255 - xy.y, b: xy.x }, context);\n          break;\n        case 'b':\n          active.val('rg', { r: xy.x, g: 255 - xy.y }, context);\n          break;\n        }\n      }\n      // user has dragged the ColorBar slider\n      function colorBarValueChanged (ui, context) {\n        const {active} = color;\n        if (context !== colorBar && active.val() == null) return;\n        switch (settings.color.mode) {\n        case 'h':\n          active.val('h', { h: 360 - ui.val('y') }, context);\n          break;\n        case 's':\n          active.val('s', { s: 100 - ui.val('y') }, context);\n          break;\n        case 'v':\n          active.val('v', { v: 100 - ui.val('y') }, context);\n          break;\n        case 'r':\n          active.val('r', { r: 255 - ui.val('y') }, context);\n          break;\n        case 'g':\n          active.val('g', { g: 255 - ui.val('y') }, context);\n          break;\n        case 'b':\n          active.val('b', { b: 255 - ui.val('y') }, context);\n          break;\n        case 'a':\n          active.val('a', 255 - ui.val('y'), context);\n          break;\n        }\n      }\n      // position map and bar arrows to match current color\n      function positionMapAndBarArrows (ui, context) {\n        if (context !== colorMap) {\n          switch (settings.color.mode) {\n          case 'h':\n            const sv = ui.val('sv');\n            colorMap.val('xy', { x: sv != null ? sv.s : 100, y: 100 - (sv != null ? sv.v : 100) }, context);\n            break;\n          case 's':\n          case 'a':\n            const hv = ui.val('hv');\n            colorMap.val('xy', { x: (hv && hv.h) || 0, y: 100 - (hv != null ? hv.v : 100) }, context);\n            break;\n          case 'v':\n            const hs = ui.val('hs');\n            colorMap.val('xy', { x: (hs && hs.h) || 0, y: 100 - (hs != null ? hs.s : 100) }, context);\n            break;\n          case 'r':\n            const bg = ui.val('bg');\n            colorMap.val('xy', { x: (bg && bg.b) || 0, y: 255 - ((bg && bg.g) || 0) }, context);\n            break;\n          case 'g':\n            const br = ui.val('br');\n            colorMap.val('xy', { x: (br && br.b) || 0, y: 255 - ((br && br.r) || 0) }, context);\n            break;\n          case 'b':\n            const rg = ui.val('rg');\n            colorMap.val('xy', { x: (rg && rg.r) || 0, y: 255 - ((rg && rg.g) || 0) }, context);\n            break;\n          }\n        }\n        if (context !== colorBar) {\n          switch (settings.color.mode) {\n          case 'h':\n            colorBar.val('y', 360 - (ui.val('h') || 0), context);\n            break;\n          case 's':\n            const s = ui.val('s');\n            colorBar.val('y', 100 - (s != null ? s : 100), context);\n            break;\n          case 'v':\n            const v = ui.val('v');\n            colorBar.val('y', 100 - (v != null ? v : 100), context);\n            break;\n          case 'r':\n            colorBar.val('y', 255 - (ui.val('r') || 0), context);\n            break;\n          case 'g':\n            colorBar.val('y', 255 - (ui.val('g') || 0), context);\n            break;\n          case 'b':\n            colorBar.val('y', 255 - (ui.val('b') || 0), context);\n            break;\n          case 'a':\n            const a = ui.val('a');\n            colorBar.val('y', 255 - (a != null ? a : 255), context);\n            break;\n          }\n        }\n      }\n      function updatePreview (ui) {\n        try {\n          const all = ui.val('all');\n          activePreview.css({ backgroundColor: (all && '#' + all.hex) || 'transparent' });\n          setAlpha.call($this, activePreview, (all && Math.precision((all.a * 100) / 255, 4)) || 0);\n        } catch (e) { }\n      }\n      function updateMapVisuals (ui) {\n        switch (settings.color.mode) {\n        case 'h':\n          setBG.call($this, colorMapDiv, new Color({ h: ui.val('h') || 0, s: 100, v: 100 }).val('hex'));\n          break;\n        case 's':\n        case 'a':\n          const s = ui.val('s');\n          setAlpha.call($this, colorMapL2, 100 - (s != null ? s : 100));\n          break;\n        case 'v':\n          const v = ui.val('v');\n          setAlpha.call($this, colorMapL1, v != null ? v : 100);\n          break;\n        case 'r':\n          setAlpha.call($this, colorMapL2, Math.precision((ui.val('r') || 0) / 255 * 100, 4));\n          break;\n        case 'g':\n          setAlpha.call($this, colorMapL2, Math.precision((ui.val('g') || 0) / 255 * 100, 4));\n          break;\n        case 'b':\n          setAlpha.call($this, colorMapL2, Math.precision((ui.val('b') || 0) / 255 * 100));\n          break;\n        }\n        const a = ui.val('a');\n        setAlpha.call($this, colorMapL3, Math.precision(((255 - (a || 0)) * 100) / 255, 4));\n      }\n      function updateBarVisuals (ui) {\n        switch (settings.color.mode) {\n        case 'h':\n          const a = ui.val('a');\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - (a || 0)) * 100) / 255, 4));\n          break;\n        case 's':\n          const hva = ui.val('hva'),\n            saturatedColor = new Color({ h: (hva && hva.h) || 0, s: 100, v: hva != null ? hva.v : 100 });\n          setBG.call($this, colorBarDiv, saturatedColor.val('hex'));\n          setAlpha.call($this, colorBarL2, 100 - (hva != null ? hva.v : 100));\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - ((hva && hva.a) || 0)) * 100) / 255, 4));\n          break;\n        case 'v':\n          const hsa = ui.val('hsa'),\n            valueColor = new Color({ h: (hsa && hsa.h) || 0, s: hsa != null ? hsa.s : 100, v: 100 });\n          setBG.call($this, colorBarDiv, valueColor.val('hex'));\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - ((hsa && hsa.a) || 0)) * 100) / 255, 4));\n          break;\n        case 'r':\n        case 'g':\n        case 'b':\n          const rgba = ui.val('rgba');\n          let hValue = 0, vValue = 0;\n          if (settings.color.mode === 'r') {\n            hValue = (rgba && rgba.b) || 0;\n            vValue = (rgba && rgba.g) || 0;\n          } else if (settings.color.mode === 'g') {\n            hValue = (rgba && rgba.b) || 0;\n            vValue = (rgba && rgba.r) || 0;\n          } else if (settings.color.mode === 'b') {\n            hValue = (rgba && rgba.r) || 0;\n            vValue = (rgba && rgba.g) || 0;\n          }\n          const middle = vValue > hValue ? hValue : vValue;\n          setAlpha.call($this, colorBarL2, hValue > vValue ? Math.precision(((hValue - vValue) / (255 - vValue)) * 100, 4) : 0);\n          setAlpha.call($this, colorBarL3, vValue > hValue ? Math.precision(((vValue - hValue) / (255 - hValue)) * 100, 4) : 0);\n          setAlpha.call($this, colorBarL4, Math.precision((middle / 255) * 100, 4));\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - ((rgba && rgba.a) || 0)) * 100) / 255, 4));\n          break;\n        case 'a': {\n          const a = ui.val('a');\n          setBG.call($this, colorBarDiv, ui.val('hex') || '000000');\n          setAlpha.call($this, colorBarL5, a != null ? 0 : 100);\n          setAlpha.call($this, colorBarL6, a != null ? 100 : 0);\n          break;\n        }\n        }\n      }\n      function setBG (el, c) {\n        el.css({backgroundColor: (c && c.length === 6 && '#' + c) || 'transparent'});\n      }\n      function setImg (img, src) {\n        if (isLessThanIE7 && (src.includes('AlphaBar.png') || src.includes('Bars.png') || src.includes('Maps.png'))) {\n          img.attr('pngSrc', src);\n          img.css({ backgroundImage: 'none', filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\\'' + src + '\\', sizingMethod=\\'scale\\')' });\n        } else img.css({ backgroundImage: 'url(\\'' + src + '\\')' });\n      }\n      function setImgLoc (img, y) {\n        img.css({ top: y + 'px' });\n      }\n      function setAlpha (obj, alpha) {\n        obj.css({ visibility: alpha > 0 ? 'visible' : 'hidden' });\n        if (alpha > 0 && alpha < 100) {\n          if (isLessThanIE7) {\n            const src = obj.attr('pngSrc');\n            if (src != null && (\n              src.includes('AlphaBar.png') || src.includes('Bars.png') || src.includes('Maps.png')\n            )) {\n              obj.css({ filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\\'' + src + '\\', sizingMethod=\\'scale\\') progid:DXImageTransform.Microsoft.Alpha(opacity=' + alpha + ')' });\n            } else obj.css({ opacity: Math.precision(alpha / 100, 4) });\n          } else obj.css({ opacity: Math.precision(alpha / 100, 4) });\n        } else if (alpha === 0 || alpha === 100) {\n          if (isLessThanIE7) {\n            const src = obj.attr('pngSrc');\n            if (src != null && (\n              src.includes('AlphaBar.png') || src.includes('Bars.png') || src.includes('Maps.png')\n            )) {\n              obj.css({ filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\\'' + src + '\\', sizingMethod=\\'scale\\')' });\n            } else obj.css({ opacity: '' });\n          } else obj.css({ opacity: '' });\n        }\n      }\n      // revert color to original color when opened\n      function revertColor () {\n        color.active.val('ahex', color.current.val('ahex'));\n      }\n      // commit the color changes\n      function commitColor () {\n        color.current.val('ahex', color.active.val('ahex'));\n      }\n      function radioClicked (e) {\n        $(this).parents('tbody:first').find('input:radio[value!=\"' + e.target.value + '\"]').removeAttr('checked');\n        setColorMode.call($this, e.target.value);\n      }\n      function currentClicked () {\n        revertColor.call($this);\n      }\n      function cancelClicked () {\n        revertColor.call($this);\n        settings.window.expandable && hide.call($this);\n        typeof cancelCallback === 'function' && cancelCallback.call($this, color.active, cancelButton);\n      }\n      function okClicked () {\n        commitColor.call($this);\n        settings.window.expandable && hide.call($this);\n        typeof commitCallback === 'function' && commitCallback.call($this, color.active, okButton);\n      }\n      function iconImageClicked () {\n        show.call($this);\n      }\n      function currentColorChanged (ui, context) {\n        const hex = ui.val('hex');\n        currentPreview.css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n        setAlpha.call($this, currentPreview, Math.precision(((ui.val('a') || 0) * 100) / 255, 4));\n      }\n      function expandableColorChanged (ui, context) {\n        const hex = ui.val('hex');\n        const va = ui.val('va');\n        iconColor.css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n        setAlpha.call($this, iconAlpha, Math.precision(((255 - ((va && va.a) || 0)) * 100) / 255, 4));\n        if (settings.window.bindToInput && settings.window.updateInputColor) {\n          settings.window.input.css({\n            backgroundColor: (hex && '#' + hex) || 'transparent',\n            color: va == null || va.v > 75 ? '#000000' : '#ffffff'\n          });\n        }\n      }\n      function moveBarMouseDown (e) {\n        // const {element} = settings.window, // local copies for YUI compressor\n        //     {page} = settings.window;\n        elementStartX = parseInt(container.css('left'));\n        elementStartY = parseInt(container.css('top'));\n        pageStartX = e.pageX;\n        pageStartY = e.pageY;\n        // bind events to document to move window - we will unbind these on mouseup\n        $(document).bind('mousemove', documentMouseMove).bind('mouseup', documentMouseUp);\n        e.preventDefault(); // prevent attempted dragging of the column\n      }\n      function documentMouseMove (e) {\n        container.css({ left: elementStartX - (pageStartX - e.pageX) + 'px', top: elementStartY - (pageStartY - e.pageY) + 'px' });\n        if (settings.window.expandable && !$.support.boxModel) container.prev().css({ left: container.css('left'), top: container.css('top') });\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n      }\n      function documentMouseUp (e) {\n        $(document).unbind('mousemove', documentMouseMove).unbind('mouseup', documentMouseUp);\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n      }\n      function quickPickClicked (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        color.active.val('ahex', $(this).attr('title') || null, e.target);\n        return false;\n      }\n      function show () {\n        color.current.val('ahex', color.active.val('ahex'));\n        function attachIFrame () {\n          if (!settings.window.expandable || $.support.boxModel) return;\n          const table = container.find('table:first');\n          container.before('<iframe/>');\n          container.prev().css({width: table.width(), height: container.height(), opacity: 0, position: 'absolute', left: container.css('left'), top: container.css('top')});\n        }\n        if (settings.window.expandable) {\n          $(document.body).children('div.jPicker.Container').css({zIndex: 10});\n          container.css({zIndex: 20});\n        }\n        switch (settings.window.effects.type) {\n        case 'fade':\n          container.fadeIn(settings.window.effects.speed.show, attachIFrame);\n          break;\n        case 'slide':\n          container.slideDown(settings.window.effects.speed.show, attachIFrame);\n          break;\n        case 'show':\n        default:\n          container.show(settings.window.effects.speed.show, attachIFrame);\n          break;\n        }\n      }\n      function hide () {\n        function removeIFrame () {\n          if (settings.window.expandable) container.css({ zIndex: 10 });\n          if (!settings.window.expandable || $.support.boxModel) return;\n          container.prev().remove();\n        }\n        switch (settings.window.effects.type) {\n        case 'fade':\n          container.fadeOut(settings.window.effects.speed.hide, removeIFrame);\n          break;\n        case 'slide':\n          container.slideUp(settings.window.effects.speed.hide, removeIFrame);\n          break;\n        case 'show':\n        default:\n          container.hide(settings.window.effects.speed.hide, removeIFrame);\n          break;\n        }\n      }\n      function initialize () {\n        const win = settings.window,\n          popup = win.expandable ? $($this).next().find('.Container:first') : null;\n        container = win.expandable ? $('<div/>') : $($this);\n        container.addClass('jPicker Container');\n        if (win.expandable) container.hide();\n        container.get(0).onselectstart = function (event) { if (event.target.nodeName.toLowerCase() !== 'input') return false; };\n        // inject html source code - we are using a single table for this control - I know tables are considered bad, but it takes care of equal height columns and\n        // this control really is tabular data, so I believe it is the right move\n        const all = color.active.val('all');\n        if (win.alphaPrecision < 0) win.alphaPrecision = 0;\n        else if (win.alphaPrecision > 2) win.alphaPrecision = 2;\n        const controlHtml = '<table class=\"jPicker\" cellpadding=\"0\" cellspacing=\"0\"><tbody>' + (win.expandable ? '<tr><td class=\"Move\" colspan=\"5\">&nbsp;</td></tr>' : '') + '<tr><td rowspan=\"9\"><h2 class=\"Title\">' + (win.title || localization.text.title) + '</h2><div class=\"Map\"><span class=\"Map1\">&nbsp;</span><span class=\"Map2\">&nbsp;</span><span class=\"Map3\">&nbsp;</span><img src=\"' + images.clientPath + images.colorMap.arrow.file + '\" class=\"Arrow\"/></div></td><td rowspan=\"9\"><div class=\"Bar\"><span class=\"Map1\">&nbsp;</span><span class=\"Map2\">&nbsp;</span><span class=\"Map3\">&nbsp;</span><span class=\"Map4\">&nbsp;</span><span class=\"Map5\">&nbsp;</span><span class=\"Map6\">&nbsp;</span><img src=\"' + images.clientPath + images.colorBar.arrow.file + '\" class=\"Arrow\"/></div></td><td colspan=\"2\" class=\"Preview\">' + localization.text.newColor + '<div><span class=\"Active\" title=\"' + localization.tooltips.colors.newColor + '\">&nbsp;</span><span class=\"Current\" title=\"' + localization.tooltips.colors.currentColor + '\">&nbsp;</span></div>' + localization.text.currentColor + '</td><td rowspan=\"9\" class=\"Button\"><input type=\"button\" class=\"Ok\" value=\"' + localization.text.ok + '\" title=\"' + localization.tooltips.buttons.ok + '\"/><input type=\"button\" class=\"Cancel\" value=\"' + localization.text.cancel + '\" title=\"' + localization.tooltips.buttons.cancel + '\"/><hr/><div class=\"Grid\">&nbsp;</div></td></tr><tr class=\"Hue\"><td class=\"Radio\"><label title=\"' + localization.tooltips.hue.radio + '\"><input type=\"radio\" value=\"h\"' + (settings.color.mode === 'h' ? ' checked=\"checked\"' : '') + '/>H:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.h : '') + '\" title=\"' + localization.tooltips.hue.textbox + '\"/>&nbsp;&deg;</td></tr><tr class=\"Saturation\"><td class=\"Radio\"><label title=\"' + localization.tooltips.saturation.radio + '\"><input type=\"radio\" value=\"s\"' + (settings.color.mode === 's' ? ' checked=\"checked\"' : '') + '/>S:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.s : '') + '\" title=\"' + localization.tooltips.saturation.textbox + '\"/>&nbsp;%</td></tr><tr class=\"Value\"><td class=\"Radio\"><label title=\"' + localization.tooltips.value.radio + '\"><input type=\"radio\" value=\"v\"' + (settings.color.mode === 'v' ? ' checked=\"checked\"' : '') + '/>V:</label><br/><br/></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.v : '') + '\" title=\"' + localization.tooltips.value.textbox + '\"/>&nbsp;%<br/><br/></td></tr><tr class=\"Red\"><td class=\"Radio\"><label title=\"' + localization.tooltips.red.radio + '\"><input type=\"radio\" value=\"r\"' + (settings.color.mode === 'r' ? ' checked=\"checked\"' : '') + '/>R:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.r : '') + '\" title=\"' + localization.tooltips.red.textbox + '\"/></td></tr><tr class=\"Green\"><td class=\"Radio\"><label title=\"' + localization.tooltips.green.radio + '\"><input type=\"radio\" value=\"g\"' + (settings.color.mode === 'g' ? ' checked=\"checked\"' : '') + '/>G:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.g : '') + '\" title=\"' + localization.tooltips.green.textbox + '\"/></td></tr><tr class=\"Blue\"><td class=\"Radio\"><label title=\"' + localization.tooltips.blue.radio + '\"><input type=\"radio\" value=\"b\"' + (settings.color.mode === 'b' ? ' checked=\"checked\"' : '') + '/>B:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.b : '') + '\" title=\"' + localization.tooltips.blue.textbox + '\"/></td></tr><tr class=\"Alpha\"><td class=\"Radio\">' + (win.alphaSupport ? '<label title=\"' + localization.tooltips.alpha.radio + '\"><input type=\"radio\" value=\"a\"' + (settings.color.mode === 'a' ? ' checked=\"checked\"' : '') + '/>A:</label>' : '&nbsp;') + '</td><td class=\"Text\">' + (win.alphaSupport ? '<input type=\"text\" maxlength=\"' + (3 + win.alphaPrecision) + '\" value=\"' + (all != null ? Math.precision((all.a * 100) / 255, win.alphaPrecision) : '') + '\" title=\"' + localization.tooltips.alpha.textbox + '\"/>&nbsp;%' : '&nbsp;') + '</td></tr><tr class=\"Hex\"><td colspan=\"2\" class=\"Text\"><label title=\"' + localization.tooltips.hex.textbox + '\">#:<input type=\"text\" maxlength=\"6\" class=\"Hex\" value=\"' + (all != null ? all.hex : '') + '\"/></label>' + (win.alphaSupport ? '<input type=\"text\" maxlength=\"2\" class=\"AHex\" value=\"' + (all != null ? all.ahex.substring(6) : '') + '\" title=\"' + localization.tooltips.hex.alpha + '\"/></td>' : '&nbsp;') + '</tr></tbody></table>';\n        if (win.expandable) {\n          container.html(controlHtml);\n          if (!$(document.body).children('div.jPicker.Container').length) {\n            $(document.body).prepend(container);\n          } else {\n            $(document.body).children('div.jPicker.Container:last').after(container);\n          }\n          container.mousedown(\n            function () {\n              $(document.body).children('div.jPicker.Container').css({zIndex: 10});\n              container.css({zIndex: 20});\n            });\n          container.css( // positions must be set and display set to absolute before source code injection or IE will size the container to fit the window\n            {\n              left:\n                win.position.x === 'left'\n                  ? (popup.offset().left - 530 - (win.position.y === 'center' ? 25 : 0)) + 'px'\n                  : win.position.x === 'center'\n                    ? (popup.offset().left - 260) + 'px'\n                    : win.position.x === 'right'\n                      ? (popup.offset().left - 10 + (win.position.y === 'center' ? 25 : 0)) + 'px'\n                      : win.position.x === 'screenCenter'\n                        ? (($(document).width() >> 1) - 260) + 'px'\n                        : (popup.offset().left + parseInt(win.position.x)) + 'px',\n              position: 'absolute',\n              top: win.position.y === 'top'\n                ? (popup.offset().top - 312) + 'px'\n                : win.position.y === 'center'\n                  ? (popup.offset().top - 156) + 'px'\n                  : win.position.y === 'bottom'\n                    ? (popup.offset().top + 25) + 'px'\n                    : (popup.offset().top + parseInt(win.position.y)) + 'px'\n            });\n        } else {\n          container = $($this);\n          container.html(controlHtml);\n        }\n        // initialize the objects to the source code just injected\n        const tbody = container.find('tbody:first');\n        colorMapDiv = tbody.find('div.Map:first');\n        colorBarDiv = tbody.find('div.Bar:first');\n        const MapMaps = colorMapDiv.find('span');\n        const BarMaps = colorBarDiv.find('span');\n        colorMapL1 = MapMaps.filter('.Map1:first');\n        colorMapL2 = MapMaps.filter('.Map2:first');\n        colorMapL3 = MapMaps.filter('.Map3:first');\n        colorBarL1 = BarMaps.filter('.Map1:first');\n        colorBarL2 = BarMaps.filter('.Map2:first');\n        colorBarL3 = BarMaps.filter('.Map3:first');\n        colorBarL4 = BarMaps.filter('.Map4:first');\n        colorBarL5 = BarMaps.filter('.Map5:first');\n        colorBarL6 = BarMaps.filter('.Map6:first');\n        // create color pickers and maps\n        colorMap = new Slider(colorMapDiv,\n          {\n            map: {\n              width: images.colorMap.width,\n              height: images.colorMap.height\n            },\n            arrow: {\n              image: images.clientPath + images.colorMap.arrow.file,\n              width: images.colorMap.arrow.width,\n              height: images.colorMap.arrow.height\n            }\n          }\n        );\n        colorMap.bind(mapValueChanged);\n        colorBar = new Slider(colorBarDiv,\n          {\n            map: {\n              width: images.colorBar.width,\n              height: images.colorBar.height\n            },\n            arrow: {\n              image: images.clientPath + images.colorBar.arrow.file,\n              width: images.colorBar.arrow.width,\n              height: images.colorBar.arrow.height\n            }\n          }\n        );\n        colorBar.bind(colorBarValueChanged);\n        colorPicker = new ColorValuePicker(\n          tbody,\n          color.active,\n          win.expandable && win.bindToInput ? win.input : null, win.alphaPrecision\n        );\n        const hex = all != null ? all.hex : null,\n          preview = tbody.find('.Preview'),\n          button = tbody.find('.Button');\n        activePreview = preview.find('.Active:first').css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n        currentPreview = preview.find('.Current:first').css({ backgroundColor: (hex && '#' + hex) || 'transparent' }).bind('click', currentClicked);\n        setAlpha.call($this, currentPreview, Math.precision(color.current.val('a') * 100) / 255, 4);\n        okButton = button.find('.Ok:first').bind('click', okClicked);\n        cancelButton = button.find('.Cancel:first').bind('click', cancelClicked);\n        grid = button.find('.Grid:first');\n        setTimeout(function () {\n          setImg.call($this, colorMapL1, images.clientPath + 'Maps.png');\n          setImg.call($this, colorMapL2, images.clientPath + 'Maps.png');\n          setImg.call($this, colorMapL3, images.clientPath + 'map-opacity.png');\n          setImg.call($this, colorBarL1, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL2, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL3, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL4, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL5, images.clientPath + 'bar-opacity.png');\n          setImg.call($this, colorBarL6, images.clientPath + 'AlphaBar.png');\n          setImg.call($this, preview.find('div:first'), images.clientPath + 'preview-opacity.png');\n        }, 0);\n        tbody.find('td.Radio input').bind('click', radioClicked);\n        // initialize quick list\n        if (color.quickList && color.quickList.length > 0) {\n          let html = '';\n          for (let i = 0; i < color.quickList.length; i++) {\n            /* if default colors are hex strings, change them to color objects */\n            if ((typeof (color.quickList[i])).toString().toLowerCase() === 'string') color.quickList[i] = new Color({ hex: color.quickList[i] });\n            const alpha = color.quickList[i].val('a');\n            let ahex = color.quickList[i].val('ahex');\n            if (!win.alphaSupport && ahex) ahex = ahex.substring(0, 6) + 'ff';\n            const quickHex = color.quickList[i].val('hex');\n            if (!ahex) ahex = '00000000';\n            html += '<span class=\"QuickColor\"' + ((ahex && ' title=\"#' + ahex + '\"') || 'none') + ' style=\"background-color:' + ((quickHex && '#' + quickHex) || '') + ';' + (quickHex ? '' : 'background-image:url(' + images.clientPath + 'NoColor.png)') + (win.alphaSupport && alpha && alpha < 255 ? ';opacity:' + Math.precision(alpha / 255, 4) + ';filter:Alpha(opacity=' + Math.precision(alpha / 2.55, 4) + ')' : '') + '\">&nbsp;</span>';\n          }\n          setImg.call($this, grid, images.clientPath + 'bar-opacity.png');\n          grid.html(html);\n          grid.find('.QuickColor').click(quickPickClicked);\n        }\n        setColorMode.call($this, settings.color.mode);\n        color.active.bind(activeColorChanged);\n        typeof liveCallback === 'function' && color.active.bind(liveCallback);\n        color.current.bind(currentColorChanged);\n        // bind to input\n        if (win.expandable) {\n          $this.icon = popup.parents('.Icon:first');\n          iconColor = $this.icon.find('.Color:first').css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n          iconAlpha = $this.icon.find('.Alpha:first');\n          setImg.call($this, iconAlpha, images.clientPath + 'bar-opacity.png');\n          setAlpha.call($this, iconAlpha, Math.precision(((255 - (all != null ? all.a : 0)) * 100) / 255, 4));\n          iconImage = $this.icon.find('.Image:first').css({\n            backgroundImage: 'url(\\'' + images.clientPath + images.picker.file + '\\')'\n          }).bind('click', iconImageClicked);\n          if (win.bindToInput && win.updateInputColor) {\n            win.input.css({\n              backgroundColor: (hex && '#' + hex) || 'transparent',\n              color: all == null || all.v > 75 ? '#000000' : '#ffffff'\n            });\n          }\n          moveBar = tbody.find('.Move:first').bind('mousedown', moveBarMouseDown);\n          color.active.bind(expandableColorChanged);\n        } else show.call($this);\n      }\n      function destroy () {\n        container.find('td.Radio input').unbind('click', radioClicked);\n        currentPreview.unbind('click', currentClicked);\n        cancelButton.unbind('click', cancelClicked);\n        okButton.unbind('click', okClicked);\n        if (settings.window.expandable) {\n          iconImage.unbind('click', iconImageClicked);\n          moveBar.unbind('mousedown', moveBarMouseDown);\n          $this.icon = null;\n        }\n        container.find('.QuickColor').unbind('click', quickPickClicked);\n        colorMapDiv = null;\n        colorBarDiv = null;\n        colorMapL1 = null;\n        colorMapL2 = null;\n        colorMapL3 = null;\n        colorBarL1 = null;\n        colorBarL2 = null;\n        colorBarL3 = null;\n        colorBarL4 = null;\n        colorBarL5 = null;\n        colorBarL6 = null;\n        colorMap.destroy();\n        colorMap = null;\n        colorBar.destroy();\n        colorBar = null;\n        colorPicker.destroy();\n        colorPicker = null;\n        activePreview = null;\n        currentPreview = null;\n        okButton = null;\n        cancelButton = null;\n        grid = null;\n        commitCallback = null;\n        cancelCallback = null;\n        liveCallback = null;\n        container.html('');\n        for (let i = 0; i < List.length; i++) {\n          if (List[i] === $this) {\n            List.splice(i, 1);\n          }\n        }\n      }\n      const {images, localization} = settings; // local copies for YUI compressor\n      const color = {\n        active: (typeof settings.color.active).toString().toLowerCase() === 'string'\n          ? new Color({ahex: !settings.window.alphaSupport && settings.color.active\n            ? settings.color.active.substring(0, 6) + 'ff'\n            : settings.color.active\n          })\n          : new Color({ahex: !settings.window.alphaSupport &&\n              settings.color.active.val('ahex')\n            ? settings.color.active.val('ahex').substring(0, 6) + 'ff'\n            : settings.color.active.val('ahex')\n          }),\n        current: (typeof settings.color.active).toString().toLowerCase() === 'string'\n          ? new Color({ahex: !settings.window.alphaSupport && settings.color.active\n            ? settings.color.active.substring(0, 6) + 'ff'\n            : settings.color.active})\n          : new Color({ahex: !settings.window.alphaSupport &&\n              settings.color.active.val('ahex')\n            ? settings.color.active.val('ahex').substring(0, 6) + 'ff'\n            : settings.color.active.val('ahex')\n          }),\n        quickList: settings.color.quickList\n      };\n\n      let elementStartX = null, // Used to record the starting css positions for dragging the control\n        elementStartY = null,\n        pageStartX = null, // Used to record the mousedown coordinates for dragging the control\n        pageStartY = null,\n        container = null,\n        colorMapDiv = null,\n        colorBarDiv = null,\n        colorMapL1 = null, // different layers of colorMap and colorBar\n        colorMapL2 = null,\n        colorMapL3 = null,\n        colorBarL1 = null,\n        colorBarL2 = null,\n        colorBarL3 = null,\n        colorBarL4 = null,\n        colorBarL5 = null,\n        colorBarL6 = null,\n        colorMap = null, // color maps\n        colorBar = null,\n        colorPicker = null,\n        activePreview = null, // color boxes above the radio buttons\n        currentPreview = null,\n        okButton = null,\n        cancelButton = null,\n        grid = null, // preset colors grid\n        iconColor = null, // iconColor for popup icon\n        iconAlpha = null, // iconAlpha for popup icon\n        iconImage = null, // iconImage popup icon\n        moveBar = null, // drag bar\n        commitCallback = typeof $arguments[1] === 'function' ? $arguments[1] : null,\n        liveCallback = typeof $arguments[2] === 'function' ? $arguments[2] : null,\n        cancelCallback = typeof $arguments[3] === 'function' ? $arguments[3] : null;\n\n      $.extend(true, $this, {\n        // public properties, methods, and callbacks\n        commitCallback, // commitCallback function can be overridden to return the selected color to a method you specify when the user clicks \"OK\"\n        liveCallback, // liveCallback function can be overridden to return the selected color to a method you specify in live mode (continuous update)\n        cancelCallback, // cancelCallback function can be overridden to a method you specify when the user clicks \"Cancel\"\n        color,\n        show,\n        hide,\n        destroy // destroys this control entirely, removing all events and objects, and removing itself from the List\n      });\n      List.push($this);\n      setTimeout(function () {\n        initialize.call($this);\n      }, 0);\n    });\n  };\n  /**\n  * jPicker defaults - you can change anything in this section (such as the\n  * clientPath to your images) without fear of breaking the program\n  */\n  $.fn.jPicker.defaults = {\n    window: {\n      title: null, /* any title for the jPicker window itself - displays \"Drag Markers To Pick A Color\" if left null */\n      effects: {\n        type: 'slide', /* effect used to show/hide an expandable picker. Acceptable values \"slide\", \"show\", \"fade\" */\n        speed: {\n          show: 'slow', /* duration of \"show\" effect. Acceptable values are \"fast\", \"slow\", or time in ms */\n          hide: 'fast' /* duration of \"hide\" effect. Acceptable values are \"fast\", \"slow\", or time in ms */\n        }\n      },\n      position: {\n        x: 'screenCenter', /* acceptable values \"left\", \"center\", \"right\", \"screenCenter\", or relative px value */\n        y: 'top' /* acceptable values \"top\", \"bottom\", \"center\", or relative px value */\n      },\n      expandable: false, /* default to large static picker - set to true to make an expandable picker (small icon with popup) - set automatically when binded to input element */\n      liveUpdate: true, /* set false if you want the user to have to click \"OK\" before the binded input box updates values (always \"true\" for expandable picker) */\n      alphaSupport: false, /* set to true to enable alpha picking */\n      alphaPrecision: 0, /* set decimal precision for alpha percentage display - hex codes do not map directly to percentage integers - range 0-2 */\n      updateInputColor: true /* set to false to prevent binded input colors from changing */\n    },\n    color: {\n      mode: 'h', /* acceptabled values \"h\" (hue), \"s\" (saturation), \"v\" (value), \"r\" (red), \"g\" (green), \"b\" (blue), \"a\" (alpha) */\n      active: new Color({ahex: '#ffcc00ff'}), /* acceptable values are any declared $.jPicker.Color object or string HEX value (e.g. #ffc000) WITH OR WITHOUT the \"#\" prefix */\n      // the quick pick color list\n      quickList: [\n        new Color({ h: 360, s: 33, v: 100 }), /* acceptable values are any declared $.jPicker.Color object or string HEX value (e.g. #ffc000) WITH OR WITHOUT the \"#\" prefix */\n        new Color({ h: 360, s: 66, v: 100 }),\n        new Color({ h: 360, s: 100, v: 100 }),\n        new Color({ h: 360, s: 100, v: 75 }),\n        new Color({ h: 360, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 100 }),\n        new Color({ h: 30, s: 33, v: 100 }),\n        new Color({ h: 30, s: 66, v: 100 }),\n        new Color({ h: 30, s: 100, v: 100 }),\n        new Color({ h: 30, s: 100, v: 75 }),\n        new Color({ h: 30, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 90 }),\n        new Color({ h: 60, s: 33, v: 100 }),\n        new Color({ h: 60, s: 66, v: 100 }),\n        new Color({ h: 60, s: 100, v: 100 }),\n        new Color({ h: 60, s: 100, v: 75 }),\n        new Color({ h: 60, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 80 }),\n        new Color({ h: 90, s: 33, v: 100 }),\n        new Color({ h: 90, s: 66, v: 100 }),\n        new Color({ h: 90, s: 100, v: 100 }),\n        new Color({ h: 90, s: 100, v: 75 }),\n        new Color({ h: 90, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 70 }),\n        new Color({ h: 120, s: 33, v: 100 }),\n        new Color({ h: 120, s: 66, v: 100 }),\n        new Color({ h: 120, s: 100, v: 100 }),\n        new Color({ h: 120, s: 100, v: 75 }),\n        new Color({ h: 120, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 60 }),\n        new Color({ h: 150, s: 33, v: 100 }),\n        new Color({ h: 150, s: 66, v: 100 }),\n        new Color({ h: 150, s: 100, v: 100 }),\n        new Color({ h: 150, s: 100, v: 75 }),\n        new Color({ h: 150, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 50 }),\n        new Color({ h: 180, s: 33, v: 100 }),\n        new Color({ h: 180, s: 66, v: 100 }),\n        new Color({ h: 180, s: 100, v: 100 }),\n        new Color({ h: 180, s: 100, v: 75 }),\n        new Color({ h: 180, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 40 }),\n        new Color({ h: 210, s: 33, v: 100 }),\n        new Color({ h: 210, s: 66, v: 100 }),\n        new Color({ h: 210, s: 100, v: 100 }),\n        new Color({ h: 210, s: 100, v: 75 }),\n        new Color({ h: 210, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 30 }),\n        new Color({ h: 240, s: 33, v: 100 }),\n        new Color({ h: 240, s: 66, v: 100 }),\n        new Color({ h: 240, s: 100, v: 100 }),\n        new Color({ h: 240, s: 100, v: 75 }),\n        new Color({ h: 240, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 20 }),\n        new Color({ h: 270, s: 33, v: 100 }),\n        new Color({ h: 270, s: 66, v: 100 }),\n        new Color({ h: 270, s: 100, v: 100 }),\n        new Color({ h: 270, s: 100, v: 75 }),\n        new Color({ h: 270, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 10 }),\n        new Color({ h: 300, s: 33, v: 100 }),\n        new Color({ h: 300, s: 66, v: 100 }),\n        new Color({ h: 300, s: 100, v: 100 }),\n        new Color({ h: 300, s: 100, v: 75 }),\n        new Color({ h: 300, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 0 }),\n        new Color({ h: 330, s: 33, v: 100 }),\n        new Color({ h: 330, s: 66, v: 100 }),\n        new Color({ h: 330, s: 100, v: 100 }),\n        new Color({ h: 330, s: 100, v: 75 }),\n        new Color({ h: 330, s: 100, v: 50 }),\n        new Color()\n      ]\n    },\n    images: {\n      clientPath: '/jPicker/images/', /* Path to image files */\n      colorMap: {\n        width: 256,\n        height: 256,\n        arrow: {\n          file: 'mappoint.gif', /* ColorMap arrow icon */\n          width: 15,\n          height: 15\n        }\n      },\n      colorBar: {\n        width: 20,\n        height: 256,\n        arrow: {\n          file: 'rangearrows.gif', /* ColorBar arrow icon */\n          width: 20,\n          height: 7\n        }\n      },\n      picker: {\n        file: 'picker.gif', /* Color Picker icon */\n        width: 25,\n        height: 24\n      }\n    },\n    // alter these to change the text presented by the picker (e.g. different language) */\n    localization: {\n      text: {\n        title: 'Drag Markers To Pick A Color',\n        newColor: 'new',\n        currentColor: 'current',\n        ok: 'OK',\n        cancel: 'Cancel'\n      },\n      tooltips: {\n        colors: {\n          newColor: 'New Color - Press &ldquo;OK&rdquo; To Commit',\n          currentColor: 'Click To Revert To Original Color'\n        },\n        buttons: {\n          ok: 'Commit To This Color Selection',\n          cancel: 'Cancel And Revert To Original Color'\n        },\n        hue: {\n          radio: 'Set To &ldquo;Hue&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Hue&rdquo; Value (0-360&deg;)'\n        },\n        saturation: {\n          radio: 'Set To &ldquo;Saturation&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Saturation&rdquo; Value (0-100%)'\n        },\n        value: {\n          radio: 'Set To &ldquo;Value&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Value&rdquo; Value (0-100%)'\n        },\n        red: {\n          radio: 'Set To &ldquo;Red&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Red&rdquo; Value (0-255)'\n        },\n        green: {\n          radio: 'Set To &ldquo;Green&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Green&rdquo; Value (0-255)'\n        },\n        blue: {\n          radio: 'Set To &ldquo;Blue&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Blue&rdquo; Value (0-255)'\n        },\n        alpha: {\n          radio: 'Set To &ldquo;Alpha&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Alpha&rdquo; Value (0-100)'\n        },\n        hex: {\n          textbox: 'Enter A &ldquo;Hex&rdquo; Color Value (#000000-#ffffff)',\n          alpha: 'Enter A &ldquo;Alpha&rdquo; Value (#00-#ff)'\n        }\n      }\n    }\n  };\n  return $;\n};\n\nexport default jPicker;\n","/* globals jQuery */\n/*\n * Localizing script for SVG-edit UI\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Narendra Sisodya\n * Copyright(c) 2010 Alexis Deveria\n *\n */\n\nimport {importSetGlobalDefault} from '../external/dynamic-import-polyfill/importModule.js';\n\nconst $ = jQuery;\n\nlet langParam;\nfunction setStrings (type, obj, ids) {\n  // Root element to look for element from\n  const parent = $('#svg_editor').parent();\n  Object.entries(obj).forEach(([sel, val]) => {\n    if (!val) { console.log(sel); }\n\n    if (ids) { sel = '#' + sel; }\n    const $elem = parent.find(sel);\n    if ($elem.length) {\n      const elem = parent.find(sel)[0];\n\n      switch (type) {\n      case 'content':\n        for (let i = 0, node; (node = elem.childNodes[i]); i++) {\n          if (node.nodeType === 3 && node.textContent.trim()) {\n            node.textContent = val;\n            break;\n          }\n        }\n        break;\n\n      case 'title':\n        elem.title = val;\n        break;\n      }\n    } else {\n      console.log('Missing: ' + sel);\n    }\n  });\n}\n\nlet editor_;\nexport const init = (editor) => {\n  editor_ = editor;\n};\n\nexport const readLang = function (langData) {\n  const more = editor_.addLangData(langParam);\n  $.each(more, function (i, m) {\n    if (m.data) {\n      langData = $.merge(langData, m.data);\n    }\n  });\n\n  // Old locale file, do nothing for now.\n  if (!langData.tools) { return; }\n\n  const {\n    tools,\n    // misc,\n    properties, config, layers, common, ui\n  } = langData;\n\n  setStrings('content', {\n    // copyrightLabel: misc.powered_by, // Currently commented out in svg-editor.html\n    curve_segments: properties.curve_segments,\n    fitToContent: tools.fitToContent,\n    fit_to_all: tools.fit_to_all,\n    fit_to_canvas: tools.fit_to_canvas,\n    fit_to_layer_content: tools.fit_to_layer_content,\n    fit_to_sel: tools.fit_to_sel,\n\n    icon_large: config.icon_large,\n    icon_medium: config.icon_medium,\n    icon_small: config.icon_small,\n    icon_xlarge: config.icon_xlarge,\n    image_opt_embed: config.image_opt_embed,\n    image_opt_ref: config.image_opt_ref,\n    includedImages: config.included_images,\n\n    largest_object: tools.largest_object,\n\n    layersLabel: layers.layers,\n    page: tools.page,\n    relativeToLabel: tools.relativeTo,\n    selLayerLabel: layers.move_elems_to,\n    selectedPredefined: config.select_predefined,\n\n    selected_objects: tools.selected_objects,\n    smallest_object: tools.smallest_object,\n    straight_segments: properties.straight_segments,\n\n    svginfo_bg_url: config.editor_img_url + ':',\n    svginfo_bg_note: config.editor_bg_note,\n    svginfo_change_background: config.background,\n    svginfo_dim: config.doc_dims,\n    svginfo_editor_prefs: config.editor_prefs,\n    svginfo_height: common.height,\n    svginfo_icons: config.icon_size,\n    svginfo_image_props: config.image_props,\n    svginfo_lang: config.language,\n    svginfo_title: config.doc_title,\n    svginfo_width: common.width,\n\n    tool_docprops_cancel: common.cancel,\n    tool_docprops_save: common.ok,\n\n    tool_source_cancel: common.cancel,\n    tool_source_save: common.ok,\n\n    tool_prefs_cancel: common.cancel,\n    tool_prefs_save: common.ok,\n\n    sidepanel_handle: layers.layers.split('').join(' '),\n\n    tool_clear: tools.new_doc,\n    tool_docprops: tools.docprops,\n    tool_export: tools.export_img,\n    tool_import: tools.import_doc,\n    tool_open: tools.open_doc,\n    tool_save: tools.save_doc,\n\n    svginfo_units_rulers: config.units_and_rulers,\n    svginfo_rulers_onoff: config.show_rulers,\n    svginfo_unit: config.base_unit,\n\n    svginfo_grid_settings: config.grid,\n    svginfo_snap_onoff: config.snapping_onoff,\n    svginfo_snap_step: config.snapping_stepsize,\n    svginfo_grid_color: config.grid_color\n  }, true);\n\n  // Shape categories\n  const cats = {};\n  for (const o in langData.shape_cats) {\n    cats['#shape_cats [data-cat=\"' + o + '\"]'] = langData.shape_cats[o];\n  }\n\n  // TODO: Find way to make this run after shapelib ext has loaded\n  setTimeout(() => {\n    setStrings('content', cats);\n  }, 2000);\n\n  // Context menus\n  const opts = {};\n  $.each(['cut', 'copy', 'paste', 'paste_in_place', 'delete', 'group', 'ungroup', 'move_front', 'move_up', 'move_down', 'move_back'], function () {\n    opts['#cmenu_canvas a[href=\"#' + this + '\"]'] = tools[this];\n  });\n\n  $.each(['dupe', 'merge_down', 'merge_all'], function () {\n    opts['#cmenu_layers a[href=\"#' + this + '\"]'] = layers[this];\n  });\n\n  opts['#cmenu_layers a[href=\"#delete\"]'] = layers.del;\n\n  setStrings('content', opts);\n\n  setStrings('title', {\n    align_relative_to: tools.align_relative_to,\n    circle_cx: properties.circle_cx,\n    circle_cy: properties.circle_cy,\n    circle_r: properties.circle_r,\n    cornerRadiusLabel: properties.corner_radius,\n    ellipse_cx: properties.ellipse_cx,\n    ellipse_cy: properties.ellipse_cy,\n    ellipse_rx: properties.ellipse_rx,\n    ellipse_ry: properties.ellipse_ry,\n    fill_color: properties.fill_color,\n    font_family: properties.font_family,\n    idLabel: properties.id,\n    image_height: properties.image_height,\n    image_url: properties.image_url,\n    image_width: properties.image_width,\n    layer_delete: layers.del,\n    layer_down: layers.move_down,\n    layer_new: layers['new'],\n    layer_rename: layers.rename,\n    layer_moreopts: common.more_opts,\n    layer_up: layers.move_up,\n    line_x1: properties.line_x1,\n    line_x2: properties.line_x2,\n    line_y1: properties.line_y1,\n    line_y2: properties.line_y2,\n    linecap_butt: properties.linecap_butt,\n    linecap_round: properties.linecap_round,\n    linecap_square: properties.linecap_square,\n    linejoin_bevel: properties.linejoin_bevel,\n    linejoin_miter: properties.linejoin_miter,\n    linejoin_round: properties.linejoin_round,\n    main_icon: tools.main_menu,\n    mode_connect: tools.mode_connect,\n    tools_shapelib_show: tools.mode_shapelib,\n    palette: ui.palette_info,\n    zoom_panel: ui.zoom_level,\n    path_node_x: properties.node_x,\n    path_node_y: properties.node_y,\n    rect_height_tool: properties.rect_height,\n    rect_width_tool: properties.rect_width,\n    seg_type: properties.seg_type,\n    selLayerNames: layers.move_selected,\n    selected_x: properties.pos_x,\n    selected_y: properties.pos_y,\n    stroke_color: properties.stroke_color,\n    stroke_style: properties.stroke_style,\n    stroke_width: properties.stroke_width,\n    svginfo_title: config.doc_title,\n    text: properties.text_contents,\n    toggle_stroke_tools: ui.toggle_stroke_tools,\n    tool_add_subpath: tools.add_subpath,\n    tool_alignbottom: tools.align_bottom,\n    tool_aligncenter: tools.align_center,\n    tool_alignleft: tools.align_left,\n    tool_alignmiddle: tools.align_middle,\n    tool_alignright: tools.align_right,\n    tool_aligntop: tools.align_top,\n    tool_angle: properties.angle,\n    tool_blur: properties.blur,\n    tool_bold: properties.bold,\n    tool_circle: tools.mode_circle,\n    tool_clone: tools.clone,\n    tool_clone_multi: tools.clone,\n    tool_delete: tools.del,\n    tool_delete_multi: tools.del,\n    tool_ellipse: tools.mode_ellipse,\n    tool_eyedropper: tools.mode_eyedropper,\n    tool_fhellipse: tools.mode_fhellipse,\n    tool_fhpath: tools.mode_fhpath,\n    tool_fhrect: tools.mode_fhrect,\n    tool_font_size: properties.font_size,\n    tool_group_elements: tools.group_elements,\n    tool_make_link: tools.make_link,\n    tool_link_url: tools.set_link_url,\n    tool_image: tools.mode_image,\n    tool_italic: properties.italic,\n    tool_line: tools.mode_line,\n    tool_move_bottom: tools.move_bottom,\n    tool_move_top: tools.move_top,\n    tool_node_clone: tools.node_clone,\n    tool_node_delete: tools.node_delete,\n    tool_node_link: tools.node_link,\n    tool_opacity: properties.opacity,\n    tool_openclose_path: tools.openclose_path,\n    tool_path: tools.mode_path,\n    tool_position: tools.align_to_page,\n    tool_rect: tools.mode_rect,\n    tool_redo: tools.redo,\n    tool_reorient: tools.reorient_path,\n    tool_select: tools.mode_select,\n    tool_source: tools.source_save,\n    tool_square: tools.mode_square,\n    tool_text: tools.mode_text,\n    tool_topath: tools.to_path,\n    tool_undo: tools.undo,\n    tool_ungroup: tools.ungroup,\n    tool_wireframe: tools.wireframe_mode,\n    view_grid: tools.toggle_grid,\n    tool_zoom: tools.mode_zoom,\n    url_notice: tools.no_embed\n\n  }, true);\n\n  editor_.setLang(langParam, langData);\n};\n\nexport const putLocale = async function (givenParam, goodLangs, conf) {\n  if (givenParam) {\n    langParam = givenParam;\n  } else {\n    langParam = $.pref('lang');\n    if (!langParam) {\n      if (navigator.userLanguage) { // Explorer\n        langParam = navigator.userLanguage;\n      } else if (navigator.language) { // FF, Opera, ...\n        langParam = navigator.language;\n      }\n    }\n\n    console.log('Lang: ' + langParam);\n\n    // Set to English if language is not in list of good langs\n    if (!goodLangs.includes(langParam) && langParam !== 'test') {\n      langParam = 'en';\n    }\n\n    // don't bother on first run if language is English\n    // The following line prevents setLang from running\n    //    extensions which depend on updated uiStrings,\n    //    so commenting it out.\n    // if (langParam.startsWith('en')) {return;}\n  }\n\n  const url = conf.langPath + 'lang.' + langParam + '.js';\n  return readLang(\n    // Todo: Replace this with `return import(url);` when\n    //   `import()` widely supported\n    await importSetGlobalDefault(url, {\n      global: 'svgEditorLang_' + langParam.replace(/-/g, '_')\n    })\n  );\n};\n","/* globals jQuery */\n/*\n * svg-editor.js\n *\n * Licensed under the MIT License\n *\n * Copyright(c) 2010 Alexis Deveria\n * Copyright(c) 2010 Pavol Rusnak\n * Copyright(c) 2010 Jeff Schiller\n * Copyright(c) 2010 Narendra Sisodiya\n * Copyright(c) 2014 Brett Zamir\n *\n */\n\nimport './touch.js';\nimport {NS} from './svgedit.js';\nimport {isWebkit, isGecko, isIE, isMac, isTouch} from './browser.js';\nimport * as Utils from './svgutils.js';\nimport {getTypeMap, convertUnit, isValidUnit} from './units.js';\nimport {\n  hasCustomHandler, getCustomHandler, injectExtendedContextMenuItemsIntoDom\n} from './contextmenu.js';\nimport {importSetGlobalDefault} from './external/dynamic-import-polyfill/importModule.js';\n\nimport SvgCanvas from './svgcanvas.js';\nimport Layer from './layer.js';\n\nimport jqPluginJSHotkeys from './js-hotkeys/jquery.hotkeys.min.js';\nimport jqPluginBBQ from './jquerybbq/jquery.bbq.min.js';\nimport jqPluginSVGIcons from './svgicons/jquery.svgicons.js';\nimport jqPluginJGraduate from './jgraduate/jquery.jgraduate.js';\nimport jqPluginSpinBtn from './spinbtn/JQuerySpinBtn.js';\nimport jqPluginSVG from './jquery-svg.js'; // Needed for SVG attribute setting and array form with `attr`\nimport jqPluginContextMenu from './contextmenu/jquery.contextMenu.js';\nimport jqPluginJPicker from './jgraduate/jpicker.js';\nimport {\n  readLang, putLocale,\n  init as localeInit\n} from './locale/locale.js';\nimport loadStylesheets from './external/load-stylesheets/index-es.js';\n\nconst $ = [\n  jqPluginJSHotkeys, jqPluginBBQ, jqPluginSVGIcons, jqPluginJGraduate,\n  jqPluginSpinBtn, jqPluginSVG, jqPluginContextMenu, jqPluginJPicker\n].reduce(($, cb) => cb($), jQuery);\n\n/*\nif (!$.loadingStylesheets) {\n  $.loadingStylesheets = [];\n}\n*/\nconst stylesheet = 'svg-editor.css';\nif (!$.loadingStylesheets.includes(stylesheet)) {\n  $.loadingStylesheets.push(stylesheet);\n}\nconst favicon = 'images/logo.png';\nif ($.loadingStylesheets.some((item) => {\n  return !Array.isArray(item) || item[0] !== favicon;\n})) {\n  $.loadingStylesheets.push([favicon, {favicon: true}]);\n}\n\nconst editor = {};\n\n// EDITOR PROPERTIES: (defined below)\n//    curPrefs, curConfig, canvas, storage, uiStrings\n//\n// STATE MAINTENANCE PROPERTIES\neditor.tool_scale = 1; // Dependent on icon size, so any use to making configurable instead? Used by JQuerySpinBtn.js\neditor.exportWindowCt = 0;\neditor.langChanged = false;\neditor.showSaveWarning = false;\neditor.storagePromptClosed = false; // For use with ext-storage.js\n\nconst callbacks = [],\n  /**\n  * PREFS AND CONFIG\n  */\n  // The iteration algorithm for defaultPrefs does not currently support array/objects\n  defaultPrefs = {\n    // EDITOR OPTIONS (DIALOG)\n    lang: '', // Default to \"en\" if locale.js detection does not detect another language\n    iconsize: '', // Will default to 's' if the window height is smaller than the minimum height and 'm' otherwise\n    bkgd_color: '#FFF',\n    bkgd_url: '',\n    // DOCUMENT PROPERTIES (DIALOG)\n    img_save: 'embed',\n    // ALERT NOTICES\n    // Only shows in UI as far as alert notices, but useful to remember, so keeping as pref\n    save_notice_done: false,\n    export_notice_done: false\n  },\n  defaultExtensions = [\n    'ext-overview_window.js',\n    'ext-markers.js',\n    'ext-connector.js',\n    'ext-eyedropper.js',\n    'ext-shapes.js',\n    'ext-imagelib.js',\n    'ext-grid.js',\n    'ext-polygon.js',\n    'ext-star.js',\n    'ext-panning.js',\n    'ext-storage.js'\n  ],\n  defaultConfig = {\n    // Todo: svgcanvas.js also sets and checks: show_outside_canvas, selectNew; add here?\n    // Change the following to preferences and add pref controls to the UI (e.g., initTool, wireframe, showlayers)?\n    canvasName: 'default',\n    canvas_expansion: 3,\n    initFill: {\n      color: 'FF0000', // solid red\n      opacity: 1\n    },\n    initStroke: {\n      width: 5,\n      color: '000000', // solid black\n      opacity: 1\n    },\n    text: {\n      stroke_width: 0,\n      font_size: 24,\n      font_family: 'serif'\n    },\n    initOpacity: 1,\n    colorPickerCSS: null, // Defaults to 'left' with a position equal to that of the fill_color or stroke_color element minus 140, and a 'bottom' equal to 40\n    initTool: 'select',\n    exportWindowType: 'new', // 'same' (todo: also support 'download')\n    wireframe: false,\n    showlayers: false,\n    no_save_warning: false,\n    // PATH CONFIGURATION\n    // The following path configuration items are disallowed in the URL (as should any future path configurations)\n    imgPath: 'images/',\n    langPath: 'locale/', // Default will be changed if this is a modular load\n    extPath: 'extensions/', // Default will be changed if this is a modular load\n    canvgPath: 'canvg/', // Default will be changed if this is a modular load\n    jspdfPath: 'jspdf/', // Default will be changed if this is a modular load\n    extIconsPath: 'extensions/',\n    jGraduatePath: 'jgraduate/images/',\n    // DOCUMENT PROPERTIES\n    // Change the following to a preference (already in the Document Properties dialog)?\n    dimensions: [640, 480],\n    // EDITOR OPTIONS\n    // Change the following to preferences (already in the Editor Options dialog)?\n    gridSnapping: false,\n    gridColor: '#000',\n    baseUnit: 'px',\n    snappingStep: 10,\n    showRulers: true,\n    // URL BEHAVIOR CONFIGURATION\n    preventAllURLConfig: false,\n    preventURLContentLoading: false,\n    // EXTENSION CONFIGURATION (see also preventAllURLConfig)\n    lockExtensions: false, // Disallowed in URL setting\n    noDefaultExtensions: false, // noDefaultExtensions can only be meaningfully used in `svgedit-config-iife.js` or in the URL\n    // EXTENSION-RELATED (GRID)\n    showGrid: false, // Set by ext-grid.js\n    // EXTENSION-RELATED (STORAGE)\n    noStorageOnLoad: false, // Some interaction with ext-storage.js; prevent even the loading of previously saved local storage\n    forceStorage: false, // Some interaction with ext-storage.js; strongly discouraged from modification as it bypasses user privacy by preventing them from choosing whether to keep local storage or not\n    emptyStorageOnDecline: false // Used by ext-storage.js; empty any prior storage if the user declines to store\n  },\n  /**\n  * LOCALE\n  */\n  uiStrings = editor.uiStrings = {};\n\nlet svgCanvas, urldata,\n  isReady = false,\n  customExportImage = false,\n  customExportPDF = false,\n  curPrefs = {},\n  // Note: The difference between Prefs and Config is that Prefs\n  //   can be changed in the UI and are stored in the browser,\n  //   while config cannot\n  curConfig = {\n    // We do not put on defaultConfig to simplify object copying\n    //   procedures (we obtain instead from defaultExtensions)\n    extensions: [],\n    stylesheets: [],\n    /**\n    * Can use window.location.origin to indicate the current\n    * origin. Can contain a '*' to allow all domains or 'null' (as\n    * a string) to support all file:// URLs. Cannot be set by\n    * URL for security reasons (not safe, at least for\n    * privacy or data integrity of SVG content).\n    * Might have been fairly safe to allow\n    *   `new URL(window.location.href).origin` by default but\n    *   avoiding it ensures some more security that even third\n    *   party apps on the same domain also cannot communicate\n    *   with this app by default.\n    * For use with ext-xdomain-messaging.js\n    * @todo We might instead make as a user-facing preference.\n    */\n    allowedOrigins: []\n  };\n\nfunction loadSvgString (str, callback) {\n  const success = svgCanvas.setSvgString(str) !== false;\n  callback = callback || $.noop;\n  if (success) {\n    callback(true); // eslint-disable-line standard/no-callback-literal\n  } else {\n    $.alert(uiStrings.notification.errorLoadingSVG, function () {\n      callback(false); // eslint-disable-line standard/no-callback-literal\n    });\n  }\n}\n\n/**\n* EXPORTS\n*/\n\n/**\n* Store and retrieve preferences\n* @param {string} key The preference name to be retrieved or set\n* @param {string} [val] The value. If the value supplied is missing or falsey, no change to the preference will be made.\n* @returns {string} If val is missing or falsey, the value of the previously stored preference will be returned.\n* @todo Can we change setting on the jQuery namespace (onto editor) to avoid conflicts?\n* @todo Review whether any remaining existing direct references to\n*  getting curPrefs can be changed to use $.pref() getting to ensure\n*  defaultPrefs fallback (also for sake of allowInitialUserOverride); specifically, bkgd_color could be changed so that\n*  the pref dialog has a button to auto-calculate background, but otherwise uses $.pref() to be able to get default prefs\n*  or overridable settings\n*/\n$.pref = function (key, val) {\n  if (val) {\n    curPrefs[key] = val;\n    editor.curPrefs = curPrefs; // Update exported value\n    return;\n  }\n  return (key in curPrefs) ? curPrefs[key] : defaultPrefs[key];\n};\n\n/**\n* EDITOR PUBLIC METHODS\n* @todo Sort these methods per invocation order, ideally with init at the end\n* @todo Prevent execution until init executes if dependent on it?\n*/\neditor.putLocale = putLocale;\neditor.readLang = readLang;\n\n/**\n* Where permitted, sets canvas and/or defaultPrefs based on previous\n*  storage. This will override URL settings (for security reasons) but\n*  not `svgedit-config-iife.js` configuration (unless initial user\n*  overriding is explicitly permitted there via `allowInitialUserOverride`).\n* @todo Split `allowInitialUserOverride` into `allowOverrideByURL` and\n*  `allowOverrideByUserStorage` so `svgedit-config-iife.js` can disallow some\n*  individual items for URL setting but allow for user storage AND/OR\n*  change URL setting so that it always uses a different namespace,\n*  so it won't affect pre-existing user storage (but then if users saves\n*  that, it will then be subject to tampering\n*/\neditor.loadContentAndPrefs = function () {\n  if (!curConfig.forceStorage &&\n    (curConfig.noStorageOnLoad ||\n        !document.cookie.match(/(?:^|;\\s*)store=(?:prefsAndContent|prefsOnly)/)\n    )\n  ) {\n    return;\n  }\n\n  // LOAD CONTENT\n  if (editor.storage && // Cookies do not have enough available memory to hold large documents\n    (curConfig.forceStorage ||\n      (!curConfig.noStorageOnLoad &&\n        document.cookie.match(/(?:^|;\\s*)store=prefsAndContent/))\n    )\n  ) {\n    const name = 'svgedit-' + curConfig.canvasName;\n    const cached = editor.storage.getItem(name);\n    if (cached) {\n      editor.loadFromString(cached);\n    }\n  }\n\n  // LOAD PREFS\n  for (const key in defaultPrefs) {\n    if (defaultPrefs.hasOwnProperty(key)) { // It's our own config, so we don't need to iterate up the prototype chain\n      const storeKey = 'svg-edit-' + key;\n      if (editor.storage) {\n        const val = editor.storage.getItem(storeKey);\n        if (val) {\n          defaultPrefs[key] = String(val); // Convert to string for FF (.value fails in Webkit)\n        }\n      } else if (window.widget) {\n        defaultPrefs[key] = window.widget.preferenceForKey(storeKey);\n      } else {\n        const result = document.cookie.match(new RegExp('(?:^|;\\\\s*)' + Utils.regexEscape(encodeURIComponent(storeKey)) + '=([^;]+)'));\n        defaultPrefs[key] = result ? decodeURIComponent(result[1]) : '';\n      }\n    }\n  }\n};\n\n/**\n* Allows setting of preferences or configuration (including extensions).\n* @param {Object} opts The preferences or configuration (including extensions)\n* @param {Object} [cfgCfg] Describes configuration which applies to the\n*    particular batch of supplied options\n* @param {boolean} [cfgCfg.allowInitialUserOverride=false] Set to true if you wish\n*  to allow initial overriding of settings by the user via the URL\n*  (if permitted) or previously stored preferences (if permitted);\n*  note that it will be too late if you make such calls in extension\n*  code because the URL or preference storage settings will\n*   have already taken place.\n* @param {boolean} [cfgCfg.overwrite=true] Set to false if you wish to\n*  prevent the overwriting of prior-set preferences or configuration\n*  (URL settings will always follow this requirement for security\n*  reasons, so `svgedit-config-iife.js` settings cannot be overridden unless it\n*  explicitly permits via `allowInitialUserOverride` but extension config\n*  can be overridden as they will run after URL settings). Should\n*   not be needed in `svgedit-config-iife.js`.\n*/\neditor.setConfig = function (opts, cfgCfg) {\n  cfgCfg = cfgCfg || {};\n  function extendOrAdd (cfgObj, key, val) {\n    if (cfgObj[key] && typeof cfgObj[key] === 'object') {\n      $.extend(true, cfgObj[key], val);\n    } else {\n      cfgObj[key] = val;\n    }\n  }\n  $.each(opts, function (key, val) {\n    if (opts.hasOwnProperty(key)) {\n      // Only allow prefs defined in defaultPrefs\n      if (defaultPrefs.hasOwnProperty(key)) {\n        if (cfgCfg.overwrite === false && (\n          curConfig.preventAllURLConfig ||\n          curPrefs.hasOwnProperty(key)\n        )) {\n          return;\n        }\n        if (cfgCfg.allowInitialUserOverride === true) {\n          defaultPrefs[key] = val;\n        } else {\n          $.pref(key, val);\n        }\n      } else if (['extensions', 'stylesheets', 'allowedOrigins'].includes(key)) {\n        if (cfgCfg.overwrite === false &&\n          (\n            curConfig.preventAllURLConfig ||\n            ['allowedOrigins', 'stylesheets'].includes(key) ||\n            (key === 'extensions' && curConfig.lockExtensions)\n          )\n        ) {\n          return;\n        }\n        curConfig[key] = curConfig[key].concat(val); // We will handle any dupes later\n      // Only allow other curConfig if defined in defaultConfig\n      } else if (defaultConfig.hasOwnProperty(key)) {\n        if (cfgCfg.overwrite === false && (\n          curConfig.preventAllURLConfig ||\n          curConfig.hasOwnProperty(key)\n        )) {\n          return;\n        }\n        // Potentially overwriting of previously set config\n        if (curConfig.hasOwnProperty(key)) {\n          if (cfgCfg.overwrite === false) {\n            return;\n          }\n          extendOrAdd(curConfig, key, val);\n        } else {\n          if (cfgCfg.allowInitialUserOverride === true) {\n            extendOrAdd(defaultConfig, key, val);\n          } else {\n            if (defaultConfig[key] && typeof defaultConfig[key] === 'object') {\n              curConfig[key] = {};\n              $.extend(true, curConfig[key], val); // Merge properties recursively, e.g., on initFill, initStroke objects\n            } else {\n              curConfig[key] = val;\n            }\n          }\n        }\n      }\n    }\n  });\n  editor.curConfig = curConfig; // Update exported value\n};\n\n/**\n* @param {Object} opts Extension mechanisms may call setCustomHandlers with three functions: opts.open, opts.save, and opts.exportImage\n* opts.open's responsibilities are:\n*  - invoke a file chooser dialog in 'open' mode\n*  - let user pick a SVG file\n*  - calls svgCanvas.setSvgString() with the string contents of that file\n*  opts.save's responsibilities are:\n*  - accept the string contents of the current document\n*  - invoke a file chooser dialog in 'save' mode\n*  - save the file to location chosen by the user\n*  opts.exportImage's responsibilities (with regard to the object it is supplied in its 2nd argument) are:\n*  - inform user of any issues supplied via the \"issues\" property\n*  - convert the \"svg\" property SVG string into an image for export;\n*    utilize the properties \"type\" (currently 'PNG', 'JPEG', 'BMP',\n*    'WEBP', 'PDF'), \"mimeType\", and \"quality\" (for 'JPEG' and 'WEBP'\n*    types) to determine the proper output.\n*/\neditor.setCustomHandlers = function (opts) {\n  editor.ready(function () {\n    if (opts.open) {\n      $('#tool_open > input[type=\"file\"]').remove();\n      $('#tool_open').show();\n      svgCanvas.open = opts.open;\n    }\n    if (opts.save) {\n      editor.showSaveWarning = false;\n      svgCanvas.bind('saved', opts.save);\n    }\n    if (opts.exportImage) {\n      customExportImage = opts.exportImage;\n      svgCanvas.bind('exported', customExportImage); // canvg and our RGBColor will be available to the method\n    }\n    if (opts.exportPDF) {\n      customExportPDF = opts.exportPDF;\n      svgCanvas.bind('exportedPDF', customExportPDF); // jsPDF and our RGBColor will be available to the method\n    }\n  });\n};\n\neditor.randomizeIds = function () {\n  svgCanvas.randomizeIds(arguments);\n};\n\neditor.init = function () {\n  const modularVersion = !('svgEditor' in window) ||\n    !window.svgEditor ||\n    window.svgEditor.modules !== false;\n  if (!modularVersion) {\n    Object.assign(defaultConfig, {\n      langPath: '../dist/locale/',\n      extPath: '../dist/extensions/',\n      canvgPath: '../dist/',\n      jspdfPath: '../dist/'\n    });\n  }\n\n  // const host = location.hostname,\n  //  onWeb = host && host.includes('.');\n  // Some FF versions throw security errors here when directly accessing\n  try {\n    if ('localStorage' in window) { // && onWeb removed so Webkit works locally\n      editor.storage = localStorage;\n    }\n  } catch (err) {}\n\n  // Todo: Avoid var-defined functions and group functions together, etc. where possible\n  const goodLangs = [];\n  $('#lang_select option').each(function () {\n    goodLangs.push(this.value);\n  });\n\n  function setupCurPrefs () {\n    curPrefs = $.extend(true, {}, defaultPrefs, curPrefs); // Now safe to merge with priority for curPrefs in the event any are already set\n    // Export updated prefs\n    editor.curPrefs = curPrefs;\n  }\n  function setupCurConfig () {\n    curConfig = $.extend(true, {}, defaultConfig, curConfig); // Now safe to merge with priority for curConfig in the event any are already set\n\n    // Now deal with extensions and other array config\n    if (!curConfig.noDefaultExtensions) {\n      curConfig.extensions = curConfig.extensions.concat(defaultExtensions);\n    }\n    // ...and remove any dupes\n    $.each(['extensions', 'stylesheets', 'allowedOrigins'], function (i, cfg) {\n      curConfig[cfg] = $.grep(curConfig[cfg], function (n, i) { // Supposedly faster than filter per http://amandeep1986.blogspot.hk/2015/02/jquery-grep-vs-js-filter.html\n        return i === curConfig[cfg].indexOf(n);\n      });\n    });\n    // Export updated config\n    editor.curConfig = curConfig;\n  }\n  (() => {\n    // Load config/data from URL if given\n    let src, qstr;\n    urldata = $.deparam.querystring(true);\n    if (!$.isEmptyObject(urldata)) {\n      if (urldata.dimensions) {\n        urldata.dimensions = urldata.dimensions.split(',');\n      }\n\n      if (urldata.bkgd_color) {\n        urldata.bkgd_color = '#' + urldata.bkgd_color;\n      }\n\n      if (urldata.extensions) {\n        // For security reasons, disallow cross-domain or cross-folder extensions via URL\n        urldata.extensions = urldata.extensions.match(/[:/\\\\]/) ? '' : urldata.extensions.split(',');\n      }\n\n      // Disallowing extension paths via URL for\n      // security reasons, even for same-domain\n      // ones given potential to interact in undesirable\n      // ways with other script resources\n      $.each(\n        [\n          'extPath', 'imgPath', 'extIconsPath', 'canvgPath',\n          'langPath', 'jGraduatePath', 'jspdfPath'\n        ],\n        function (pathConfig) {\n          if (urldata[pathConfig]) {\n            delete urldata[pathConfig];\n          }\n        }\n      );\n\n      editor.setConfig(urldata, {overwrite: false}); // Note: source and url (as with storagePrompt later) are not set on config but are used below\n\n      setupCurConfig();\n\n      if (!curConfig.preventURLContentLoading) {\n        src = urldata.source;\n        qstr = $.param.querystring();\n        if (!src) { // urldata.source may have been null if it ended with '='\n          if (qstr.includes('source=data:')) {\n            src = qstr.match(/source=(data:[^&]*)/)[1];\n          }\n        }\n        if (src) {\n          if (src.startsWith('data:')) {\n            editor.loadFromDataURI(src);\n          } else {\n            editor.loadFromString(src);\n          }\n          return;\n        }\n        if (urldata.url) {\n          editor.loadFromURL(urldata.url);\n          return;\n        }\n      }\n      if (!urldata.noStorageOnLoad || curConfig.forceStorage) {\n        editor.loadContentAndPrefs();\n      }\n      setupCurPrefs();\n    } else {\n      setupCurConfig();\n      editor.loadContentAndPrefs();\n      setupCurPrefs();\n    }\n  })();\n\n  const setIcon = editor.setIcon = function (elem, iconId, forcedSize) {\n    const icon = (typeof iconId === 'string') ? $.getSvgIcon(iconId, true) : iconId.clone();\n    if (!icon) {\n      console.log('NOTE: Icon image missing: ' + iconId);\n      return;\n    }\n    $(elem).empty().append(icon);\n  };\n\n  const extFunc = async function () {\n    try {\n      await Promise.all(\n        curConfig.extensions.map(async (extname) => {\n          const extName = extname.match(/^ext-(.+)\\.js/);\n          if (!extName) { // Ensure URL cannot specify some other unintended file in the extPath\n            return;\n          }\n          const url = curConfig.extPath + extname;\n          // Todo: Replace this with `return import(url);` when\n          //   `import()` widely supported\n          const imported = await importSetGlobalDefault(url, {\n            global: 'svgEditorExtension_' + extName[1].replace(/-/g, '_')\n          });\n          const {name, init} = imported;\n          return editor.addExtension(name, (init && init.bind(editor)) || imported);\n        })\n      );\n    } catch (err) {\n      console.log(err);\n    }\n\n    // const lang = ('lang' in curPrefs) ? curPrefs.lang : null;\n    return editor.putLocale(null, goodLangs, curConfig);\n  };\n\n  const stateObj = {tool_scale: editor.tool_scale};\n\n  const setFlyoutPositions = function () {\n    $('.tools_flyout').each(function () {\n      const shower = $('#' + this.id + '_show');\n      const pos = shower.offset();\n      const w = shower.outerWidth();\n      $(this).css({left: (pos.left + w) * editor.tool_scale, top: pos.top});\n    });\n  };\n\n  const uaPrefix = (function () {\n    const regex = /^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/;\n    const someScript = document.getElementsByTagName('script')[0];\n    for (const prop in someScript.style) {\n      if (regex.test(prop)) {\n        // test is faster than match, so it's better to perform\n        // that on the lot and match only when necessary\n        return prop.match(regex)[0];\n      }\n    }\n    // Nothing found so far?\n    if ('WebkitOpacity' in someScript.style) { return 'Webkit'; }\n    if ('KhtmlOpacity' in someScript.style) { return 'Khtml'; }\n\n    return '';\n  }());\n\n  const scaleElements = function (elems, scale) {\n    // const prefix = '-' + uaPrefix.toLowerCase() + '-'; // Currently unused\n    const sides = ['top', 'left', 'bottom', 'right'];\n\n    elems.each(function () {\n      // Handled in CSS\n      // this.style[uaPrefix + 'Transform'] = 'scale(' + scale + ')';\n      const el = $(this);\n      const w = el.outerWidth() * (scale - 1);\n      const h = el.outerHeight() * (scale - 1);\n      // const margins = {}; // Currently unused\n\n      for (let i = 0; i < 4; i++) {\n        const s = sides[i];\n        let cur = el.data('orig_margin-' + s);\n        if (cur == null) {\n          cur = parseInt(el.css('margin-' + s), 10);\n          // Cache the original margin\n          el.data('orig_margin-' + s, cur);\n        }\n        let val = cur * scale;\n        if (s === 'right') {\n          val += w;\n        } else if (s === 'bottom') {\n          val += h;\n        }\n\n        el.css('margin-' + s, val);\n        // el.css('outline', '1px solid red');\n      }\n    });\n  };\n\n  const setIconSize = editor.setIconSize = function (size) {\n    // const elems = $('.tool_button, .push_button, .tool_button_current, .disabled, .icon_label, #url_notice, #tool_open');\n    const selToscale = '#tools_top .toolset, #editor_panel > *, #history_panel > *,' +\n  '        #main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,' +\n  '        #g_panel > *, #tool_font_size > *, .tools_flyout';\n\n    const elems = $(selToscale);\n\n    let scale = 1;\n    if (typeof size === 'number') {\n      scale = size;\n    } else {\n      const iconSizes = {s: 0.75, m: 1, l: 1.25, xl: 1.5};\n      scale = iconSizes[size];\n    }\n\n    stateObj.tool_scale = editor.tool_scale = scale;\n\n    setFlyoutPositions();\n    // $('.tools_flyout').each(function () {\n    //   const pos = $(this).position();\n    //   console.log($(this), pos.left+(34 * scale));\n    //   $(this).css({left: pos.left+(34 * scale), top: pos.top+(77 * scale)});\n    //   console.log('l', $(this).css('left'));\n    // });\n    //\n    // const scale = .75;\n\n    const hiddenPs = elems.parents(':hidden');\n    hiddenPs.css('visibility', 'hidden').show();\n    scaleElements(elems, scale);\n    hiddenPs.css('visibility', 'visible').hide();\n    // return;\n\n    $.pref('iconsize', size);\n    $('#iconsize').val(size);\n\n    // Change icon size\n    // $('.tool_button, .push_button, .tool_button_current, .disabled, .icon_label, #url_notice, #tool_open')\n    // .find('> svg, > img').each(function () {\n    //   this.setAttribute('width',size_num);\n    //   this.setAttribute('height',size_num);\n    // });\n    //\n    // $.resizeSvgIcons({\n    //   '.flyout_arrow_horiz > svg, .flyout_arrow_horiz > img': size_num / 5,\n    //   '#logo > svg, #logo > img': size_num * 1.3,\n    //   '#tools_bottom .icon_label > *': (size_num === 16 ? 18 : size_num * .75)\n    // });\n    // if (size != 's') {\n    //   $.resizeSvgIcons({'#layerbuttons svg, #layerbuttons img': size_num * .6});\n    // }\n\n    // Note that all rules will be prefixed with '#svg_editor' when parsed\n    const cssResizeRules = {\n      // '.tool_button,\\\n      // .push_button,\\\n      // .tool_button_current,\\\n      // .push_button_pressed,\\\n      // .disabled,\\\n      // .icon_label,\\\n      // .tools_flyout .tool_button': {\n      //   width: {s: '16px', l: '32px', xl: '48px'},\n      //   height: {s: '16px', l: '32px', xl: '48px'},\n      //   padding: {s: '1px', l: '2px', xl: '3px'}\n      // },\n      // '.tool_sep': {\n      //   height: {s: '16px', l: '32px', xl: '48px'},\n      //   margin: {s: '2px 2px', l: '2px 5px', xl: '2px 8px'}\n      // },\n      // '#main_icon': {\n      //   width: {s: '31px', l: '53px', xl: '75px'},\n      //   height: {s: '22px', l: '42px', xl: '64px'}\n      // },\n      '#tools_top': {\n        left: 50 + $('#main_button').width(),\n        height: 72\n      },\n      '#tools_left': {\n        width: 31,\n        top: 74\n      },\n      'div#workarea': {\n        left: 38,\n        top: 74\n      }\n      // '#tools_bottom': {\n      //   left: {s: '27px', l: '46px', xl: '65px'},\n      //   height: {s: '58px', l: '98px', xl: '145px'}\n      // },\n      // '#color_tools': {\n      //   'border-spacing': {s: '0 1px'},\n      //   'margin-top': {s: '-1px'}\n      // },\n      // '#color_tools .icon_label': {\n      //   width: {l:'43px', xl: '60px'}\n      // },\n      // '.color_tool': {\n      //   height: {s: '20px'}\n      // },\n      // '#tool_opacity': {\n      //   top: {s: '1px'},\n      //   height: {s: 'auto', l:'auto', xl:'auto'}\n      // },\n      // '#tools_top input, #tools_bottom input': {\n      //   'margin-top': {s: '2px', l: '4px', xl: '5px'},\n      //   height: {s: 'auto', l: 'auto', xl: 'auto'},\n      //   border: {s: '1px solid #555', l: 'auto', xl: 'auto'},\n      //   'font-size': {s: '.9em', l: '1.2em', xl: '1.4em'}\n      // },\n      // '#zoom_panel': {\n      //   'margin-top': {s: '3px', l: '4px', xl: '5px'}\n      // },\n      // '#copyright, #tools_bottom .label': {\n      //   'font-size': {l: '1.5em', xl: '2em'},\n      //   'line-height': {s: '15px'}\n      // },\n      // '#tools_bottom_2': {\n      //   width: {l: '295px', xl: '355px'},\n      //   top: {s: '4px'}\n      // },\n      // '#tools_top > div, #tools_top': {\n      //   'line-height': {s: '17px', l: '34px', xl: '50px'}\n      // },\n      // '.dropdown button': {\n      //   height: {s: '18px', l: '34px', xl: '40px'},\n      //   'line-height': {s: '18px', l: '34px', xl: '40px'},\n      //   'margin-top': {s: '3px'}\n      // },\n      // '#tools_top label, #tools_bottom label': {\n      //   'font-size': {s: '1em', l: '1.5em', xl: '2em'},\n      //   height: {s: '25px', l: '42px', xl: '64px'}\n      // },\n      // 'div.toolset': {\n      //   height: {s: '25px', l: '42px', xl: '64px'}\n      // },\n      // '#tool_bold, #tool_italic': {\n      //   'font-size': {s: '1.5em', l: '3em', xl: '4.5em'}\n      // },\n      // '#sidepanels': {\n      //   top: {s: '50px', l: '88px', xl: '125px'},\n      //   bottom: {s: '51px', l: '68px', xl: '65px'}\n      // },\n      // '#layerbuttons': {\n      //   width: {l: '130px', xl: '175px'},\n      //   height: {l: '24px', xl: '30px'}\n      // },\n      // '#layerlist': {\n      //   width: {l: '128px', xl: '150px'}\n      // },\n      // '.layer_button': {\n      //   width: {l: '19px', xl: '28px'},\n      //   height: {l: '19px', xl: '28px'}\n      // },\n      // 'input.spin-button': {\n      //   'background-image': {l: 'url('images/spinbtn_updn_big.png')', xl: 'url('images/spinbtn_updn_big.png')'},\n      //   'background-position': {l: '100% -5px', xl: '100% -2px'},\n      //   'padding-right': {l: '24px', xl: '24px' }\n      // },\n      // 'input.spin-button.up': {\n      //   'background-position': {l: '100% -45px', xl: '100% -42px'}\n      // },\n      // 'input.spin-button.down': {\n      //   'background-position': {l: '100% -85px', xl: '100% -82px'}\n      // },\n      // '#position_opts': {\n      //   width: {all: (size_num*4) +'px'}\n      // }\n    };\n\n    let ruleElem = $('#tool_size_rules');\n    if (!ruleElem.length) {\n      ruleElem = $('<style id=\"tool_size_rules\"></style>').appendTo('head');\n    } else {\n      ruleElem.empty();\n    }\n\n    if (size !== 'm') {\n      let styleStr = '';\n      $.each(cssResizeRules, function (selector, rules) {\n        selector = '#svg_editor ' + selector.replace(/,/g, ', #svg_editor');\n        styleStr += selector + '{';\n        $.each(rules, function (prop, values) {\n          let val;\n          if (typeof values === 'number') {\n            val = (values * scale) + 'px';\n          } else if (values[size] || values.all) {\n            val = (values[size] || values.all);\n          }\n          styleStr += (prop + ':' + val + ';');\n        });\n        styleStr += '}';\n      });\n      // this.style[uaPrefix + 'Transform'] = 'scale(' + scale + ')';\n      const prefix = '-' + uaPrefix.toLowerCase() + '-';\n      styleStr += (selToscale + '{' + prefix + 'transform: scale(' + scale + ');}' +\n        ' #svg_editor div.toolset .toolset {' + prefix + 'transform: scale(1); margin: 1px !important;}' + // Hack for markers\n        ' #svg_editor .ui-slider {' + prefix + 'transform: scale(' + (1 / scale) + ');}' // Hack for sliders\n      );\n      ruleElem.text(styleStr);\n    }\n\n    setFlyoutPositions();\n  };\n  $.svgIcons(curConfig.imgPath + 'svg_edit_icons.svg', {\n    w: 24, h: 24,\n    id_match: false,\n    no_img: !isWebkit(), // Opera & Firefox 4 gives odd behavior w/images\n    fallback_path: curConfig.imgPath,\n    fallback: {\n      new_image: 'clear.png',\n      save: 'save.png',\n      open: 'open.png',\n      source: 'source.png',\n      docprops: 'document-properties.png',\n      wireframe: 'wireframe.png',\n\n      undo: 'undo.png',\n      redo: 'redo.png',\n\n      select: 'select.png',\n      select_node: 'select_node.png',\n      pencil: 'fhpath.png',\n      pen: 'line.png',\n      square: 'square.png',\n      rect: 'rect.png',\n      fh_rect: 'freehand-square.png',\n      circle: 'circle.png',\n      ellipse: 'ellipse.png',\n      fh_ellipse: 'freehand-circle.png',\n      path: 'path.png',\n      text: 'text.png',\n      image: 'image.png',\n      zoom: 'zoom.png',\n\n      clone: 'clone.png',\n      node_clone: 'node_clone.png',\n      delete: 'delete.png',\n      node_delete: 'node_delete.png',\n      group: 'shape_group_elements.png',\n      ungroup: 'shape_ungroup.png',\n      move_top: 'move_top.png',\n      move_bottom: 'move_bottom.png',\n      to_path: 'to_path.png',\n      link_controls: 'link_controls.png',\n      reorient: 'reorient.png',\n\n      align_left: 'align-left.png',\n      align_center: 'align-center.png',\n      align_right: 'align-right.png',\n      align_top: 'align-top.png',\n      align_middle: 'align-middle.png',\n      align_bottom: 'align-bottom.png',\n\n      go_up: 'go-up.png',\n      go_down: 'go-down.png',\n\n      ok: 'save.png',\n      cancel: 'cancel.png',\n\n      arrow_right: 'flyouth.png',\n      arrow_down: 'dropdown.gif'\n    },\n    placement: {\n      '#logo': 'logo',\n\n      '#tool_clear div,#layer_new': 'new_image',\n      '#tool_save div': 'save',\n      '#tool_export div': 'export',\n      '#tool_open div div': 'open',\n      '#tool_import div div': 'import',\n      '#tool_source': 'source',\n      '#tool_docprops > div': 'docprops',\n      '#tool_wireframe': 'wireframe',\n\n      '#tool_undo': 'undo',\n      '#tool_redo': 'redo',\n\n      '#tool_select': 'select',\n      '#tool_fhpath': 'pencil',\n      '#tool_line': 'pen',\n      '#tool_rect,#tools_rect_show': 'rect',\n      '#tool_square': 'square',\n      '#tool_fhrect': 'fh_rect',\n      '#tool_ellipse,#tools_ellipse_show': 'ellipse',\n      '#tool_circle': 'circle',\n      '#tool_fhellipse': 'fh_ellipse',\n      '#tool_path': 'path',\n      '#tool_text,#layer_rename': 'text',\n      '#tool_image': 'image',\n      '#tool_zoom': 'zoom',\n\n      '#tool_clone,#tool_clone_multi': 'clone',\n      '#tool_node_clone': 'node_clone',\n      '#layer_delete,#tool_delete,#tool_delete_multi': 'delete',\n      '#tool_node_delete': 'node_delete',\n      '#tool_add_subpath': 'add_subpath',\n      '#tool_openclose_path': 'open_path',\n      '#tool_move_top': 'move_top',\n      '#tool_move_bottom': 'move_bottom',\n      '#tool_topath': 'to_path',\n      '#tool_node_link': 'link_controls',\n      '#tool_reorient': 'reorient',\n      '#tool_group_elements': 'group_elements',\n      '#tool_ungroup': 'ungroup',\n      '#tool_unlink_use': 'unlink_use',\n\n      '#tool_alignleft, #tool_posleft': 'align_left',\n      '#tool_aligncenter, #tool_poscenter': 'align_center',\n      '#tool_alignright, #tool_posright': 'align_right',\n      '#tool_aligntop, #tool_postop': 'align_top',\n      '#tool_alignmiddle, #tool_posmiddle': 'align_middle',\n      '#tool_alignbottom, #tool_posbottom': 'align_bottom',\n      '#cur_position': 'align',\n\n      '#linecap_butt,#cur_linecap': 'linecap_butt',\n      '#linecap_round': 'linecap_round',\n      '#linecap_square': 'linecap_square',\n\n      '#linejoin_miter,#cur_linejoin': 'linejoin_miter',\n      '#linejoin_round': 'linejoin_round',\n      '#linejoin_bevel': 'linejoin_bevel',\n\n      '#url_notice': 'warning',\n\n      '#layer_up': 'go_up',\n      '#layer_down': 'go_down',\n      '#layer_moreopts': 'context_menu',\n      '#layerlist td.layervis': 'eye',\n\n      '#tool_source_save,#tool_docprops_save,#tool_prefs_save': 'ok',\n      '#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel': 'cancel',\n\n      '#rwidthLabel, #iwidthLabel': 'width',\n      '#rheightLabel, #iheightLabel': 'height',\n      '#cornerRadiusLabel span': 'c_radius',\n      '#angleLabel': 'angle',\n      '#linkLabel,#tool_make_link,#tool_make_link_multi': 'globe_link',\n      '#zoomLabel': 'zoom',\n      '#tool_fill label': 'fill',\n      '#tool_stroke .icon_label': 'stroke',\n      '#group_opacityLabel': 'opacity',\n      '#blurLabel': 'blur',\n      '#font_sizeLabel': 'fontsize',\n\n      '.flyout_arrow_horiz': 'arrow_right',\n      '.dropdown button, #main_button .dropdown': 'arrow_down',\n      '#palette .palette_item:first, #fill_bg, #stroke_bg': 'no_color'\n    },\n    resize: {\n      '#logo .svg_icon': 28,\n      '.flyout_arrow_horiz .svg_icon': 5,\n      '.layer_button .svg_icon, #layerlist td.layervis .svg_icon': 14,\n      '.dropdown button .svg_icon': 7,\n      '#main_button .dropdown .svg_icon': 9,\n      '.palette_item:first .svg_icon': 15,\n      '#fill_bg .svg_icon, #stroke_bg .svg_icon': 16,\n      '.toolbar_button button .svg_icon': 16,\n      '.stroke_tool div div .svg_icon': 20,\n      '#tools_bottom label .svg_icon': 18\n    },\n    callback (icons) {\n      $('.toolbar_button button > svg, .toolbar_button button > img').each(function () {\n        $(this).parent().prepend(this);\n      });\n\n      const tleft = $('#tools_left');\n\n      let minHeight;\n      if (tleft.length) {\n        minHeight = tleft.offset().top + tleft.outerHeight();\n      }\n\n      const size = $.pref('iconsize');\n      editor.setIconSize(size || ($(window).height() < minHeight ? 's' : 'm'));\n\n      // Look for any missing flyout icons from plugins\n      $('.tools_flyout').each(function () {\n        const shower = $('#' + this.id + '_show');\n        const sel = shower.attr('data-curopt');\n        // Check if there's an icon here\n        if (!shower.children('svg, img').length) {\n          const clone = $(sel).children().clone();\n          if (clone.length) {\n            clone[0].removeAttribute('style'); // Needed for Opera\n            shower.append(clone);\n          }\n        }\n      });\n\n      function getStylesheetPriority (stylesheet) {\n        switch (stylesheet) {\n        case 'jgraduate/css/jPicker.css':\n          return 1;\n        case 'jgraduate/css/jgraduate.css':\n          return 2;\n        case 'svg-editor.css':\n          return 3;\n        case 'spinbtn/JQuerySpinBtn.css':\n          return 4;\n        default:\n          return Infinity;\n        }\n      }\n      let stylesheets = $.loadingStylesheets.sort((a, b) => {\n        const priorityA = getStylesheetPriority(a);\n        const priorityB = getStylesheetPriority(b);\n        if (priorityA === priorityB) {\n          return 0;\n        }\n        return priorityA > priorityB;\n      });\n      if (curConfig.stylesheets.length) {\n        // Ensure a copy with unique items\n        stylesheets = [...new Set(curConfig.stylesheets)];\n        const idx = stylesheets.indexOf('@default');\n        if (idx > -1) {\n          stylesheets.splice(idx, 1, ...$.loadingStylesheets);\n        }\n      }\n      loadStylesheets(stylesheets, {acceptErrors: ({stylesheetURL, reject, resolve}) => {\n        if ($.loadingStylesheets.includes(stylesheetURL)) {\n          reject(new Error(`Missing expected stylesheet: ${stylesheetURL}`));\n          return;\n        }\n        resolve();\n      }}).then(() => {\n        $('#svg_container')[0].style.visibility = 'visible';\n        editor.runCallbacks();\n\n        setTimeout(function () {\n          $('.flyout_arrow_horiz:empty').each(function () {\n            $(this).append($.getSvgIcon('arrow_right').width(5).height(5));\n          });\n        }, 1);\n      });\n    }\n  });\n\n  editor.canvas = svgCanvas = new SvgCanvas(\n    document.getElementById('svgcanvas'),\n    curConfig\n  );\n  const palette = [ // Todo: Make into configuration item?\n      '#000000', '#3f3f3f', '#7f7f7f', '#bfbfbf', '#ffffff',\n      '#ff0000', '#ff7f00', '#ffff00', '#7fff00',\n      '#00ff00', '#00ff7f', '#00ffff', '#007fff',\n      '#0000ff', '#7f00ff', '#ff00ff', '#ff007f',\n      '#7f0000', '#7f3f00', '#7f7f00', '#3f7f00',\n      '#007f00', '#007f3f', '#007f7f', '#003f7f',\n      '#00007f', '#3f007f', '#7f007f', '#7f003f',\n      '#ffaaaa', '#ffd4aa', '#ffffaa', '#d4ffaa',\n      '#aaffaa', '#aaffd4', '#aaffff', '#aad4ff',\n      '#aaaaff', '#d4aaff', '#ffaaff', '#ffaad4'\n    ],\n    modKey = (isMac() ? 'meta+' : 'ctrl+'), // ⌘\n    path = svgCanvas.pathActions,\n    {undoMgr} = svgCanvas,\n    workarea = $('#workarea'),\n    canvMenu = $('#cmenu_canvas'),\n    // layerMenu = $('#cmenu_layers'), // Unused\n    paintBox = {fill: null, stroke: null};\n\n  let resizeTimer, curScrollPos;\n  let exportWindow = null,\n    defaultImageURL = curConfig.imgPath + 'logo.png',\n    zoomInIcon = 'crosshair',\n    zoomOutIcon = 'crosshair',\n    uiContext = 'toolbars';\n\n  // For external openers\n  (function () {\n    // let the opener know SVG Edit is ready (now that config is set up)\n    const w = window.opener || window.parent;\n    let svgEditorReadyEvent;\n    if (w) {\n      try {\n        svgEditorReadyEvent = w.document.createEvent('Event');\n        svgEditorReadyEvent.initEvent('svgEditorReady', true, true);\n        w.document.documentElement.dispatchEvent(svgEditorReadyEvent);\n      } catch (e) {}\n    }\n  }());\n\n  // This sets up alternative dialog boxes. They mostly work the same way as\n  // their UI counterparts, expect instead of returning the result, a callback\n  // needs to be included that returns the result as its first parameter.\n  // In the future we may want to add additional types of dialog boxes, since\n  // they should be easy to handle this way.\n  (function () {\n    $('#dialog_container').draggable({\n      cancel: '#dialog_content, #dialog_buttons *',\n      containment: 'window'\n    }).css('position', 'absolute');\n    const box = $('#dialog_box'),\n      btnHolder = $('#dialog_buttons'),\n      dialogContent = $('#dialog_content'),\n      dbox = function (type, msg, callback, defaultVal, opts, changeCb, checkbox) {\n        dialogContent.html('<p>' + msg.replace(/\\n/g, '</p><p>') + '</p>')\n          .toggleClass('prompt', (type === 'prompt'));\n        btnHolder.empty();\n\n        const ok = $('<input type=\"button\" value=\"' + uiStrings.common.ok + '\">').appendTo(btnHolder);\n\n        if (type !== 'alert') {\n          $('<input type=\"button\" value=\"' + uiStrings.common.cancel + '\">')\n            .appendTo(btnHolder)\n            .click(function () {\n              box.hide();\n              if (callback) {\n                callback(false); // eslint-disable-line standard/no-callback-literal\n              }\n            });\n        }\n\n        let ctrl, chkbx;\n        if (type === 'prompt') {\n          ctrl = $('<input type=\"text\">').prependTo(btnHolder);\n          ctrl.val(defaultVal || '');\n          ctrl.bind('keydown', 'return', function () { ok.click(); });\n        } else if (type === 'select') {\n          const div = $('<div style=\"text-align:center;\">');\n          ctrl = $('<select>').appendTo(div);\n          if (checkbox) {\n            const label = $('<label>').text(checkbox.label);\n            chkbx = $('<input type=\"checkbox\">').appendTo(label);\n            chkbx.val(checkbox.value);\n            if (checkbox.tooltip) {\n              label.attr('title', checkbox.tooltip);\n            }\n            chkbx.prop('checked', !!checkbox.checked);\n            div.append($('<div>').append(label));\n          }\n          $.each(opts || [], function (opt, val) {\n            if (typeof val === 'object') {\n              ctrl.append($('<option>').val(val.value).html(val.text));\n            } else {\n              ctrl.append($('<option>').html(val));\n            }\n          });\n          dialogContent.append(div);\n          if (defaultVal) {\n            ctrl.val(defaultVal);\n          }\n          if (changeCb) {\n            ctrl.bind('change', 'return', changeCb);\n          }\n          ctrl.bind('keydown', 'return', function () { ok.click(); });\n        } else if (type === 'process') {\n          ok.hide();\n        }\n\n        box.show();\n\n        ok.click(function () {\n          box.hide();\n          const resp = (type === 'prompt' || type === 'select') ? ctrl.val() : true;\n          if (callback) {\n            if (chkbx) {\n              callback(resp, chkbx.prop('checked'));\n            } else {\n              callback(resp);\n            }\n          }\n        }).focus();\n\n        if (type === 'prompt' || type === 'select') {\n          ctrl.focus();\n        }\n      };\n\n    $.alert = function (msg, cb) { dbox('alert', msg, cb); };\n    $.confirm = function (msg, cb) { dbox('confirm', msg, cb); };\n    $.process_cancel = function (msg, cb) { dbox('process', msg, cb); };\n    $.prompt = function (msg, txt, cb) { dbox('prompt', msg, cb, txt); };\n    $.select = function (msg, opts, cb, changeCb, txt, checkbox) { dbox('select', msg, cb, txt, opts, changeCb, checkbox); };\n  }());\n\n  const setSelectMode = function () {\n    const curr = $('.tool_button_current');\n    if (curr.length && curr[0].id !== 'tool_select') {\n      curr.removeClass('tool_button_current').addClass('tool_button');\n      $('#tool_select').addClass('tool_button_current').removeClass('tool_button');\n      $('#styleoverrides').text('#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}');\n    }\n    svgCanvas.setMode('select');\n    workarea.css('cursor', 'auto');\n  };\n\n  // used to make the flyouts stay on the screen longer the very first time\n  // const flyoutspeed = 1250; // Currently unused\n  // let textBeingEntered = false; // Currently unused\n  const origTitle = $('title:first').text();\n  // Make [1,2,5] array\n  const rIntervals = [];\n  for (let i = 0.1; i < 1E5; i *= 10) {\n    rIntervals.push(i);\n    rIntervals.push(2 * i);\n    rIntervals.push(5 * i);\n  }\n\n  // This function highlights the layer passed in (by fading out the other layers)\n  // if no layer is passed in, this function restores the other layers\n  const toggleHighlightLayer = function (layerNameToHighlight) {\n    let i;\n    const curNames = [], numLayers = svgCanvas.getCurrentDrawing().getNumLayers();\n    for (i = 0; i < numLayers; i++) {\n      curNames[i] = svgCanvas.getCurrentDrawing().getLayerName(i);\n    }\n\n    if (layerNameToHighlight) {\n      for (i = 0; i < numLayers; ++i) {\n        if (curNames[i] !== layerNameToHighlight) {\n          svgCanvas.getCurrentDrawing().setLayerOpacity(curNames[i], 0.5);\n        }\n      }\n    } else {\n      for (i = 0; i < numLayers; ++i) {\n        svgCanvas.getCurrentDrawing().setLayerOpacity(curNames[i], 1.0);\n      }\n    }\n  };\n\n  const populateLayers = function () {\n    svgCanvas.clearSelection();\n    const layerlist = $('#layerlist tbody').empty();\n    const selLayerNames = $('#selLayerNames').empty();\n    const drawing = svgCanvas.getCurrentDrawing();\n    const currentLayerName = drawing.getCurrentLayerName();\n    const icon = $.getSvgIcon('eye');\n    let layer = svgCanvas.getCurrentDrawing().getNumLayers();\n    // we get the layers in the reverse z-order (the layer rendered on top is listed first)\n    while (layer--) {\n      const name = drawing.getLayerName(layer);\n      const layerTr = $('<tr class=\"layer\">').toggleClass('layersel', name === currentLayerName);\n      const layerVis = $('<td class=\"layervis\">').toggleClass('layerinvis', !drawing.getLayerVisibility(name));\n      const layerName = $('<td class=\"layername\">' + name + '</td>');\n      layerlist.append(layerTr.append(layerVis, layerName));\n      selLayerNames.append('<option value=\"' + name + '\">' + name + '</option>');\n    }\n    if (icon !== undefined) {\n      const copy = icon.clone();\n      $('td.layervis', layerlist).append(copy);\n      $.resizeSvgIcons({'td.layervis .svg_icon': 14});\n    }\n    // handle selection of layer\n    $('#layerlist td.layername')\n      .mouseup(function (evt) {\n        $('#layerlist tr.layer').removeClass('layersel');\n        $(this.parentNode).addClass('layersel');\n        svgCanvas.setCurrentLayer(this.textContent);\n        evt.preventDefault();\n      })\n      .mouseover(function () {\n        toggleHighlightLayer(this.textContent);\n      })\n      .mouseout(function () {\n        toggleHighlightLayer();\n      });\n    $('#layerlist td.layervis').click(function () {\n      const row = $(this.parentNode).prevAll().length;\n      const name = $('#layerlist tr.layer:eq(' + row + ') td.layername').text();\n      const vis = $(this).hasClass('layerinvis');\n      svgCanvas.setLayerVisibility(name, vis);\n      $(this).toggleClass('layerinvis');\n    });\n\n    // if there were too few rows, let's add a few to make it not so lonely\n    let num = 5 - $('#layerlist tr.layer').size();\n    while (num-- > 0) {\n      // FIXME: there must a better way to do this\n      layerlist.append('<tr><td style=\"color:white\">_</td><td/></tr>');\n    }\n  };\n\n  let editingsource = false;\n  let origSource = '';\n  const showSourceEditor = function (e, forSaving) {\n    if (editingsource) { return; }\n\n    editingsource = true;\n    origSource = svgCanvas.getSvgString();\n    $('#save_output_btns').toggle(!!forSaving);\n    $('#tool_source_back').toggle(!forSaving);\n    $('#svg_source_textarea').val(origSource);\n    $('#svg_source_editor').fadeIn();\n    $('#svg_source_textarea').focus();\n  };\n\n  let selectedElement = null;\n  let multiselected = false;\n\n  const togglePathEditMode = function (editmode, elems) {\n    $('#path_node_panel').toggle(editmode);\n    $('#tools_bottom_2,#tools_bottom_3').toggle(!editmode);\n    if (editmode) {\n      // Change select icon\n      $('.tool_button_current').removeClass('tool_button_current').addClass('tool_button');\n      $('#tool_select').addClass('tool_button_current').removeClass('tool_button');\n      setIcon('#tool_select', 'select_node');\n      multiselected = false;\n      if (elems.length) {\n        selectedElement = elems[0];\n      }\n    } else {\n      setTimeout(() => {\n        setIcon('#tool_select', 'select');\n      }, 1000);\n    }\n  };\n\n  const saveHandler = function (wind, svg) {\n    editor.showSaveWarning = false;\n\n    // by default, we add the XML prolog back, systems integrating SVG-edit (wikis, CMSs)\n    // can just provide their own custom save handler and might not want the XML prolog\n    svg = '<?xml version=\"1.0\"?>\\n' + svg;\n\n    // IE9 doesn't allow standalone Data URLs\n    // https://connect.microsoft.com/IE/feedback/details/542600/data-uri-images-fail-when-loaded-by-themselves\n    if (isIE()) {\n      showSourceEditor(0, true);\n      return;\n    }\n\n    // Since saving SVGs by opening a new window was removed in Chrome use artificial link-click\n    // https://stackoverflow.com/questions/45603201/window-is-not-allowed-to-navigate-top-frame-navigations-to-data-urls\n    const a = document.createElement('a');\n    a.href = 'data:image/svg+xml;base64,' + Utils.encode64(svg);\n    a.download = 'icon.svg';\n\n    a.click();\n\n    // Alert will only appear the first time saved OR the\n    //   first time the bug is encountered\n    let done = $.pref('save_notice_done');\n    if (done !== 'all') {\n      let note = uiStrings.notification.saveFromBrowser.replace('%s', 'SVG');\n      // Check if FF and has <defs/>\n      if (isGecko()) {\n        if (svg.includes('<defs')) {\n          // warning about Mozilla bug #308590 when applicable (seems to be fixed now in Feb 2013)\n          note += '\\n\\n' + uiStrings.notification.defsFailOnSave;\n          $.pref('save_notice_done', 'all');\n          done = 'all';\n        } else {\n          $.pref('save_notice_done', 'part');\n        }\n      } else {\n        $.pref('save_notice_done', 'all');\n      }\n      if (done !== 'part') {\n        alert(note);\n      }\n    }\n  };\n\n  const exportHandler = function (win, data) {\n    const {issues, exportWindowName} = data;\n\n    if (exportWindowName) {\n      exportWindow = window.open(Utils.blankPageObjectURL || '', exportWindowName); // A hack to get the window via JSON-able name without opening a new one\n    }\n\n    if (!exportWindow || exportWindow.closed) {\n      $.alert(uiStrings.notification.popupWindowBlocked);\n      return;\n    }\n\n    exportWindow.location.href = data.bloburl || data.datauri;\n    const done = $.pref('export_notice_done');\n    if (done !== 'all') {\n      let note = uiStrings.notification.saveFromBrowser.replace('%s', data.type);\n\n      // Check if there are issues\n      if (issues.length) {\n        const pre = '\\n \\u2022 ';\n        note += ('\\n\\n' + uiStrings.notification.noteTheseIssues + pre + issues.join(pre));\n      }\n\n      // Note that this will also prevent the notice even though new issues may appear later.\n      // May want to find a way to deal with that without annoying the user\n      $.pref('export_notice_done', 'all');\n      exportWindow.alert(note);\n    }\n  };\n\n  const operaRepaint = function () {\n    // Repaints canvas in Opera. Needed for stroke-dasharray change as well as fill change\n    if (!window.opera) {\n      return;\n    }\n    $('<p/>').hide().appendTo('body').remove();\n  };\n\n  function setStrokeOpt (opt, changeElem) {\n    const {id} = opt;\n    const bits = id.split('_');\n    const pre = bits[0];\n    const val = bits[1];\n\n    if (changeElem) {\n      svgCanvas.setStrokeAttr('stroke-' + pre, val);\n    }\n    operaRepaint();\n    setIcon('#cur_' + pre, id, 20);\n    $(opt).addClass('current').siblings().removeClass('current');\n  }\n\n  /**\n  * This is a common function used when a tool has been clicked (chosen)\n  * It does several common things:\n  * - removes the `tool_button_current` class from whatever tool currently has it\n  * - hides any flyouts\n  * - adds the `tool_button_current` class to the button passed in\n  * @param {String|Element} button The DOM element or string selector representing the toolbar button\n  * @param {Boolean} noHiding Whether not to hide any flyouts\n  * @returns {Boolean} Whether the button was disabled or not\n  */\n  const toolButtonClick = editor.toolButtonClick = function (button, noHiding) {\n    if ($(button).hasClass('disabled')) { return false; }\n    if ($(button).parent().hasClass('tools_flyout')) { return true; }\n    const fadeFlyouts = 'normal';\n    if (!noHiding) {\n      $('.tools_flyout').fadeOut(fadeFlyouts);\n    }\n    $('#styleoverrides').text('');\n    workarea.css('cursor', 'auto');\n    $('.tool_button_current').removeClass('tool_button_current').addClass('tool_button');\n    $(button).addClass('tool_button_current').removeClass('tool_button');\n    return true;\n  };\n\n  /**\n  * Unless the select toolbar button is disabled, sets the button\n  * and sets the select mode and cursor styles.\n  */\n  const clickSelect = editor.clickSelect = function () {\n    if (toolButtonClick('#tool_select')) {\n      svgCanvas.setMode('select');\n      $('#styleoverrides').text('#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}');\n    }\n  };\n\n  /**\n  * Set a selected image's URL\n  * @param {String} url\n  */\n  const setImageURL = editor.setImageURL = function (url) {\n    if (!url) {\n      url = defaultImageURL;\n    }\n    svgCanvas.setImageURL(url);\n    $('#image_url').val(url);\n\n    if (url.startsWith('data:')) {\n      // data URI found\n      $('#image_url').hide();\n      $('#change_image_url').show();\n    } else {\n      // regular URL\n      svgCanvas.embedImage(url, function (dataURI) {\n        // Couldn't embed, so show warning\n        $('#url_notice').toggle(!dataURI);\n        defaultImageURL = url;\n      });\n      $('#image_url').show();\n      $('#change_image_url').hide();\n    }\n  };\n\n  function setBackground (color, url) {\n    // if (color == $.pref('bkgd_color') && url == $.pref('bkgd_url')) { return; }\n    $.pref('bkgd_color', color);\n    $.pref('bkgd_url', url);\n\n    // This should be done in svgcanvas.js for the borderRect fill\n    svgCanvas.setBackground(color, url);\n  }\n\n  function promptImgURL ({cancelDeletes = false} = {}) {\n    let curhref = svgCanvas.getHref(selectedElement);\n    curhref = curhref.startsWith('data:') ? '' : curhref;\n    $.prompt(uiStrings.notification.enterNewImgURL, curhref, function (url) {\n      if (url) {\n        setImageURL(url);\n      } else if (cancelDeletes) {\n        svgCanvas.deleteSelectedElements();\n      }\n    });\n  }\n\n  const setInputWidth = function (elem) {\n    const w = Math.min(Math.max(12 + elem.value.length * 6, 50), 300);\n    $(elem).width(w);\n  };\n\n  function updateRulers (scanvas, zoom) {\n    if (!zoom) { zoom = svgCanvas.getZoom(); }\n    if (!scanvas) { scanvas = $('#svgcanvas'); }\n\n    let d, i;\n    const limit = 30000;\n    const contentElem = svgCanvas.getContentElem();\n    const units = getTypeMap();\n    const unit = units[curConfig.baseUnit]; // 1 = 1px\n\n    // draw x ruler then y ruler\n    for (d = 0; d < 2; d++) {\n      const isX = (d === 0);\n      const dim = isX ? 'x' : 'y';\n      const lentype = isX ? 'width' : 'height';\n      const contentDim = Number(contentElem.getAttribute(dim));\n\n      const $hcanvOrig = $('#ruler_' + dim + ' canvas:first');\n\n      // Bit of a hack to fully clear the canvas in Safari & IE9\n      const $hcanv = $hcanvOrig.clone();\n      $hcanvOrig.replaceWith($hcanv);\n\n      const hcanv = $hcanv[0];\n\n      // Set the canvas size to the width of the container\n      let rulerLen = scanvas[lentype]();\n      const totalLen = rulerLen;\n      hcanv.parentNode.style[lentype] = totalLen + 'px';\n      let ctx = hcanv.getContext('2d');\n      let ctxArr, num, ctxArrNum;\n\n      ctx.fillStyle = 'rgb(200,0,0)';\n      ctx.fillRect(0, 0, hcanv.width, hcanv.height);\n\n      // Remove any existing canvasses\n      $hcanv.siblings().remove();\n\n      // Create multiple canvases when necessary (due to browser limits)\n      if (rulerLen >= limit) {\n        ctxArrNum = parseInt(rulerLen / limit, 10) + 1;\n        ctxArr = [];\n        ctxArr[0] = ctx;\n        let copy;\n        for (i = 1; i < ctxArrNum; i++) {\n          hcanv[lentype] = limit;\n          copy = hcanv.cloneNode(true);\n          hcanv.parentNode.append(copy);\n          ctxArr[i] = copy.getContext('2d');\n        }\n\n        copy[lentype] = rulerLen % limit;\n\n        // set copy width to last\n        rulerLen = limit;\n      }\n\n      hcanv[lentype] = rulerLen;\n\n      const uMulti = unit * zoom;\n\n      // Calculate the main number interval\n      const rawM = 50 / uMulti;\n      let multi = 1;\n      for (i = 0; i < rIntervals.length; i++) {\n        num = rIntervals[i];\n        multi = num;\n        if (rawM <= num) {\n          break;\n        }\n      }\n\n      const bigInt = multi * uMulti;\n\n      ctx.font = '9px sans-serif';\n\n      let rulerD = ((contentDim / uMulti) % multi) * uMulti;\n      let labelPos = rulerD - bigInt;\n      // draw big intervals\n      let ctxNum = 0;\n      while (rulerD < totalLen) {\n        labelPos += bigInt;\n        // const realD = rulerD - contentDim; // Currently unused\n\n        const curD = Math.round(rulerD) + 0.5;\n        if (isX) {\n          ctx.moveTo(curD, 15);\n          ctx.lineTo(curD, 0);\n        } else {\n          ctx.moveTo(15, curD);\n          ctx.lineTo(0, curD);\n        }\n\n        num = (labelPos - contentDim) / uMulti;\n        let label;\n        if (multi >= 1) {\n          label = Math.round(num);\n        } else {\n          const decs = String(multi).split('.')[1].length;\n          label = num.toFixed(decs);\n        }\n\n        // Change 1000s to Ks\n        if (label !== 0 && label !== 1000 && label % 1000 === 0) {\n          label = (label / 1000) + 'K';\n        }\n\n        if (isX) {\n          ctx.fillText(label, rulerD + 2, 8);\n        } else {\n          // draw label vertically\n          const str = String(label).split('');\n          for (i = 0; i < str.length; i++) {\n            ctx.fillText(str[i], 1, (rulerD + 9) + i * 9);\n          }\n        }\n\n        const part = bigInt / 10;\n        // draw the small intervals\n        for (i = 1; i < 10; i++) {\n          let subD = Math.round(rulerD + part * i) + 0.5;\n          if (ctxArr && subD > rulerLen) {\n            ctxNum++;\n            ctx.stroke();\n            if (ctxNum >= ctxArrNum) {\n              i = 10;\n              rulerD = totalLen;\n              continue;\n            }\n            ctx = ctxArr[ctxNum];\n            rulerD -= limit;\n            subD = Math.round(rulerD + part * i) + 0.5;\n          }\n\n          // odd lines are slighly longer\n          const lineNum = (i % 2) ? 12 : 10;\n          if (isX) {\n            ctx.moveTo(subD, 15);\n            ctx.lineTo(subD, lineNum);\n          } else {\n            ctx.moveTo(15, subD);\n            ctx.lineTo(lineNum, subD);\n          }\n        }\n        rulerD += bigInt;\n      }\n      ctx.strokeStyle = '#000';\n      ctx.stroke();\n    }\n  }\n\n  /**\n  * @param center\n  * @param newCtr\n  */\n  const updateCanvas = editor.updateCanvas = function (center, newCtr) {\n    const zoom = svgCanvas.getZoom();\n    const wArea = workarea;\n    const cnvs = $('#svgcanvas');\n\n    let w = workarea.width(), h = workarea.height();\n    const wOrig = w, hOrig = h;\n    const oldCtr = {\n      x: wArea[0].scrollLeft + wOrig / 2,\n      y: wArea[0].scrollTop + hOrig / 2\n    };\n    const multi = curConfig.canvas_expansion;\n    w = Math.max(wOrig, svgCanvas.contentW * zoom * multi);\n    h = Math.max(hOrig, svgCanvas.contentH * zoom * multi);\n\n    if (w === wOrig && h === hOrig) {\n      workarea.css('overflow', 'hidden');\n    } else {\n      workarea.css('overflow', 'scroll');\n    }\n\n    const oldCanY = cnvs.height() / 2;\n    const oldCanX = cnvs.width() / 2;\n    cnvs.width(w).height(h);\n    const newCanY = h / 2;\n    const newCanX = w / 2;\n    const offset = svgCanvas.updateCanvas(w, h);\n\n    const ratio = newCanX / oldCanX;\n\n    const scrollX = w / 2 - wOrig / 2;\n    const scrollY = h / 2 - hOrig / 2;\n\n    if (!newCtr) {\n      const oldDistX = oldCtr.x - oldCanX;\n      const newX = newCanX + oldDistX * ratio;\n\n      const oldDistY = oldCtr.y - oldCanY;\n      const newY = newCanY + oldDistY * ratio;\n\n      newCtr = {\n        x: newX,\n        y: newY\n      };\n    } else {\n      newCtr.x += offset.x;\n      newCtr.y += offset.y;\n    }\n\n    if (center) {\n      // Go to top-left for larger documents\n      if (svgCanvas.contentW > wArea.width()) {\n        // Top-left\n        workarea[0].scrollLeft = offset.x - 10;\n        workarea[0].scrollTop = offset.y - 10;\n      } else {\n        // Center\n        wArea[0].scrollLeft = scrollX;\n        wArea[0].scrollTop = scrollY;\n      }\n    } else {\n      wArea[0].scrollLeft = newCtr.x - wOrig / 2;\n      wArea[0].scrollTop = newCtr.y - hOrig / 2;\n    }\n    if (curConfig.showRulers) {\n      updateRulers(cnvs, zoom);\n      workarea.scroll();\n    }\n    if (urldata.storagePrompt !== true && !editor.storagePromptClosed) {\n      $('#dialog_box').hide();\n    }\n  };\n\n  const updateToolButtonState = function () {\n    let index, button;\n    const bNoFill = (svgCanvas.getColor('fill') === 'none');\n    const bNoStroke = (svgCanvas.getColor('stroke') === 'none');\n    const buttonsNeedingStroke = ['#tool_fhpath', '#tool_line'];\n    const buttonsNeedingFillAndStroke = ['#tools_rect .tool_button', '#tools_ellipse .tool_button', '#tool_text', '#tool_path'];\n    if (bNoStroke) {\n      for (index in buttonsNeedingStroke) {\n        button = buttonsNeedingStroke[index];\n        if ($(button).hasClass('tool_button_current')) {\n          clickSelect();\n        }\n        $(button).addClass('disabled');\n      }\n    } else {\n      for (index in buttonsNeedingStroke) {\n        button = buttonsNeedingStroke[index];\n        $(button).removeClass('disabled');\n      }\n    }\n\n    if (bNoStroke && bNoFill) {\n      for (index in buttonsNeedingFillAndStroke) {\n        button = buttonsNeedingFillAndStroke[index];\n        if ($(button).hasClass('tool_button_current')) {\n          clickSelect();\n        }\n        $(button).addClass('disabled');\n      }\n    } else {\n      for (index in buttonsNeedingFillAndStroke) {\n        button = buttonsNeedingFillAndStroke[index];\n        $(button).removeClass('disabled');\n      }\n    }\n\n    svgCanvas.runExtensions('toolButtonStateUpdate', {\n      nofill: bNoFill,\n      nostroke: bNoStroke\n    });\n\n    // Disable flyouts if all inside are disabled\n    $('.tools_flyout').each(function () {\n      const shower = $('#' + this.id + '_show');\n      let hasEnabled = false;\n      $(this).children().each(function () {\n        if (!$(this).hasClass('disabled')) {\n          hasEnabled = true;\n        }\n      });\n      shower.toggleClass('disabled', !hasEnabled);\n    });\n\n    operaRepaint();\n  };\n\n  // Updates the toolbar (colors, opacity, etc) based on the selected element\n  // This function also updates the opacity and id elements that are in the context panel\n  const updateToolbar = function () {\n    let i, len;\n    if (selectedElement != null) {\n      switch (selectedElement.tagName) {\n      case 'use':\n      case 'image':\n      case 'foreignObject':\n        break;\n      case 'g':\n      case 'a':\n        // Look for common styles\n        const childs = selectedElement.getElementsByTagName('*');\n        let gWidth = null;\n        for (i = 0, len = childs.length; i < len; i++) {\n          const swidth = childs[i].getAttribute('stroke-width');\n\n          if (i === 0) {\n            gWidth = swidth;\n          } else if (gWidth !== swidth) {\n            gWidth = null;\n          }\n        }\n\n        $('#stroke_width').val(gWidth === null ? '' : gWidth);\n\n        paintBox.fill.update(true);\n        paintBox.stroke.update(true);\n\n        break;\n      default:\n        paintBox.fill.update(true);\n        paintBox.stroke.update(true);\n\n        $('#stroke_width').val(selectedElement.getAttribute('stroke-width') || 1);\n        $('#stroke_style').val(selectedElement.getAttribute('stroke-dasharray') || 'none');\n\n        let attr = selectedElement.getAttribute('stroke-linejoin') || 'miter';\n\n        if ($('#linejoin_' + attr).length) {\n          setStrokeOpt($('#linejoin_' + attr)[0]);\n        }\n\n        attr = selectedElement.getAttribute('stroke-linecap') || 'butt';\n\n        if ($('#linecap_' + attr).length) {\n          setStrokeOpt($('#linecap_' + attr)[0]);\n        }\n      }\n    }\n\n    // All elements including image and group have opacity\n    if (selectedElement != null) {\n      const opacPerc = (selectedElement.getAttribute('opacity') || 1.0) * 100;\n      $('#group_opacity').val(opacPerc);\n      $('#opac_slider').slider('option', 'value', opacPerc);\n      $('#elem_id').val(selectedElement.id);\n      $('#elem_class').val(selectedElement.getAttribute('class'));\n    }\n\n    updateToolButtonState();\n  };\n\n  // updates the context panel tools based on the selected element\n  const updateContextPanel = function () {\n    let elem = selectedElement;\n    // If element has just been deleted, consider it null\n    if (elem != null && !elem.parentNode) { elem = null; }\n    const currentLayerName = svgCanvas.getCurrentDrawing().getCurrentLayerName();\n    const currentMode = svgCanvas.getMode();\n    const unit = curConfig.baseUnit !== 'px' ? curConfig.baseUnit : null;\n\n    const isNode = currentMode === 'pathedit'; // elem ? (elem.id && elem.id.startsWith('pathpointgrip')) : false;\n    const menuItems = $('#cmenu_canvas li');\n    $('#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,' +\n      '#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel,' +\n      ' #use_panel, #a_panel').hide();\n    if (elem != null) {\n      const elname = elem.nodeName;\n      // If this is a link with no transform and one child, pretend\n      // its child is selected\n      // if (elname === 'a') { // && !$(elem).attr('transform')) {\n      //   elem = elem.firstChild;\n      // }\n\n      const angle = svgCanvas.getRotationAngle(elem);\n      $('#angle').val(angle);\n\n      const blurval = svgCanvas.getBlur(elem);\n      $('#blur').val(blurval);\n      $('#blur_slider').slider('option', 'value', blurval);\n\n      if (svgCanvas.addedNew) {\n        if (elname === 'image' && svgCanvas.getMode() === 'image') {\n          // Prompt for URL if not a data URL\n          if (!svgCanvas.getHref(elem).startsWith('data:')) {\n            promptImgURL({cancelDeletes: true});\n          }\n        }\n        /* else if (elname == 'text') {\n          // TODO: Do something here for new text\n        } */\n      }\n\n      if (!isNode && currentMode !== 'pathedit') {\n        $('#selected_panel').show();\n        // Elements in this array already have coord fields\n        if (['line', 'circle', 'ellipse'].includes(elname)) {\n          $('#xy_panel').hide();\n        } else {\n          let x, y;\n\n          // Get BBox vals for g, polyline and path\n          if (['g', 'polyline', 'path'].includes(elname)) {\n            const bb = svgCanvas.getStrokedBBox([elem]);\n            if (bb) {\n              ({x, y} = bb);\n            }\n          } else {\n            x = elem.getAttribute('x');\n            y = elem.getAttribute('y');\n          }\n\n          if (unit) {\n            x = convertUnit(x);\n            y = convertUnit(y);\n          }\n\n          $('#selected_x').val(x || 0);\n          $('#selected_y').val(y || 0);\n          $('#xy_panel').show();\n        }\n\n        // Elements in this array cannot be converted to a path\n        const noPath = !['image', 'text', 'path', 'g', 'use'].includes(elname);\n        $('#tool_topath').toggle(noPath);\n        $('#tool_reorient').toggle(elname === 'path');\n        $('#tool_reorient').toggleClass('disabled', angle === 0);\n      } else {\n        const point = path.getNodePoint();\n        $('#tool_add_subpath').removeClass('push_button_pressed').addClass('tool_button');\n        $('#tool_node_delete').toggleClass('disabled', !path.canDeleteNodes);\n\n        // Show open/close button based on selected point\n        setIcon('#tool_openclose_path', path.closed_subpath ? 'open_path' : 'close_path');\n\n        if (point) {\n          const segType = $('#seg_type');\n          if (unit) {\n            point.x = convertUnit(point.x);\n            point.y = convertUnit(point.y);\n          }\n          $('#path_node_x').val(point.x);\n          $('#path_node_y').val(point.y);\n          if (point.type) {\n            segType.val(point.type).removeAttr('disabled');\n          } else {\n            segType.val(4).attr('disabled', 'disabled');\n          }\n        }\n        return;\n      }\n\n      // update contextual tools here\n      const panels = {\n        g: [],\n        a: [],\n        rect: ['rx', 'width', 'height'],\n        image: ['width', 'height'],\n        circle: ['cx', 'cy', 'r'],\n        ellipse: ['cx', 'cy', 'rx', 'ry'],\n        line: ['x1', 'y1', 'x2', 'y2'],\n        text: [],\n        use: []\n      };\n\n      const {tagName} = elem;\n\n      // if ($(elem).data('gsvg')) {\n      //   $('#g_panel').show();\n      // }\n\n      let linkHref = null;\n      if (tagName === 'a') {\n        linkHref = svgCanvas.getHref(elem);\n        $('#g_panel').show();\n      }\n\n      if (elem.parentNode.tagName === 'a') {\n        if (!$(elem).siblings().length) {\n          $('#a_panel').show();\n          linkHref = svgCanvas.getHref(elem.parentNode);\n        }\n      }\n\n      // Hide/show the make_link buttons\n      $('#tool_make_link, #tool_make_link').toggle(!linkHref);\n\n      if (linkHref) {\n        $('#link_url').val(linkHref);\n      }\n\n      if (panels[tagName]) {\n        const curPanel = panels[tagName];\n\n        $('#' + tagName + '_panel').show();\n\n        $.each(curPanel, function (i, item) {\n          let attrVal = elem.getAttribute(item);\n          if (curConfig.baseUnit !== 'px' && elem[item]) {\n            const bv = elem[item].baseVal.value;\n            attrVal = convertUnit(bv);\n          }\n          $('#' + tagName + '_' + item).val(attrVal || 0);\n        });\n\n        if (tagName === 'text') {\n          $('#text_panel').css('display', 'inline');\n          $('#tool_font_size').css('display', 'inline');\n          if (svgCanvas.getItalic()) {\n            $('#tool_italic').addClass('push_button_pressed').removeClass('tool_button');\n          } else {\n            $('#tool_italic').removeClass('push_button_pressed').addClass('tool_button');\n          }\n          if (svgCanvas.getBold()) {\n            $('#tool_bold').addClass('push_button_pressed').removeClass('tool_button');\n          } else {\n            $('#tool_bold').removeClass('push_button_pressed').addClass('tool_button');\n          }\n          $('#font_family').val(elem.getAttribute('font-family'));\n          $('#font_size').val(elem.getAttribute('font-size'));\n          $('#text').val(elem.textContent);\n          if (svgCanvas.addedNew) {\n            // Timeout needed for IE9\n            setTimeout(function () {\n              $('#text').focus().select();\n            }, 100);\n          }\n        // text\n        } else if (tagName === 'image' && svgCanvas.getMode() === 'image') {\n          setImageURL(svgCanvas.getHref(elem));\n        // image\n        } else if (tagName === 'g' || tagName === 'use') {\n          $('#container_panel').show();\n          const title = svgCanvas.getTitle();\n          const label = $('#g_title')[0];\n          label.value = title;\n          setInputWidth(label);\n          $('#g_title').prop('disabled', tagName === 'use');\n        }\n      }\n      menuItems[(tagName === 'g' ? 'en' : 'dis') + 'ableContextMenuItems']('#ungroup');\n      menuItems[((tagName === 'g' || !multiselected) ? 'dis' : 'en') + 'ableContextMenuItems']('#group');\n    // if (elem != null)\n    } else if (multiselected) {\n      $('#multiselected_panel').show();\n      menuItems\n        .enableContextMenuItems('#group')\n        .disableContextMenuItems('#ungroup');\n    } else {\n      menuItems.disableContextMenuItems('#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back');\n    }\n\n    // update history buttons\n    $('#tool_undo').toggleClass('disabled', undoMgr.getUndoStackSize() === 0);\n    $('#tool_redo').toggleClass('disabled', undoMgr.getRedoStackSize() === 0);\n\n    svgCanvas.addedNew = false;\n\n    if ((elem && !isNode) || multiselected) {\n      // update the selected elements' layer\n      $('#selLayerNames').removeAttr('disabled').val(currentLayerName);\n\n      // Enable regular menu options\n      canvMenu.enableContextMenuItems('#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back');\n    } else {\n      $('#selLayerNames').attr('disabled', 'disabled');\n    }\n  };\n\n  const updateWireFrame = function () {\n    // Test support\n    if (supportsNonSS) { return; }\n\n    const rule = '#workarea.wireframe #svgcontent * { stroke-width: ' + 1 / svgCanvas.getZoom() + 'px; }';\n    $('#wireframe_rules').text(workarea.hasClass('wireframe') ? rule : '');\n  };\n\n  let curContext = '';\n\n  const updateTitle = function (title) {\n    title = title || svgCanvas.getDocumentTitle();\n    const newTitle = origTitle + (title ? ': ' + title : '');\n\n    // Remove title update with current context info, isn't really necessary\n    // if (curContext) {\n    //   new_title = new_title + curContext;\n    // }\n    $('title:first').text(newTitle);\n  };\n\n  // called when we've selected a different element\n  /**\n  *\n  * @param win\n  * @param elems Array of elements that were selected\n  */\n  const selectedChanged = function (win, elems) {\n    const mode = svgCanvas.getMode();\n    if (mode === 'select') {\n      setSelectMode();\n    }\n    const isNode = mode === 'pathedit';\n    // if elems[1] is present, then we have more than one element\n    selectedElement = (elems.length === 1 || elems[1] == null ? elems[0] : null);\n    multiselected = (elems.length >= 2 && elems[1] != null);\n    if (selectedElement != null) {\n      // unless we're already in always set the mode of the editor to select because\n      // upon creation of a text element the editor is switched into\n      // select mode and this event fires - we need our UI to be in sync\n\n      if (!isNode) {\n        updateToolbar();\n      }\n    } // if (elem != null)\n\n    // Deal with pathedit mode\n    togglePathEditMode(isNode, elems);\n    updateContextPanel();\n    svgCanvas.runExtensions('selectedChanged', {\n      elems,\n      selectedElement,\n      multiselected\n    });\n  };\n\n  // Call when part of element is in process of changing, generally\n  // on mousemove actions like rotate, move, etc.\n  const elementTransition = function (win, elems) {\n    const mode = svgCanvas.getMode();\n    const elem = elems[0];\n\n    if (!elem) {\n      return;\n    }\n\n    multiselected = (elems.length >= 2 && elems[1] != null);\n    // Only updating fields for single elements for now\n    if (!multiselected) {\n      switch (mode) {\n      case 'rotate':\n        const ang = svgCanvas.getRotationAngle(elem);\n        $('#angle').val(ang);\n        $('#tool_reorient').toggleClass('disabled', ang === 0);\n        break;\n\n      // TODO: Update values that change on move/resize, etc\n      // case 'select':\n      // case 'resize':\n      //   break;\n      }\n    }\n    svgCanvas.runExtensions('elementTransition', {\n      elems\n    });\n  };\n\n  /**\n   * Test whether an element is a layer or not.\n   * @param {SVGGElement} elem - The SVGGElement to test.\n   * @returns {boolean} True if the element is a layer\n   */\n  function isLayer (elem) {\n    return elem && elem.tagName === 'g' && Layer.CLASS_REGEX.test(elem.getAttribute('class'));\n  }\n\n  // called when any element has changed\n  const elementChanged = function (win, elems) {\n    const mode = svgCanvas.getMode();\n    if (mode === 'select') {\n      setSelectMode();\n    }\n\n    for (let i = 0; i < elems.length; ++i) {\n      const elem = elems[i];\n\n      const isSvgElem = (elem && elem.tagName === 'svg');\n      if (isSvgElem || isLayer(elem)) {\n        populateLayers();\n        // if the element changed was the svg, then it could be a resolution change\n        if (isSvgElem) {\n          updateCanvas();\n        }\n      // Update selectedElement if element is no longer part of the image.\n      // This occurs for the text elements in Firefox\n      } else if (elem && selectedElement && selectedElement.parentNode == null) {\n        // || elem && elem.tagName == \"path\" && !multiselected) { // This was added in r1430, but not sure why\n        selectedElement = elem;\n      }\n    }\n\n    editor.showSaveWarning = true;\n\n    // we update the contextual panel with potentially new\n    // positional/sizing information (we DON'T want to update the\n    // toolbar here as that creates an infinite loop)\n    // also this updates the history buttons\n\n    // we tell it to skip focusing the text control if the\n    // text element was previously in focus\n    updateContextPanel();\n\n    // In the event a gradient was flipped:\n    if (selectedElement && mode === 'select') {\n      paintBox.fill.update();\n      paintBox.stroke.update();\n    }\n\n    svgCanvas.runExtensions('elementChanged', {\n      elems\n    });\n  };\n\n  const zoomDone = function () {\n    updateWireFrame();\n    // updateCanvas(); // necessary?\n  };\n\n  const zoomChanged = svgCanvas.zoomChanged = function (win, bbox, autoCenter) {\n    const scrbar = 15,\n      // res = svgCanvas.getResolution(), // Currently unused\n      wArea = workarea;\n    // const canvasPos = $('#svgcanvas').position(); // Currently unused\n    const zInfo = svgCanvas.setBBoxZoom(bbox, wArea.width() - scrbar, wArea.height() - scrbar);\n    if (!zInfo) { return; }\n    const zoomlevel = zInfo.zoom,\n      bb = zInfo.bbox;\n\n    if (zoomlevel < 0.001) {\n      changeZoom({value: 0.1});\n      return;\n    }\n\n    $('#zoom').val((zoomlevel * 100).toFixed(1));\n\n    if (autoCenter) {\n      updateCanvas();\n    } else {\n      updateCanvas(false, {x: bb.x * zoomlevel + (bb.width * zoomlevel) / 2, y: bb.y * zoomlevel + (bb.height * zoomlevel) / 2});\n    }\n\n    if (svgCanvas.getMode() === 'zoom' && bb.width) {\n      // Go to select if a zoom box was drawn\n      setSelectMode();\n    }\n\n    zoomDone();\n  };\n\n  const changeZoom = function (ctl) {\n    const zoomlevel = ctl.value / 100;\n    if (zoomlevel < 0.001) {\n      ctl.value = 0.1;\n      return;\n    }\n    const zoom = svgCanvas.getZoom();\n    const wArea = workarea;\n\n    zoomChanged(window, {\n      width: 0,\n      height: 0,\n      // center pt of scroll position\n      x: (wArea[0].scrollLeft + wArea.width() / 2) / zoom,\n      y: (wArea[0].scrollTop + wArea.height() / 2) / zoom,\n      zoom: zoomlevel\n    }, true);\n  };\n\n  $('#cur_context_panel').delegate('a', 'click', function () {\n    const link = $(this);\n    if (link.attr('data-root')) {\n      svgCanvas.leaveContext();\n    } else {\n      svgCanvas.setContext(link.text());\n    }\n    svgCanvas.clearSelection();\n    return false;\n  });\n\n  const contextChanged = function (win, context) {\n    let linkStr = '';\n    if (context) {\n      let str = '';\n      linkStr = '<a href=\"#\" data-root=\"y\">' + svgCanvas.getCurrentDrawing().getCurrentLayerName() + '</a>';\n\n      $(context).parentsUntil('#svgcontent > g').andSelf().each(function () {\n        if (this.id) {\n          str += ' > ' + this.id;\n          if (this !== context) {\n            linkStr += ' > <a href=\"#\">' + this.id + '</a>';\n          } else {\n            linkStr += ' > ' + this.id;\n          }\n        }\n      });\n\n      curContext = str;\n    } else {\n      curContext = null;\n    }\n    $('#cur_context_panel').toggle(!!context).html(linkStr);\n\n    updateTitle();\n  };\n\n  // Makes sure the current selected paint is available to work with\n  const prepPaints = function () {\n    paintBox.fill.prep();\n    paintBox.stroke.prep();\n  };\n\n  const flyoutFuncs = {};\n\n  const setFlyoutTitles = function () {\n    $('.tools_flyout').each(function () {\n      const shower = $('#' + this.id + '_show');\n      if (shower.data('isLibrary')) {\n        return;\n      }\n\n      const tooltips = [];\n      $(this).children().each(function () {\n        tooltips.push(this.title);\n      });\n      shower[0].title = tooltips.join(' / ');\n    });\n  };\n\n  const setupFlyouts = function (holders) {\n    $.each(holders, function (holdSel, btnOpts) {\n      const buttons = $(holdSel).children();\n      const showSel = holdSel + '_show';\n      const shower = $(showSel);\n      let def = false;\n      buttons.addClass('tool_button')\n        .unbind('click mousedown mouseup') // may not be necessary\n        .each(function (i) {\n          // Get this buttons options\n          const opts = btnOpts[i];\n\n          // Remember the function that goes with this ID\n          flyoutFuncs[opts.sel] = opts.fn;\n\n          if (opts.isDefault) { def = i; }\n\n          // Clicking the icon in flyout should set this set's icon\n          const func = function (event) {\n            let options = opts;\n            // Find the currently selected tool if comes from keystroke\n            if (event.type === 'keydown') {\n              const flyoutIsSelected = $(options.parent + '_show').hasClass('tool_button_current');\n              const currentOperation = $(options.parent + '_show').attr('data-curopt');\n              $.each(holders[opts.parent], function (i, tool) {\n                if (tool.sel === currentOperation) {\n                  if (!event.shiftKey || !flyoutIsSelected) {\n                    options = tool;\n                  } else {\n                    options = holders[opts.parent][i + 1] || holders[opts.parent][0];\n                  }\n                }\n              });\n            }\n            if ($(this).hasClass('disabled')) { return false; }\n            if (toolButtonClick(showSel)) {\n              options.fn();\n            }\n            let icon;\n            if (options.icon) {\n              icon = $.getSvgIcon(options.icon, true);\n            } else {\n              icon = $(options.sel).children().eq(0).clone();\n            }\n\n            icon[0].setAttribute('width', shower.width());\n            icon[0].setAttribute('height', shower.height());\n            shower.children(':not(.flyout_arrow_horiz)').remove();\n            shower.append(icon).attr('data-curopt', options.sel); // This sets the current mode\n          };\n\n          $(this).mouseup(func);\n\n          if (opts.key) {\n            $(document).bind('keydown', opts.key[0] + ' shift+' + opts.key[0], func);\n          }\n        });\n\n      if (def) {\n        shower.attr('data-curopt', btnOpts[def].sel);\n      } else if (!shower.attr('data-curopt')) {\n        // Set first as default\n        shower.attr('data-curopt', btnOpts[0].sel);\n      }\n\n      let timer;\n      const pos = $(showSel).position();\n\n      // Clicking the \"show\" icon should set the current mode\n      shower.mousedown(function (evt) {\n        if (shower.hasClass('disabled')) {\n          return false;\n        }\n        const holder = $(holdSel);\n        const l = pos.left + 34;\n        const w = holder.width() * -1;\n        const time = holder.data('shown_popop') ? 200 : 0;\n        timer = setTimeout(function () {\n          // Show corresponding menu\n          if (!shower.data('isLibrary')) {\n            holder.css('left', w).show().animate({\n              left: l\n            }, 150);\n          } else {\n            holder.css('left', l).show();\n          }\n          holder.data('shown_popop', true);\n        }, time);\n        evt.preventDefault();\n      }).mouseup(function (evt) {\n        clearTimeout(timer);\n        const opt = $(this).attr('data-curopt');\n        // Is library and popped up, so do nothing\n        if (shower.data('isLibrary') && $(showSel.replace('_show', '')).is(':visible')) {\n          toolButtonClick(showSel, true);\n          return;\n        }\n        if (toolButtonClick(showSel) && flyoutFuncs[opt]) {\n          flyoutFuncs[opt]();\n        }\n      });\n      // $('#tools_rect').mouseleave(function () { $('#tools_rect').fadeOut(); });\n    });\n    setFlyoutTitles();\n    setFlyoutPositions();\n  };\n\n  const makeFlyoutHolder = function (id, child) {\n    const div = $('<div>', {\n      class: 'tools_flyout',\n      id\n    }).appendTo('#svg_editor').append(child);\n\n    return div;\n  };\n\n  // TODO: Combine this with addDropDown or find other way to optimize\n  const addAltDropDown = function (elem, list, callback, opts) {\n    const button = $(elem);\n    const {dropUp} = opts;\n    list = $(list);\n    if (dropUp) {\n      $(elem).addClass('dropup');\n    }\n    list.find('li').bind('mouseup', function () {\n      if (opts.seticon) {\n        setIcon('#cur_' + button[0].id, $(this).children());\n        $(this).addClass('current').siblings().removeClass('current');\n      }\n      callback.apply(this, arguments);\n    });\n\n    let onButton = false;\n    $(window).mouseup(function (evt) {\n      if (!onButton) {\n        button.removeClass('down');\n        list.hide();\n        list.css({top: 0, left: 0});\n      }\n      onButton = false;\n    });\n\n    // const height = list.height(); // Currently unused\n    button.bind('mousedown', function () {\n      const off = button.offset();\n      if (dropUp) {\n        off.top -= list.height();\n        off.left += 8;\n      } else {\n        off.top += button.height();\n      }\n      list.offset(off);\n\n      if (!button.hasClass('down')) {\n        list.show();\n        onButton = true;\n      } else {\n        // CSS position must be reset for Webkit\n        list.hide();\n        list.css({top: 0, left: 0});\n      }\n      button.toggleClass('down');\n    }).hover(function () {\n      onButton = true;\n    }).mouseout(function () {\n      onButton = false;\n    });\n\n    if (opts.multiclick) {\n      list.mousedown(function () {\n        onButton = true;\n      });\n    }\n  };\n\n  const extsPreLang = [];\n  const extAdded = function (win, ext) {\n    if (!ext) {\n      return;\n    }\n    let cbCalled = false;\n    let resizeDone = false;\n    let cbReady = true; // Set to false to delay callback (e.g. wait for $.svgIcons)\n\n    if (ext.langReady) {\n      if (editor.langChanged) { // We check for this since the \"lang\" pref could have been set by storage\n        const lang = $.pref('lang');\n        ext.langReady({lang, uiStrings});\n      } else {\n        extsPreLang.push(ext);\n      }\n    }\n\n    function prepResize () {\n      if (resizeTimer) {\n        clearTimeout(resizeTimer);\n        resizeTimer = null;\n      }\n      if (!resizeDone) {\n        resizeTimer = setTimeout(function () {\n          resizeDone = true;\n          setIconSize($.pref('iconsize'));\n        }, 50);\n      }\n    }\n\n    const runCallback = function () {\n      if (ext.callback && !cbCalled && cbReady) {\n        cbCalled = true;\n        ext.callback.call(editor);\n      }\n    };\n\n    const btnSelects = [];\n\n    if (ext.context_tools) {\n      $.each(ext.context_tools, function (i, tool) {\n        // Add select tool\n        const contId = tool.container_id ? (' id=\"' + tool.container_id + '\"') : '';\n\n        let panel = $('#' + tool.panel);\n        // create the panel if it doesn't exist\n        if (!panel.length) {\n          panel = $('<div>', {id: tool.panel}).appendTo('#tools_top');\n        }\n\n        let html;\n        // TODO: Allow support for other types, or adding to existing tool\n        switch (tool.type) {\n        case 'tool_button':\n          html = '<div class=\"tool_button\">' + tool.id + '</div>';\n          const div = $(html).appendTo(panel);\n          if (tool.events) {\n            $.each(tool.events, function (evt, func) {\n              $(div).bind(evt, func);\n            });\n          }\n          break;\n        case 'select':\n          html = '<label' + contId + '>' +\n            '<select id=\"' + tool.id + '\">';\n          $.each(tool.options, function (val, text) {\n            const sel = (val === tool.defval) ? ' selected' : '';\n            html += '<option value=\"' + val + '\"' + sel + '>' + text + '</option>';\n          });\n          html += '</select></label>';\n          // Creates the tool, hides & adds it, returns the select element\n          const sel = $(html).appendTo(panel).find('select');\n\n          $.each(tool.events, function (evt, func) {\n            $(sel).bind(evt, func);\n          });\n          break;\n        case 'button-select':\n          html = '<div id=\"' + tool.id + '\" class=\"dropdown toolset\" title=\"' + tool.title + '\">' +\n            '<div id=\"cur_' + tool.id + '\" class=\"icon_label\"></div><button></button></div>';\n\n          const list = $('<ul id=\"' + tool.id + '_opts\"></ul>').appendTo('#option_lists');\n\n          if (tool.colnum) {\n            list.addClass('optcols' + tool.colnum);\n          }\n\n          // Creates the tool, hides & adds it, returns the select element\n          /* const dropdown = */ $(html).appendTo(panel).children();\n\n          btnSelects.push({\n            elem: ('#' + tool.id),\n            list: ('#' + tool.id + '_opts'),\n            title: tool.title,\n            callback: tool.events.change,\n            cur: ('#cur_' + tool.id)\n          });\n\n          break;\n        case 'input':\n          html = '<label' + contId + '>' +\n            '<span id=\"' + tool.id + '_label\">' +\n            tool.label + ':</span>' +\n            '<input id=\"' + tool.id + '\" title=\"' + tool.title +\n            '\" size=\"' + (tool.size || '4') + '\" value=\"' + (tool.defval || '') + '\" type=\"text\"/></label>';\n\n          // Creates the tool, hides & adds it, returns the select element\n\n          // Add to given tool.panel\n          const inp = $(html).appendTo(panel).find('input');\n\n          if (tool.spindata) {\n            inp.SpinButton(tool.spindata);\n          }\n\n          if (tool.events) {\n            $.each(tool.events, function (evt, func) {\n              inp.bind(evt, func);\n            });\n          }\n          break;\n\n        default:\n          break;\n        }\n      });\n    }\n\n    if (ext.buttons) {\n      const fallbackObj = {},\n        placementObj = {},\n        {svgicons} = ext,\n        holders = {};\n\n      // Add buttons given by extension\n      $.each(ext.buttons, function (i, btn) {\n        let icon, svgicon, tlsId;\n\n        let {id} = btn;\n        let num = i;\n        // Give button a unique ID\n        while ($('#' + id).length) {\n          id = btn.id + '_' + (++num);\n        }\n\n        if (!svgicons) {\n          icon = $('<img src=\"' + btn.icon + '\">');\n        } else {\n          fallbackObj[id] = btn.icon;\n          svgicon = btn.svgicon || btn.id;\n          if (btn.type === 'app_menu') {\n            placementObj['#' + id + ' > div'] = svgicon;\n          } else {\n            placementObj['#' + id] = svgicon;\n          }\n        }\n\n        let cls, parent;\n\n        // Set button up according to its type\n        switch (btn.type) {\n        case 'mode_flyout':\n        case 'mode':\n          cls = 'tool_button';\n          parent = '#tools_left';\n          break;\n        case 'context':\n          cls = 'tool_button';\n          parent = '#' + btn.panel;\n          // create the panel if it doesn't exist\n          if (!$(parent).length) {\n            $('<div>', {id: btn.panel}).appendTo('#tools_top');\n          }\n          break;\n        case 'app_menu':\n          cls = '';\n          parent = '#main_menu ul';\n          break;\n        }\n        let flyoutHolder, curH, showBtn, refData, refBtn;\n        const button = $((btn.list || btn.type === 'app_menu') ? '<li/>' : '<div/>')\n          .attr('id', id)\n          .attr('title', btn.title)\n          .addClass(cls);\n        if (!btn.includeWith && !btn.list) {\n          if ('position' in btn) {\n            if ($(parent).children().eq(btn.position).length) {\n              $(parent).children().eq(btn.position).before(button);\n            } else {\n              $(parent).children().last().before(button);\n            }\n          } else {\n            button.appendTo(parent);\n          }\n\n          if (btn.type === 'mode_flyout') {\n          // Add to flyout menu / make flyout menu\n            // const opts = btn.includeWith;\n            // // opts.button, default, position\n            refBtn = $(button);\n\n            flyoutHolder = refBtn.parent();\n            // Create a flyout menu if there isn't one already\n            if (!refBtn.parent().hasClass('tools_flyout')) {\n              // Create flyout placeholder\n              tlsId = refBtn[0].id.replace('tool_', 'tools_');\n              showBtn = refBtn.clone()\n                .attr('id', tlsId + '_show')\n                .append($('<div>', {class: 'flyout_arrow_horiz'}));\n\n              refBtn.before(showBtn);\n\n              // Create a flyout div\n              flyoutHolder = makeFlyoutHolder(tlsId, refBtn);\n              flyoutHolder.data('isLibrary', true);\n              showBtn.data('isLibrary', true);\n            }\n            // refData = Actions.getButtonData(opts.button);\n\n            placementObj['#' + tlsId + '_show'] = btn.id;\n            // TODO: Find way to set the current icon using the iconloader if this is not default\n\n            // Include data for extension button as well as ref button\n            curH = holders['#' + flyoutHolder[0].id] = [{\n              sel: '#' + id,\n              fn: btn.events.click,\n              icon: btn.id,\n              // key: btn.key,\n              isDefault: true\n            }, refData];\n            //\n            // // {sel:'#tool_rect', fn: clickRect, evt: 'mouseup', key: 4, parent: '#tools_rect', icon: 'rect'}\n            //\n            // const pos = ('position' in opts)?opts.position:'last';\n            // const len = flyoutHolder.children().length;\n            //\n            // // Add at given position or end\n            // if (!isNaN(pos) && pos >= 0 && pos < len) {\n            //   flyoutHolder.children().eq(pos).before(button);\n            // } else {\n            //   flyoutHolder.append(button);\n            //   curH.reverse();\n            // }\n          } else if (btn.type === 'app_menu') {\n            button.append('<div>').append(btn.title);\n          }\n        } else if (btn.list) {\n          // Add button to list\n          button.addClass('push_button');\n          $('#' + btn.list + '_opts').append(button);\n          if (btn.isDefault) {\n            $('#cur_' + btn.list).append(button.children().clone());\n            svgicon = btn.svgicon || btn.id;\n            placementObj['#cur_' + btn.list] = svgicon;\n          }\n        } else if (btn.includeWith) {\n          // Add to flyout menu / make flyout menu\n          const opts = btn.includeWith;\n          // opts.button, default, position\n          refBtn = $(opts.button);\n\n          flyoutHolder = refBtn.parent();\n          // Create a flyout menu if there isn't one already\n          if (!refBtn.parent().hasClass('tools_flyout')) {\n            // Create flyout placeholder\n            tlsId = refBtn[0].id.replace('tool_', 'tools_');\n            showBtn = refBtn.clone()\n              .attr('id', tlsId + '_show')\n              .append($('<div>', {class: 'flyout_arrow_horiz'}));\n\n            refBtn.before(showBtn);\n\n            // Create a flyout div\n            flyoutHolder = makeFlyoutHolder(tlsId, refBtn);\n          }\n\n          refData = Actions.getButtonData(opts.button);\n\n          if (opts.isDefault) {\n            placementObj['#' + tlsId + '_show'] = btn.id;\n          }\n          // TODO: Find way to set the current icon using the iconloader if this is not default\n\n          // Include data for extension button as well as ref button\n          curH = holders['#' + flyoutHolder[0].id] = [{\n            sel: '#' + id,\n            fn: btn.events.click,\n            icon: btn.id,\n            key: btn.key,\n            isDefault: btn.includeWith ? btn.includeWith.isDefault : 0\n          }, refData];\n\n          // {sel:'#tool_rect', fn: clickRect, evt: 'mouseup', key: 4, parent: '#tools_rect', icon: 'rect'}\n\n          const pos = ('position' in opts) ? opts.position : 'last';\n          const len = flyoutHolder.children().length;\n\n          // Add at given position or end\n          if (!isNaN(pos) && pos >= 0 && pos < len) {\n            flyoutHolder.children().eq(pos).before(button);\n          } else {\n            flyoutHolder.append(button);\n            curH.reverse();\n          }\n        }\n\n        if (!svgicons) {\n          button.append(icon);\n        }\n\n        if (!btn.list) {\n          // Add given events to button\n          $.each(btn.events, function (name, func) {\n            if (name === 'click' && btn.type === 'mode') {\n              if (btn.includeWith) {\n                button.bind(name, func);\n              } else {\n                button.bind(name, function () {\n                  if (toolButtonClick(button)) {\n                    func();\n                  }\n                });\n              }\n              if (btn.key) {\n                $(document).bind('keydown', btn.key, func);\n                if (btn.title) {\n                  button.attr('title', btn.title + ' [' + btn.key + ']');\n                }\n              }\n            } else {\n              button.bind(name, func);\n            }\n          });\n        }\n\n        setupFlyouts(holders);\n      });\n\n      $.each(btnSelects, function () {\n        addAltDropDown(this.elem, this.list, this.callback, {seticon: true});\n      });\n\n      if (svgicons) {\n        cbReady = false; // Delay callback\n      }\n\n      $.svgIcons(svgicons, {\n        w: 24, h: 24,\n        id_match: false,\n        no_img: (!isWebkit()),\n        fallback: fallbackObj,\n        placement: placementObj,\n        callback (icons) {\n          // Non-ideal hack to make the icon match the current size\n          // if (curPrefs.iconsize && curPrefs.iconsize !== 'm') {\n          if ($.pref('iconsize') !== 'm') {\n            prepResize();\n          }\n          cbReady = true; // Ready for callback\n          runCallback();\n        }\n      });\n    }\n\n    runCallback();\n  };\n\n  const getPaint = function (color, opac, type) {\n    // update the editor's fill paint\n    const opts = { alpha: opac };\n    if (color.startsWith('url(#')) {\n      let refElem = svgCanvas.getRefElem(color);\n      if (refElem) {\n        refElem = refElem.cloneNode(true);\n      } else {\n        refElem = $('#' + type + '_color defs *')[0];\n      }\n      opts[refElem.tagName] = refElem;\n    } else if (color.startsWith('#')) {\n      opts.solidColor = color.substr(1);\n    } else {\n      opts.solidColor = 'none';\n    }\n    return new $.jGraduate.Paint(opts);\n  };\n\n  // $('#text').focus(function () { textBeingEntered = true; });\n  // $('#text').blur(function () { textBeingEntered = false; });\n\n  // bind the selected event to our function that handles updates to the UI\n  svgCanvas.bind('selected', selectedChanged);\n  svgCanvas.bind('transition', elementTransition);\n  svgCanvas.bind('changed', elementChanged);\n  svgCanvas.bind('saved', saveHandler);\n  svgCanvas.bind('exported', exportHandler);\n  svgCanvas.bind('exportedPDF', function (win, data) {\n    const {exportWindowName} = data;\n    if (exportWindowName) {\n      exportWindow = window.open('', exportWindowName); // A hack to get the window via JSON-able name without opening a new one\n    }\n    if (!exportWindow || exportWindow.closed) {\n      $.alert(uiStrings.notification.popupWindowBlocked);\n      return;\n    }\n    exportWindow.location.href = data.dataurlstring;\n  });\n  svgCanvas.bind('zoomed', zoomChanged);\n  svgCanvas.bind('zoomDone', zoomDone);\n  svgCanvas.bind('updateCanvas', function (win, {center, newCtr}) {\n    updateCanvas(center, newCtr);\n  });\n  svgCanvas.bind('contextset', contextChanged);\n  svgCanvas.bind('extension_added', extAdded);\n  svgCanvas.textActions.setInputElem($('#text')[0]);\n\n  let str = '<div class=\"palette_item\" data-rgb=\"none\"></div>';\n  $.each(palette, function (i, item) {\n    str += '<div class=\"palette_item\" style=\"background-color: ' + item + ';\" data-rgb=\"' + item + '\"></div>';\n  });\n  $('#palette').append(str);\n\n  // Set up editor background functionality\n  // TODO add checkerboard as \"pattern\"\n  const colorBlocks = ['#FFF', '#888', '#000']; // ,'url(data:image/gif;base64,R0lGODlhEAAQAIAAAP%2F%2F%2F9bW1iH5BAAAAAAALAAAAAAQABAAAAIfjG%2Bgq4jM3IFLJgpswNly%2FXkcBpIiVaInlLJr9FZWAQA7)'];\n  str = '';\n  $.each(colorBlocks, function () {\n    str += '<div class=\"color_block\" style=\"background-color:' + this + ';\"></div>';\n  });\n  $('#bg_blocks').append(str);\n  const blocks = $('#bg_blocks div');\n  const curBg = 'cur_background';\n  blocks.each(function () {\n    const blk = $(this);\n    blk.click(function () {\n      blocks.removeClass(curBg);\n      $(this).addClass(curBg);\n    });\n  });\n\n  setBackground($.pref('bkgd_color'), $.pref('bkgd_url'));\n\n  $('#image_save_opts input').val([$.pref('img_save')]);\n\n  const changeRectRadius = function (ctl) {\n    svgCanvas.setRectRadius(ctl.value);\n  };\n\n  const changeFontSize = function (ctl) {\n    svgCanvas.setFontSize(ctl.value);\n  };\n\n  const changeStrokeWidth = function (ctl) {\n    let val = ctl.value;\n    if (val === 0 && selectedElement && ['line', 'polyline'].includes(selectedElement.nodeName)) {\n      val = ctl.value = 1;\n    }\n    svgCanvas.setStrokeWidth(val);\n  };\n\n  const changeRotationAngle = function (ctl) {\n    svgCanvas.setRotationAngle(ctl.value);\n    $('#tool_reorient').toggleClass('disabled', parseInt(ctl.value, 10) === 0);\n  };\n\n  const changeOpacity = function (ctl, val) {\n    if (val == null) { val = ctl.value; }\n    $('#group_opacity').val(val);\n    if (!ctl || !ctl.handle) {\n      $('#opac_slider').slider('option', 'value', val);\n    }\n    svgCanvas.setOpacity(val / 100);\n  };\n\n  const changeBlur = function (ctl, val, noUndo) {\n    if (val == null) { val = ctl.value; }\n    $('#blur').val(val);\n    let complete = false;\n    if (!ctl || !ctl.handle) {\n      $('#blur_slider').slider('option', 'value', val);\n      complete = true;\n    }\n    if (noUndo) {\n      svgCanvas.setBlurNoUndo(val);\n    } else {\n      svgCanvas.setBlur(val, complete);\n    }\n  };\n\n  $('#stroke_style').change(function () {\n    svgCanvas.setStrokeAttr('stroke-dasharray', $(this).val());\n    operaRepaint();\n  });\n\n  $('#stroke_linejoin').change(function () {\n    svgCanvas.setStrokeAttr('stroke-linejoin', $(this).val());\n    operaRepaint();\n  });\n\n  // Lose focus for select elements when changed (Allows keyboard shortcuts to work better)\n  $('select').change(function () { $(this).blur(); });\n\n  // fired when user wants to move elements to another layer\n  let promptMoveLayerOnce = false;\n  $('#selLayerNames').change(function () {\n    const destLayer = this.options[this.selectedIndex].value;\n    const confirmStr = uiStrings.notification.QmoveElemsToLayer.replace('%s', destLayer);\n    const moveToLayer = function (ok) {\n      if (!ok) { return; }\n      promptMoveLayerOnce = true;\n      svgCanvas.moveSelectedToLayer(destLayer);\n      svgCanvas.clearSelection();\n      populateLayers();\n    };\n    if (destLayer) {\n      if (promptMoveLayerOnce) {\n        moveToLayer(true);\n      } else {\n        $.confirm(confirmStr, moveToLayer);\n      }\n    }\n  });\n\n  $('#font_family').change(function () {\n    svgCanvas.setFontFamily(this.value);\n  });\n\n  $('#seg_type').change(function () {\n    svgCanvas.setSegType($(this).val());\n  });\n\n  $('#text').bind('keyup input', function () {\n    svgCanvas.setTextContent(this.value);\n  });\n\n  $('#image_url').change(function () {\n    setImageURL(this.value);\n  });\n\n  $('#link_url').change(function () {\n    if (this.value.length) {\n      svgCanvas.setLinkURL(this.value);\n    } else {\n      svgCanvas.removeHyperlink();\n    }\n  });\n\n  $('#g_title').change(function () {\n    svgCanvas.setGroupTitle(this.value);\n  });\n\n  $('.attr_changer').change(function () {\n    const attr = this.getAttribute('data-attr');\n    let val = this.value;\n    const valid = isValidUnit(attr, val, selectedElement);\n\n    if (!valid) {\n      $.alert(uiStrings.notification.invalidAttrValGiven);\n      this.value = selectedElement.getAttribute(attr);\n      return false;\n    }\n\n    if (attr !== 'id' && attr !== 'class') {\n      if (isNaN(val)) {\n        val = svgCanvas.convertToNum(attr, val);\n      } else if (curConfig.baseUnit !== 'px') {\n        // Convert unitless value to one with given unit\n\n        const unitData = getTypeMap();\n\n        if (selectedElement[attr] || svgCanvas.getMode() === 'pathedit' || attr === 'x' || attr === 'y') {\n          val *= unitData[curConfig.baseUnit];\n        }\n      }\n    }\n\n    // if the user is changing the id, then de-select the element first\n    // change the ID, then re-select it with the new ID\n    if (attr === 'id') {\n      const elem = selectedElement;\n      svgCanvas.clearSelection();\n      elem.id = val;\n      svgCanvas.addToSelection([elem], true);\n    } else {\n      svgCanvas.changeSelectedAttribute(attr, val);\n    }\n    this.blur();\n  });\n\n  // Prevent selection of elements when shift-clicking\n  $('#palette').mouseover(function () {\n    const inp = $('<input type=\"hidden\">');\n    $(this).append(inp);\n    inp.focus().remove();\n  });\n\n  $('.palette_item').mousedown(function (evt) {\n    // shift key or right click for stroke\n    const picker = evt.shiftKey || evt.button === 2 ? 'stroke' : 'fill';\n    let color = $(this).data('rgb');\n    let paint;\n\n    // Webkit-based browsers returned 'initial' here for no stroke\n    if (color === 'none' || color === 'transparent' || color === 'initial') {\n      color = 'none';\n      paint = new $.jGraduate.Paint();\n    } else {\n      paint = new $.jGraduate.Paint({alpha: 100, solidColor: color.substr(1)});\n    }\n\n    paintBox[picker].setPaint(paint);\n    svgCanvas.setColor(picker, color);\n\n    if (color !== 'none' && svgCanvas.getPaintOpacity(picker) !== 1) {\n      svgCanvas.setPaintOpacity(picker, 1.0);\n    }\n    updateToolButtonState();\n  }).bind('contextmenu', function (e) { e.preventDefault(); });\n\n  $('#toggle_stroke_tools').on('click', function () {\n    $('#tools_bottom').toggleClass('expanded');\n  });\n\n  (function () {\n    const wArea = workarea[0];\n\n    let lastX = null, lastY = null,\n      panning = false, keypan = false;\n\n    $('#svgcanvas').bind('mousemove mouseup', function (evt) {\n      if (panning === false) { return; }\n\n      wArea.scrollLeft -= (evt.clientX - lastX);\n      wArea.scrollTop -= (evt.clientY - lastY);\n\n      lastX = evt.clientX;\n      lastY = evt.clientY;\n\n      if (evt.type === 'mouseup') { panning = false; }\n      return false;\n    }).mousedown(function (evt) {\n      if (evt.button === 1 || keypan === true) {\n        panning = true;\n        lastX = evt.clientX;\n        lastY = evt.clientY;\n        return false;\n      }\n    });\n\n    $(window).mouseup(function () {\n      panning = false;\n    });\n\n    $(document).bind('keydown', 'space', function (evt) {\n      svgCanvas.spaceKey = keypan = true;\n      evt.preventDefault();\n    }).bind('keyup', 'space', function (evt) {\n      evt.preventDefault();\n      svgCanvas.spaceKey = keypan = false;\n    }).bind('keydown', 'shift', function (evt) {\n      if (svgCanvas.getMode() === 'zoom') {\n        workarea.css('cursor', zoomOutIcon);\n      }\n    }).bind('keyup', 'shift', function (evt) {\n      if (svgCanvas.getMode() === 'zoom') {\n        workarea.css('cursor', zoomInIcon);\n      }\n    });\n\n    /**\n    * @param {Boolean} active\n    */\n    editor.setPanning = function (active) {\n      svgCanvas.spaceKey = keypan = active;\n    };\n  }());\n\n  (function () {\n    const button = $('#main_icon');\n    const overlay = $('#main_icon span');\n    const list = $('#main_menu');\n\n    let onButton = false;\n    let height = 0;\n    let jsHover = true;\n    let setClick = false;\n\n    /*\n    // Currently unused\n    const hideMenu = function () {\n      list.fadeOut(200);\n    };\n    */\n\n    $(window).mouseup(function (evt) {\n      if (!onButton) {\n        button.removeClass('buttondown');\n        // do not hide if it was the file input as that input needs to be visible\n        // for its change event to fire\n        if (evt.target.tagName !== 'INPUT') {\n          list.fadeOut(200);\n        } else if (!setClick) {\n          setClick = true;\n          $(evt.target).click(function () {\n            list.css('margin-left', '-9999px').show();\n          });\n        }\n      }\n      onButton = false;\n    }).mousedown(function (evt) {\n      // $('.contextMenu').hide();\n      const islib = $(evt.target).closest('div.tools_flyout, .contextMenu').length;\n      if (!islib) {\n        $('.tools_flyout:visible,.contextMenu').fadeOut(250);\n      }\n    });\n\n    overlay.bind('mousedown', function () {\n      if (!button.hasClass('buttondown')) {\n        // Margin must be reset in case it was changed before;\n        list.css('margin-left', 0).show();\n        if (!height) {\n          height = list.height();\n        }\n        // Using custom animation as slideDown has annoying 'bounce effect'\n        list.css('height', 0).animate({\n          height\n        }, 200);\n        onButton = true;\n      } else {\n        list.fadeOut(200);\n      }\n      button.toggleClass('buttondown buttonup');\n    }).hover(function () {\n      onButton = true;\n    }).mouseout(function () {\n      onButton = false;\n    });\n\n    const listItems = $('#main_menu li');\n\n    // Check if JS method of hovering needs to be used (Webkit bug)\n    listItems.mouseover(function () {\n      jsHover = ($(this).css('background-color') === 'rgba(0, 0, 0, 0)');\n\n      listItems.unbind('mouseover');\n      if (jsHover) {\n        listItems.mouseover(function () {\n          this.style.backgroundColor = '#FFC';\n        }).mouseout(function () {\n          this.style.backgroundColor = 'transparent';\n          return true;\n        });\n      }\n    });\n  }());\n  // Made public for UI customization.\n  // TODO: Group UI functions into a public editor.ui interface.\n  /**\n  * @param {Element|String} elem DOM Element or selector\n  * @param {Function} callback Mouseup callback\n  * @param {Boolean} dropUp\n  */\n  editor.addDropDown = function (elem, callback, dropUp) {\n    if (!$(elem).length) { return; } // Quit if called on non-existent element\n    const button = $(elem).find('button');\n    const list = $(elem).find('ul').attr('id', $(elem)[0].id + '-list');\n    if (dropUp) {\n      $(elem).addClass('dropup');\n    } else {\n      // Move list to place where it can overflow container\n      $('#option_lists').append(list);\n    }\n    list.find('li').bind('mouseup', callback);\n\n    let onButton = false;\n    $(window).mouseup(function (evt) {\n      if (!onButton) {\n        button.removeClass('down');\n        list.hide();\n      }\n      onButton = false;\n    });\n\n    button.bind('mousedown', function () {\n      if (!button.hasClass('down')) {\n        if (!dropUp) {\n          const pos = $(elem).position();\n          list.css({\n            top: pos.top + 24,\n            left: pos.left - 10\n          });\n        }\n        list.show();\n        onButton = true;\n      } else {\n        list.hide();\n      }\n      button.toggleClass('down');\n    }).hover(function () {\n      onButton = true;\n    }).mouseout(function () {\n      onButton = false;\n    });\n  };\n\n  editor.addDropDown('#font_family_dropdown', function () {\n    $('#font_family').val($(this).text()).change();\n  });\n\n  editor.addDropDown('#opacity_dropdown', function () {\n    if ($(this).find('div').length) { return; }\n    const perc = parseInt($(this).text().split('%')[0], 10);\n    changeOpacity(false, perc);\n  }, true);\n\n  // For slider usage, see: http://jqueryui.com/demos/slider/\n  $('#opac_slider').slider({\n    start () {\n      $('#opacity_dropdown li:not(.special)').hide();\n    },\n    stop () {\n      $('#opacity_dropdown li').show();\n      $(window).mouseup();\n    },\n    slide (evt, ui) {\n      changeOpacity(ui);\n    }\n  });\n\n  editor.addDropDown('#blur_dropdown', $.noop);\n\n  let slideStart = false;\n  $('#blur_slider').slider({\n    max: 10,\n    step: 0.1,\n    stop (evt, ui) {\n      slideStart = false;\n      changeBlur(ui);\n      $('#blur_dropdown li').show();\n      $(window).mouseup();\n    },\n    start () {\n      slideStart = true;\n    },\n    slide (evt, ui) {\n      changeBlur(ui, null, slideStart);\n    }\n  });\n\n  editor.addDropDown('#zoom_dropdown', function () {\n    const item = $(this);\n    const val = item.data('val');\n    if (val) {\n      zoomChanged(window, val);\n    } else {\n      changeZoom({value: parseFloat(item.text())});\n    }\n  }, true);\n\n  addAltDropDown('#stroke_linecap', '#linecap_opts', function () {\n    setStrokeOpt(this, true);\n  }, {dropUp: true});\n\n  addAltDropDown('#stroke_linejoin', '#linejoin_opts', function () {\n    setStrokeOpt(this, true);\n  }, {dropUp: true});\n\n  addAltDropDown('#tool_position', '#position_opts', function () {\n    const letter = this.id.replace('tool_pos', '').charAt(0);\n    svgCanvas.alignSelectedElements(letter, 'page');\n  }, {multiclick: true});\n\n  /*\n\n  When a flyout icon is selected\n    (if flyout) {\n    - Change the icon\n    - Make pressing the button run its stuff\n    }\n    - Run its stuff\n\n  When its shortcut key is pressed\n    - If not current in list, do as above\n    , else:\n    - Just run its stuff\n\n  */\n\n  // Unfocus text input when workarea is mousedowned.\n  (function () {\n    let inp;\n    const unfocus = function () {\n      $(inp).blur();\n    };\n\n    $('#svg_editor').find('button, select, input:not(#text)').focus(function () {\n      inp = this;\n      uiContext = 'toolbars';\n      workarea.mousedown(unfocus);\n    }).blur(function () {\n      uiContext = 'canvas';\n      workarea.unbind('mousedown', unfocus);\n      // Go back to selecting text if in textedit mode\n      if (svgCanvas.getMode() === 'textedit') {\n        $('#text').focus();\n      }\n    });\n  }());\n\n  const clickFHPath = function () {\n    if (toolButtonClick('#tool_fhpath')) {\n      svgCanvas.setMode('fhpath');\n    }\n  };\n\n  const clickLine = function () {\n    if (toolButtonClick('#tool_line')) {\n      svgCanvas.setMode('line');\n    }\n  };\n\n  const clickSquare = function () {\n    if (toolButtonClick('#tool_square')) {\n      svgCanvas.setMode('square');\n    }\n  };\n\n  const clickRect = function () {\n    if (toolButtonClick('#tool_rect')) {\n      svgCanvas.setMode('rect');\n    }\n  };\n\n  const clickFHRect = function () {\n    if (toolButtonClick('#tool_fhrect')) {\n      svgCanvas.setMode('fhrect');\n    }\n  };\n\n  const clickCircle = function () {\n    if (toolButtonClick('#tool_circle')) {\n      svgCanvas.setMode('circle');\n    }\n  };\n\n  const clickEllipse = function () {\n    if (toolButtonClick('#tool_ellipse')) {\n      svgCanvas.setMode('ellipse');\n    }\n  };\n\n  const clickFHEllipse = function () {\n    if (toolButtonClick('#tool_fhellipse')) {\n      svgCanvas.setMode('fhellipse');\n    }\n  };\n\n  const clickImage = function () {\n    if (toolButtonClick('#tool_image')) {\n      svgCanvas.setMode('image');\n    }\n  };\n\n  const clickZoom = function () {\n    if (toolButtonClick('#tool_zoom')) {\n      svgCanvas.setMode('zoom');\n      workarea.css('cursor', zoomInIcon);\n    }\n  };\n\n  const zoomImage = function (multiplier) {\n    const res = svgCanvas.getResolution();\n    multiplier = multiplier ? res.zoom * multiplier : 1;\n    // setResolution(res.w * multiplier, res.h * multiplier, true);\n    $('#zoom').val(multiplier * 100);\n    svgCanvas.setZoom(multiplier);\n    zoomDone();\n    updateCanvas(true);\n  };\n\n  const dblclickZoom = function () {\n    if (toolButtonClick('#tool_zoom')) {\n      zoomImage();\n      setSelectMode();\n    }\n  };\n\n  const clickText = function () {\n    if (toolButtonClick('#tool_text')) {\n      svgCanvas.setMode('text');\n    }\n  };\n\n  const clickPath = function () {\n    if (toolButtonClick('#tool_path')) {\n      svgCanvas.setMode('path');\n    }\n  };\n\n  // Delete is a contextual tool that only appears in the ribbon if\n  // an element has been selected\n  const deleteSelected = function () {\n    if (selectedElement != null || multiselected) {\n      svgCanvas.deleteSelectedElements();\n    }\n  };\n\n  const cutSelected = function () {\n    if (selectedElement != null || multiselected) {\n      svgCanvas.cutSelectedElements();\n    }\n  };\n\n  const copySelected = function () {\n    if (selectedElement != null || multiselected) {\n      svgCanvas.copySelectedElements();\n    }\n  };\n\n  const pasteInCenter = function () {\n    const zoom = svgCanvas.getZoom();\n    const x = (workarea[0].scrollLeft + workarea.width() / 2) / zoom - svgCanvas.contentW;\n    const y = (workarea[0].scrollTop + workarea.height() / 2) / zoom - svgCanvas.contentH;\n    svgCanvas.pasteElements('point', x, y);\n  };\n\n  const moveToTopSelected = function () {\n    if (selectedElement != null) {\n      svgCanvas.moveToTopSelectedElement();\n    }\n  };\n\n  const moveToBottomSelected = function () {\n    if (selectedElement != null) {\n      svgCanvas.moveToBottomSelectedElement();\n    }\n  };\n\n  const moveUpDownSelected = function (dir) {\n    if (selectedElement != null) {\n      svgCanvas.moveUpDownSelected(dir);\n    }\n  };\n\n  const convertToPath = function () {\n    if (selectedElement != null) {\n      svgCanvas.convertToPath();\n    }\n  };\n\n  const reorientPath = function () {\n    if (selectedElement != null) {\n      path.reorient();\n    }\n  };\n\n  const makeHyperlink = function () {\n    if (selectedElement != null || multiselected) {\n      $.prompt(uiStrings.notification.enterNewLinkURL, 'http://', function (url) {\n        if (url) { svgCanvas.makeHyperlink(url); }\n      });\n    }\n  };\n\n  const moveSelected = function (dx, dy) {\n    if (selectedElement != null || multiselected) {\n      if (curConfig.gridSnapping) {\n        // Use grid snap value regardless of zoom level\n        const multi = svgCanvas.getZoom() * curConfig.snappingStep;\n        dx *= multi;\n        dy *= multi;\n      }\n      svgCanvas.moveSelectedElements(dx, dy);\n    }\n  };\n\n  const linkControlPoints = function () {\n    $('#tool_node_link').toggleClass('push_button_pressed tool_button');\n    const linked = $('#tool_node_link').hasClass('push_button_pressed');\n    path.linkControlPoints(linked);\n  };\n\n  const clonePathNode = function () {\n    if (path.getNodePoint()) {\n      path.clonePathNode();\n    }\n  };\n\n  const deletePathNode = function () {\n    if (path.getNodePoint()) {\n      path.deletePathNode();\n    }\n  };\n\n  const addSubPath = function () {\n    const button = $('#tool_add_subpath');\n    const sp = !button.hasClass('push_button_pressed');\n    button.toggleClass('push_button_pressed tool_button');\n    path.addSubPath(sp);\n  };\n\n  const opencloseSubPath = function () {\n    path.opencloseSubPath();\n  };\n\n  const selectNext = function () {\n    svgCanvas.cycleElement(1);\n  };\n\n  const selectPrev = function () {\n    svgCanvas.cycleElement(0);\n  };\n\n  const rotateSelected = function (cw, step) {\n    if (selectedElement == null || multiselected) { return; }\n    if (!cw) { step *= -1; }\n    const angle = parseFloat($('#angle').val()) + step;\n    svgCanvas.setRotationAngle(angle);\n    updateContextPanel();\n  };\n\n  const clickClear = function () {\n    const dims = curConfig.dimensions;\n    $.confirm(uiStrings.notification.QwantToClear, function (ok) {\n      if (!ok) { return; }\n      setSelectMode();\n      svgCanvas.clear();\n      svgCanvas.setResolution(dims[0], dims[1]);\n      updateCanvas(true);\n      zoomImage();\n      populateLayers();\n      updateContextPanel();\n      prepPaints();\n      svgCanvas.runExtensions('onNewDocument');\n    });\n  };\n\n  const clickBold = function () {\n    svgCanvas.setBold(!svgCanvas.getBold());\n    updateContextPanel();\n    return false;\n  };\n\n  const clickItalic = function () {\n    svgCanvas.setItalic(!svgCanvas.getItalic());\n    updateContextPanel();\n    return false;\n  };\n\n  const clickSave = function () {\n    // In the future, more options can be provided here\n    const saveOpts = {\n      images: $.pref('img_save'),\n      round_digits: 6\n    };\n    svgCanvas.save(saveOpts);\n  };\n\n  let loadingURL;\n  const clickExport = function () {\n    $.select('Select an image type for export: ', [\n      // See http://kangax.github.io/jstests/toDataUrl_mime_type_test/ for a useful list of MIME types and browser support\n      // 'ICO', // Todo: Find a way to preserve transparency in SVG-Edit if not working presently and do full packaging for x-icon; then switch back to position after 'PNG'\n      'PNG',\n      'JPEG', 'BMP', 'WEBP', 'PDF'\n    ], function (imgType) { // todo: replace hard-coded msg with uiStrings.notification.\n      if (!imgType) {\n        return;\n      }\n      // Open placeholder window (prevents popup)\n      let exportWindowName;\n      function openExportWindow () {\n        const str = uiStrings.notification.loadingImage;\n        if (curConfig.exportWindowType === 'new') {\n          editor.exportWindowCt++;\n        }\n        exportWindowName = curConfig.canvasName + editor.exportWindowCt;\n        let popHTML, popURL;\n        if (loadingURL) {\n          popURL = loadingURL;\n        } else {\n          popHTML = '<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>' + str + '</title></head><body><h1>' + str + '</h1></body><html>';\n          if (typeof URL && URL.createObjectURL) {\n            const blob = new Blob([popHTML], {type: 'text/html'});\n            popURL = URL.createObjectURL(blob);\n          } else {\n            popURL = 'data:text/html;base64;charset=utf-8,' + Utils.encode64(popHTML);\n          }\n          loadingURL = popURL;\n        }\n        exportWindow = window.open(popURL, exportWindowName);\n      }\n      if (imgType === 'PDF') {\n        if (!customExportPDF) {\n          openExportWindow();\n        }\n        svgCanvas.exportPDF(exportWindowName);\n      } else {\n        if (!customExportImage) {\n          openExportWindow();\n        }\n        const quality = parseInt($('#image-slider').val(), 10) / 100;\n        svgCanvas.rasterExport(imgType, quality, exportWindowName);\n      }\n    }, function () {\n      const sel = $(this);\n      if (sel.val() === 'JPEG' || sel.val() === 'WEBP') {\n        if (!$('#image-slider').length) {\n          $(`<div><label>${uiStrings.ui.quality}\n              <input id=\"image-slider\"\n                type=\"range\" min=\"1\" max=\"100\" value=\"92\" />\n            </label></div>`).appendTo(sel.parent());\n        }\n      } else {\n        $('#image-slider').parent().remove();\n      }\n    });\n  };\n\n  // by default, svgCanvas.open() is a no-op.\n  // it is up to an extension mechanism (opera widget, etc)\n  // to call setCustomHandlers() which will make it do something\n  const clickOpen = function () {\n    svgCanvas.open();\n  };\n\n  const clickImport = function () {\n  };\n\n  const clickUndo = function () {\n    if (undoMgr.getUndoStackSize() > 0) {\n      undoMgr.undo();\n      populateLayers();\n    }\n  };\n\n  const clickRedo = function () {\n    if (undoMgr.getRedoStackSize() > 0) {\n      undoMgr.redo();\n      populateLayers();\n    }\n  };\n\n  const clickGroup = function () {\n    // group\n    if (multiselected) {\n      svgCanvas.groupSelectedElements();\n    // ungroup\n    } else if (selectedElement) {\n      svgCanvas.ungroupSelectedElement();\n    }\n  };\n\n  const clickClone = function () {\n    svgCanvas.cloneSelectedElements(20, 20);\n  };\n\n  const clickAlign = function () {\n    const letter = this.id.replace('tool_align', '').charAt(0);\n    svgCanvas.alignSelectedElements(letter, $('#align_relative_to').val());\n  };\n\n  const clickWireframe = function () {\n    $('#tool_wireframe').toggleClass('push_button_pressed tool_button');\n    workarea.toggleClass('wireframe');\n\n    if (supportsNonSS) { return; }\n    let wfRules = $('#wireframe_rules');\n    if (!wfRules.length) {\n      wfRules = $('<style id=\"wireframe_rules\"></style>').appendTo('head');\n    } else {\n      wfRules.empty();\n    }\n\n    updateWireFrame();\n  };\n\n  $('#svg_docprops_container, #svg_prefs_container').draggable({\n    cancel: 'button,fieldset',\n    containment: 'window'\n  }).css('position', 'absolute');\n\n  let docprops = false;\n  let preferences = false;\n\n  const showDocProperties = function () {\n    if (docprops) { return; }\n    docprops = true;\n\n    // This selects the correct radio button by using the array notation\n    $('#image_save_opts input').val([$.pref('img_save')]);\n\n    // update resolution option with actual resolution\n    const res = svgCanvas.getResolution();\n    if (curConfig.baseUnit !== 'px') {\n      res.w = convertUnit(res.w) + curConfig.baseUnit;\n      res.h = convertUnit(res.h) + curConfig.baseUnit;\n    }\n\n    $('#canvas_width').val(res.w);\n    $('#canvas_height').val(res.h);\n    $('#canvas_title').val(svgCanvas.getDocumentTitle());\n\n    $('#svg_docprops').show();\n  };\n\n  const showPreferences = function () {\n    if (preferences) { return; }\n    preferences = true;\n    $('#main_menu').hide();\n\n    // Update background color with current one\n    const blocks = $('#bg_blocks div');\n    const curBg = 'cur_background';\n    const canvasBg = curPrefs.bkgd_color;\n    const url = $.pref('bkgd_url');\n    blocks.each(function () {\n      const blk = $(this);\n      const isBg = blk.css('background-color') === canvasBg;\n      blk.toggleClass(curBg, isBg);\n      if (isBg) { $('#canvas_bg_url').removeClass(curBg); }\n    });\n    if (!canvasBg) { blocks.eq(0).addClass(curBg); }\n    if (url) {\n      $('#canvas_bg_url').val(url);\n    }\n    $('#grid_snapping_on').prop('checked', curConfig.gridSnapping);\n    $('#grid_snapping_step').attr('value', curConfig.snappingStep);\n    $('#grid_color').attr('value', curConfig.gridColor);\n\n    $('#svg_prefs').show();\n  };\n\n  const hideSourceEditor = function () {\n    $('#svg_source_editor').hide();\n    editingsource = false;\n    $('#svg_source_textarea').blur();\n  };\n\n  const saveSourceEditor = function () {\n    if (!editingsource) { return; }\n\n    const saveChanges = function () {\n      svgCanvas.clearSelection();\n      hideSourceEditor();\n      zoomImage();\n      populateLayers();\n      updateTitle();\n      prepPaints();\n    };\n\n    if (!svgCanvas.setSvgString($('#svg_source_textarea').val())) {\n      $.confirm(uiStrings.notification.QerrorsRevertToSource, function (ok) {\n        if (!ok) { return false; }\n        saveChanges();\n      });\n    } else {\n      saveChanges();\n    }\n    setSelectMode();\n  };\n\n  const hideDocProperties = function () {\n    $('#svg_docprops').hide();\n    $('#canvas_width,#canvas_height').removeAttr('disabled');\n    $('#resolution')[0].selectedIndex = 0;\n    $('#image_save_opts input').val([$.pref('img_save')]);\n    docprops = false;\n  };\n\n  const hidePreferences = function () {\n    $('#svg_prefs').hide();\n    preferences = false;\n  };\n\n  const saveDocProperties = function () {\n    // set title\n    const newTitle = $('#canvas_title').val();\n    updateTitle(newTitle);\n    svgCanvas.setDocumentTitle(newTitle);\n\n    // update resolution\n    const width = $('#canvas_width'), w = width.val();\n    const height = $('#canvas_height'), h = height.val();\n\n    if (w !== 'fit' && !isValidUnit('width', w)) {\n      $.alert(uiStrings.notification.invalidAttrValGiven);\n      width.parent().addClass('error');\n      return false;\n    }\n\n    width.parent().removeClass('error');\n\n    if (h !== 'fit' && !isValidUnit('height', h)) {\n      $.alert(uiStrings.notification.invalidAttrValGiven);\n      height.parent().addClass('error');\n      return false;\n    }\n\n    height.parent().removeClass('error');\n\n    if (!svgCanvas.setResolution(w, h)) {\n      $.alert(uiStrings.notification.noContentToFitTo);\n      return false;\n    }\n\n    // Set image save option\n    $.pref('img_save', $('#image_save_opts :checked').val());\n    updateCanvas();\n    hideDocProperties();\n  };\n\n  /**\n  * Save user preferences based on current values in the UI\n  */\n  const savePreferences = editor.savePreferences = function () {\n    // Set background\n    const color = $('#bg_blocks div.cur_background').css('background-color') || '#FFF';\n    setBackground(color, $('#canvas_bg_url').val());\n\n    // set language\n    const lang = $('#lang_select').val();\n    if (lang !== $.pref('lang')) {\n      editor.putLocale(lang, goodLangs, curConfig);\n    }\n\n    // set icon size\n    setIconSize($('#iconsize').val());\n\n    // set grid setting\n    curConfig.gridSnapping = $('#grid_snapping_on')[0].checked;\n    curConfig.snappingStep = $('#grid_snapping_step').val();\n    curConfig.gridColor = $('#grid_color').val();\n    curConfig.showRulers = $('#show_rulers')[0].checked;\n\n    $('#rulers').toggle(curConfig.showRulers);\n    if (curConfig.showRulers) { updateRulers(); }\n    curConfig.baseUnit = $('#base_unit').val();\n\n    svgCanvas.setConfig(curConfig);\n\n    updateCanvas();\n    hidePreferences();\n  };\n\n  let resetScrollPos = $.noop;\n\n  const cancelOverlays = function () {\n    $('#dialog_box').hide();\n    if (!editingsource && !docprops && !preferences) {\n      if (curContext) {\n        svgCanvas.leaveContext();\n      }\n      return;\n    }\n\n    if (editingsource) {\n      if (origSource !== $('#svg_source_textarea').val()) {\n        $.confirm(uiStrings.notification.QignoreSourceChanges, function (ok) {\n          if (ok) { hideSourceEditor(); }\n        });\n      } else {\n        hideSourceEditor();\n      }\n    } else if (docprops) {\n      hideDocProperties();\n    } else if (preferences) {\n      hidePreferences();\n    }\n    resetScrollPos();\n  };\n\n  const winWh = {width: $(window).width(), height: $(window).height()};\n\n  // Fix for Issue 781: Drawing area jumps to top-left corner on window resize (IE9)\n  if (isIE()) {\n    (() => {\n      resetScrollPos = function () {\n        if (workarea[0].scrollLeft === 0 && workarea[0].scrollTop === 0) {\n          workarea[0].scrollLeft = curScrollPos.left;\n          workarea[0].scrollTop = curScrollPos.top;\n        }\n      };\n\n      curScrollPos = {\n        left: workarea[0].scrollLeft,\n        top: workarea[0].scrollTop\n      };\n\n      $(window).resize(resetScrollPos);\n      editor.ready(function () {\n        // TODO: Find better way to detect when to do this to minimize\n        // flickering effect\n        setTimeout(function () {\n          resetScrollPos();\n        }, 500);\n      });\n\n      workarea.scroll(function () {\n        curScrollPos = {\n          left: workarea[0].scrollLeft,\n          top: workarea[0].scrollTop\n        };\n      });\n    })();\n  }\n\n  $(window).resize(function (evt) {\n    $.each(winWh, function (type, val) {\n      const curval = $(window)[type]();\n      workarea[0]['scroll' + (type === 'width' ? 'Left' : 'Top')] -= (curval - val) / 2;\n      winWh[type] = curval;\n    });\n    setFlyoutPositions();\n  });\n\n  (() => {\n    workarea.scroll(function () {\n      // TODO: jQuery's scrollLeft/Top() wouldn't require a null check\n      if ($('#ruler_x').length) {\n        $('#ruler_x')[0].scrollLeft = workarea[0].scrollLeft;\n      }\n      if ($('#ruler_y').length) {\n        $('#ruler_y')[0].scrollTop = workarea[0].scrollTop;\n      }\n    });\n  })();\n\n  $('#url_notice').click(function () {\n    $.alert(this.title);\n  });\n\n  $('#change_image_url').click(promptImgURL);\n\n  // added these event handlers for all the push buttons so they\n  // behave more like buttons being pressed-in and not images\n  (function () {\n    const toolnames = ['clear', 'open', 'save', 'source', 'delete', 'delete_multi', 'paste', 'clone', 'clone_multi', 'move_top', 'move_bottom'];\n    const curClass = 'tool_button_current';\n\n    let allTools = '';\n\n    $.each(toolnames, function (i, item) {\n      allTools += (i ? ',' : '') + '#tool_' + item;\n    });\n\n    $(allTools).mousedown(function () {\n      $(this).addClass(curClass);\n    }).bind('mousedown mouseout', function () {\n      $(this).removeClass(curClass);\n    });\n\n    $('#tool_undo, #tool_redo').mousedown(function () {\n      if (!$(this).hasClass('disabled')) { $(this).addClass(curClass); }\n    }).bind('mousedown mouseout', function () {\n      $(this).removeClass(curClass);\n    });\n  }());\n\n  // switch modifier key in tooltips if mac\n  // NOTE: This code is not used yet until I can figure out how to successfully bind ctrl/meta\n  // in Opera and Chrome\n  if (isMac() && !window.opera) {\n    const shortcutButtons = ['tool_clear', 'tool_save', 'tool_source', 'tool_undo', 'tool_redo', 'tool_clone'];\n    let i = shortcutButtons.length;\n    while (i--) {\n      const button = document.getElementById(shortcutButtons[i]);\n      if (button) {\n        const {title} = button;\n        const index = title.indexOf('Ctrl+');\n        button.title = [title.substr(0, index), 'Cmd+', title.substr(index + 5)].join('');\n      }\n    }\n  }\n\n  // TODO: go back to the color boxes having white background-color and then setting\n  //  background-image to none.png (otherwise partially transparent gradients look weird)\n  const colorPicker = function (elem) {\n    const picker = elem.attr('id') === 'stroke_color' ? 'stroke' : 'fill';\n    // const opacity = (picker == 'stroke' ? $('#stroke_opacity') : $('#fill_opacity'));\n    const title = (picker === 'stroke' ? 'Pick a Stroke Paint and Opacity' : 'Pick a Fill Paint and Opacity');\n    // let wasNone = false; // Currently unused\n    const pos = elem.offset();\n    let {paint} = paintBox[picker];\n    $('#color_picker')\n      .draggable({\n        cancel: '.jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker',\n        containment: 'window'\n      })\n      .css(curConfig.colorPickerCSS || {left: pos.left - 140, bottom: 40})\n      .jGraduate(\n        {\n          paint,\n          window: { pickerTitle: title },\n          images: { clientPath: curConfig.jGraduatePath },\n          newstop: 'inverse'\n        },\n        function (p) {\n          paint = new $.jGraduate.Paint(p);\n          paintBox[picker].setPaint(paint);\n          svgCanvas.setPaint(picker, paint);\n          $('#color_picker').hide();\n        },\n        function () {\n          $('#color_picker').hide();\n        }\n      );\n  };\n\n  const PaintBox = function (container, type) {\n    let paintColor, paintOpacity;\n    const cur = curConfig[type === 'fill' ? 'initFill' : 'initStroke'];\n    // set up gradients to be used for the buttons\n    const svgdocbox = new DOMParser().parseFromString(\n      '<svg xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"16.5\" height=\"16.5\"' +\n'          fill=\"#' + cur.color + '\" opacity=\"' + cur.opacity + '\"/>' +\n'          <defs><linearGradient id=\"gradbox_\"/></defs></svg>', 'text/xml');\n\n    let docElem = svgdocbox.documentElement;\n    docElem = $(container)[0].appendChild(document.importNode(docElem, true));\n    docElem.setAttribute('width', 16.5);\n\n    this.rect = docElem.firstChild;\n    this.defs = docElem.getElementsByTagName('defs')[0];\n    this.grad = this.defs.firstChild;\n    this.paint = new $.jGraduate.Paint({solidColor: cur.color});\n    this.type = type;\n\n    this.setPaint = function (paint, apply) {\n      this.paint = paint;\n\n      const ptype = paint.type;\n      const opac = paint.alpha / 100;\n\n      let fillAttr = 'none';\n      switch (ptype) {\n      case 'solidColor':\n        fillAttr = (paint[ptype] !== 'none') ? '#' + paint[ptype] : paint[ptype];\n        break;\n      case 'linearGradient':\n      case 'radialGradient':\n        this.grad.remove();\n        this.grad = this.defs.appendChild(paint[ptype]);\n        const id = this.grad.id = 'gradbox_' + this.type;\n        fillAttr = 'url(#' + id + ')';\n        break;\n      }\n\n      this.rect.setAttribute('fill', fillAttr);\n      this.rect.setAttribute('opacity', opac);\n\n      if (apply) {\n        svgCanvas.setColor(this.type, paintColor, true);\n        svgCanvas.setPaintOpacity(this.type, paintOpacity, true);\n      }\n    };\n\n    this.update = function (apply) {\n      if (!selectedElement) { return; }\n\n      const {type} = this;\n      switch (selectedElement.tagName) {\n      case 'use':\n      case 'image':\n      case 'foreignObject':\n        // These elements don't have fill or stroke, so don't change\n        // the current value\n        return;\n      case 'g':\n      case 'a': {\n        const childs = selectedElement.getElementsByTagName('*');\n\n        let gPaint = null;\n        for (let i = 0, len = childs.length; i < len; i++) {\n          const elem = childs[i];\n          const p = elem.getAttribute(type);\n          if (i === 0) {\n            gPaint = p;\n          } else if (gPaint !== p) {\n            gPaint = null;\n            break;\n          }\n        }\n\n        if (gPaint === null) {\n          // No common color, don't update anything\n          paintColor = null;\n          return;\n        }\n        paintColor = gPaint;\n        paintOpacity = 1;\n        break;\n      } default:\n        paintOpacity = parseFloat(selectedElement.getAttribute(type + '-opacity'));\n        if (isNaN(paintOpacity)) {\n          paintOpacity = 1.0;\n        }\n\n        const defColor = type === 'fill' ? 'black' : 'none';\n        paintColor = selectedElement.getAttribute(type) || defColor;\n      }\n\n      if (apply) {\n        svgCanvas.setColor(type, paintColor, true);\n        svgCanvas.setPaintOpacity(type, paintOpacity, true);\n      }\n\n      paintOpacity *= 100;\n\n      const paint = getPaint(paintColor, paintOpacity, type);\n      // update the rect inside #fill_color/#stroke_color\n      this.setPaint(paint);\n    };\n\n    this.prep = function () {\n      const ptype = this.paint.type;\n\n      switch (ptype) {\n      case 'linearGradient':\n      case 'radialGradient':\n        const paint = new $.jGraduate.Paint({copy: this.paint});\n        svgCanvas.setPaint(type, paint);\n        break;\n      }\n    };\n  };\n\n  paintBox.fill = new PaintBox('#fill_color', 'fill');\n  paintBox.stroke = new PaintBox('#stroke_color', 'stroke');\n\n  $('#stroke_width').val(curConfig.initStroke.width);\n  $('#group_opacity').val(curConfig.initOpacity * 100);\n\n  // Use this SVG elem to test vectorEffect support\n  const testEl = paintBox.fill.rect.cloneNode(false);\n  testEl.setAttribute('style', 'vector-effect:non-scaling-stroke');\n  const supportsNonSS = (testEl.style.vectorEffect === 'non-scaling-stroke');\n  testEl.removeAttribute('style');\n  const svgdocbox = paintBox.fill.rect.ownerDocument;\n  // Use this to test support for blur element. Seems to work to test support in Webkit\n  const blurTest = svgdocbox.createElementNS(NS.SVG, 'feGaussianBlur');\n  if (blurTest.stdDeviationX === undefined) {\n    $('#tool_blur').hide();\n  }\n  $(blurTest).remove();\n\n  // Test for zoom icon support\n  (function () {\n    const pre = '-' + uaPrefix.toLowerCase() + '-zoom-';\n    const zoom = pre + 'in';\n    workarea.css('cursor', zoom);\n    if (workarea.css('cursor') === zoom) {\n      zoomInIcon = zoom;\n      zoomOutIcon = pre + 'out';\n    }\n    workarea.css('cursor', 'auto');\n  }());\n\n  // Test for embedImage support (use timeout to not interfere with page load)\n  setTimeout(function () {\n    svgCanvas.embedImage('images/logo.png', function (datauri) {\n      if (!datauri) {\n        // Disable option\n        $('#image_save_opts [value=embed]').attr('disabled', 'disabled');\n        $('#image_save_opts input').val(['ref']);\n        $.pref('img_save', 'ref');\n        $('#image_opt_embed').css('color', '#666').attr('title', uiStrings.notification.featNotSupported);\n      }\n    });\n  }, 1000);\n\n  $('#fill_color, #tool_fill .icon_label').click(function () {\n    colorPicker($('#fill_color'));\n    updateToolButtonState();\n  });\n\n  $('#stroke_color, #tool_stroke .icon_label').click(function () {\n    colorPicker($('#stroke_color'));\n    updateToolButtonState();\n  });\n\n  $('#group_opacityLabel').click(function () {\n    $('#opacity_dropdown button').mousedown();\n    $(window).mouseup();\n  });\n\n  $('#zoomLabel').click(function () {\n    $('#zoom_dropdown button').mousedown();\n    $(window).mouseup();\n  });\n\n  $('#tool_move_top').mousedown(function (evt) {\n    $('#tools_stacking').show();\n    evt.preventDefault();\n  });\n\n  $('.layer_button').mousedown(function () {\n    $(this).addClass('layer_buttonpressed');\n  }).mouseout(function () {\n    $(this).removeClass('layer_buttonpressed');\n  }).mouseup(function () {\n    $(this).removeClass('layer_buttonpressed');\n  });\n\n  $('.push_button').mousedown(function () {\n    if (!$(this).hasClass('disabled')) {\n      $(this).addClass('push_button_pressed').removeClass('push_button');\n    }\n  }).mouseout(function () {\n    $(this).removeClass('push_button_pressed').addClass('push_button');\n  }).mouseup(function () {\n    $(this).removeClass('push_button_pressed').addClass('push_button');\n  });\n\n  // ask for a layer name\n  $('#layer_new').click(function () {\n    let uniqName,\n      i = svgCanvas.getCurrentDrawing().getNumLayers();\n    do {\n      uniqName = uiStrings.layers.layer + ' ' + (++i);\n    } while (svgCanvas.getCurrentDrawing().hasLayer(uniqName));\n\n    $.prompt(uiStrings.notification.enterUniqueLayerName, uniqName, function (newName) {\n      if (!newName) { return; }\n      if (svgCanvas.getCurrentDrawing().hasLayer(newName)) {\n        $.alert(uiStrings.notification.dupeLayerName);\n        return;\n      }\n      svgCanvas.createLayer(newName);\n      updateContextPanel();\n      populateLayers();\n    });\n  });\n\n  function deleteLayer () {\n    if (svgCanvas.deleteCurrentLayer()) {\n      updateContextPanel();\n      populateLayers();\n      // This matches what SvgCanvas does\n      // TODO: make this behavior less brittle (svg-editor should get which\n      // layer is selected from the canvas and then select that one in the UI)\n      $('#layerlist tr.layer').removeClass('layersel');\n      $('#layerlist tr.layer:first').addClass('layersel');\n    }\n  }\n\n  function cloneLayer () {\n    const name = svgCanvas.getCurrentDrawing().getCurrentLayerName() + ' copy';\n\n    $.prompt(uiStrings.notification.enterUniqueLayerName, name, function (newName) {\n      if (!newName) { return; }\n      if (svgCanvas.getCurrentDrawing().hasLayer(newName)) {\n        $.alert(uiStrings.notification.dupeLayerName);\n        return;\n      }\n      svgCanvas.cloneLayer(newName);\n      updateContextPanel();\n      populateLayers();\n    });\n  }\n\n  function mergeLayer () {\n    if ($('#layerlist tr.layersel').index() === svgCanvas.getCurrentDrawing().getNumLayers() - 1) {\n      return;\n    }\n    svgCanvas.mergeLayer();\n    updateContextPanel();\n    populateLayers();\n  }\n\n  function moveLayer (pos) {\n    const total = svgCanvas.getCurrentDrawing().getNumLayers();\n\n    let curIndex = $('#layerlist tr.layersel').index();\n    if (curIndex > 0 || curIndex < total - 1) {\n      curIndex += pos;\n      svgCanvas.setCurrentLayerPosition(total - curIndex - 1);\n      populateLayers();\n    }\n  }\n\n  $('#layer_delete').click(deleteLayer);\n\n  $('#layer_up').click(() => {\n    moveLayer(-1);\n  });\n\n  $('#layer_down').click(() => {\n    moveLayer(1);\n  });\n\n  $('#layer_rename').click(function () {\n    // const curIndex = $('#layerlist tr.layersel').prevAll().length; // Currently unused\n    const oldName = $('#layerlist tr.layersel td.layername').text();\n    $.prompt(uiStrings.notification.enterNewLayerName, '', function (newName) {\n      if (!newName) { return; }\n      if (oldName === newName || svgCanvas.getCurrentDrawing().hasLayer(newName)) {\n        $.alert(uiStrings.notification.layerHasThatName);\n        return;\n      }\n\n      svgCanvas.renameCurrentLayer(newName);\n      populateLayers();\n    });\n  });\n\n  const SIDEPANEL_MAXWIDTH = 300;\n  const SIDEPANEL_OPENWIDTH = 150;\n  let sidedrag = -1, sidedragging = false, allowmove = false;\n\n  const changeSidePanelWidth = function (delta) {\n    const rulerX = $('#ruler_x');\n    $('#sidepanels').width('+=' + delta);\n    $('#layerpanel').width('+=' + delta);\n    rulerX.css('right', parseInt(rulerX.css('right'), 10) + delta);\n    workarea.css('right', parseInt(workarea.css('right'), 10) + delta);\n    svgCanvas.runExtensions('workareaResized');\n  };\n\n  const resizeSidePanel = function (evt) {\n    if (!allowmove) { return; }\n    if (sidedrag === -1) { return; }\n    sidedragging = true;\n    let deltaX = sidedrag - evt.pageX;\n    let sideWidth = $('#sidepanels').width();\n    if (sideWidth + deltaX > SIDEPANEL_MAXWIDTH) {\n      deltaX = SIDEPANEL_MAXWIDTH - sideWidth;\n      sideWidth = SIDEPANEL_MAXWIDTH;\n    } else if (sideWidth + deltaX < 2) {\n      deltaX = 2 - sideWidth;\n      sideWidth = 2;\n    }\n    if (deltaX === 0) { return; }\n    sidedrag -= deltaX;\n    changeSidePanelWidth(deltaX);\n  };\n\n  // if width is non-zero, then fully close it, otherwise fully open it\n  // the optional close argument forces the side panel closed\n  const toggleSidePanel = function (close) {\n    const w = $('#sidepanels').width();\n    const deltaX = (w > 2 || close ? 2 : SIDEPANEL_OPENWIDTH) - w;\n    changeSidePanelWidth(deltaX);\n  };\n\n  $('#sidepanel_handle')\n    .mousedown(function (evt) {\n      sidedrag = evt.pageX;\n      $(window).mousemove(resizeSidePanel);\n      allowmove = false;\n      // Silly hack for Chrome, which always runs mousemove right after mousedown\n      setTimeout(function () {\n        allowmove = true;\n      }, 20);\n    })\n    .mouseup(function (evt) {\n      if (!sidedragging) { toggleSidePanel(); }\n      sidedrag = -1;\n      sidedragging = false;\n    });\n\n  $(window).mouseup(function () {\n    sidedrag = -1;\n    sidedragging = false;\n    $('#svg_editor').unbind('mousemove', resizeSidePanel);\n  });\n\n  populateLayers();\n\n  // function changeResolution (x,y) {\n  //   const {zoom} = svgCanvas.getResolution();\n  //   setResolution(x * zoom, y * zoom);\n  // }\n\n  const centerCanvas = () => {\n    // this centers the canvas vertically in the workarea (horizontal handled in CSS)\n    workarea.css('line-height', workarea.height() + 'px');\n  };\n\n  $(window).bind('load resize', centerCanvas);\n\n  function stepFontSize (elem, step) {\n    const origVal = Number(elem.value);\n    const sugVal = origVal + step;\n    const increasing = sugVal >= origVal;\n    if (step === 0) { return origVal; }\n\n    if (origVal >= 24) {\n      if (increasing) {\n        return Math.round(origVal * 1.1);\n      }\n      return Math.round(origVal / 1.1);\n    }\n    if (origVal <= 1) {\n      if (increasing) {\n        return origVal * 2;\n      }\n      return origVal / 2;\n    }\n    return sugVal;\n  }\n\n  function stepZoom (elem, step) {\n    const origVal = Number(elem.value);\n    if (origVal === 0) { return 100; }\n    const sugVal = origVal + step;\n    if (step === 0) { return origVal; }\n\n    if (origVal >= 100) {\n      return sugVal;\n    }\n    if (sugVal >= origVal) {\n      return origVal * 2;\n    }\n    return origVal / 2;\n  }\n\n  // function setResolution (w, h, center) {\n  //   updateCanvas();\n  //   // w -= 0; h -= 0;\n  //   // $('#svgcanvas').css({width: w, height: h});\n  //   // $('#canvas_width').val(w);\n  //   // $('#canvas_height').val(h);\n  //   //\n  //   // if (center) {\n  //   //   const wArea = workarea;\n  //   //   const scrollY = h/2 - wArea.height()/2;\n  //   //   const scrollX = w/2 - wArea.width()/2;\n  //   //   wArea[0].scrollTop = scrollY;\n  //   //   wArea[0].scrollLeft = scrollX;\n  //   // }\n  // }\n\n  $('#resolution').change(function () {\n    const wh = $('#canvas_width,#canvas_height');\n    if (!this.selectedIndex) {\n      if ($('#canvas_width').val() === 'fit') {\n        wh.removeAttr('disabled').val(100);\n      }\n    } else if (this.value === 'content') {\n      wh.val('fit').attr('disabled', 'disabled');\n    } else {\n      const dims = this.value.split('x');\n      $('#canvas_width').val(dims[0]);\n      $('#canvas_height').val(dims[1]);\n      wh.removeAttr('disabled');\n    }\n  });\n\n  // Prevent browser from erroneously repopulating fields\n  $('input,select').attr('autocomplete', 'off');\n\n  // Associate all button actions as well as non-button keyboard shortcuts\n  const Actions = (function () {\n    // sel:'selector', fn:function, evt:'event', key:[key, preventDefault, NoDisableInInput]\n    const toolButtons = [\n      {sel: '#tool_select', fn: clickSelect, evt: 'click', key: ['V', true]},\n      {sel: '#tool_fhpath', fn: clickFHPath, evt: 'click', key: ['Q', true]},\n      {sel: '#tool_line', fn: clickLine, evt: 'click', key: ['L', true]},\n      {sel: '#tool_rect', fn: clickRect, evt: 'mouseup', key: ['R', true], parent: '#tools_rect', icon: 'rect'},\n      {sel: '#tool_square', fn: clickSquare, evt: 'mouseup', parent: '#tools_rect', icon: 'square'},\n      {sel: '#tool_fhrect', fn: clickFHRect, evt: 'mouseup', parent: '#tools_rect', icon: 'fh_rect'},\n      {sel: '#tool_ellipse', fn: clickEllipse, evt: 'mouseup', key: ['E', true], parent: '#tools_ellipse', icon: 'ellipse'},\n      {sel: '#tool_circle', fn: clickCircle, evt: 'mouseup', parent: '#tools_ellipse', icon: 'circle'},\n      {sel: '#tool_fhellipse', fn: clickFHEllipse, evt: 'mouseup', parent: '#tools_ellipse', icon: 'fh_ellipse'},\n      {sel: '#tool_path', fn: clickPath, evt: 'click', key: ['P', true]},\n      {sel: '#tool_text', fn: clickText, evt: 'click', key: ['T', true]},\n      {sel: '#tool_image', fn: clickImage, evt: 'mouseup'},\n      {sel: '#tool_zoom', fn: clickZoom, evt: 'mouseup', key: ['Z', true]},\n      {sel: '#tool_clear', fn: clickClear, evt: 'mouseup', key: ['N', true]},\n      {sel: '#tool_save', fn () {\n        if (editingsource) {\n          saveSourceEditor();\n        } else {\n          clickSave();\n        }\n      }, evt: 'mouseup', key: ['S', true]},\n      {sel: '#tool_export', fn: clickExport, evt: 'mouseup'},\n      {sel: '#tool_open', fn: clickOpen, evt: 'mouseup', key: ['O', true]},\n      {sel: '#tool_import', fn: clickImport, evt: 'mouseup'},\n      {sel: '#tool_source', fn: showSourceEditor, evt: 'click', key: ['U', true]},\n      {sel: '#tool_wireframe', fn: clickWireframe, evt: 'click', key: ['F', true]},\n      {sel: '#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel', fn: cancelOverlays, evt: 'click', key: ['esc', false, false], hidekey: true},\n      {sel: '#tool_source_save', fn: saveSourceEditor, evt: 'click'},\n      {sel: '#tool_docprops_save', fn: saveDocProperties, evt: 'click'},\n      {sel: '#tool_docprops', fn: showDocProperties, evt: 'mouseup'},\n      {sel: '#tool_prefs_save', fn: savePreferences, evt: 'click'},\n      {sel: '#tool_prefs_option', fn () { showPreferences(); return false; }, evt: 'mouseup'},\n      {sel: '#tool_delete,#tool_delete_multi', fn: deleteSelected, evt: 'click', key: ['del/backspace', true]},\n      {sel: '#tool_reorient', fn: reorientPath, evt: 'click'},\n      {sel: '#tool_node_link', fn: linkControlPoints, evt: 'click'},\n      {sel: '#tool_node_clone', fn: clonePathNode, evt: 'click'},\n      {sel: '#tool_node_delete', fn: deletePathNode, evt: 'click'},\n      {sel: '#tool_openclose_path', fn: opencloseSubPath, evt: 'click'},\n      {sel: '#tool_add_subpath', fn: addSubPath, evt: 'click'},\n      {sel: '#tool_move_top', fn: moveToTopSelected, evt: 'click', key: 'ctrl+shift+]'},\n      {sel: '#tool_move_bottom', fn: moveToBottomSelected, evt: 'click', key: 'ctrl+shift+['},\n      {sel: '#tool_topath', fn: convertToPath, evt: 'click'},\n      {sel: '#tool_make_link,#tool_make_link_multi', fn: makeHyperlink, evt: 'click'},\n      {sel: '#tool_undo', fn: clickUndo, evt: 'click'},\n      {sel: '#tool_redo', fn: clickRedo, evt: 'click'},\n      {sel: '#tool_clone,#tool_clone_multi', fn: clickClone, evt: 'click', key: ['D', true]},\n      {sel: '#tool_group_elements', fn: clickGroup, evt: 'click', key: ['G', true]},\n      {sel: '#tool_ungroup', fn: clickGroup, evt: 'click'},\n      {sel: '#tool_unlink_use', fn: clickGroup, evt: 'click'},\n      {sel: '[id^=tool_align]', fn: clickAlign, evt: 'click'},\n      // these two lines are required to make Opera work properly with the flyout mechanism\n      // {sel: '#tools_rect_show', fn: clickRect, evt: 'click'},\n      // {sel: '#tools_ellipse_show', fn: clickEllipse, evt: 'click'},\n      {sel: '#tool_bold', fn: clickBold, evt: 'mousedown'},\n      {sel: '#tool_italic', fn: clickItalic, evt: 'mousedown'},\n      {sel: '#sidepanel_handle', fn: toggleSidePanel, key: ['X']},\n      {sel: '#copy_save_done', fn: cancelOverlays, evt: 'click'},\n\n      // Shortcuts not associated with buttons\n\n      {key: 'ctrl+left', fn () { rotateSelected(0, 1); }},\n      {key: 'ctrl+right', fn () { rotateSelected(1, 1); }},\n      {key: 'ctrl+shift+left', fn () { rotateSelected(0, 5); }},\n      {key: 'ctrl+shift+right', fn () { rotateSelected(1, 5); }},\n      {key: 'shift+O', fn: selectPrev},\n      {key: 'shift+P', fn: selectNext},\n      {key: [modKey + 'up', true], fn () { zoomImage(2); }},\n      {key: [modKey + 'down', true], fn () { zoomImage(0.5); }},\n      {key: [modKey + ']', true], fn () { moveUpDownSelected('Up'); }},\n      {key: [modKey + '[', true], fn () { moveUpDownSelected('Down'); }},\n      {key: ['up', true], fn () { moveSelected(0, -1); }},\n      {key: ['down', true], fn () { moveSelected(0, 1); }},\n      {key: ['left', true], fn () { moveSelected(-1, 0); }},\n      {key: ['right', true], fn () { moveSelected(1, 0); }},\n      {key: 'shift+up', fn () { moveSelected(0, -10); }},\n      {key: 'shift+down', fn () { moveSelected(0, 10); }},\n      {key: 'shift+left', fn () { moveSelected(-10, 0); }},\n      {key: 'shift+right', fn () { moveSelected(10, 0); }},\n      {key: ['alt+up', true], fn () { svgCanvas.cloneSelectedElements(0, -1); }},\n      {key: ['alt+down', true], fn () { svgCanvas.cloneSelectedElements(0, 1); }},\n      {key: ['alt+left', true], fn () { svgCanvas.cloneSelectedElements(-1, 0); }},\n      {key: ['alt+right', true], fn () { svgCanvas.cloneSelectedElements(1, 0); }},\n      {key: ['alt+shift+up', true], fn () { svgCanvas.cloneSelectedElements(0, -10); }},\n      {key: ['alt+shift+down', true], fn () { svgCanvas.cloneSelectedElements(0, 10); }},\n      {key: ['alt+shift+left', true], fn () { svgCanvas.cloneSelectedElements(-10, 0); }},\n      {key: ['alt+shift+right', true], fn () { svgCanvas.cloneSelectedElements(10, 0); }},\n      {key: 'A', fn () { svgCanvas.selectAllInCurrentLayer(); }},\n\n      // Standard shortcuts\n      {key: modKey + 'z', fn: clickUndo},\n      {key: modKey + 'shift+z', fn: clickRedo},\n      {key: modKey + 'y', fn: clickRedo},\n\n      {key: modKey + 'x', fn: cutSelected},\n      {key: modKey + 'c', fn: copySelected},\n      {key: modKey + 'v', fn: pasteInCenter}\n    ];\n\n    // Tooltips not directly associated with a single function\n    const keyAssocs = {\n      '4/Shift+4': '#tools_rect_show',\n      '5/Shift+5': '#tools_ellipse_show'\n    };\n\n    return {\n      setAll () {\n        const flyouts = {};\n\n        $.each(toolButtons, function (i, opts) {\n          // Bind function to button\n          let btn;\n          if (opts.sel) {\n            btn = $(opts.sel);\n            if (!btn.length) { return true; } // Skip if markup does not exist\n            if (opts.evt) {\n              if (isTouch() && opts.evt === 'click') {\n                opts.evt = 'mousedown';\n              }\n              btn[opts.evt](opts.fn);\n            }\n\n            // Add to parent flyout menu, if able to be displayed\n            if (opts.parent && $(opts.parent + '_show').length) {\n              let fH = $(opts.parent);\n              if (!fH.length) {\n                fH = makeFlyoutHolder(opts.parent.substr(1));\n              }\n\n              fH.append(btn);\n\n              if (!Array.isArray(flyouts[opts.parent])) {\n                flyouts[opts.parent] = [];\n              }\n              flyouts[opts.parent].push(opts);\n            }\n          }\n\n          // Bind function to shortcut key\n          if (opts.key) {\n            // Set shortcut based on options\n            let keyval,\n              // disInInp = true,\n              pd = false;\n            if (Array.isArray(opts.key)) {\n              keyval = opts.key[0];\n              if (opts.key.length > 1) { pd = opts.key[1]; }\n              // if (opts.key.length > 2) { disInInp = opts.key[2]; }\n            } else {\n              keyval = opts.key;\n            }\n            keyval += '';\n\n            const {fn} = opts;\n            $.each(keyval.split('/'), function (i, key) {\n              $(document).bind('keydown', key, function (e) {\n                fn();\n                if (pd) {\n                  e.preventDefault();\n                }\n                // Prevent default on ALL keys?\n                return false;\n              });\n            });\n\n            // Put shortcut in title\n            if (opts.sel && !opts.hidekey && btn.attr('title')) {\n              const newTitle = btn.attr('title').split('[')[0] + ' (' + keyval + ')';\n              keyAssocs[keyval] = opts.sel;\n              // Disregard for menu items\n              if (!btn.parents('#main_menu').length) {\n                btn.attr('title', newTitle);\n              }\n            }\n          }\n        });\n\n        // Setup flyouts\n        setupFlyouts(flyouts);\n\n        // Misc additional actions\n\n        // Make 'return' keypress trigger the change event\n        $('.attr_changer, #image_url').bind('keydown', 'return',\n          function (evt) {\n            $(this).change();\n            evt.preventDefault();\n          }\n        );\n\n        $(window).bind('keydown', 'tab', function (e) {\n          if (uiContext === 'canvas') {\n            e.preventDefault();\n            selectNext();\n          }\n        }).bind('keydown', 'shift+tab', function (e) {\n          if (uiContext === 'canvas') {\n            e.preventDefault();\n            selectPrev();\n          }\n        });\n\n        $('#tool_zoom').dblclick(dblclickZoom);\n      },\n      setTitles () {\n        $.each(keyAssocs, function (keyval, sel) {\n          const menu = ($(sel).parents('#main_menu').length);\n\n          $(sel).each(function () {\n            let t;\n            if (menu) {\n              t = $(this).text().split(' [')[0];\n            } else {\n              t = this.title.split(' [')[0];\n            }\n            let keyStr = '';\n            // Shift+Up\n            $.each(keyval.split('/'), function (i, key) {\n              const modBits = key.split('+');\n              let mod = '';\n              if (modBits.length > 1) {\n                mod = modBits[0] + '+';\n                key = modBits[1];\n              }\n              keyStr += (i ? '/' : '') + mod + (uiStrings['key_' + key] || key);\n            });\n            if (menu) {\n              this.lastChild.textContent = t + ' [' + keyStr + ']';\n            } else {\n              this.title = t + ' [' + keyStr + ']';\n            }\n          });\n        });\n      },\n      getButtonData (sel) {\n        let b;\n        $.each(toolButtons, function (i, btn) {\n          if (btn.sel === sel) { b = btn; }\n        });\n        return b;\n      }\n    };\n  }());\n\n  Actions.setAll();\n\n  // Select given tool\n  editor.ready(function () {\n    let tool;\n    const itool = curConfig.initTool,\n      container = $('#tools_left, #svg_editor .tools_flyout'),\n      preTool = container.find('#tool_' + itool),\n      regTool = container.find('#' + itool);\n    if (preTool.length) {\n      tool = preTool;\n    } else if (regTool.length) {\n      tool = regTool;\n    } else {\n      tool = $('#tool_select');\n    }\n    tool.click().mouseup();\n\n    if (curConfig.wireframe) {\n      $('#tool_wireframe').click();\n    }\n\n    if (curConfig.showlayers) {\n      toggleSidePanel();\n    }\n\n    $('#rulers').toggle(!!curConfig.showRulers);\n\n    if (curConfig.showRulers) {\n      $('#show_rulers')[0].checked = true;\n    }\n\n    if (curConfig.baseUnit) {\n      $('#base_unit').val(curConfig.baseUnit);\n    }\n\n    if (curConfig.gridSnapping) {\n      $('#grid_snapping_on')[0].checked = true;\n    }\n\n    if (curConfig.snappingStep) {\n      $('#grid_snapping_step').val(curConfig.snappingStep);\n    }\n\n    if (curConfig.gridColor) {\n      $('#grid_color').val(curConfig.gridColor);\n    }\n  });\n\n  // init SpinButtons\n  $('#rect_rx').SpinButton({min: 0, max: 1000, stateObj, callback: changeRectRadius});\n  $('#stroke_width').SpinButton({min: 0, max: 99, smallStep: 0.1, stateObj, callback: changeStrokeWidth});\n  $('#angle').SpinButton({min: -180, max: 180, step: 5, stateObj, callback: changeRotationAngle});\n  $('#font_size').SpinButton({min: 0.001, stepfunc: stepFontSize, stateObj, callback: changeFontSize});\n  $('#group_opacity').SpinButton({min: 0, max: 100, step: 5, stateObj, callback: changeOpacity});\n  $('#blur').SpinButton({min: 0, max: 10, step: 0.1, stateObj, callback: changeBlur});\n  $('#zoom').SpinButton({min: 0.001, max: 10000, step: 50, stepfunc: stepZoom, stateObj, callback: changeZoom})\n    // Set default zoom\n    .val(svgCanvas.getZoom() * 100);\n\n  $('#workarea').contextMenu(\n    {\n      menu: 'cmenu_canvas',\n      inSpeed: 0\n    },\n    function (action, el, pos) {\n      switch (action) {\n      case 'delete':\n        deleteSelected();\n        break;\n      case 'cut':\n        cutSelected();\n        break;\n      case 'copy':\n        copySelected();\n        break;\n      case 'paste':\n        svgCanvas.pasteElements();\n        break;\n      case 'paste_in_place':\n        svgCanvas.pasteElements('in_place');\n        break;\n      case 'group':\n      case 'group_elements':\n        svgCanvas.groupSelectedElements();\n        break;\n      case 'ungroup':\n        svgCanvas.ungroupSelectedElement();\n        break;\n      case 'move_front':\n        moveToTopSelected();\n        break;\n      case 'move_up':\n        moveUpDownSelected('Up');\n        break;\n      case 'move_down':\n        moveUpDownSelected('Down');\n        break;\n      case 'move_back':\n        moveToBottomSelected();\n        break;\n      default:\n        if (hasCustomHandler(action)) {\n          getCustomHandler(action).call();\n        }\n        break;\n      }\n    }\n  );\n\n  const lmenuFunc = function (action, el, pos) {\n    switch (action) {\n    case 'dupe':\n      cloneLayer();\n      break;\n    case 'delete':\n      deleteLayer();\n      break;\n    case 'merge_down':\n      mergeLayer();\n      break;\n    case 'merge_all':\n      svgCanvas.mergeAllLayers();\n      updateContextPanel();\n      populateLayers();\n      break;\n    }\n  };\n\n  $('#layerlist').contextMenu(\n    {\n      menu: 'cmenu_layers',\n      inSpeed: 0\n    },\n    lmenuFunc\n  );\n\n  $('#layer_moreopts').contextMenu(\n    {\n      menu: 'cmenu_layers',\n      inSpeed: 0,\n      allowLeft: true\n    },\n    lmenuFunc\n  );\n\n  $('.contextMenu li').mousedown(function (ev) {\n    ev.preventDefault();\n  });\n\n  $('#cmenu_canvas li').disableContextMenu();\n  canvMenu.enableContextMenuItems('#delete,#cut,#copy');\n\n  function enableOrDisableClipboard () {\n    let svgeditClipboard;\n    try {\n      svgeditClipboard = localStorage.getItem('svgedit_clipboard');\n    } catch (err) {}\n    canvMenu[(svgeditClipboard ? 'en' : 'dis') + 'ableContextMenuItems'](\n      '#paste,#paste_in_place'\n    );\n  }\n  enableOrDisableClipboard();\n\n  window.addEventListener('storage', function (e) {\n    if (e.key !== 'svgedit_clipboard') { return; }\n\n    enableOrDisableClipboard();\n  });\n\n  window.addEventListener('beforeunload', function (e) {\n    // Suppress warning if page is empty\n    if (undoMgr.getUndoStackSize() === 0) {\n      editor.showSaveWarning = false;\n    }\n\n    // showSaveWarning is set to 'false' when the page is saved.\n    if (!curConfig.no_save_warning && editor.showSaveWarning) {\n      // Browser already asks question about closing the page\n      e.returnValue = uiStrings.notification.unsavedChanges; // Firefox needs this when beforeunload set by addEventListener (even though message is not used)\n      return uiStrings.notification.unsavedChanges;\n    }\n  }, false);\n\n  /**\n  * Expose the uiStrings\n  */\n  editor.canvas.getUIStrings = function () {\n    return uiStrings;\n  };\n\n  /**\n  * @param {Function} func Confirmation dialog callback\n  */\n  editor.openPrep = function (func) {\n    $('#main_menu').hide();\n    if (undoMgr.getUndoStackSize() === 0) {\n      func(true);\n    } else {\n      $.confirm(uiStrings.notification.QwantToOpen, func);\n    }\n  };\n\n  function onDragEnter (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    // and indicator should be displayed here, such as \"drop files here\"\n  }\n\n  function onDragOver (e) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function onDragLeave (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    // hypothetical indicator should be removed here\n  }\n  // Use HTML5 File API: http://www.w3.org/TR/FileAPI/\n  // if browser has HTML5 File API support, then we will show the open menu item\n  // and provide a file input to click. When that change event fires, it will\n  // get the text contents of the file and send it to the canvas\n  if (window.FileReader) {\n    const importImage = function (e) {\n      $.process_cancel(uiStrings.notification.loadingImage);\n      e.stopPropagation();\n      e.preventDefault();\n      $('#workarea').removeAttr('style');\n      $('#main_menu').hide();\n      const file = (e.type === 'drop') ? e.dataTransfer.files[0] : this.files[0];\n      if (!file) {\n        $('#dialog_box').hide();\n        return;\n      }\n      /* if (file.type === 'application/pdf') { // Todo: Handle PDF imports\n\n      }\n      else */\n      if (file.type.includes('image')) {\n        // Detected an image\n        // svg handling\n        let reader;\n        if (file.type.includes('svg')) {\n          reader = new FileReader();\n          reader.onloadend = function (e) {\n            const newElement = svgCanvas.importSvgString(e.target.result, true);\n            svgCanvas.ungroupSelectedElement();\n            svgCanvas.ungroupSelectedElement();\n            svgCanvas.groupSelectedElements();\n            svgCanvas.alignSelectedElements('m', 'page');\n            svgCanvas.alignSelectedElements('c', 'page');\n            // highlight imported element, otherwise we get strange empty selectbox\n            svgCanvas.selectOnly([newElement]);\n            $('#dialog_box').hide();\n          };\n          reader.readAsText(file);\n        } else {\n          // bitmap handling\n          reader = new FileReader();\n          reader.onloadend = function (e) {\n            // let's insert the new image until we know its dimensions\n            const insertNewImage = function (width, height) {\n              const newImage = svgCanvas.addSvgElementFromJson({\n                element: 'image',\n                attr: {\n                  x: 0,\n                  y: 0,\n                  width,\n                  height,\n                  id: svgCanvas.getNextId(),\n                  style: 'pointer-events:inherit'\n                }\n              });\n              svgCanvas.setHref(newImage, e.target.result);\n              svgCanvas.selectOnly([newImage]);\n              svgCanvas.alignSelectedElements('m', 'page');\n              svgCanvas.alignSelectedElements('c', 'page');\n              updateContextPanel();\n              $('#dialog_box').hide();\n            };\n            // create dummy img so we know the default dimensions\n            let imgWidth = 100;\n            let imgHeight = 100;\n            const img = new Image();\n            img.src = e.target.result;\n            img.style.opacity = 0;\n            img.onload = function () {\n              imgWidth = img.offsetWidth;\n              imgHeight = img.offsetHeight;\n              insertNewImage(imgWidth, imgHeight);\n            };\n          };\n          reader.readAsDataURL(file);\n        }\n      }\n    };\n\n    workarea[0].addEventListener('dragenter', onDragEnter, false);\n    workarea[0].addEventListener('dragover', onDragOver, false);\n    workarea[0].addEventListener('dragleave', onDragLeave, false);\n    workarea[0].addEventListener('drop', importImage, false);\n\n    const open = $('<input type=\"file\">').change(function () {\n      const f = this;\n      editor.openPrep(function (ok) {\n        if (!ok) { return; }\n        svgCanvas.clear();\n        if (f.files.length === 1) {\n          $.process_cancel(uiStrings.notification.loadingImage);\n          const reader = new FileReader();\n          reader.onloadend = function (e) {\n            loadSvgString(e.target.result);\n            updateCanvas();\n          };\n          reader.readAsText(f.files[0]);\n        }\n      });\n    });\n    $('#tool_open').show().prepend(open);\n\n    const imgImport = $('<input type=\"file\">').change(importImage);\n    $('#tool_import').show().prepend(imgImport);\n  }\n\n  // $(function () {\n  updateCanvas(true);\n  // });\n\n  //  const revnums = 'svg-editor.js ($Rev$) ';\n  //  revnums += svgCanvas.getVersion();\n  //  $('#copyright')[0].setAttribute('title', revnums);\n\n  /**\n  * @param {String} lang The language code\n  * @param {Object} allStrings\n  */\n  const setLang = editor.setLang = function (lang, allStrings) {\n    editor.langChanged = true;\n    $.pref('lang', lang);\n    $('#lang_select').val(lang);\n    if (!allStrings) {\n      return;\n    }\n    $.extend(uiStrings, allStrings);\n\n    // const notif = allStrings.notification; // Currently unused\n    // $.extend will only replace the given strings\n    const oldLayerName = $('#layerlist tr.layersel td.layername').text();\n    const renameLayer = (oldLayerName === uiStrings.common.layer + ' 1');\n\n    svgCanvas.setUiStrings(allStrings);\n    Actions.setTitles();\n\n    if (renameLayer) {\n      svgCanvas.renameCurrentLayer(uiStrings.common.layer + ' 1');\n      populateLayers();\n    }\n\n    // In case extensions loaded before the locale, now we execute a callback on them\n    if (extsPreLang.length) {\n      while (extsPreLang.length) {\n        const ext = extsPreLang.shift();\n        ext.langReady({lang, uiStrings});\n      }\n    } else {\n      svgCanvas.runExtensions('langReady', {lang, uiStrings});\n    }\n    svgCanvas.runExtensions('langChanged', lang);\n\n    // Update flyout tooltips\n    setFlyoutTitles();\n\n    // Copy title for certain tool elements\n    const elems = {\n      '#stroke_color': '#tool_stroke .icon_label, #tool_stroke .color_block',\n      '#fill_color': '#tool_fill label, #tool_fill .color_block',\n      '#linejoin_miter': '#cur_linejoin',\n      '#linecap_butt': '#cur_linecap'\n    };\n\n    $.each(elems, function (source, dest) {\n      $(dest).attr('title', $(source)[0].title);\n    });\n\n    // Copy alignment titles\n    $('#multiselected_panel div[id^=tool_align]').each(function () {\n      $('#tool_pos' + this.id.substr(10))[0].title = this.title;\n    });\n  };\n  localeInit({\n    addLangData (langParam) {\n      return editor.canvas.runExtensions('addlangData', langParam, true);\n    },\n    curConfig,\n    setLang\n  });\n  // Load extensions\n  // Bit of a hack to run extensions in local Opera/IE9\n  if (document.location.protocol === 'file:') {\n    setTimeout(extFunc, 100);\n  } else {\n    // Returns a promise (if we wanted to fire 'extensions-loaded' event)\n    extFunc();\n  }\n};\n\n/**\n* Queues a callback to be invoked when the editor is ready (or\n*   to be invoked immediately if it is already ready)--i.e.,\n*   once all callbacks set by `svgEditor.runCallbacks` have been run\n* @param {Function} cb Callback to be queued to invoke\n*/\neditor.ready = function (cb) {\n  if (!isReady) {\n    callbacks.push(cb);\n  } else {\n    cb();\n  }\n};\n\n/**\n* Invokes the callbacks previous set by `svgEditor.ready`\n*/\neditor.runCallbacks = function () {\n  // Todo: See if there is any benefit to refactoring some\n  //   of the existing `editor.ready()` calls to return Promises\n  return Promise.all(callbacks.map((cb) => {\n    return cb();\n  })).then(() => {\n    isReady = true;\n  });\n};\n\n/**\n* @param {String} str The SVG string to load\n*/\neditor.loadFromString = function (str) {\n  editor.ready(function () {\n    loadSvgString(str);\n  });\n};\n\n/**\n* Not presently in use\n* @param featList\n*/\neditor.disableUI = function (featList) {\n  // $(function () {\n  //   $('#tool_wireframe, #tool_image, #main_button, #tool_source, #sidepanels').remove();\n  //   $('#tools_top').css('left', 5);\n  // });\n};\n\n/**\n* @param url URL from which to load an SVG string via Ajax\n* @param {Object} [opts] May contain properties: `cache`, `callback` (invoked with `true` or `false` depending on success)\n*/\neditor.loadFromURL = function (url, opts) {\n  if (!opts) { opts = {}; }\n\n  const {cache, callback: cb} = opts;\n\n  editor.ready(function () {\n    $.ajax({\n      url,\n      dataType: 'text',\n      cache: !!cache,\n      beforeSend () {\n        $.process_cancel(uiStrings.notification.loadingImage);\n      },\n      success (str) {\n        loadSvgString(str, cb);\n      },\n      error (xhr, stat, err) {\n        if (xhr.status !== 404 && xhr.responseText) {\n          loadSvgString(xhr.responseText, cb);\n        } else {\n          $.alert(uiStrings.notification.URLloadFail + ': \\n' + err, cb);\n        }\n      },\n      complete () {\n        $('#dialog_box').hide();\n      }\n    });\n  });\n};\n\n/**\n* @param {String} str The Data URI to base64-decode (if relevant) and load\n*/\neditor.loadFromDataURI = function (str) {\n  editor.ready(function () {\n    let base64 = false;\n    let pre = str.match(/^data:image\\/svg\\+xml;base64,/);\n    if (pre) {\n      base64 = true;\n    } else {\n      pre = str.match(/^data:image\\/svg\\+xml(?:;(?:utf8)?)?,/);\n    }\n    if (pre) {\n      pre = pre[0];\n    }\n    const src = str.slice(pre.length);\n    loadSvgString(base64 ? Utils.decode64(src) : decodeURIComponent(src));\n  });\n};\n\n/**\n* @param {...*} args Arguments to pass to `svgCanvas.addExtension` (though invoked on `svgEditor`)\n*/\neditor.addExtension = function (...args) {\n  // Note that we don't want this on editor.ready since some extensions\n  // may want to run before then (like server_opensave).\n  // $(function () {\n  if (svgCanvas) { svgCanvas.addExtension.apply(this, args); }\n  // });\n};\n\n// Defer injection to wait out initial menu processing. This probably goes\n//    away once all context menu behavior is brought to context menu.\neditor.ready(() => {\n  injectExtendedContextMenuItemsIntoDom();\n});\n\n// Run init once DOM is loaded\n// jQuery(editor.init);\nPromise.resolve().then(() => {\n  // We wait a micro-task to let the svgEditor variable be defined for module checks\n  editor.init();\n});\n\nexport default editor;\n","// Todo: Update: https://github.com/jeresig/jquery.hotkeys\n/*\n * jQuery Hotkeys Plugin\n * Copyright 2010, John Resig\n * Dual licensed under the MIT or GPL Version 2 licenses.\n *\n * http://github.com/jeresig/jquery.hotkeys\n *\n * Based upon the plugin by Tzury Bar Yochay:\n * http://github.com/tzuryby/hotkeys\n *\n * Original idea by:\n * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/\n*/\n\nexport default function(b){b.hotkeys={version:\"0.8\",specialKeys:{8:\"backspace\",9:\"tab\",13:\"return\",16:\"shift\",17:\"ctrl\",18:\"alt\",19:\"pause\",20:\"capslock\",27:\"esc\",32:\"space\",33:\"pageup\",34:\"pagedown\",35:\"end\",36:\"home\",37:\"left\",38:\"up\",39:\"right\",40:\"down\",45:\"insert\",46:\"del\",96:\"0\",97:\"1\",98:\"2\",99:\"3\",100:\"4\",101:\"5\",102:\"6\",103:\"7\",104:\"8\",105:\"9\",106:\"*\",107:\"+\",109:\"-\",110:\".\",111:\"/\",112:\"f1\",113:\"f2\",114:\"f3\",115:\"f4\",116:\"f5\",117:\"f6\",118:\"f7\",119:\"f8\",120:\"f9\",121:\"f10\",122:\"f11\",123:\"f12\",144:\"numlock\",145:\"scroll\",191:\"/\",224:\"meta\",219:\"[\",221:\"]\"},shiftNums:{\"`\":\"~\",\"1\":\"!\",\"2\":\"@\",\"3\":\"#\",\"4\":\"$\",\"5\":\"%\",\"6\":\"^\",\"7\":\"&\",\"8\":\"*\",\"9\":\"(\",\"0\":\")\",\"-\":\"_\",\"=\":\"+\",\";\":\": \",\"'\":'\"',\",\":\"<\",\".\":\">\",\"/\":\"?\",\"\\\\\":\"|\"}};function a(d){if(typeof d.data!==\"string\"){return}var c=d.handler,e=d.data.toLowerCase().split(\" \");d.handler=function(n){if(this!==n.target&&(/textarea|select/i.test(n.target.nodeName)||n.target.type===\"text\")){return}var h=n.type!==\"keypress\"&&b.hotkeys.specialKeys[n.which],o=String.fromCharCode(n.which).toLowerCase(),k,m=\"\",g={};if(n.altKey&&h!==\"alt\"){m+=\"alt+\"}if(n.ctrlKey&&h!==\"ctrl\"){m+=\"ctrl+\"}if(n.metaKey&&!n.ctrlKey&&h!==\"meta\"){m+=\"meta+\"}if(n.shiftKey&&h!==\"shift\"){m+=\"shift+\"}if(h){g[m+h]=true}else{g[m+o]=true;g[m+b.hotkeys.shiftNums[o]]=true;if(m===\"shift+\"){g[b.hotkeys.shiftNums[o]]=true}}for(var j=0,f=e.length;j<f;j++){if(g[e[j]]){return c.apply(this,arguments)}}}}b.each([\"keydown\",\"keyup\",\"keypress\"],function(){b.event.special[this]={add:a}})\n\nreturn b;\n}\n","/*\n * Todo: Update to latest at https://github.com/cowboy/jquery-bbq ?\n * jQuery BBQ: Back Button & Query Library - v1.2.1 - 2/17/2010\n * http://benalman.com/projects/jquery-bbq-plugin/\n *\n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n\n// For sake of modules, added this wrapping export and changed `this` to `window`\nexport default function (jQuery) {\n\n(function($,p){var i,m=Array.prototype.slice,r=decodeURIComponent,a=$.param,c,l,v,b=$.bbq=$.bbq||{},q,u,j,e=$.event.special,d=\"hashchange\",A=\"querystring\",D=\"fragment\",y=\"elemUrlAttr\",g=\"location\",k=\"href\",t=\"src\",x=/^.*\\?|#.*$/g,w=/^.*\\#/,h,C={};function E(F){return typeof F===\"string\"}function B(G){var F=m.call(arguments,1);return function(){return G.apply(this,F.concat(m.call(arguments)))}}function n(F){return F.replace(/^[^#]*#?(.*)$/,\"$1\")}function o(F){return F.replace(/(?:^[^?#]*\\?([^#]*).*$)?.*/,\"$1\")}function f(H,M,F,I,G){var O,L,K,N,J;if(I!==i){K=F.match(H?/^([^#]*)\\#?(.*)$/:/^([^#?]*)\\??([^#]*)(#?.*)/);J=K[3]||\"\";if(G===2&&E(I)){L=I.replace(H?w:x,\"\")}else{N=l(K[2]);I=E(I)?l[H?D:A](I):I;L=G===2?I:G===1?$.extend({},I,N):$.extend({},N,I);L=a(L);if(H){L=L.replace(h,r)}}O=K[1]+(H?\"#\":L||!K[1]?\"?\":\"\")+L+J}else{O=M(F!==i?F:p[g][k])}return O}a[A]=B(f,0,o);a[D]=c=B(f,1,n);c.noEscape=function(G){G=G||\"\";var F=$.map(G.split(\"\"),encodeURIComponent);h=new RegExp(F.join(\"|\"),\"g\")};c.noEscape(\",/\");$.deparam=l=function(I,F){var H={},G={\"true\":!0,\"false\":!1,\"null\":null};$.each(I.replace(/\\+/g,\" \").split(\"&\"),function(L,Q){var K=Q.split(\"=\"),P=r(K[0]),J,O=H,M=0,R=P.split(\"][\"),N=R.length-1;if(/\\[/.test(R[0])&&/\\]$/.test(R[N])){R[N]=R[N].replace(/\\]$/,\"\");R=R.shift().split(\"[\").concat(R);N=R.length-1}else{N=0}if(K.length===2){J=r(K[1]);if(F){J=J&&!isNaN(J)?+J:J===\"undefined\"?i:G[J]!==i?G[J]:J}if(N){for(;M<=N;M++){P=R[M]===\"\"?O.length:R[M];O=O[P]=M<N?O[P]||(R[M+1]&&isNaN(R[M+1])?{}:[]):J}}else{if($.isArray(H[P])){H[P].push(J)}else{if(H[P]!==i){H[P]=[H[P],J]}else{H[P]=J}}}}else{if(P){H[P]=F?i:\"\"}}});return H};function z(H,F,G){if(F===i||typeof F===\"boolean\"){G=F;F=a[H?D:A]()}else{F=E(F)?F.replace(H?w:x,\"\"):F}return l(F,G)}l[A]=B(z,0);l[D]=v=B(z,1);$[y]||($[y]=function(F){return $.extend(C,F)})({a:k,base:k,iframe:t,img:t,input:t,form:\"action\",link:k,script:t});j=$[y];function s(I,G,H,F){if(!E(H)&&typeof H!==\"object\"){F=H;H=G;G=i}return this.each(function(){var L=$(this),J=G||j()[(this.nodeName||\"\").toLowerCase()]||\"\",K=J&&L.attr(J)||\"\";L.attr(J,a[I](K,H,F))})}$.fn[A]=B(s,A);$.fn[D]=B(s,D);b.pushState=q=function(I,F){if(E(I)&&/^#/.test(I)&&F===i){F=2}var H=I!==i,G=c(p[g][k],H?I:{},H?F:2);p[g][k]=G+(/#/.test(G)?\"\":\"#\")};b.getState=u=function(F,G){return F===i||typeof F===\"boolean\"?v(F):v(G)[F]};b.removeState=function(F){var G={};if(F!==i){G=u();$.each($.isArray(F)?F:arguments,function(I,H){delete G[H]})}q(G,2)};e[d]=$.extend(e[d],{add:function(F){var H;function G(J){var I=J[D]=c();J.getState=function(K,L){return K===i||typeof K===\"boolean\"?l(I,K):l(I,L)[K]};H.apply(this,arguments)}if($.isFunction(F)){H=F;return G}else{H=F.handler;F.handler=G}}})})(jQuery,window);\n/*\n * jQuery hashchange event - v1.2 - 2/11/2010\n * http://benalman.com/projects/jquery-hashchange-plugin/\n *\n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n(function($,i,b){var j,k=$.event.special,c=\"location\",d=\"hashchange\",l=\"href\",f=$.browser,g=document.documentMode,h=f.msie&&(g===b||g<8),e=\"on\"+d in i&&!h;function a(m){m=m||i[c][l];return m.replace(/^[^#]*#?(.*)$/,\"$1\")}$[d+\"Delay\"]=100;k[d]=$.extend(k[d],{setup:function(){if(e){return false}$(j.start)},teardown:function(){if(e){return false}$(j.stop)}});j=(function(){var m={},r,n,o,q;function p(){o=q=function(s){return s};if(h){n=$('<iframe src=\"javascript:0\"/>').hide().insertAfter(\"body\")[0].contentWindow;q=function(){return a(n.document[c][l])};o=function(u,s){if(u!==s){var t=n.document;t.open().close();t[c].hash=\"#\"+u}};o(a())}}m.start=function(){if(r){return}var t=a();o||p();(function s(){var v=a(),u=q(t);if(v!==t){o(t=v,u);$(i).trigger(d)}else{if(u!==t){i[c][l]=i[c][l].replace(/#.*/,\"\")+\"#\"+u}}r=setTimeout(s,$[d+\"Delay\"])})()};m.stop=function(){if(!n){r&&clearTimeout(r);r=0}};return m})()})(jQuery,window);\n\nreturn jQuery;\n}\n","/*\n * SVG Icon Loader 2.0\n *\n * jQuery Plugin for loading SVG icons from a single file\n *\n * Copyright (c) 2009 Alexis Deveria\n * http://a.deveria.com\n *\n * MIT License\n\nHow to use:\n\n1. Create the SVG master file that includes all icons:\n\nThe master SVG icon-containing file is an SVG file that contains\n<g> elements. Each <g> element should contain the markup of an SVG\nicon. The <g> element has an ID that should\ncorrespond with the ID of the HTML element used on the page that should contain\nor optionally be replaced by the icon. Additionally, one empty element should be\nadded at the end with id \"svg_eof\".\n\n2. Optionally create fallback raster images for each SVG icon.\n\n3. Include the jQuery and the SVG Icon Loader scripts on your page.\n\n4. Run $.svgIcons() when the document is ready:\n\n$.svgIcons( file [string], options [object literal]);\n\nFile is the location of a local SVG or SVGz file.\n\nAll options are optional and can include:\n\n- 'w (number)': The icon widths\n\n- 'h (number)': The icon heights\n\n- 'fallback (object literal)': List of raster images with each\n  key being the SVG icon ID to replace, and the value the image file name.\n\n- 'fallback_path (string)': The path to use for all images\n  listed under \"fallback\"\n\n- 'replace (boolean)': If set to true, HTML elements will be replaced by,\n  rather than include the SVG icon.\n\n- 'placement (object literal)': List with selectors for keys and SVG icon ids\n  as values. This provides a custom method of adding icons.\n\n- 'resize (object literal)': List with selectors for keys and numbers\n  as values. This allows an easy way to resize specific icons.\n\n- 'callback (function)': A function to call when all icons have been loaded.\n  Includes an object literal as its argument with as keys all icon IDs and the\n  icon as a jQuery object as its value.\n\n- 'id_match (boolean)': Automatically attempt to match SVG icon ids with\n  corresponding HTML id (default: true)\n\n- 'no_img (boolean)': Prevent attempting to convert the icon into an <img>\n  element (may be faster, help for browser consistency)\n\n- 'svgz (boolean)': Indicate that the file is an SVGZ file, and thus not to\n  parse as XML. SVGZ files add compression benefits, but getting data from\n  them fails in Firefox 2 and older.\n\n5. To access an icon at a later point without using the callback, use this:\n  $.getSvgIcon(id (string));\n\nThis will return the icon (as jQuery object) with a given ID.\n\n6. To resize icons at a later point without using the callback, use this:\n  $.resizeSvgIcons(resizeOptions) (use the same way as the \"resize\" parameter)\n\nExample usage #1:\n\n$(function() {\n  $.svgIcons('my_icon_set.svg'); // The SVG file that contains all icons\n  // No options have been set, so all icons will automatically be inserted\n  // into HTML elements that match the same IDs.\n});\n\nExample usage #2:\n\n$(function() {\n  $.svgIcons('my_icon_set.svg', { // The SVG file that contains all icons\n    callback (icons) { // Custom callback function that sets click\n                  // events for each icon\n      $.each(icons, function(id, icon) {\n        icon.click(function() {\n          alert('You clicked on the icon with id ' + id);\n        });\n      });\n    }\n  }); //The SVG file that contains all icons\n});\n\nExample usage #3:\n\n$(function() {\n  $.svgIcons('my_icon_set.svgz', { // The SVGZ file that contains all icons\n    w: 32,  // All icons will be 32px wide\n    h: 32,  // All icons will be 32px high\n    fallback_path: 'icons/',  // All fallback files can be found here\n    fallback: {\n      '#open_icon': 'open.png',  // The \"open.png\" will be appended to the\n                    // HTML element with ID \"open_icon\"\n      '#close_icon': 'close.png',\n      '#save_icon': 'save.png'\n    },\n    placement: {'.open_icon','open'}, // The \"open\" icon will be added\n                    // to all elements with class \"open_icon\"\n    resize () {\n      '#save_icon .svg_icon': 64  // The \"save\" icon will be resized to 64 x 64px\n    },\n\n    callback (icons) { // Sets background color for \"close\" icon\n      icons['close'].css('background','red');\n    },\n\n    svgz: true // Indicates that an SVGZ file is being used\n\n  })\n});\n*/\n\nexport default function ($) {\n  const svgIcons = {};\n\n  let fixIDs;\n  $.svgIcons = function (file, opts) {\n    const svgns = 'http://www.w3.org/2000/svg',\n      xlinkns = 'http://www.w3.org/1999/xlink',\n      iconW = opts.w || 24,\n      iconH = opts.h || 24;\n    let elems, svgdoc, testImg,\n      iconsMade = false, dataLoaded = false, loadAttempts = 0;\n    const isOpera = !!window.opera,\n      // ua = navigator.userAgent,\n      // isSafari = (ua.includes('Safari/') && !ua.includes('Chrome/')),\n      dataPre = 'data:image/svg+xml;charset=utf-8;base64,';\n\n    let dataEl;\n    if (opts.svgz) {\n      dataEl = $('<object data=\"' + file + '\" type=image/svg+xml>').appendTo('body').hide();\n      try {\n        svgdoc = dataEl[0].contentDocument;\n        dataEl.load(getIcons);\n        getIcons(0, true); // Opera will not run \"load\" event if file is already cached\n      } catch (err1) {\n        useFallback();\n      }\n    } else {\n      const parser = new DOMParser();\n      $.ajax({\n        url: file,\n        dataType: 'string',\n        success (data) {\n          if (!data) {\n            $(useFallback);\n            return;\n          }\n          svgdoc = parser.parseFromString(data, 'text/xml');\n          $(function () {\n            getIcons('ajax');\n          });\n        },\n        error (err) {\n          // TODO: Fix Opera widget icon bug\n          if (window.opera) {\n            $(function () {\n              useFallback();\n            });\n          } else {\n            if (err.responseText) {\n              svgdoc = parser.parseFromString(err.responseText, 'text/xml');\n\n              if (!svgdoc.childNodes.length) {\n                $(useFallback);\n              }\n              $(function () {\n                getIcons('ajax');\n              });\n            } else {\n              $(useFallback);\n            }\n          }\n        }\n      });\n    }\n\n    function getIcons (evt, noWait) {\n      if (evt !== 'ajax') {\n        if (dataLoaded) return;\n        // Webkit sometimes says svgdoc is undefined, other times\n        // it fails to load all nodes. Thus we must make sure the \"eof\"\n        // element is loaded.\n        svgdoc = dataEl[0].contentDocument; // Needed again for Webkit\n        const isReady = (svgdoc && svgdoc.getElementById('svg_eof'));\n        if (!isReady && !(noWait && isReady)) {\n          loadAttempts++;\n          if (loadAttempts < 50) {\n            setTimeout(getIcons, 20);\n          } else {\n            useFallback();\n            dataLoaded = true;\n          }\n          return;\n        }\n        dataLoaded = true;\n      }\n\n      elems = $(svgdoc.firstChild).children(); // .getElementsByTagName('foreignContent');\n\n      if (!opts.no_img) {\n        const testSrc = dataPre + 'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D';\n\n        testImg = $(new Image()).attr({\n          src: testSrc,\n          width: 0,\n          height: 0\n        }).appendTo('body')\n          .load(function () {\n            // Safari 4 crashes, Opera and Chrome don't\n            makeIcons(true);\n          }).error(function () {\n            makeIcons();\n          });\n      } else {\n        setTimeout(function () {\n          if (!iconsMade) makeIcons();\n        }, 500);\n      }\n    }\n\n    const setIcon = function (target, icon, id, setID) {\n      if (isOpera) icon.css('visibility', 'hidden');\n      if (opts.replace) {\n        if (setID) icon.attr('id', id);\n        const cl = target.attr('class');\n        if (cl) icon.attr('class', 'svg_icon ' + cl);\n        target.replaceWith(icon);\n      } else {\n        target.append(icon);\n      }\n      if (isOpera) {\n        setTimeout(function () {\n          icon.removeAttr('style');\n        }, 1);\n      }\n    };\n\n    let holder;\n    const addIcon = function (icon, id) {\n      if (opts.id_match === undefined || opts.id_match !== false) {\n        setIcon(holder, icon, id, true);\n      }\n      svgIcons[id] = icon;\n    };\n\n    function makeIcons (toImage, fallback) {\n      if (iconsMade) return;\n      if (opts.no_img) toImage = false;\n\n      let tempHolder;\n      if (toImage) {\n        tempHolder = $(document.createElement('div'));\n        tempHolder.hide().appendTo('body');\n      }\n      if (fallback) {\n        const path = opts.fallback_path || '';\n        $.each(fallback, function (id, imgsrc) {\n          holder = $('#' + id);\n          const icon = $(new Image())\n            .attr({\n              class: 'svg_icon',\n              src: path + imgsrc,\n              width: iconW,\n              height: iconH,\n              alt: 'icon'\n            });\n\n          addIcon(icon, id);\n        });\n      } else {\n        const len = elems.length;\n        for (let i = 0; i < len; i++) {\n          const elem = elems[i];\n          const {id} = elem;\n          if (id === 'svg_eof') break;\n          holder = $('#' + id);\n          const svgroot = document.createElementNS(svgns, 'svg');\n          // Per https://www.w3.org/TR/xml-names11/#defaulting, the namespace for\n          // attributes should have no value.\n          svgroot.setAttributeNS(null, 'viewBox', [0, 0, iconW, iconH].join(' '));\n\n          let svg = elem.getElementsByTagNameNS(svgns, 'svg')[0];\n\n          // Make flexible by converting width/height to viewBox\n          const w = svg.getAttribute('width');\n          const h = svg.getAttribute('height');\n          svg.removeAttribute('width');\n          svg.removeAttribute('height');\n\n          const vb = svg.getAttribute('viewBox');\n          if (!vb) {\n            svg.setAttribute('viewBox', [0, 0, w, h].join(' '));\n          }\n\n          // Not using jQuery to be a bit faster\n          svgroot.setAttribute('xmlns', svgns);\n          svgroot.setAttribute('width', iconW);\n          svgroot.setAttribute('height', iconH);\n          svgroot.setAttribute('xmlns:xlink', xlinkns);\n          svgroot.setAttribute('class', 'svg_icon');\n\n          // Without cloning, Firefox will make another GET request.\n          // With cloning, causes issue in Opera/Win/Non-EN\n          if (!isOpera) svg = svg.cloneNode(true);\n\n          svgroot.append(svg);\n\n          let icon;\n          if (toImage) {\n            tempHolder.empty().append(svgroot);\n            const str = dataPre + encode64(unescape(encodeURIComponent(new XMLSerializer().serializeToString(svgroot))));\n            icon = $(new Image())\n              .attr({class: 'svg_icon', src: str});\n          } else {\n            icon = fixIDs($(svgroot), i);\n          }\n          addIcon(icon, id);\n        }\n      }\n\n      if (opts.placement) {\n        $.each(opts.placement, function (sel, id) {\n          if (!svgIcons[id]) return;\n          $(sel).each(function (i) {\n            let copy = svgIcons[id].clone();\n            if (i > 0 && !toImage) copy = fixIDs(copy, i, true);\n            setIcon($(this), copy, id);\n          });\n        });\n      }\n      if (!fallback) {\n        if (toImage) tempHolder.remove();\n        if (dataEl) dataEl.remove();\n        if (testImg) testImg.remove();\n      }\n      if (opts.resize) $.resizeSvgIcons(opts.resize);\n      iconsMade = true;\n\n      if (opts.callback) opts.callback(svgIcons);\n    }\n\n    fixIDs = function (svgEl, svgNum, force) {\n      const defs = svgEl.find('defs');\n      if (!defs.length) return svgEl;\n\n      let idElems;\n      if (isOpera) {\n        idElems = defs.find('*').filter(function () {\n          return !!this.id;\n        });\n      } else {\n        idElems = defs.find('[id]');\n      }\n\n      const allElems = svgEl[0].getElementsByTagName('*'), len = allElems.length;\n\n      idElems.each(function (i) {\n        const {id} = this;\n        /*\n        const noDupes = ($(svgdoc).find('#' + id).length <= 1);\n        if (isOpera) noDupes = false; // Opera didn't clone svgEl, so not reliable\n        if(!force && noDupes) return;\n        */\n        const newId = 'x' + id + svgNum + i;\n        this.id = newId;\n\n        const oldVal = 'url(#' + id + ')';\n        const newVal = 'url(#' + newId + ')';\n\n        // Selector method, possibly faster but fails in Opera / jQuery 1.4.3\n        //  svgEl.find('[fill=\"url(#' + id + ')\"]').each(function() {\n        //    this.setAttribute('fill', 'url(#' + newId + ')');\n        //  }).end().find('[stroke=\"url(#' + id + ')\"]').each(function() {\n        //    this.setAttribute('stroke', 'url(#' + newId + ')');\n        //  }).end().find('use').each(function() {\n        //    if(this.getAttribute('xlink:href') == '#' + id) {\n        //      this.setAttributeNS(xlinkns,'href','#' + newId);\n        //    }\n        //  }).end().find('[filter=\"url(#' + id + ')\"]').each(function() {\n        //    this.setAttribute('filter', 'url(#' + newId + ')');\n        //  });\n\n        for (i = 0; i < len; i++) {\n          const elem = allElems[i];\n          if (elem.getAttribute('fill') === oldVal) {\n            elem.setAttribute('fill', newVal);\n          }\n          if (elem.getAttribute('stroke') === oldVal) {\n            elem.setAttribute('stroke', newVal);\n          }\n          if (elem.getAttribute('filter') === oldVal) {\n            elem.setAttribute('filter', newVal);\n          }\n        }\n      });\n      return svgEl;\n    };\n\n    function useFallback () {\n      if (file.includes('.svgz')) {\n        const regFile = file.replace('.svgz', '.svg');\n        if (window.console) {\n          console.log('.svgz failed, trying with .svg');\n        }\n        $.svgIcons(regFile, opts);\n      } else if (opts.fallback) {\n        makeIcons(false, opts.fallback);\n      }\n    }\n\n    function encode64 (input) {\n      // base64 strings are 4/3 larger than the original string\n      if (window.btoa) return window.btoa(input);\n      const _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n      const output = new Array(Math.floor((input.length + 2) / 3) * 4);\n\n      let i = 0, p = 0;\n      do {\n        const chr1 = input.charCodeAt(i++);\n        const chr2 = input.charCodeAt(i++);\n        const chr3 = input.charCodeAt(i++);\n\n        const enc1 = chr1 >> 2;\n        const enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n\n        let enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n        let enc4 = chr3 & 63;\n        if (isNaN(chr2)) {\n          enc3 = enc4 = 64;\n        } else if (isNaN(chr3)) {\n          enc4 = 64;\n        }\n\n        output[p++] = _keyStr.charAt(enc1);\n        output[p++] = _keyStr.charAt(enc2);\n        output[p++] = _keyStr.charAt(enc3);\n        output[p++] = _keyStr.charAt(enc4);\n      } while (i < input.length);\n\n      return output.join('');\n    }\n  };\n\n  $.getSvgIcon = function (id, uniqueClone) {\n    let icon = svgIcons[id];\n    if (uniqueClone && icon) {\n      icon = fixIDs(icon, 0, true).clone(true);\n    }\n    return icon;\n  };\n\n  $.resizeSvgIcons = function (obj) {\n    // FF2 and older don't detect .svg_icon, so we change it detect svg elems instead\n    const changeSel = !$('.svg_icon:first').length;\n    $.each(obj, function (sel, size) {\n      const arr = Array.isArray(size);\n      const w = arr ? size[0] : size,\n        h = arr ? size[1] : size;\n      if (changeSel) {\n        sel = sel.replace(/\\.svg_icon/g, 'svg');\n      }\n      $(sel).each(function () {\n        this.setAttribute('width', w);\n        this.setAttribute('height', h);\n        if (window.opera && window.widget) {\n          this.parentNode.style.width = w + 'px';\n          this.parentNode.style.height = h + 'px';\n        }\n      });\n    });\n  };\n  return $;\n}\n","/* SpinButton control\n *\n * Adds bells and whistles to any ordinary textbox to\n * make it look and feel like a SpinButton Control.\n *\n * Originally written by George Adamson, Software Unity (george.jquery@softwareunity.com) August 2006.\n * - Added min/max options\n * - Added step size option\n * - Added bigStep (page up/down) option\n *\n * Modifications made by Mark Gibson, (mgibson@designlinks.net) September 2006:\n * - Converted to jQuery plugin\n * - Allow limited or unlimited min/max values\n * - Allow custom class names, and add class to input element\n * - Removed global vars\n * - Reset (to original or through config) when invalid value entered\n * - Repeat whilst holding mouse button down (with initial pause, like keyboard repeat)\n * - Support mouse wheel in Firefox\n * - Fix double click in IE\n * - Refactored some code and renamed some vars\n *\n * Modifications by Jeff Schiller, June 2009:\n * - provide callback function for when the value changes based on the following\n *   https://www.mail-archive.com/jquery-en@googlegroups.com/msg36070.html\n * Modifications by Jeff Schiller, July 2009:\n * - improve styling for widget in Opera\n * - consistent key-repeat handling cross-browser\n * Modifications by Alexis Deveria, October 2009:\n * - provide \"stepfunc\" callback option to allow custom function to run when changing a value\n * - Made adjustValue(0) only run on certain keyup events, not all.\n *\n * Tested in IE6, Opera9, Firefox 1.5\n * v1.0  11 Aug 2006 - George Adamson  - First release\n * v1.1     Aug 2006 - George Adamson  - Minor enhancements\n * v1.2  27 Sep 2006 - Mark Gibson    - Major enhancements\n * v1.3a 28 Sep 2006 - George Adamson  - Minor enhancements\n * v1.4  18 Jun 2009 - Jeff Schiller    - Added callback function\n * v1.5  06 Jul 2009 - Jeff Schiller    - Fixes for Opera.\n * v1.6  13 Oct 2009 - Alexis Deveria   - Added stepfunc function\n * v1.7  21 Oct 2009 - Alexis Deveria   - Minor fixes\n *                                        Fast-repeat for keys and live updating as you type.\n * v1.8  12 Jan 2010 - Benjamin Thomas  - Fixes for mouseout behavior.\n *                                        Added smallStep\n * ? 20 May 2018 - Brett Zamir - Avoid SVGEdit dependency via `stateObj` config;\n  convert to ES6 module\n Sample usage:\n\n  // Create group of settings to initialise spinbutton(s). (Optional)\n  const myOptions = {\n    min: 0, // Set lower limit.\n    max: 100, // Set upper limit.\n    step: 1, // Set increment size.\n    smallStep: 0.5, // Set shift-click increment size.\n    stateObj: {tool_scale: 1}, // Object to allow passing in live-updating scale\n    spinClass: mySpinBtnClass, // CSS class to style the spinbutton. (Class also specifies url of the up/down button image.)\n    upClass: mySpinUpClass, // CSS class for style when mouse over up button.\n    downClass: mySpinDnClass // CSS class for style when mouse over down button.\n  };\n\n  $(function () {\n    // Initialise INPUT element(s) as SpinButtons: (passing options if desired)\n    $(\"#myInputElement\").SpinButton(myOptions);\n  });\n */\nexport default function ($) {\n  if (!$.loadingStylesheets) {\n    $.loadingStylesheets = [];\n  }\n  const stylesheet = 'spinbtn/JQuerySpinBtn.css';\n  if (!$.loadingStylesheets.includes(stylesheet)) {\n    $.loadingStylesheets.push(stylesheet);\n  }\n  $.fn.SpinButton = function (cfg) {\n    cfg = cfg || {};\n    function coord (el, prop) {\n      const b = document.body;\n\n      let c = el[prop];\n      while ((el = el.offsetParent) && (el !== b)) {\n        if (!$.browser.msie || (el.currentStyle.position !== 'relative')) {\n          c += el[prop];\n        }\n      }\n\n      return c;\n    }\n\n    return this.each(function () {\n      this.repeating = false;\n\n      // Apply specified options or defaults:\n      // (Ought to refactor this some day to use $.extend() instead)\n      this.spinCfg = {\n        // min: cfg.min ? Number(cfg.min) : null,\n        // max: cfg.max ? Number(cfg.max) : null,\n        min: !isNaN(parseFloat(cfg.min)) ? Number(cfg.min) : null, // Fixes bug with min:0\n        max: !isNaN(parseFloat(cfg.max)) ? Number(cfg.max) : null,\n        step: cfg.step ? Number(cfg.step) : 1,\n        stepfunc: cfg.stepfunc || false,\n        page: cfg.page ? Number(cfg.page) : 10,\n        upClass: cfg.upClass || 'up',\n        downClass: cfg.downClass || 'down',\n        reset: cfg.reset || this.value,\n        delay: cfg.delay ? Number(cfg.delay) : 500,\n        interval: cfg.interval ? Number(cfg.interval) : 100,\n        _btn_width: 20,\n        _direction: null,\n        _delay: null,\n        _repeat: null,\n        callback: cfg.callback || null\n      };\n\n      // if a smallStep isn't supplied, use half the regular step\n      this.spinCfg.smallStep = cfg.smallStep || this.spinCfg.step / 2;\n\n      this.adjustValue = function (i) {\n        let v;\n        if (isNaN(this.value)) {\n          v = this.spinCfg.reset;\n        } else if (typeof this.spinCfg.stepfunc === 'function') {\n          v = this.spinCfg.stepfunc(this, i);\n        } else {\n          // weirdest JavaScript bug ever: 5.1 + 0.1 = 5.199999999\n          v = Number((Number(this.value) + Number(i)).toFixed(5));\n        }\n        if (this.spinCfg.min !== null) { v = Math.max(v, this.spinCfg.min); }\n        if (this.spinCfg.max !== null) { v = Math.min(v, this.spinCfg.max); }\n        this.value = v;\n        if (typeof this.spinCfg.callback === 'function') { this.spinCfg.callback(this); }\n      };\n\n      $(this)\n        .addClass(cfg.spinClass || 'spin-button')\n\n        .mousemove(function (e) {\n          // Determine which button mouse is over, or not (spin direction):\n          const x = e.pageX || e.x;\n          const y = e.pageY || e.y;\n          const el = e.target;\n          const scale = cfg.stateObj.tool_scale || 1;\n          const height = $(el).height() / 2;\n\n          const direction =\n            (x > coord(el, 'offsetLeft') +\n              el.offsetWidth * scale - this.spinCfg._btn_width)\n              ? ((y < coord(el, 'offsetTop') + height * scale) ? 1 : -1) : 0;\n\n          if (direction !== this.spinCfg._direction) {\n            // Style up/down buttons:\n            switch (direction) {\n            case 1: // Up arrow:\n              $(this).removeClass(this.spinCfg.downClass).addClass(this.spinCfg.upClass);\n              break;\n            case -1: // Down arrow:\n              $(this).removeClass(this.spinCfg.upClass).addClass(this.spinCfg.downClass);\n              break;\n            default: // Mouse is elsewhere in the textbox\n              $(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass);\n            }\n\n            // Set spin direction:\n            this.spinCfg._direction = direction;\n          }\n        })\n\n        .mouseout(function () {\n          // Reset up/down buttons to their normal appearance when mouse moves away:\n          $(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass);\n          this.spinCfg._direction = null;\n          window.clearInterval(this.spinCfg._repeat);\n          window.clearTimeout(this.spinCfg._delay);\n        })\n\n        .mousedown(function (e) {\n          if (e.button === 0 && this.spinCfg._direction !== 0) {\n            // Respond to click on one of the buttons:\n            const stepSize = e.shiftKey ? this.spinCfg.smallStep : this.spinCfg.step;\n\n            const adjust = () => {\n              this.adjustValue(this.spinCfg._direction * stepSize);\n            };\n\n            adjust();\n\n            // Initial delay before repeating adjustment\n            this.spinCfg._delay = window.setTimeout(() => {\n              adjust();\n              // Repeat adjust at regular intervals\n              this.spinCfg._repeat = window.setInterval(adjust, this.spinCfg.interval);\n            }, this.spinCfg.delay);\n          }\n        })\n\n        .mouseup(function (e) {\n          // Cancel repeating adjustment\n          window.clearInterval(this.spinCfg._repeat);\n          window.clearTimeout(this.spinCfg._delay);\n        })\n\n        .dblclick(function (e) {\n          if ($.browser.msie) {\n            this.adjustValue(this.spinCfg._direction * this.spinCfg.step);\n          }\n        })\n\n        .keydown(function (e) {\n          // Respond to up/down arrow keys.\n          switch (e.keyCode) {\n          case 38: this.adjustValue(this.spinCfg.step); break; // Up\n          case 40: this.adjustValue(-this.spinCfg.step); break; // Down\n          case 33: this.adjustValue(this.spinCfg.page); break; // PageUp\n          case 34: this.adjustValue(-this.spinCfg.page); break; // PageDown\n          }\n        })\n\n        /*\n        http://unixpapa.com/js/key.html describes the current state-of-affairs for\n        key repeat events:\n        - Safari 3.1 changed their model so that keydown is reliably repeated going forward\n        - Firefox and Opera still only repeat the keypress event, not the keydown\n        */\n        .keypress(function (e) {\n          if (this.repeating) {\n            // Respond to up/down arrow keys.\n            switch (e.keyCode) {\n            case 38: this.adjustValue(this.spinCfg.step); break; // Up\n            case 40: this.adjustValue(-this.spinCfg.step); break; // Down\n            case 33: this.adjustValue(this.spinCfg.page); break; // PageUp\n            case 34: this.adjustValue(-this.spinCfg.page); break; // PageDown\n            }\n          // we always ignore the first keypress event (use the keydown instead)\n          } else {\n            this.repeating = true;\n          }\n        })\n\n        // clear the 'repeating' flag\n        .keyup(function (e) {\n          this.repeating = false;\n          switch (e.keyCode) {\n          case 38: // Up\n          case 40: // Down\n          case 33: // PageUp\n          case 34: // PageDown\n          case 13: this.adjustValue(0); break; // Enter/Return\n          }\n        })\n\n        .bind('mousewheel', function (e) {\n          // Respond to mouse wheel in IE. (It returns up/dn motion in multiples of 120)\n          if (e.wheelDelta >= 120) {\n            this.adjustValue(this.spinCfg.step);\n          } else if (e.wheelDelta <= -120) {\n            this.adjustValue(-this.spinCfg.step);\n          }\n\n          e.preventDefault();\n        })\n\n        .change(function (e) {\n          this.adjustValue(0);\n        });\n\n      if (this.addEventListener) {\n        // Respond to mouse wheel in Firefox\n        this.addEventListener('DOMMouseScroll', function (e) {\n          if (e.detail > 0) {\n            this.adjustValue(-this.spinCfg.step);\n          } else if (e.detail < 0) {\n            this.adjustValue(this.spinCfg.step);\n          }\n\n          e.preventDefault();\n        }, false);\n      }\n    });\n  };\n  return $;\n}\n","// Todo: Update to latest version and adapt (and needs jQuery update as well): https://github.com/swisnl/jQuery-contextMenu\n// jQuery Context Menu Plugin\n//\n// Version 1.01\n//\n// Cory S.N. LaViska\n// A Beautiful Site (https://abeautifulsite.net/)\n// Modified by Alexis Deveria\n//\n// More info: https://abeautifulsite.net/2008/09/jquery-context-menu-plugin/\n//\n// Terms of Use\n//\n// This plugin is dual-licensed under the GNU General Public License\n//   and the MIT License and is copyright A Beautiful Site, LLC.\n//\nimport {isMac} from '../browser.js';\n\nexport default function ($) {\n  const win = $(window);\n  const doc = $(document);\n\n  $.extend($.fn, {\n    contextMenu (o, callback) {\n      // Defaults\n      if (o.menu === undefined) return false;\n      if (o.inSpeed === undefined) o.inSpeed = 150;\n      if (o.outSpeed === undefined) o.outSpeed = 75;\n      // 0 needs to be -1 for expected results (no fade)\n      if (o.inSpeed === 0) o.inSpeed = -1;\n      if (o.outSpeed === 0) o.outSpeed = -1;\n      // Loop each context menu\n      $(this).each(function () {\n        const el = $(this);\n        const offset = $(el).offset();\n\n        const menu = $('#' + o.menu);\n\n        // Add contextMenu class\n        menu.addClass('contextMenu');\n        // Simulate a true right click\n        $(this).bind('mousedown', function (e) {\n          const evt = e;\n          $(this).mouseup(function (e) {\n            const srcElement = $(this);\n            srcElement.unbind('mouseup');\n            if (evt.button === 2 || o.allowLeft ||\n              (evt.ctrlKey && isMac())) {\n              e.stopPropagation();\n              // Hide context menus that may be showing\n              $('.contextMenu').hide();\n              // Get this context menu\n\n              if (el.hasClass('disabled')) return false;\n\n              // Detect mouse position\n              let x = e.pageX, y = e.pageY;\n\n              const xOff = win.width() - menu.width(),\n                yOff = win.height() - menu.height();\n\n              if (x > xOff - 15) x = xOff - 15;\n              if (y > yOff - 30) y = yOff - 30; // 30 is needed to prevent scrollbars in FF\n\n              // Show the menu\n              doc.unbind('click');\n              menu.css({ top: y, left: x }).fadeIn(o.inSpeed);\n              // Hover events\n              menu.find('A').mouseover(function () {\n                menu.find('LI.hover').removeClass('hover');\n                $(this).parent().addClass('hover');\n              }).mouseout(function () {\n                menu.find('LI.hover').removeClass('hover');\n              });\n\n              // Keyboard\n              doc.keypress(function (e) {\n                switch (e.keyCode) {\n                case 38: // up\n                  if (!menu.find('LI.hover').length) {\n                    menu.find('LI:last').addClass('hover');\n                  } else {\n                    menu.find('LI.hover').removeClass('hover').prevAll('LI:not(.disabled)').eq(0).addClass('hover');\n                    if (!menu.find('LI.hover').length) menu.find('LI:last').addClass('hover');\n                  }\n                  break;\n                case 40: // down\n                  if (!menu.find('LI.hover').length) {\n                    menu.find('LI:first').addClass('hover');\n                  } else {\n                    menu.find('LI.hover').removeClass('hover').nextAll('LI:not(.disabled)').eq(0).addClass('hover');\n                    if (!menu.find('LI.hover').length) menu.find('LI:first').addClass('hover');\n                  }\n                  break;\n                case 13: // enter\n                  menu.find('LI.hover A').trigger('click');\n                  break;\n                case 27: // esc\n                  doc.trigger('click');\n                  break;\n                }\n              });\n\n              // When items are selected\n              menu.find('A').unbind('mouseup');\n              menu.find('LI:not(.disabled) A').mouseup(function () {\n                doc.unbind('click').unbind('keypress');\n                $('.contextMenu').hide();\n                // Callback\n                if (callback) callback($(this).attr('href').substr(1), $(srcElement), {x: x - offset.left, y: y - offset.top, docX: x, docY: y});\n                return false;\n              });\n\n              // Hide bindings\n              setTimeout(function () { // Delay for Mozilla\n                doc.click(function () {\n                  doc.unbind('click').unbind('keypress');\n                  menu.fadeOut(o.outSpeed);\n                  return false;\n                });\n              }, 0);\n            }\n          });\n        });\n\n        // Disable text selection\n        if ($.browser.mozilla) {\n          $('#' + o.menu).each(function () { $(this).css({MozUserSelect: 'none'}); });\n        } else if ($.browser.msie) {\n          $('#' + o.menu).each(function () { $(this).bind('selectstart.disableTextSelect', function () { return false; }); });\n        } else {\n          $('#' + o.menu).each(function () { $(this).bind('mousedown.disableTextSelect', function () { return false; }); });\n        }\n        // Disable browser context menu (requires both selectors to work in IE/Safari + FF/Chrome)\n        $(el).add($('UL.contextMenu')).bind('contextmenu', function () { return false; });\n      });\n      return $(this);\n    },\n\n    // Disable context menu items on the fly\n    disableContextMenuItems (o) {\n      if (o === undefined) {\n        // Disable all\n        $(this).find('LI').addClass('disabled');\n        return $(this);\n      }\n      $(this).each(function () {\n        if (o !== undefined) {\n          const d = o.split(',');\n          for (let i = 0; i < d.length; i++) {\n            $(this).find('A[href=\"' + d[i] + '\"]').parent().addClass('disabled');\n          }\n        }\n      });\n      return $(this);\n    },\n\n    // Enable context menu items on the fly\n    enableContextMenuItems (o) {\n      if (o === undefined) {\n        // Enable all\n        $(this).find('LI.disabled').removeClass('disabled');\n        return $(this);\n      }\n      $(this).each(function () {\n        if (o !== undefined) {\n          const d = o.split(',');\n          for (let i = 0; i < d.length; i++) {\n            $(this).find('A[href=\"' + d[i] + '\"]').parent().removeClass('disabled');\n          }\n        }\n      });\n      return $(this);\n    },\n\n    // Disable context menu(s)\n    disableContextMenu () {\n      $(this).each(function () {\n        $(this).addClass('disabled');\n      });\n      return $(this);\n    },\n\n    // Enable context menu(s)\n    enableContextMenu () {\n      $(this).each(function () {\n        $(this).removeClass('disabled');\n      });\n      return $(this);\n    },\n\n    // Destroy context menu(s)\n    destroyContextMenu () {\n      // Destroy specified context menus\n      $(this).each(function () {\n        // Disable action\n        $(this).unbind('mousedown').unbind('mouseup');\n      });\n      return $(this);\n    }\n  });\n  return $;\n}\n","function loadStylesheets(stylesheets, {\n    before: beforeDefault, after: afterDefault, favicon: faviconDefault,\n    canvas: canvasDefault, image: imageDefault = true,\n    acceptErrors\n} = {}) {\n    stylesheets = Array.isArray(stylesheets) ? stylesheets : [stylesheets];\n\n    function setupLink(stylesheetURL) {\n        let options = {};\n        if (Array.isArray(stylesheetURL)) {\n            [stylesheetURL, options = {}] = stylesheetURL;\n        }\n        let { favicon = faviconDefault } = options;\n        const {\n            before = beforeDefault,\n            after = afterDefault,\n            canvas = canvasDefault,\n            image = imageDefault\n        } = options;\n        function addLink() {\n            if (before) {\n                before.before(link);\n            } else if (after) {\n                after.after(link);\n            } else {\n                document.head.appendChild(link);\n            }\n        }\n\n        const link = document.createElement('link');\n        return new Promise((resolve, reject) => {\n            if (acceptErrors) {\n                reject = typeof acceptErrors === 'function' ? error => {\n                    acceptErrors({ error, stylesheetURL, options, resolve, reject });\n                } : resolve;\n            }\n            if (stylesheetURL.endsWith('.css')) {\n                favicon = false;\n            } else if (stylesheetURL.endsWith('.ico')) {\n                favicon = true;\n            }\n            if (favicon) {\n                link.rel = 'shortcut icon';\n                link.type = 'image/x-icon';\n\n                if (image === false) {\n                    link.href = stylesheetURL;\n                    addLink();\n                    resolve(link);\n                    return;\n                }\n\n                const cnv = document.createElement('canvas');\n                cnv.width = 16;\n                cnv.height = 16;\n                const context = cnv.getContext('2d');\n                const img = document.createElement('img');\n                img.addEventListener('error', error => {\n                    reject(error);\n                });\n                img.addEventListener('load', () => {\n                    context.drawImage(img, 0, 0);\n                    link.href = canvas ? cnv.toDataURL('image/x-icon') : stylesheetURL;\n                    addLink();\n                    resolve(link);\n                });\n                img.src = stylesheetURL;\n                return;\n            }\n            link.rel = 'stylesheet';\n            link.type = 'text/css';\n            link.href = stylesheetURL;\n            addLink();\n            link.addEventListener('error', error => {\n                reject(error);\n            });\n            link.addEventListener('load', () => {\n                resolve(link);\n            });\n        });\n    }\n\n    return Promise.all(stylesheets.map(setupLink));\n}\n\nexport default loadStylesheets;\n"],"names":["touchHandler","event","touches","changedTouches","first","type","simulatedEvent","document","createEvent","initMouseEvent","window","screenX","screenY","clientX","clientY","length","target","dispatchEvent","preventDefault","addEventListener","NS","getReverseNS","reverseNS","entries","forEach","name","URI","toLowerCase","SVGPathSeg","typeAsLetter","owningPathSegList","pathSegType","pathSegTypeAsLetter","_owningPathSegList","this","segmentChanged","prototype","classname","PATHSEG_UNKNOWN","PATHSEG_CLOSEPATH","PATHSEG_MOVETO_ABS","PATHSEG_MOVETO_REL","PATHSEG_LINETO_ABS","PATHSEG_LINETO_REL","PATHSEG_CURVETO_CUBIC_ABS","PATHSEG_CURVETO_CUBIC_REL","PATHSEG_CURVETO_QUADRATIC_ABS","PATHSEG_CURVETO_QUADRATIC_REL","PATHSEG_ARC_ABS","PATHSEG_ARC_REL","PATHSEG_LINETO_HORIZONTAL_ABS","PATHSEG_LINETO_HORIZONTAL_REL","PATHSEG_LINETO_VERTICAL_ABS","PATHSEG_LINETO_VERTICAL_REL","PATHSEG_CURVETO_CUBIC_SMOOTH_ABS","PATHSEG_CURVETO_CUBIC_SMOOTH_REL","PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS","PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL","SVGPathSegClosePath","undefined","SVGPathSegMovetoAbs","x","y","_x","_y","defineProperties","_segmentChanged","SVGPathSegMovetoRel","SVGPathSegLinetoAbs","SVGPathSegLinetoRel","SVGPathSegCurvetoCubicAbs","x1","y1","x2","y2","_x1","_y1","_x2","_y2","SVGPathSegCurvetoCubicRel","SVGPathSegCurvetoQuadraticAbs","SVGPathSegCurvetoQuadraticRel","SVGPathSegArcAbs","r1","r2","angle","largeArcFlag","sweepFlag","_r1","_r2","_angle","_largeArcFlag","_sweepFlag","SVGPathSegArcRel","SVGPathSegLinetoHorizontalAbs","defineProperty","SVGPathSegLinetoHorizontalRel","SVGPathSegLinetoVerticalAbs","SVGPathSegLinetoVerticalRel","SVGPathSegCurvetoCubicSmoothAbs","SVGPathSegCurvetoCubicSmoothRel","SVGPathSegCurvetoQuadraticSmoothAbs","SVGPathSegCurvetoQuadraticSmoothRel","createSVGPathSegClosePath","createSVGPathSegMovetoAbs","createSVGPathSegMovetoRel","createSVGPathSegLinetoAbs","createSVGPathSegLinetoRel","createSVGPathSegCurvetoCubicAbs","createSVGPathSegCurvetoCubicRel","createSVGPathSegCurvetoQuadraticAbs","createSVGPathSegCurvetoQuadraticRel","createSVGPathSegArcAbs","createSVGPathSegArcRel","createSVGPathSegLinetoHorizontalAbs","createSVGPathSegLinetoHorizontalRel","createSVGPathSegLinetoVerticalAbs","createSVGPathSegLinetoVerticalRel","createSVGPathSegCurvetoCubicSmoothAbs","createSVGPathSegCurvetoCubicSmoothRel","createSVGPathSegCurvetoQuadraticSmoothAbs","createSVGPathSegCurvetoQuadraticSmoothRel","SVGPathElement","getPathSegAtLength","distance","isFinite","Error","measurementElement","createElementNS","setAttribute","getAttribute","lastPathSegment","pathSegList","numberOfItems","removeItem","getTotalLength","SVGPathSegList","pathElement","_pathElement","_list","_parsePath","_mutationObserverConfig","attributes","attributeFilter","_pathElementMutationObserver","MutationObserver","_updateListFromPathMutations","bind","observe","takeRecords","mutationRecords","hasPathMutations","record","attributeName","disconnect","_pathSegArrayAsString","pathSeg","_writeListToPath","_checkPathSynchronizedToList","newItem","index","isNaN","_checkValidIndex","clone","splice","item","push","string","Builder","Source","_string","_currentIndex","_endIndex","_previousCommand","_skipOptionalSpaces","character","_isCurrentSpace","charAt","lookahead","_pathSegTypeFromChar","previousCommand","hasMoreData","command","peekSegmentType","exponent","integer","frac","decimal","sign","expsign","startIndex","startIntPartIndex","scanIntPartIndex","multiplier","number","Math","pow","_skipOptionalSpacesOrDelimiter","flag","flagChar","_nextCommandHelper","_parseNumber","points","arcAngle","arcLarge","_parseArcFlag","arcSweep","builder","source","initialCommandIsMoveTo","parseSegment","appendSegment","pathSegArray","_asPathString","_pathSegList","rect","$","jQuery","userAgent","SVG","createSVGRect","navigator","svg","isOpera_","opera","isWebkit_","includes","isGecko_","isIE_","isChrome_","isMac_","isTouch_","supportsSelectors_","querySelector","supportsXpath_","evaluate","supportsPathReplaceItem_","path","seglist","seg","replaceItem","err","supportsPathInsertItemBefore_","insertItemBefore","supportsGoodTextCharPos_","svgroot","svgcontent","documentElement","append","text","textContent","pos","getStartPositionOfChar","remove","supportsPathBBox_","bbox","getBBox","height","supportsHVLineContainerBBox_","path2","g","width","supportsNonScalingStroke_","retValue","cloneNode","alert","style","vectorEffect","supportsNativeSVGTransformLists_","rxform","transform","baseVal","t1","createSVGTransform","appendItem","getItem","SVGTransform","matrix","a","b","c","d","e","f","isOpera","isWebkit","isGecko","isIE","isChrome","isMac","isTouch","supportsHVLineContainerBBox","supportsNonScalingStroke","proxied","fn","attr","key","value","len","apply","arguments","i","elem","namespaceURI","Array","isArray","obj","j","aname","v","transformToString","xform","m","join","cx","cy","K","listMap_","SVGTransformList","_elem","_xforms","_update","tstr","createSVGMatrix","_init","str","re","match","replace","bits","split","valBits","valArr","letters","mtx","values","parseFloat","fname","toUpperCase","slice","_removeFromOtherLists","found","id","tl","clear","initialize","code","newxforms","removeElementFromListMap","getTransformList","t","gradientTransform","patternTransform","wAttrs","hAttrs","unitAttrs","elementContainer_","typeMap_","getTypeMap","shortFloat","val","digits","getRoundDigits","toFixed","convertUnit","unit","getBaseUnit","convertToNum","substr","num","getWidth","getHeight","sqrt","isValidUnit","selectedElement","Object","keys","some","RegExp","test","result","getElement","HistoryEventTypes","MoveElementCommand","oldNextSibling","oldParent","tagName","newNextSibling","nextSibling","newParent","parentNode","handler","handleHistoryEvent","BEFORE_APPLY","insertBefore","AFTER_APPLY","BEFORE_UNAPPLY","AFTER_UNAPPLY","InsertElementCommand","parent","removeChild","RemoveElementCommand","console","log","ChangeElementCommand","attrs","newValues","oldValues","getHref","bChangedTransform","removeAttribute","getRotationAngle","rotate","BatchCommand","stack","unapply","elems","cmd","thisElems","elements","UndoManager","historyEventHandler","handler_","undoStackPointer","undoStack","undoChangeStackPointer","undoableChangeStack","getText","attrName","p","changeset","batchCmd","changes","addSubCommand","transformPoint","isIdentity","matrixMultiply","args","reduceRight","prev","m1","multiply","abs","hasMatrixTransform","tlist","transformBox","l","w","h","tr","bl","br","minx","min","maxx","max","miny","transformListToTransform","createSVGTransformFromMatrix","parseInt","temp","mtom","getMatrix","snapToAngle","snap","PI","dx","dy","atan2","dist","snapangle","round","cos","sin","rectsIntersect","segData","uiStrings","setUiStrings","strs","assign","ui","pathFuncs","linkControlPts","pathData","editorContext_","init","editorContext","each","s","newseg","list","arr","curSeg","getGripPt","altPt","out","currentZoom","getCurrentZoom","getPointFromGrip","pt","imatrix","addPointGrip","pointGripContainer","getGripContainer","pointGrip","getElem","atts","pathNodeTooltip","appendChild","dblclick","setSegType","addCtrlGrip","pathCtrlPtTooltip","getCtrlLine","ctrlLine","getControlPoints","cpt","segItems","segs","gpt","replacePathSeg","pts","pth","segList","getSegSelector","update","segLine","segItem","ptObjToArr","smoothControlPoints","ct1","ct2","nct1","getSVGRoot","createSVGPoint","nct2","anglea","angleb","angleBetween","angleDiff","newAnglea","newAngleb","Segment","selected","ctrlpts","ptgrip","segsel","hasOwnProperty","showCtrlPts","selectCtrls","getPointGrip","full","curPts","next","nextPts","mate","anum","newType","Path","selected_pts","find","first_seg","segment","startI","nextSeg","prevSeg","startSeg","addGrip","call","newX","newY","p0x","p1x","p2x","p01x","p12x","p0y","p1y","p2y","p01y","p12y","show","closed","eachSeg","indexOf","select","last_d","selectPt","move","moveCtrl","dragctrl","setLinked","storeD","selPt","cur","Number","curX","curY","prevX","prevY","olditem","old","diffX","diffY","setType","endChanges","ctrlNum","clearSelection","addPtsToSelection","inverse","resetD","indexes","sort","grips","closedSubpath","subpathIsClosed","getPath_","removePath_","newcx","newcy","oldcx","oldcy","getRotVals","r","theta","recalcRotatedPath","currentPath","oldbox","oldbbox","box","rvals","cVals1","cVals2","Rnc","setRotate","pathMap","convertPath","toRel","curx","cury","lastM","letter","pathDSegment","morePoints","lastPoint","pnt","subpath","newPoint","firstCtrl","hasMoved","pathActions","evt","mouseTarget","startX","startY","getCurrentMode","curPt","cur_pt","dragging","shiftKey","removePtFromSelection","startsWith","parts","rubberBox","getRubberBox","setRubberBox","selectorManager","getRubberBandBox","mouseX","mouseY","stretchy","getGridSnapping","snapToGrid","drawnPath","getDrawnPath","FUZZ","clickOnPoint","px","py","getId","newpath","sSeg","absX","absY","endseg","setDrawnPath","setStarted","remapElement","newD","origD","toEditMode","contains","getContainer","getMouseTarget","last","lastx","lasty","xya","dAttr","addSvgElementFromJson","getNextId","getOpacity","mpt","movePts","rbb","ptBb","sel","pointGrip1","pointGrip2","ptX","ptY","altX","altY","lastX","lastY","element","lastPt","toSelectMode","setCurrentMode","utilsGetBBox","selPath","addToSelection","on","getSelectedElements","resetOrientation","addCommandToHistory","nodeName","n","bb","attrVal","grad","getRefElem","pt1","pt2","gCoords","newgrad","linkPoints","selPts","nums","addSeg","openPt","startItem","closer","zSeg","canDeleteNodes","deleteSeg","cleanup","remItems","count","nprev","prevType","canvas","deleteSelectedElements","cp","N","curpos","prevCtlPt","end","newpts","prevArr","newValue","diff","fixEnd","jqPluginSVG","KEYSTR","visElemsArr","domdoc_","domcontainer_","svgroot_","toXml","encode64","input","encodeUTF8","btoa","output","floor","chr1","charCodeAt","chr2","chr3","enc1","enc2","enc3","enc4","decode64","atob","decodeUTF8","String","fromCharCode","argString","decodeURIComponent","escape","unescape","encodeURIComponent","dataURLToObjectURL","dataurl","Uint8Array","Blob","URL","createObjectURL","mime","bstr","u8arr","blob","blankPageObjectURL","text2xml","sXML","dXML","DOMParser","ActiveXObject","async","loadXML","parseFromString","e2","walkTree","cbFn","nodeType","childNodes","getUrlFromAttr","substring","getAttributeNS","XLINK","setHref","setAttributeNS","findDefs","svgElement","getSVGContent","defs","getElementsByTagNameNS","ownerDocument","firstChild","getPathBBox","tot","bounds","start","P0","P1","P2","P3","calc","b2ac","t2","groupBBFix","ref","data","matched","ret","copy","children","filter","issue","getStrokedBBox","geSelectedElements","elname","extent","getExtentOfChar","getComputedTextLength","fo","closest","getPathDFromSegments","pathSegments","getPathDFromElement","rx","ry","getExtraAttributesForConvertToPath","getBBoxOfElementAsPath","eltrans","before","getBBoxWithTransform","getRotationAngleFromTransformList","hasMatrixXForm","goodBb","angleModulo90","bBoxCanBeOptimizedOverNativeGetBBox","aabox","getStrokeOffsetForBBox","sw","fullBb","maxX","maxY","minX","minY","offset","curBb","getVisibleElements","contentElems","reverse","getStrokedBBoxDefaultVisible","toRad","singleNodeValue","assignAttributes","node","suspendLength","unitCheck","ns","XML","cleanupElement","defaults","stepSize","getSnappingStep","preventClickDefault","img","click","contextMenuExtensions","injectExtendedContextMenuItemIntoDom","menuItem","shortcut","label","addScriptAtts","script","prop","url","config","importSetGlobal","returnDefault","global","svgEditor","modules","importModule","importScript","Promise","all","map","u","resolve","reject","createElement","destructor","onerror","onload","src","defer","head","vector","random","toString","revokeObjectURL","loader","href","toAbsoluteURL","Layer","group","svgElem","name_","group_","svgdoc","layerTitle","after","visible","expected","opacity","child","hrService","previousName","title","getTitleElement","empty","changeElement","#text","addLayerClass","classes","CLASS_REGEX","CLASS_NAME","HistoryRecordingService","undoManager","undoManager_","currentBatchCommand_","batchCommandStack_","batchCommand","pop","addCommand_","NO_HISTORY","visElems","RandomizeModes","randIds","LET_DOCUMENT_DECIDE","disabledElems","historyRecordingService","canvas_","undoMgr","getNewLayerName","existingLayerNames","Drawing","optIdPrefix","svgElem_","obj_num","idPrefix","releasedNums","all_layers","layer_map","current_layer","nonce_","SE","NEVER_RANDOMIZE","ALWAYS_RANDOMIZE","setNonce","XMLNS","oldObjNum","restoreOldObjNum","getElem_","front","getNumLayers","getName","getGroup","layer","finalName","oldName","setName","newpos","layerCount","oldpos","currentGroup","refGroup","identifyLayers","setCurrentLayer","getLayerName","prevGroup","startBatchCommand","layerNextSibling","removeElement","localName","moveElement","removeGroup","endBatchCommand","mergeLayer","deactivate","activate","oldLayerGroup","numchildren","orphans","layernames","childgroups","querySelectorAll","appendChildren","insertElement","ch","copyElem","layername","isVisible","bVisible","setVisible","setOpacity","el","self","newEl","fixedD","nodeValue","utilCopyElem","randomizeIds","enableRandomization","currentDrawing","getNonce","clearNonce","getCurrentDrawing","leaveContext","orig","elData","setCurrentGroup","setContext","parentsUntil","andSelf","siblings","opac","getCurrentGroup","newLayer","createLayer","cloneLayer","currentLayer","getCurrentLayer","deleteCurrentLayer","newname","drawing","setCurrentLayerName","setCurrentLayerPosition","prevVisibility","getLayerVisibility","setLayerVisibility","oldDisplay","display","getLayerByName","selElems","oldLayer","changeSvgcontent","mergeAllLayers","REVERSE_NS","svgWhiteList_","svgWhiteListNS_","elt","attNS","att","sanitizeSvg","doc","allowedAttrs","allowedAttrsNS","seAttrs","attrLocalName","attrNsURI","removeAttributeNS","props","styleAttrName","trim","styleAttrVal","hasChildNodes","remap","scalew","scaleh","doSnapping","finishUp","o","getDrawing","elName","chlist","mt","setMatrix","existing","tNew","tbox","gsvg","pstr","firstseg","currentpt","dstr","context_","updateClipPath","tx","ty","cpXform","newxlate","setTranslate","recalculateDimensions","k","noi","mxs","mNew","initial","extend","getStartTransform","oldcenter","newcenter","gangle","rm","operation","firstM","oldStartTransform","tm","sm","tmn","childTlist","setStartTransform","e2t","t2n","s2","translateOrigin","scale","translateBack","setScale","T_M","mInv","M2","clipPathsDone","uses","useElem","usexlate","newRot","em","e2m","avg","roldt","rold","rnew","rnewInv","extrat","fill","paint","gtlist","gmatrix","mStr","oldxlate","meq","meqInv","tspanChanges","svgFactory_","config_","selectorManager_","gripRadius","Selector","locked","selectorGroup","createSVGElement","selectorRect","gripCoords","reset","resize","dir","dirArr","steps","selectorGrips","shift","bShow","selectorGripsGroup","hasGrips","updateGripCursors","selectedBox","mgr","selectedGrips","strokedBbox","nbox","nbax","nbay","nbaw","nbah","rot","svgRoot","rotm","maxy","coords","rotateGripConnector","rotateGrip","SelectorManager","selectorParentGroup","rubberBandBox","selectors","selectorMap","initGroup","grip","imgPath","dims","dimensions","canvasbg","svgContent","babelHelpers.typeof","showGrips","history","postError","SvgCanvas","container","curConfig","importNode","clearSvgContentElement","show_outside_canvas","appendTo","comment","createComment","idprefix","setIdPrefix","current_drawing_","draw","allProperties","initFill","color","initStroke","initOpacity","shape","stroke_width","font_size","font_family","curShape","selectedElements","getJsonFromSvgElement","retval","createTextNode","namespace","curStyles","stroke","stroke_dasharray","stroke_linejoin","stroke_linecap","stroke_opacity","fill_opacity","elementContainer","body","inch","baseUnit","saveOptions","round_digits","getSelectedElems","pathModule","snappingStep","getDOMDocument","getDOMContainer","gridSnapping","startTransform","nsMap","eventType","EventTypes","cmdType","isApply","stdDeviation","setBlurOffsets","getZoom","svgFactory","jsonMap","ev","arg","events","noCall","releaseSelector","elemsToAdd","requestSelector","compareDocumentPosition","correspondingUseElement","MATH","HTML","rb","closed_subpath","currentMode","cm","dp","refAttrs","opacAni","restoreRefElems","removedElements","childs","getElementsByTagName","encodableImages","runExtensions","action","vars","returnArray","extensions","opts","addExtension","extFunc","ext","argObj","getPrivateMethods","callback","getIntersectionList","rubberBBox","resultList","curBBoxes","getVisibleElementsAndBBoxes","groupSvgElem","replaceWith","prepareSvg","newDoc","paths","ffClone","setRotationAngle","preventUndo","oldTransform","center","newTransform","selector","recalculateAllSelectedDimensions","currentResizeMode","isEmpty","logMatrix","rootSctm","selectOnly","removeFromSelection","elemsToRemove","newSelectedItems","selectAllInCurrentLayer","freehand","rStartX","rStartY","initBbox","sumDistance","controllPoint2","controllPoint1","bSpline","nextPos","parameter","getBsplinePoint","spline","p0","p1","p2","p3","t3","mousedown","spaceKey","button","rightClick","altKey","cloneSelectedElements","getScreenCTM","pageX","pageY","realX","realY","griptype","strokeW","slist","iswebkit","delayedStroke","ele","_stroke","setTimeout","newImage","lastGoodImgUrl","curText","mouseDown","beginUndoableChange","extResult","started","mousemove","newList","intElem","foundInd","hasMatrix","top","sy","sx","left","square","rad","STEP_COUNT","mouseMove","mouseup","tempJustSelected","justSelected","keep","factor","commaIndex","smoothPolylineIntoPath","res","mouseUp","finishUndoableChange","addedNew","aniDur","cAni","beginElement","selectNew","releaseId","setMode","originalEvent","workarea","rulerwidth","showRulers","editorFullW","editorFullH","editorW","editorH","workareaViewW","workareaViewH","wOffset","wOffsetLeft","wOffsetTop","delta","wheelDelta","detail","wZoom","hZoom","ceil","zoomlevel","topLeftOld","newCtr","setZoom","textActions","curtext","textinput","cursor","selblock","blinker","chardata","textbb","allowDbl","setCursor","focus","selectionEnd","selectionStart","charbb","setSelectionRange","setInterval","startPt","ptToScreen","endPt","setSelection","skipInput","startbb","endbb","getIndexFromPoint","charpos","getCharNumAtPosition","setCursorFromPoint","setEndSelectionFromPoint","i1","i2","screenToPt","xIn","yIn","selectAll","unbind","selectWord","ept","css","selectElem","blur","inputElem","getEndPositionOfChar","contentW","removeUnusedDefElems","defelemUses","numRemoved","alen","allEls","allLen","defelems","defelem","getIssues","issues","issueCodes","issueList","exportNoBlur","exportNoforeignObject","exportNoDashArray","content","getContext","exportNoText","descr","svgCanvasToString","nakedSvgs","svgToString","indent","unitRe","from","getResolution","nsuris","uri","attrNames","mozAttrs","images","bOneLine","embedImage","Image","load","drawImage","urldata","toDataURL","setGoodImage","open","save","canvg","rasterExport","imgType","quality","exportWindowName","cb","mimeType","done","bloburl","canvgPath","hide","contentH","dataURLType","toBlob","datauri","exportPDF","outputType","that","jsPDF","jspdfPath","modularVersion","getDocumentTitle","setProperties","docTitle","addSVG","method","getSvgString","uniquifyElems","ids","refElems","oldid","hrefs","attrnode","getAttributeNode","refid","newid","ownerElement","hreffers","hreffer","setUseData","refElem","convertGradients","convertToGroup","$elem","ts","unwrap","removeData","vb","hasMore","dupeGrads","pushGroupProperties","setSvgString","xmlString","firstElementChild","oldzoom","adoptNode","nonce","image","pa","percs","dim","importSvgString","useEl","uid","useExisting","importIds","symbol","parents","innerw","innerh","innervb","canvash","cg","resetUndoStack","linkControlPoints","getContentElem","getRootElem","getSnapToGrid","getVersion","notification","setConfig","getTitle","setGroupTitle","prepend","tsNextSibling","setDocumentTitle","newtitle","oldTitle","getEditorNS","add","setResolution","visEls","moveSelectedElements","viewBox","getOffset","setBBoxZoom","spacer","calcZoom","zoom","newzoom","selectedElems","zoomChange","getMode","getColor","curProperties","setColor","addNonG","setGradient","duplicateGrad","findDuplicateGradient","existingGrads","radAttrs","og","gradAttrs","ogAttrs","stops","ostops","stop","ostop","setPaint","jGraduate","Paint","setPaintOpacity","alpha","solidColor","setStrokePaint","setFillPaint","getStrokeWidth","setStrokeWidth","setStrokeAttr","getStyle","getFillOpacity","getStrokeOpacity","getPaintOpacity","getBlur","curCommand","filterHidden","finishChange","bCmd","setBlurNoUndo","setBlur","stdDev","complete","elemId","newblur","getBold","setBold","getItalic","setItalic","getFontFamily","setFontFamily","setFontColor","getFontColor","getFontSize","setFontSize","setTextContent","setImageURL","setsize","curHref","setLinkURL","parentsA","setRectRadius","makeHyperlink","groupSelectedElements","removeHyperlink","ungroupSelectedElement","convertToPath","changeSelectedAttributeNoUndo","moveNode","noXYElems","goodGAttrs","oldval","newrot","changeSelectedAttribute","selectedCopy","cutSelectedElements","copySelectedElements","setItem","JSON","stringify","enableContextMenuItems","pasteElements","parse","localStorage","pasted","changedIDs","checkIDs","extChanges","removeID","cbItem","ctrX","ctrY","lastClickPoint","urlArg","cmdStr","undoable","glist","gattrs","gfilter","gblur","newOpac","cblur","origCblur","suffix","chtlist","rgm","rcm","cangle","cbox","ceqm","coldc","sangle","trm","oldxform","newxform","chm","chmInv","gm","anchor","gNextSibling","moveToTopSelectedElement","moveToBottomSelectedElement","moveUpDownSelected","foundCur","toArray","constructor","copiedElements","alignSelectedElements","relativeTo","bboxes","MAX_VALUE","MIN_VALUE","curwidth","curheight","updateCanvas","bg","oldX","oldY","bgImg","new_x","new_y","old_x","old_y","d_x","d_y","setBackground","border","cycleElement","curElem","allElems","precision","langParam","setStrings","editor_","readLang","langData","more","addLangData","merge","tools","properties","layers","common","curve_segments","fitToContent","fit_to_all","fit_to_canvas","fit_to_layer_content","fit_to_sel","icon_large","icon_medium","icon_small","icon_xlarge","image_opt_embed","image_opt_ref","included_images","largest_object","page","move_elems_to","select_predefined","selected_objects","smallest_object","straight_segments","editor_img_url","editor_bg_note","background","doc_dims","editor_prefs","icon_size","image_props","language","doc_title","cancel","ok","new_doc","docprops","export_img","import_doc","open_doc","save_doc","units_and_rulers","show_rulers","base_unit","grid","snapping_onoff","snapping_stepsize","grid_color","cats","shape_cats","del","align_relative_to","circle_cx","circle_cy","circle_r","corner_radius","ellipse_cx","ellipse_cy","ellipse_rx","ellipse_ry","fill_color","image_height","image_url","image_width","move_down","rename","more_opts","move_up","line_x1","line_x2","line_y1","line_y2","linecap_butt","linecap_round","linecap_square","linejoin_bevel","linejoin_miter","linejoin_round","main_menu","mode_connect","mode_shapelib","palette_info","zoom_level","node_x","node_y","rect_height","rect_width","seg_type","move_selected","pos_x","pos_y","stroke_color","stroke_style","text_contents","toggle_stroke_tools","add_subpath","align_bottom","align_center","align_left","align_middle","align_right","align_top","bold","mode_circle","mode_ellipse","mode_eyedropper","mode_fhellipse","mode_fhpath","mode_fhrect","group_elements","make_link","set_link_url","mode_image","italic","mode_line","move_bottom","move_top","node_clone","node_delete","node_link","openclose_path","mode_path","align_to_page","mode_rect","redo","reorient_path","mode_select","source_save","mode_square","mode_text","to_path","undo","ungroup","wireframe_mode","toggle_grid","mode_zoom","no_embed","setLang","putLocale","givenParam","goodLangs","conf","pref","userLanguage","langPath","importSetGlobalDefault","hotkeys","specialKeys","which","ctrlKey","metaKey","shiftNums","version","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","191","224","219","221","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","special","q","param","bbq","A","D","C","E","F","B","G","concat","H","M","I","O","L","J","z","noEscape","deparam","true","false","null","Q","P","R","base","iframe","form","link","pushState","getState","removeState","isFunction","browser","documentMode","msie","setup","teardown","insertAfter","contentWindow","close","hash","trigger","clearTimeout","svgIcons","fixIDs","file","svgns","xlinkns","iconW","iconH","testImg","iconsMade","dataLoaded","loadAttempts","dataEl","svgz","contentDocument","getIcons","err1","parser","ajax","useFallback","responseText","noWait","isReady","getElementById","no_img","makeIcons","testSrc","dataPre","error","setIcon","icon","setID","cl","removeAttr","holder","addIcon","id_match","toImage","fallback","tempHolder","fallback_path","imgsrc","XMLSerializer","serializeToString","class","placement","resizeSvgIcons","regFile","_keyStr","svgEl","svgNum","force","idElems","newId","oldVal","newVal","getSvgIcon","uniqueClone","changeSel","size","widget","loadingStylesheets","opt","options","linearGradient","radialGradient","jGraduateDefaults","mkElem","newparent","$arguments","$this","$settings","idref","okClicked","okCallback","cancelClicked","cancelCallback","$win","addClass","html","colPicker","gradPicker","pickerTitle","clientPath","MAX","SIZEY","attrInput","curType","curGradient","gradalpha","isSolid","stopGroup","newstop","inverted","inv","fx","fy","previewRect","SIZEX","beginCoord","endCoord","centerCoord","focusCoord","showFocus","isRadial","attrval","change","cssName","stopMakerDiv","curStop","drag","delStop","stopOffset","scaleX","scaleY","cX","cY","stopMakerSVG","transImg","bgImage","xlink","stopPropagation","mouseover","spreadMethodOpt","draggingCoord","onCoordDrag","fracx","fracy","onCoordUp","numstops","checked","lastfx","lastfy","toggle","slider","ellipVal","angleVal","sliders","handle","dragSlider","stopSlider","isRad","xpos","SLIDERW","margin-left","div","posx","thisAlpha","jPicker","effects","speed","active","alphaSupport","tabs","removeClass","newGrad","curStops","tab","mkStop","stopElem","stop-color","stop-opacity","pickerD","pathbg","dragColor","remDrags","colorhandle","stopOpacity","stopColor","bottom","arg2","curS","newcolor","newopac","selectStop","xfStr","sX","SpinButton","cfg","coord","offsetParent","currentStyle","position","repeating","spinCfg","step","stepfunc","upClass","downClass","delay","interval","smallStep","adjustValue","spinClass","stateObj","tool_scale","direction","offsetWidth","_btn_width","_direction","mouseout","clearInterval","_repeat","_delay","adjust","_this","keydown","keyCode","keypress","keyup","win","menu","inSpeed","outSpeed","srcElement","allowLeft","hasClass","xOff","yOff","fadeIn","prevAll","eq","nextAll","docX","docY","fadeOut","mozilla","MozUserSelect","Slider","bar","off","timeout","setValuesFromMousePosition","barW","locX","locY","barH","rangeX","rangeY","context","changed","changeEvents","arrow","newMaxX","newMinY","newMaxY","newMinX","arrowW","arrowH","arrowOffsetX","arrowOffsetY","fireChangeEvents","set","Boolean","ahex","ColorMethods","rgbaToHex","hex","hexToRgba","newV","rgb","hsv","rgbToHsv","hsvToRgb","intToHex","validateHex","hexToInt","rgba","dec","Color","List","settings","get","current","expandable","liveUpdate","isLessThanIE7","appVersion","filters","setColorMode","colorMode","rgbMap","rgbBar","mode","colorMapDiv","colorMapL1","colorMapL2","colorBarDiv","colorBarL1","colorBarL2","colorBarL3","colorBarL4","colorBarL6","range","colorMap","colorBar","activeColorChanged","sv","hv","hs","rg","backgroundColor","activePreview","colorMapL3","colorBarL5","hva","saturatedColor","hsa","valueColor","hValue","vValue","middle","mapValueChanged","xy","colorBarValueChanged","setBG","setImg","backgroundImage","setImgLoc","setAlpha","visibility","revertColor","radioClicked","currentClicked","cancelButton","commitCallback","okButton","iconImageClicked","currentColorChanged","currentPreview","expandableColorChanged","va","iconAlpha","bindToInput","updateInputColor","moveBarMouseDown","documentMouseMove","documentMouseUp","elementStartX","pageStartX","elementStartY","pageStartY","support","boxModel","quickPickClicked","attachIFrame","table","zIndex","slideDown","removeIFrame","slideUp","popup","onselectstart","alphaPrecision","controlHtml","localization","newColor","tooltips","colors","currentColor","buttons","hue","radio","textbox","saturation","red","green","blue","tbody","MapMaps","BarMaps","picker","bindedHex","inputs","keyDown","validateKey","setValueInRange","keyUp","colorChanged","preview","quickList","quickHex","liveCallback","colorPicker","destroy","reduce","favicon","editor","callbacks","defaultPrefs","defaultExtensions","defaultConfig","svgCanvas","customExportImage","customExportPDF","curPrefs","loadSvgString","success","noop","errorLoadingSVG","loadContentAndPrefs","forceStorage","noStorageOnLoad","cookie","storage","canvasName","cached","loadFromString","storeKey","preferenceForKey","delimiter","Utils","cfgCfg","extendOrAdd","cfgObj","overwrite","preventAllURLConfig","allowInitialUserOverride","lockExtensions","setCustomHandlers","ready","showSaveWarning","exportImage","setupCurPrefs","setupCurConfig","noDefaultExtensions","grep","qstr","querystring","isEmptyObject","bkgd_color","pathConfig","preventURLContentLoading","loadFromDataURI","loadFromURL","iconId","forcedSize","extname","extPath","extName","imported","setFlyoutPositions","shower","outerWidth","uaPrefix","regex","someScript","setIconSize","selToscale","xl","hiddenPs","sides","outerHeight","cssResizeRules","ruleElem","styleStr","rules","prefix","icons","tleft","minHeight","getStylesheetPriority","stylesheet","Infinity","stylesheets","priorityA","priorityB","idx","Set","beforeDefault","afterDefault","faviconDefault","canvasDefault","imageDefault","acceptErrors","stylesheetURL","addLink","endsWith","rel","cnv","then","runCallbacks","modKey","canvMenu","paintBox","resizeTimer","curScrollPos","exportWindow","defaultImageURL","zoomInIcon","zoomOutIcon","uiContext","opener","svgEditorReadyEvent","initEvent","draggable","btnHolder","dialogContent","dbox","msg","defaultVal","changeCb","checkbox","toggleClass","ctrl","chkbx","prependTo","tooltip","resp","confirm","process_cancel","prompt","txt","setSelectMode","curr","origTitle","rIntervals","toggleHighlightLayer","layerNameToHighlight","curNames","numLayers","setLayerOpacity","populateLayers","layerlist","selLayerNames","currentLayerName","getCurrentLayerName","layerTr","layerVis","layerName","td.layervis .svg_icon","row","vis","editingsource","origSource","showSourceEditor","forSaving","multiselected","operaRepaint","setStrokeOpt","changeElem","pre","toolButtonClick","noHiding","clickSelect","dataURI","promptImgURL","cancelDeletes","curhref","enterNewImgURL","updateRulers","scanvas","contentElem","isX","lentype","contentDim","$hcanvOrig","$hcanv","hcanv","rulerLen","totalLen","ctx","ctxArr","ctxArrNum","fillStyle","fillRect","uMulti","rawM","multi","bigInt","font","rulerD","labelPos","ctxNum","curD","moveTo","lineTo","decs","fillText","part","subD","lineNum","strokeStyle","wArea","cnvs","wOrig","hOrig","oldCtr","scrollLeft","scrollTop","canvas_expansion","oldCanY","oldCanX","newCanY","newCanX","ratio","scrollX","scrollY","scroll","storagePrompt","storagePromptClosed","updateToolButtonState","bNoFill","bNoStroke","buttonsNeedingStroke","buttonsNeedingFillAndStroke","hasEnabled","updateContextPanel","isNode","menuItems","blurval","point","getNodePoint","segType","noPath","panels","linkHref","curPanel","bv","disableContextMenuItems","getUndoStackSize","getRedoStackSize","updateWireFrame","supportsNonSS","rule","curContext","updateTitle","newTitle","isLayer","zoomDone","zoomChanged","autoCenter","zInfo","changeZoom","ctl","delegate","prepPaints","prep","flyoutFuncs","setFlyoutTitles","setupFlyouts","holders","holdSel","btnOpts","showSel","def","isDefault","func","flyoutIsSelected","currentOperation","tool","timer","time","animate","is","makeFlyoutHolder","addAltDropDown","dropUp","seticon","onButton","hover","multiclick","extsPreLang","gWidth","swidth","opacPerc","editmode","ang","isSvgElem","wind","download","note","saveFromBrowser","defsFailOnSave","location","noteTheseIssues","popupWindowBlocked","dataurlstring","linkStr","cbCalled","resizeDone","cbReady","langReady","langChanged","lang","runCallback","btnSelects","context_tools","contId","container_id","panel","defval","colnum","inp","spindata","placementObj","svgicons","btn","svgicon","tlsId","cls","flyoutHolder","curH","showBtn","refData","refBtn","includeWith","Actions","getButtonData","fallbackObj","setInputElem","blocks","changeOpacity","changeBlur","noUndo","panning","keypan","promptMoveLayerOnce","destLayer","selectedIndex","confirmStr","QmoveElemsToLayer","moveToLayer","moveSelectedToLayer","invalidAttrValGiven","unitData","setPanning","overlay","jsHover","setClick","listItems","addDropDown","perc","unfocus","slideStart","clickFHPath","clickLine","clickSquare","clickRect","clickFHRect","clickCircle","clickEllipse","clickFHEllipse","clickImage","clickZoom","zoomImage","dblclickZoom","clickText","clickPath","deleteSelected","cutSelected","copySelected","pasteInCenter","moveToTopSelected","moveToBottomSelected","reorientPath","reorient","enterNewLinkURL","moveSelected","linked","clonePathNode","deletePathNode","addSubPath","sp","opencloseSubPath","selectNext","selectPrev","rotateSelected","cw","clickClear","QwantToClear","clickBold","clickItalic","loadingURL","clickExport","openExportWindow","loadingImage","exportWindowType","exportWindowCt","popHTML","popURL","clickOpen","clickImport","clickUndo","clickRedo","clickGroup","clickClone","clickAlign","clickWireframe","wfRules","curClass","allTools","preferences","showDocProperties","hideSourceEditor","saveSourceEditor","saveChanges","QerrorsRevertToSource","hideDocProperties","hidePreferences","saveDocProperties","noContentToFitTo","savePreferences","gridColor","resetScrollPos","cancelOverlays","QignoreSourceChanges","winWh","curval","shortcutButtons","colorPickerCSS","jGraduatePath","PaintBox","paintColor","paintOpacity","docElem","ptype","fillAttr","gPaint","defColor","getPaint","testEl","blurTest","deleteLayer","moveLayer","total","curIndex","stdDeviationX","featNotSupported","uniqName","hasLayer","enterUniqueLayerName","newName","dupeLayerName","enterNewLayerName","layerHasThatName","renameCurrentLayer","sidedrag","sidedragging","allowmove","changeSidePanelWidth","rulerX","resizeSidePanel","deltaX","sideWidth","toggleSidePanel","wh","toolButtons","keyAssocs","saveOpts","hidekey","curBg","canvasBg","blk","isBg","flyouts","fH","keyval","pd","keyStr","modBits","mod","lastChild","setAll","itool","initTool","preTool","regTool","wireframe","showlayers","origVal","sugVal","increasing","contextMenu","handlerKey","lmenuFunc","enableOrDisableClipboard","svgeditClipboard","disableContextMenu","no_save_warning","returnValue","unsavedChanges","getUIStrings","openPrep","QwantToOpen","FileReader","importImage","dataTransfer","files","reader","onloadend","newElement","readAsText","imgWidth","imgHeight","offsetHeight","readAsDataURL","imgImport","allStrings","renameLayer","setTitles","dest","protocol","disableUI","featList","cache","xhr","stat","status","URLloadFail","base64"],"mappings":"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"}